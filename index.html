<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link href="style.css" rel="stylesheet" type="text/css" /><title>Microsoft Power BI Cookbook, Second Edition (for pre sume)</title></head><body><div class="calibre1" id="calibre_link-1322">
<div id="calibre_link-1323" class="calibre2">
<div id="calibre_link-1324" class="calibre3"><div id="calibre_link-1325" class="calibre4">
    <p class="book-title--packt">Microsoft Power BI Cookbook</p>
    <p class="book-title--packt">Second Edition</p>
    <p class="book-title--packt">Gain expertise in Power BI with over 90 hands-on recipes, tips, and use cases</p>
    <p class="book-title--packt">Greg Deckler</p>
    <p class="book-title--packt">Brett Powell</p>
    <p class="book-title--packt"><img src="images/000156.jpg" alt="" width="272" height="86" class="calibre5" /></p>
    <p class="book-title--packt">BIRMINGHAM&mdash;MUMBAI</p>
<p class="eop"></p>
    <p class="book-title--packt">Microsoft Power BI Cookbook</p>
    <p class="book-title--packt">Second Edition</p>
    <p class="book-title--packt">Copyright Â© 2021 Packt Publishing</p>
    <p class="book-title--packt"><em class="italic">All rights reserved</em>. No part of this book may be reproduced, stored in a retrieval system, or transmitted in any form or by any means, without the prior written permission of the publisher, except in the case of brief quotations embedded in critical articles or reviews.</p>
    <p class="book-title--packt">Every effort has been made in the preparation of this book to ensure the accuracy of the information presented. However, the information contained in this book is sold without warranty, either express or implied. Neither the authors, nor Packt Publishing or its dealers and distributors, will be held liable for any damages caused or alleged to have been caused directly or indirectly by this book.</p>
    <p class="book-title--packt">Packt Publishing has endeavored to provide trademark information about all of the companies and products mentioned in this book by the appropriate use of capitals. However, Packt Publishing cannot guarantee the accuracy of this information.</p>
    <p class="book-title--packt"><strong class="screentext">Producer:</strong> Suman Sen</p>
    <p class="book-title--packt"><strong class="screentext">Acquisition Editor &ndash; Peer Reviews:</strong> Saby Dsilva</p>
    <p class="book-title--packt"><strong class="screentext">Project Editor:</strong> Parvathy Nair</p>
    <p class="book-title--packt"><strong class="screentext">Content Development Editor:</strong> Alex Patterson</p>
    <p class="book-title--packt"><strong class="screentext">Copy Editor:</strong> Safis Editor</p>
    <p class="book-title--packt"><strong class="screentext">Technical Editor:</strong> Aditya Sawant</p>
    <p class="book-title--packt"><strong class="screentext">Proofreader:</strong> Safis Editor</p>
    <p class="book-title--packt"><strong class="screentext">Indexer:</strong> Manju Arasan</p>
    <p class="book-title--packt"><strong class="screentext">Presentation Designer:</strong> Ganesh Bhadwalkar</p>
    <p class="book-title--packt">First published: September 2017</p>
    <p class="book-title--packt">Second edition: September 2021</p>
    <p class="book-title--packt">Production reference: 2141022</p>
    <p class="book-title--packt">Published by Packt Publishing Ltd.</p>
    <p class="book-title--packt">Livery Place</p>
    <p class="book-title--packt">35 Livery Street</p>
    <p class="book-title--packt">Birmingham</p>
    <p class="book-title--packt">B3 2PB, UK.</p>
    <p class="book-title--packt">ISBN 978-1-80181-304-4</p>
    <p class="book-title--packt"><a href="http://www.packt.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">www.packt.com</span></a></p>
<p class="eop"></p>
    <h1 id="calibre_link-1326" class="introduction-title--packt">Contributors</h1>
    <h1 id="calibre_link-1327" class="title">About the authors</h1>
    <p class="book-title--packt"><strong class="screentext">Greg Deckler</strong> is a Vice President at Fusion Alliance and has been a professional of consulting services for over 27 years. Recognized as an expert in Power BI, Greg is a six-time Microsoft MVP for the Data Platform and an active member of the Power BI Community site with over 5,000 solutions authored and hundreds of Quick Measure Gallery submissions. Greg founded the Columbus Azure ML and Power BI User Group in Columbus, OH in 2016 and continues to hold regularly monthly meetings.</p>
    <p class="acknowledgement--packt">I would like to thank the dynamic and vibrant Power BI community as a whole and especially all of the Super Users and my User Group members. Finally, I'd like to thank my son, Rocket, for keeping me supplied with excellent graphics and videos!</p>
    <p class="book-title--packt"><strong class="screentext">Brett Powell</strong> owns Frontline Analytics LLC, a data and analytics consultancy specializing in the Microsoft data platform. Brett has over ten years of experience in business intelligence and data warehouse projects as both a developer and technical architect. In addition to project engagements, Brett shares technical tips and examples via his popular <em class="italic">Insights Quest</em> blog and has authored two commercially successful books &ndash; <em class="italic">Mastering Microsoft Power BI </em>and<em class="italic"> Microsoft Power BI Cookbook</em>.</p>
    <p class="acknowledgement--packt">I'd first like to acknowledge and praise Jesus Christ, my Lord and Savior, for blessing me with these opportunities and for loving me and guiding me each day. I'd also like to thank my mother, Cathy, and brother Dustin, for their endless support and encouragement. Finally, I'd like to thank Packt for their efforts to produce quality, valuable content.</p>
<p class="eop"></p>
    <h1 id="calibre_link-1328" class="title">About the reviewer</h1>
    <p class="book-title--packt"><strong class="screentext">David R. Eldersveld</strong> is a Technical Specialist at Microsoft currently focused on Power BI. Prior to joining Microsoft, he was a Data Platform MVP and spent nearly ten years as a data and analytics consultant with CapstoneBI and BlueGranite. David has contributed to technical communities as a blogger, speaker, and contributor to <em class="italic">Workout Wednesday's</em> Power BI challenges.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-1170">
<div id="calibre_link-1329" class="calibre2">
<div id="calibre_link-1330" class="calibre3"><nav id="calibre_link-1331" type="toc" class="calibre7">
    <h2 class="calibre8">Contents</h2>
    <ol class="calibre9">
      <li class="calibre10"><a href="#calibre_link-1171" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Preface</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1172" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Who this book is for</a></li>
          <li class="calibre10"><a href="#calibre_link-1173" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">What this book covers</a></li>
          <li class="calibre10"><a href="#calibre_link-1174" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">To get the most out of this book</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1175" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Get in touch</a></li>
        </ol>
      </li>
      <li value="1" class="calibre12"><a href="#calibre_link-1176" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Configuring Power BI&nbsp;Tools</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1177" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1178" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Installing and Configuring Power BI Desktop</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1179" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Creating an On-Premises Data Gateway</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1180" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Installing Analyze in Excel from the Power BI Service </a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1181" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Installing and Configuring Additional Tools</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1182" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1183" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Accessing and Retrieving Data</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1184" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1185" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Viewing and Analyzing M Functions</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1186" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Managing Queries and Data Sources</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1187" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Using DirectQuery</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1188" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Importing Data</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1189" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Applying Multiple Filters</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1190" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Selecting and Renaming Columns</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1191" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Transforming and Cleansing Data</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1192" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Creating Custom Columns</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1193" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Combining and Merging Queries</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1194" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Selecting Column Data Types</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1195" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Visualizing the M library</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1196" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Profiling Source Data</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1197" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Diagnosing Queries</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1198" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1199" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Building a Power BI Data Model</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1200" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1201" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Designing a Data Model</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1202" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Implementing a Data Model</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1203" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Creating Relationships</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1204" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Configuring Model Metadata</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1205" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Hiding Columns and Tables</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1206" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Enriching a Model with DAX</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1207" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Supporting Virtual Table Relationships</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1208" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Creating Hierarchies and Groups</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1209" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Designing Column Level Security</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1210" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Leveraging Aggregation Tables</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1211" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1212" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Authoring Power BI&nbsp;Reports</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1213" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1214" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Building Rich and Intuitive Reports</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1215" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Filtering at Different Scopes</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1216" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Integrating Card visualizations</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1217" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Using Slicers</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1218" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Controlling Visual Interactions</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1219" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Utilizing Graphical Visualizations</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1220" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Creating Table and Matrix visuals</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1221" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Enhancing Reports</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1222" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Formatting Reports for Publication</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1223" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Designing Mobile Layouts</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1224" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Creating Paginated Reports</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1225" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1226" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Working in the Service</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1227" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1228" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Building a Dashboard</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1229" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Preparing for Q&amp;A</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1230" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Adding Alerts and Subscriptions</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1231" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Deploying Content from Excel and SSRS</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1232" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Streaming Datasets</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1233" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Authoring Dataflows</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1234" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1235" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Getting Serious with Date Intelligence</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1236" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1237" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Building a Date Dimension Table</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1238" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Preparing the Date Dimension via the Query Editor</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1239" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Authoring Date Intelligence Measures</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1240" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Developing Advanced Date Intelligence Measures</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1241" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Simplifying Date Intelligence with DAX and Calculated Tables</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1242" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Leveraging Calculation Groups</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1243" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1244" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Parameterizing Power BI Solutions</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1245" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1246" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Filtering reports dynamically</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1247" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Leveraging query parameters</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1248" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Working with templates</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1249" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Converting static queries to dynamic functions</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1250" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Capturing user selections with parameter tables</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1251" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Forecasting with what-if analysis</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1252" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1253" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Implementing Dynamic User-Based Visibility in&nbsp;Power BI</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1254" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1255" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Capturing Current User Context</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1256" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Defining RLS Roles and Filter Expressions</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1257" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Designing Dynamic Security Models</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1258" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Building Dynamic Security for DirectQuery</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1259" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Displaying the Current Filter Context</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1260" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Avoiding Manual User Clicks</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1261" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1262" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Applying Advanced Analytics and Custom&nbsp;Visuals</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1263" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1264" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Incorporating Advanced Analytics</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1265" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Enriching Content with Custom Visuals and Quick Insights</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1266" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Creating Geospatial Mapping with ArcGIS Maps</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1267" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Democratizing Artificial Intelligence</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1268" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Building Animation and Storytelling</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1269" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Embedding Statistical Analyses </a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1270" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Grouping and Binning</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1271" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Detecting and Analyzing Clusters</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1272" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Forecasting and Anomaly Detection</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1273" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Using R and Python Visuals</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1274" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1275" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Administering and Monitoring Power BI</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1276" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1277" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Creating a centralized IT monitoring solution with Power BI</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1278" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Constructing a monitoring, visualization, and analysis layer</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1279" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Importing and visualizing dynamic management view (DMV) data</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1280" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Increasing DBA productivity</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1281" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Providing documentation</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1282" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Analyzing SSAS tabular databases and gateways</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1283" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Analyzing Extended Events</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1284" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Visualizing log file data</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1285" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Leveraging the Power BI PowerShell Module</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1286" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1287" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Enhancing and Optimizing Existing Power BI Solutions</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1288" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1289" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Enhancing Data Model Scalability and Usability</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1290" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Improving DAX Measure Performance</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1291" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Pushing Query Processing Back to Source Systems</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1292" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Strengthening Data Import and Integration Processes</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1293" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Isolating and Documenting DAX Expressions</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1294" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Improving Data Load Speeds with Incremental Refresh</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1295" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1296" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Deploying and Distributing Power BI Content</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1297" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1298" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Preparing for Content Creation and Collaboration</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1299" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Managing Content between Environments</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1300" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Sharing Content with Colleagues</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1301" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Configuring Workspaces</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1302" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Configuring On-Premises Gateway Data Connections</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1303" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Publishing Apps</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1304" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Publishing Reports to the Public Internet</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1305" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Enabling the Mobile Experience</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1306" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Distributing Content with Teams</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1307" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre12"><a href="#calibre_link-1308" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Integrating Power BI with Other Applications</a>
        <ol class="calibre11">
          <li class="calibre10"><a href="#calibre_link-1309" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Technical Requirements</a></li>
          <li class="calibre10"><a href="#calibre_link-1310" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Integrating SSRS and Excel</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1311" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Migrating from Power Pivot for Excel Data to Power BI</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1312" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Accessing and Analyzing Power BI Datasets in Excel</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1313" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Building Power BI Reports into PowerPoint Presentations</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1314" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Connecting to Azure Analysis Services</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1315" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Integrating with Power Automate and Power Apps</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1316" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Leveraging Dataverse and Dynamics 365</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1317" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Connecting Dynamics 365 Finance and Operations and the Power Platform</a>
          </li>
          <li class="calibre10"><a href="#calibre_link-1318" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Conclusion</a></li>
        </ol>
      </li>
      <li class="calibre10"><a href="#calibre_link-1319" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Other Book You&nbsp;May&nbsp;Enjoy</a>
      </li>
      <li class="calibre10"><a href="#calibre_link-1320" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Index</a></li>
    </ol>
  </nav>
  <nav type="landmarks" id="calibre_link-1332" hidden="" class="calibre7">
    <h1 class="title">Landmarks</h1>
    <ol class="calibre9">
      <li class="calibre12">
        <a type="cover" href="cover.xhtml" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Cover</a>
      </li>
      <li class="calibre12">
        <a type="index" href="#calibre_link-1321" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">Index</a>
      </li>
    </ol>
  </nav>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-0">
<div id="calibre_link-1333" class="calibre2">
<div id="calibre_link-1334" class="calibre3"><div id="calibre_link-1335" class="calibre4">
    <h1 id="calibre_link-1171" class="introduction-title--packt">Preface</h1>
    <p class="book-title--packt">Microsoft Power BI is a collection of business intelligence and analytics applications and services designed to work in coordination with each other to provide visual, interactive insights into data.</p>
    <p class="book-title--packt">This book provides detailed, step-by-step technical examples of using all the primary Power BI tools and features and also demonstrates end-to-end solutions that leverage and integrate with Power BI technologies and services. You will become familiar with Power BI development tools and services; go deep into data connectivity and transformation, modeling, visualization and analytical capabilities of Power BI; and see Power BI's functional programming languages of DAX and M come alive to deliver powerful solutions that address challenging scenarios common to business intelligence.</p>
    <p class="book-title--packt">This book is designed to excite and empower you to get more out of Power BI via detailed, step-by-step recipes, advanced design and development tips, and guidance on enhancing existing Power BI projects. </p>
    <p class="book-title--packt">The second edition of this book includes even more recipes covering the latest enhancements and integrations to Power BI. All other recipes have been updated and revised to make the recipes more detailed, easier to follow, and entirely based on the stock Adventure Works DW database. </p>
    <div class="calibre13"></div><h1 id="calibre_link-1172" class="title">Who this book is for</h1>
    <p class="book-title--packt">This book is for business intelligence professionals that want to enhance their knowledge of Power BI design and development while increasing the value of the Power BI solutions they deliver. Those interested in quick resolutions to common challenges and a reference guide to Power BI features and design patterns are certain to find this book a useful resource.</p>
    <div class="calibre13"></div><h1 id="calibre_link-1173" class="title">What this book covers</h1>
    <p class="book-title--packt"><em class="italic">Chapter 1</em>, <em class="italic">Configuring Power BI Tools</em>, covers the installation and configuration of the primary tools and services that BI professionals utilize to design and develop Power BI content, including Power BI Desktop, the On-Premises Data Gateway, Analyze in Excel, DAX Studio, Tabular Editor, and ALM Toolkit.</p>
    <p class="book-title--packt"><em class="italic">Chapter 2</em>, <em class="italic">Accessing and Retrieving Data</em>, dives into Power BI Desktop's Get Data experience and walks through the process of establishing and managing data source connections and queries.</p>
    <p class="book-title--packt"><em class="italic">Chapter 3</em>, <em class="italic">Building a Power BI Data Model</em>, explores the primary processes of designing and developing robust data models.</p>
    <p class="book-title--packt"><em class="italic">Chapter 4</em>, <em class="italic">Authoring Power BI Reports</em>, develops and describes the most fundamental report visualizations and design concepts. Additionally, guidance is provided to enhance and control the user experience when consuming and interacting with Power BI reports in the Power BI service as well as on mobile devices.</p>
    <p class="book-title--packt"><em class="italic">Chapter 5</em>, <em class="italic">Working in the Service</em>, covers Power BI dashboards constructed to provide simple, at-a-glance monitoring of critical measures and high-impact business activities.</p>
    <p class="book-title--packt"><em class="italic">Chapter 6</em>, <em class="italic">Getting Serious with Date Intelligence</em>, contains recipes for preparing a data model to support robust date intelligence as well as recipes for authoring custom date intelligence measures.</p>
    <p class="book-title--packt"><em class="italic">Chapter 7</em>, <em class="italic">Parameterizing Power BI Solutions</em>, covers both standard parameterization features and techniques in Power BI as well as more advanced custom implementations.</p>
    <p class="book-title--packt"><em class="italic">Chapter 8</em>, <em class="italic">Implementing Dynamic User-Based Visibility in Power BI</em>, contains detailed examples of building and deploying dynamic, user-based security for both import and DirectQuery models as well as developing dynamic filter context functionality to enhance the user experience.</p>
    <p class="book-title--packt"><em class="italic">Chapter 9</em>, <em class="italic">Applying Advanced Analytics and Custom Visuals</em>, contains a broad mix of recipes highlighting many of the latest and most popular custom visualizations and advanced analytics features of Power BI.</p>
    <p class="book-title--packt"><em class="italic">Chapter 10</em>, <em class="italic">Administering and Monitoring Power BI</em>, highlights the most common and impactful administration data sources including Windows Performance Monitor, SQL Server Query Store, the Microsoft On-Premises Data Gateway, the MSDB system database, Extended Events, Office 365 audit log, and Power BI REST API.</p>
    <p class="book-title--packt"><em class="italic">Chapter 11</em>, <em class="italic">Enhancing and Optimizing Existing Power BI Solutions</em>, contains top data modeling, DAX measure, and M query patterns to enhance the performance, scalability, and reliability of Power BI datasets.</p>
    <p class="book-title--packt"><em class="italic">Chapter 12</em>, <em class="italic">Deploying and Distributing Power BI Content</em>, contains detailed examples and considerations for deploying and distributing Power BI content via the Power BI service and Power BI mobile applications.</p>
    <p class="book-title--packt"><em class="italic">Chapter 13</em>, <em class="italic">Integrating Power BI with Other Applications</em>, highlights new and powerful integrations between Power BI, SSAS, SSRS, Excel, PowerPoint, PowerApps, Power Automate, and Dynamics 365.</p>
    <h1 id="calibre_link-1174" class="title">To get the most out of this book</h1>
    <ul class="calibre9">
      <li class="bullet">Some prior knowledge of Power BI is recommended.</li>
      <li class="bullet">A Power BI Desktop and Power BI service account (both free).</li>
      <li class="bullet">Tabular Editor 2.x (free).</li>
      <li class="bullet">DAX Studio (free).</li>
      <li class="bullet">SQL Server (any edition, including Express and Developer, which are free) with the <strong class="screentext">AdventureWorksDW2019</strong> database installed. This database is a free download and instructions for installing are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a>.</li>
    </ul>
    <h2 id="calibre_link-1336" class="calibre8">Download the example code files</h2>
    <p class="book-title--packt">The code bundle for the book is hosted on GitHub at <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a>. We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/</span></a>. Check them out!</p>
    <h2 id="calibre_link-1337" class="calibre8">Download the color images</h2>
    <p class="book-title--packt">We also provide a PDF file that has color images of the screenshots/diagrams used in this book. You can download it here: <a href="https://static.packt-cdn.com/downloads/9781801813044_ColorImages.pdf" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://static.packt-cdn.com/downloads/9781801813044_ColorImages.pdf</span></a>.</p>
    <h2 id="calibre_link-1338" class="calibre8">Conventions used</h2>
    <p class="book-title--packt">There are a number of text conventions used throughout this book.</p>
    <p class="book-title--packt"><code class="code-in-text--packt">CodeInText</code>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. For example; "After completing these steps, the reports all have a live connection back to the dataset, <code class="code-in-text--packt">CH5_R1_SalesAndFinanceDataset</code>."</p>
    <p class="book-title--packt">A block of code is set as follows:</p>
    <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Data = Source{[Schema="dbo",Item="vCH3R2_Products"]}[Data]
in
    Data
</code></pre>
    <p class="book-title--packt">When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:</p>
    <pre class="programlisting"><code class="hljs"><span><strong class="screentext">Products Rows (Sales)</strong></span> = CALCULATE(COUNTROWS('Products'),'Internet Sales') 
</code></pre>
    <p class="book-title--packt"><strong class="screentext">Bold</strong>: Indicates a new term, an important word, or words that you see on the screen, for example, in menus or dialog boxes, also appear in the text like this. For example: "The <strong class="screentext">Manage roles</strong> dialog box includes the ability to set <strong class="screentext">Precedence</strong>."</p>
    <div class="pcalibre4 pcalibre5 note">
      <p class="book-title--packt">Warnings or important notes appear like this.</p>
    </div>
    <div class="pcalibre4 pcalibre5 packt_tip">
      <p class="book-title--packt">Tips and tricks appear like this.</p>
    </div>
    <h1 id="calibre_link-1175" class="title">Get in touch</h1>
    <p class="book-title--packt">Feedback from our readers is always welcome.</p>
    <p class="book-title--packt"><strong class="screentext">General feedback</strong>: Email <code class="code-in-text--packt">feedback@packtpub.com</code>, and mention the book's title in the subject of your message. If you have questions about any aspect of this book, please email us at <code class="code-in-text--packt">questions@packtpub.com</code>.</p>
    <p class="book-title--packt"><strong class="screentext">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book we would be grateful if you would report this to us. Please visit, <a href="http://www.packtpub.com/submit-errata" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://www.packtpub.com/submit-errata</span></a>, selecting your book, clicking on the Errata Submission Form link, and entering the details.</p>
    <p class="book-title--packt"><strong class="screentext">Piracy</strong>: If you come across any illegal copies of our works in any form on the Internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <code class="code-in-text--packt">copyright@packtpub.com</code> with a link to the material.</p>
    <p class="book-title--packt"><strong class="screentext">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit <a href="http://authors.packtpub.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://authors.packtpub.com</span></a>.</p>
  </div>
  <div id="calibre_link-1339" class="calibre4">
    <h1 id="calibre_link-1340" class="title">Share Your Thoughts</h1>
    <p class="book-title--packt">Once you've read <em class="italic">Microsoft Power BI Cookbook, Second Edition</em>, we'd love to hear your thoughts! <a href="https://www.packtpub.com/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">Please click here to go straight to the Amazon review page</span></a> for this book and share your feedback.</p>
    <p class="book-title--packt">Your review is important to us and the tech community and will help us make sure we're delivering excellent quality content.</p>

    <h1 class="heading">Download a free PDF copy of this book</h1>
<p class="book-title--packt">Thanks for purchasing this book!</p>
<p class="book-title--packt">Do you like to read on the go but are unable to carry your print books everywhere? Is your eBook purchase not compatible with the device of your choice?</p>
<p class="book-title--packt">Donât worry, now with every Packt book you get a DRM-free PDF version of that book at no cost.</p>
<p class="book-title--packt">Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into your application.</p>
<p class="book-title--packt">The perks donât stop there, you can get exclusive access to discounts, newsletters, and great free content in your inbox daily</p>
<p class="book-title--packt">Follow these simple steps to get the benefits:</p>
    <ol class="calibre9">
      <li class="calibre12">Scan the QR code or visit the link below
      <figure class="mediaobject"><img src="images/000218.png" alt="" class="calibre14" /></figure>
<p class="normal"><a href="https://packt.link/free-ebook/9781801813044" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://packt.link/free-ebook/9781801813044</span></a></p></li>
      <li class="calibre12">Submit your proof of purchase</li>
      <li class="calibre12">Thatâs it! Weâll send your free PDF and other benefits to your email directly</li>
    </ol>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-1">
<div id="calibre_link-1341" class="calibre2">
<div id="calibre_link-1342" class="calibre3"><div id="calibre_link-1343" class="calibre4">
    <h1 class="heading">1</h1>
    <h1 id="calibre_link-1176" class="title">Configuring Power BI&nbsp;Tools</h1>
    <p class="book-title--packt">Power BI is a suite of business analytics tools and services that work together to access data sources, shape, analyze, and visualize data, and share insights. Although not all tools are required for all projects or deployments of Power BI, synergies are available by utilizing the unique features of multiple tools as part of integrated solutions encompassing diverse data sources and visualization types.</p>
    <p class="book-title--packt">In this chapter, we walk through the installation and configuration of the primary tools and services <strong class="screentext">business intelligence</strong> (<strong class="screentext">BI</strong>) professionals utilize to design and develop Power BI content. This includes official Microsoft tools such as Power BI Desktop, the on-premises data gateway, and Analyze in Excel, as well as third-party tools such as DAX Studio, the ALM Toolkit, and Tabular Editor. Since Power BI tools and services are regularly updated with new features and enhancements, resources are identified to stay up to date and to best take advantage of these tools for your projects.</p>
    <p class="book-title--packt">The recipes in this chapter are as follows:</p>
    <ul class="calibre9">
      <li class="bullet">Installing and Configuring Power BI Desktop</li>
      <li class="bullet">Creating an On-Premises Data Gateway</li>
      <li class="bullet">Installing Analyze in Excel from the Power BI Service</li>
      <li class="bullet">Installing and Configuring Additional Tools</li>
    </ul>
    <h1 id="calibre_link-1177" class="title">Technical Requirements</h1>
    <p class="book-title--packt">It is assumed that the reader has access to a Power BI Pro license, rights to download and install the development tools on their machine, and has the necessary access and rights to deploy and manage content in the Power BI service and utilize the Power BI mobile applications. </p>
    <p class="book-title--packt">Power BI licensing options and assigning and managing these rights are outside the scope of this book. In addition, the following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">A Windows PC running Windows 10 version 14393 or higher. There is no Power BI Desktop for Apple computers or operating systems.</li>
      <li class="bullet">Microsoft Excel.</li>
      <li class="bullet">Ensure that you have at least 10 GB of disk space available; the Power BI Desktop download is up to 600 MB in size and the installed application is over 1.5 GB.</li>
      <li class="bullet">A Power BI login for the Power BI service.</li>
    </ul>
    <p class="book-title--packt">Additionally, the Microsoft on-premises data gateway requires the following:</p>
    <ul class="calibre9">
      <li class="bullet">.NET Framework 4.7.2 (Gateway release December 2020 and earlier)</li>
      <li class="bullet">.NET Framework 4.8 (Gateway release February 2021 and later)</li>
      <li class="bullet">A 64-bit version of Windows 8 or later or a 64-bit version of Windows Server 2012 R2 or later with&nbsp;current TLS 1.2 and cipher suites</li>
      <li class="bullet">4 GB disk space for&nbsp;performance monitoring&nbsp;logs (in the default configuration)</li>
    </ul>
    <h1 id="calibre_link-1178" class="title">Installing and Configuring Power BI Desktop</h1>
    <p class="book-title--packt">Power BI Desktop is the primary tool used to develop the visual and analytical content that is then deployed <a id="calibre_link-768" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and collaborated on in the Power BI service, embedded in other applications and portals, or even shared on the public internet. Although <a id="calibre_link-769" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI Desktop runs as a single application, it includes three <a id="calibre_link-776" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>tightly integrated components with their own options and settings:</p>
    <ul class="calibre9">
      <li class="bullet">The Power Query and Power Query Editor experience, with its underlying M language and data mashup engine.</li>
      <li class="bullet">The&nbsp;Analysis Services&nbsp;tabular data modeling engine and its DAX analytical language.</li>
      <li class="bullet">The interactive reporting and visualization engine.</li>
    </ul>
    <p class="book-title--packt">Configuring and leveraging these capabilities, in addition to advanced analytics and customization features such as R, Python, mobile layout, and natural language queries, makes it possible to build robust and elegant BI and analytics solutions.</p>
    <h2 id="calibre_link-1344" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">Most organizations restrict the ability of employees to install software such as Power BI Desktop onto their corporate devices. These organizations typically define a policy and process for pushing a particular version of Power BI Desktop to all user devices or to certain groups of users thus avoiding compatibility issues and ensuring users have access to recent features.</p>
    <h2 id="calibre_link-1345" class="calibre8">How to install and configure Power BI Desktop</h2>
    <p class="book-title--packt">There are actually <a id="calibre_link-770" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>three different versions of the Power BI Desktop application, as follows:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop (Microsoft Store app)</li>
      <li class="bullet">Power BI Desktop (Microsoft Installer)</li>
      <li class="bullet">Power BI Desktop RS (Report Server Edition)</li>
    </ul>
    <p class="book-title--packt">The preferred method <a id="calibre_link-777" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of installation is by using the Microsoft Store app. In order to install Power BI Desktop from the Microsoft Store, execute the following:</p>
    <ol class="calibre9">
      <li class="calibre12">Open the Microsoft Store app and search for Power BI Desktop. Alternatively, you can enter <a href="https://aka.ms/pbidesktop" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://aka.ms/pbidesktop</span></a> into any browser bar and the Microsoft Store app will automatically open to the Power BI Desktop app, as shown in <em class="italic">Figure 1.1</em>.</li>
      <li class="calibre12"><strong class="screentext">It is important to make sure that you are getting the Power BI Desktop app and not just the Power BI app. The Power BI app is for viewing reports published to the Power BI service only.</strong>
        <figure class="mediaobject"><img src="images/000278.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.1: The Power BI Desktop app in the Microsoft Store</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Get</strong> button.</li>
      <li class="calibre12">Once the <a id="calibre_link-771" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>download and installation is complete, click the <strong class="screentext">Launch</strong> button.</li>
    </ol>
    <p class="book-title--packt">For a variety of <a id="calibre_link-778" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>reasons, it may not be possible to install the Microsoft Store app version of Power BI Desktop. This may be because of running an older version of Windows, corporate policies, or a desire to use the 32-bit version of Power BI Desktop (the Microsoft Store app is 64-bit only). In this case, you can install the <strong class="screentext">Microsoft Installer</strong> (<strong class="screentext">MSI</strong>) version. To install the MSI version, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">The <strong class="screentext">Microsoft Installer</strong> (<strong class="screentext">MSI</strong>) version of <a id="calibre_link-608" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI Desktop can be downloaded on the Power BI downloads page: <a href="https://powerbi.microsoft.com/downloads" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://powerbi.microsoft.com/downloads</span></a>.</li>
      <li class="calibre12">Under <strong class="screentext">Microsoft Power BI Desktop</strong>, choose <strong class="screentext">Advanced download options</strong>.<figure class="mediaobject"><img src="images/000291.png" alt="Graphical user interface, text, application  Description automatically generated" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.2: Download the MSI version using Advanced download options</p>
      </li>
      <li class="calibre12">Select your language preference and click the <strong class="screentext">Download</strong> button.</li>
      <li class="calibre12">Choose either <a id="calibre_link-1346" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the 64-bit version (<code class="code-in-text--packt">PBIDesktopSetup_x64.exe</code>) or the 32-bit version (<code class="code-in-text--packt">PBIDesktopSetup.exe</code>) and then click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Once the <a id="calibre_link-1347" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>file downloads, click <strong class="screentext">Open file</strong>.</li>
      <li class="calibre12">The Microsoft Power BI Desktop Setup Wizard will launch. Select a language and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Complete the rest of the installation wizard, including accepting the license terms and destination folder, clicking the <strong class="screentext">Next</strong> button each time. </li>
      <li class="calibre12">On the final screen, click the <strong class="screentext">Install</strong> button.</li>
      <li class="calibre12">Once the installation finishes, click the <strong class="screentext">Finish</strong> button.<figure class="mediaobject"><img src="images/000303.png" alt="Graphical user interface, application  Description automatically generated" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 1.3: Successful installation of Power BI Desktop (MSI)</p>
    <p class="book-title--packt">If you are using Power BI Report Server (on-premises) you need to download the corresponding <a id="calibre_link-772" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>version of Power BI Desktop optimized for Report Server (RS version). Updates for Power BI Report Server come out quarterly and <a id="calibre_link-779" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>there is a specific version of Power BI Desktop released simultaneously that is optimized to work with each quarterly version. The installation is the same as the MSI version. However, to find the download for the RS version, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Use a browser to<a id="calibre_link-995" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> navigate to <a href="https://powerbi.microsoft.com/report-server" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://powerbi.microsoft.com/report-server</span></a>.</li>
      <li class="calibre12">Use the <strong class="screentext">Advanced download options</strong> link directly under the <strong class="screentext">DOWNLOAD FREE TRIAL</strong> button.<figure class="mediaobject"><img src="images/000315.png" alt="Text  Description automatically generated" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 1.4: Download the RS version using Advanced download options</p>
    <h2 id="calibre_link-1348" class="calibre8">How it works</h2>
    <p class="book-title--packt">Power BI Desktop supports a rich set of configuration options both for the currently open file and for all instances of Power BI Desktop on the given device. These options control the availability of preview and end user features and define default behaviors resource usage, security, and privacy/isolation of data sources.</p>
    <p class="book-title--packt">Regardless of the version of Power BI Desktop <a id="calibre_link-780" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>that is installed, these options are available by using the <strong class="screentext">File</strong> menu in the ribbon and then selecting <strong class="screentext">Options and settings</strong>, and then <strong class="screentext">Options</strong>, as shown in <em class="italic">Figure 1.5</em>.</p>
    <figure class="mediaobject"><img src="images/000327.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 1.5: Power BI Desktop Options and settings</p>
    <p class="book-title--packt">Selecting <strong class="screentext">Options</strong> brings up the <strong class="screentext">Options</strong> window, displayed in <em class="italic">Figure 1.6</em>.</p>
    <figure class="mediaobject"><img src="images/000338.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 1.6: Power BI Desktop Options (February 2021)</p>
    <p class="book-title--packt"><strong class="screentext">GLOBAL</strong>&nbsp;options are applied to all Power BI Desktop files created or accessed by the user, while&nbsp;<strong class="screentext">CURRENT FILE</strong>&nbsp;options must be defined for each Power BI Desktop file. The following <a id="calibre_link-773" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>steps are recommended for&nbsp;<strong class="screentext">GLOBAL</strong>&nbsp;options:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">On the&nbsp;<strong class="screentext">Data Load</strong>&nbsp;tab, under <strong class="screentext">Data Cache Management Options</strong>, confirm that the currently used data cache is below the&nbsp;<strong class="screentext">Maximum allowed (MB)</strong>&nbsp;setting. If it is near <a id="calibre_link-781" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the limit and local disk space is available, increase the value of <strong class="screentext">Maximum allowed (MB)</strong>. Do not clear the cache unless local disk space is unavailable as this will require additional, often unnecessary, queries to be executed.<figure class="mediaobject"><img src="images/000350.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.7: Global Data Load options</p>
        <p class="packt_figref">In addition, under the <strong class="screentext">Time intelligence</strong> heading, consider turning off <strong class="screentext">Auto date/time for new files</strong>. While its convenient to have out-of-the-box calendar hierarchy functionality for date columns, this can also significantly increase the size of a data model and its strongly recommended to utilize a common date dimension table, preferably from an corporate data warehouse source. Finally, under the <strong class="screentext">Type Detection</strong> heading, it is <a id="calibre_link-1349" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>recommended that you choose the option to <strong class="screentext">Never detect column types and headers for unstructured sources</strong>. The default detection of column types from unstructured sources such as text or Excel files will create a hardcoded dependency on the column names in the source file. Additionally, this default transformation will be applied prior to any filter expression and thus can require more time and resources to perform the refresh.</p>
      </li>
      <li class="calibre12">On the <strong class="screentext">Power Query Editor</strong> tab, under the <strong class="screentext">Layout</strong> header, ensure that <strong class="screentext">Display the Query Settings pane</strong> and <strong class="screentext">Display the Formula Bar</strong> are both checked, as seen in <em class="italic">Figure 1.8</em>.<figure class="mediaobject"><img src="images/000361.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.8: Power Query Editor Layout settings</p>
      </li>
      <li class="calibre12">On the&nbsp;<strong class="screentext">Security</strong>&nbsp;tab, under the <strong class="screentext">Native Database Queries</strong> header, select the option to <strong class="screentext">Require user approval for new native database queries</strong>. Native queries are the user-specified SQL statements passed to data sources as opposed to the queries Power BI generates internally.<figure class="mediaobject"><img src="images/000372.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.9: Security option for Native Database Queries</p>
        <p class="packt_figref">Optionally, set&nbsp;<strong class="screentext">Show security warning when adding a custom visual to a report</strong>&nbsp;as well.&nbsp;Custom visuals can be divided into three categories as follows:</p>
        <ul class="calibre11">
          <li class="calibre12">Certified for Power BI (only on AppSource)</li>
          <li class="calibre12">Uncertified but available in AppSource</li>
          <li class="calibre12">Third-party, not available in AppSource</li>
        </ul>
        <p class="packt_figref">Certified custom visuals have been thoroughly tested for safety to ensure that the visuals do <a id="calibre_link-774" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>not access external services or resources and that they follow secure coding practices. Uncertified visuals available in AppSource have been through a validation process, though there is no guarantee <a id="calibre_link-782" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>that all code paths have been tested or that no external services or resources are accessed. Third-party visuals not available in AppSource should be used with caution, and it is recommended that organizations establish policies and procedures regarding their use.</p>
      </li>
      <li class="calibre12">On the <strong class="screentext">Privacy</strong> tab, under the <strong class="screentext">Privacy Levels</strong> heading, configure the privacy levels for all data sources and enable the option to&nbsp;<strong class="screentext">Always combine data according to your Privacy Level settings for each source</strong>. Use the <strong class="screentext">Learn more about Privacy Levels</strong> link&nbsp;for details on these settings.&nbsp;<figure class="mediaobject"><img src="images/000383.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.10: Global Privacy Level options</p>
      </li>
      <li class="calibre12">Use the <strong class="screentext">Diagnostics</strong> tab to provide version information and diagnostics options if there is a need to troubleshoot a particular problem with Power BI Desktop. The <strong class="screentext">Enable tracing</strong> option under the <strong class="screentext">Diagnostic Options</strong> header writes out detailed trace event data to the local hard drive and thus should only be activated for <a id="calibre_link-1350" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>complex troubleshooting scenarios.<figure class="mediaobject"><img src="images/000394.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.11: Diagnostics Options in Power BI Desktop</p>
      </li>
      <li class="calibre12">Use the <strong class="screentext">Preview features</strong> tab to enable preview features&nbsp;for evaluation purposes. The&nbsp;options under&nbsp;<strong class="screentext">Preview features</strong>&nbsp;change with new versions as some previous <a id="calibre_link-783" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>options become generally available and new preview features are introduced. The monthly Power BI Desktop update video and<a id="calibre_link-660" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> blog post (see <a href="https://powerbi.microsoft.com/en-us/blog/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://powerbi.microsoft.com/en-us/blog/</span></a>) provide details and examples of these new features.</li>
      <li class="calibre12">Usually a restart of the Power BI Desktop application is required once a new preview option has been activated.<figure class="mediaobject"><img src="images/000406.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.12: Preview features available with the February 2021 release of Power BI Desktop</p>
      </li>
      <li class="calibre12">On the&nbsp;<strong class="screentext">Data Load</strong>&nbsp;tab under&nbsp;<strong class="screentext">CURRENT FILE</strong>, more experienced users should disable all of the options under the <strong class="screentext">Type Detection</strong> and <strong class="screentext">Relationships</strong> headings; these <a id="calibre_link-775" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>model design decisions should be <a id="calibre_link-1351" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>implemented explicitly by the Power BI developer with knowledge of the source data. <p class="packt_figref">Also note that you can disable <strong class="screentext">Auto date/time</strong> here on an individual file basis if you did not disable this option at a <strong class="screentext">GLOBAL</strong> level.</p>
        <figure class="mediaobject"><img src="images/000418.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 1.13: Current File Data Load Options</p>
    <h2 id="calibre_link-1352" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">As a modern cloud and service-oriented analytics platform, Power BI delivers new and improved features across its toolset on a monthly basis. These scheduled releases and updates for Power BI Desktop, the Power BI service, the on-premises data gateway, Power BI mobile applications, and more reflect customer feedback, industry trends, and the Power BI team's internal ideas and product roadmap.</p>
    <p class="book-title--packt">BI professionals responsible for developing and managing Power BI content can both stay informed of these updates as well as review detailed documentation and guidance on implementing <a id="calibre_link-609" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the features via the Microsoft <a id="calibre_link-788" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI blog (<a href="http://bit.ly/20bcQb4" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/20bcQb4</span></a>), Power BI documentation (<a href="http://bit.ly/2o22qi4" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2o22qi4</span></a>), and the Power BI Community (<a href="https://community.powerbi.com/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http:/bit.ly/2mqiuxP</span></a>).</p>
    <figure class="mediaobject"><img src="images/000429.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 1.14: Blog post and supporting video for February 2021 update to Power BI Desktop</p>
    <p class="book-title--packt">The Power BI Community portal provides a robust, searchable hub of information across common <a id="calibre_link-753" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>topics as well as an active, moderated forum of user experiences and troubleshooting. The community also maintains its own blog featuring examples <a id="calibre_link-823" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and use cases from top community contributors, and links to local&nbsp;<strong class="screentext">Power BI User Groups</strong>&nbsp;(<strong class="screentext">PUGs</strong>), relevant events such as <strong class="screentext">Microsoft Business Applications Summit</strong> (<strong class="screentext">MBAS</strong>), along with various galleries such <a id="calibre_link-607" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>as a Themes Gallery, Data Stories Gallery, R Script Showcase, and Quick Measures Gallery.</p>
    <p class="book-title--packt">The Power BI Ideas forum (<a href="https://ideas.powerbi.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://ideas.powerbi.com</span></a>) is a valuable source for identifying <a id="calibre_link-789" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>requested features and enhancements, and their status relative to future releases. Ideas are provided a status, such as "Planned," "Under Review," or "Needs Votes." The search functionality allows for filtering by these status details. Filtering for <strong class="screentext">Planned</strong>&nbsp;ideas, particularly those with higher community vote counts, provides a sense of impactful updates to be released over a longer time horizon.</p>
    <h2 id="calibre_link-1353" class="calibre8">See also</h2>
    <p class="book-title--packt">For additional information <a id="calibre_link-751" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>on topics covered in this recipe, refer to the following links:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Security white paper:&nbsp;<a href="http://bit.ly/22NHzRS" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/22NHzRS</span></a></li>
      <li class="bullet">Data source privacy levels:&nbsp;<a href="http://bit.ly/2nC0Lmx%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2nC0Lmx</span></a></li>
      <li class="bullet">Power BI Auto date/time: <a href="http://bit.ly/3bH59cn%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3bH59cn</span></a></li>
      <li class="bullet">Change settings for Power BI reports: <a href="http://bit.ly/2OP8m0F%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OP8m0F</span></a></li>
    </ul>
    <h1 id="calibre_link-1179" class="title">Creating an On-Premises Data Gateway</h1>
    <p class="book-title--packt">The Microsoft on-premises <a id="calibre_link-678" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>data gateway (or simply gateway) is a Windows service that runs in on-premises environments or in <strong class="screentext">infrastructure-as-a-service</strong> (<strong class="screentext">IaaS</strong>) data sources running in the cloud, such as virtual machines <a id="calibre_link-559" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>running SQL Server databases. The sole purpose of the gateway is to support secure (encrypted) and efficient data transfer between on-premises and IaaS data sources and Microsoft Azure services such as Power BI, Power Apps, Power Automate, and Azure Logic Apps, via an outbound connection to Azure Service Bus. It is important to note that if all data sources used in Power BI reports are in the cloud (and so not on-premises) and accessible by the Power BI service, then the Microsoft on-premises data gateway is not required, as the Power BI service will use native cloud gateways to access native cloud data sources; this could be something such as Azure SQL Database or Azure SQL Managed Instances. </p>
    <p class="book-title--packt">Once installed, a gateway can be used to schedule data refreshes of imported Power BI datasets, to support <a id="calibre_link-58" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI reports and dashboards built with DirectQuery, plus live connections to&nbsp;<strong class="screentext">Analysis Services</strong> databases.</p>
    <p class="book-title--packt">A single on-premises data gateway can support the refresh and query activity for multiple data sources, and permission to use the gateway can be shared with multiple users. Currently, the <a id="calibre_link-689" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>gateway supports all common data sources via scheduled imports, including <strong class="screentext">Open Database Connectivity</strong> (<strong class="screentext">ODBC</strong>) connections, and many of the most common sources via Live Connection and DirectQuery.</p>
    <h2 id="calibre_link-1354" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">The hardware resources required by the gateway vary based on the type of connection (import versus live connection), the usage of the reports, and dashboards in the Power BI service, and the proportion of data volume handled by the gateway versus the on-premises source systems. It is recommended to start with 8-core CPUs, 8 GB of RAM server, and Windows 2012 R2 or later for the operating system. This machine cannot be a domain controller, and to maintain the availability of Power BI content, the gateway server should always be on and connected to the internet.</p>
    <p class="book-title--packt">Another top consideration for the gateway is the location of the gateway server in relation to the Power BI <a id="calibre_link-1355" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>tenant and the data sources to be supported by the gateway. For example, if a SQL Server database is the primary gateway source and it runs on a server in the Western United States, and the Power BI Tenant for the organization is in the West US Azure region, then the gateway should be installed on a server or potentially an Azure <strong class="screentext">virtual machine</strong> (<strong class="screentext">VM</strong>) in the West US Azure region or a location in the Western United States.</p>
    <p class="book-title--packt">Based on an analysis of current and projected workloads, the gateway resources can be scaled up or down and, optionally, additional gateways can be installed on separate servers to distribute the overall Power BI refresh and query deployment workload. </p>
    <p class="book-title--packt">For example, one gateway server can be dedicated to scheduled refresh/import workloads, thus isolating this activity from a separate gateway server responsible for DirectQuery and Live Connection queries.</p>
    <p class="book-title--packt">The gateway does not require inbound ports to be opened and defaults to HTTPS but can be forced to use TCP.&nbsp;For the default communication mode, it is recommended to whitelist the IP addresses in your data region in your firewall. This list is updated weekly and is available via the Microsoft Azure Datacenter IP list (<a href="http://bit.ly/2oeAQyd" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2oeAQyd</span></a>).</p>
    <h2 id="calibre_link-1356" class="calibre8">How to create the Gateway</h2>
    <p class="book-title--packt">The gateway has two modes, the Standard mode and the Personal mode. The Personal mode is intended for <a id="calibre_link-679" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>personal use, and thus cannot be shared among users within an enterprise. We will focus on the Standard mode, as the installation and configuration are essentially the same for the Personal mode:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Download the latest Microsoft on-premises data gateway from <a href="https://powerbi.microsoft.com/downloads/%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://powerbi.microsoft.com/downloads/</span></a>
        <figure class="mediaobject"><img src="images/000440.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.15: Download the Microsoft on-premises data gateway</p>
      </li>
      <li class="calibre12">Select the <strong class="screentext">Download standard mode</strong> link.</li>
      <li class="calibre12">Once <a id="calibre_link-1357" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>downloaded, choose <strong class="screentext">Open file</strong> to run <strong class="screentext">GatewayInstall.exe</strong>.<figure class="mediaobject"><img src="images/000451.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.16: GatewayInstall.exe</p>
      </li>
      <li class="calibre12">Choose the file directory for the installation, accept the terms of use and privacy agreement, and then click the <strong class="screentext">Install</strong> button.</li>
      <li class="calibre12">Sign in to the Power BI service to register the gateway:<figure class="mediaobject"><img src="images/000462.png" alt="Graphical user interface, text, application, email  Description automatically generated" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.17: Registering the gateway</p>
      </li>
      <li class="calibre12">On the next <a id="calibre_link-680" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>screen after signing in, choose to <strong class="screentext">Register a new gateway on this computer</strong> and then click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Enter a user-friendly name for the gateway and a recovery key and then click the <strong class="screentext">Configure</strong> button.<figure class="mediaobject"><img src="images/000473.png" alt="Graphical user interface, text, application, email  Description automatically generated" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 1.18: Final configuration information for the gateway</p>
    <p class="book-title--packt">With the gateway installed and registered, data sources, gateway admins, and authorized data <a id="calibre_link-681" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>source users can be added to the Power BI service. A&nbsp;<strong class="screentext">Manage Gateways</strong>&nbsp;option will be available under the gear icon in the Power BI service. See the&nbsp;Configuring On-Premises Gateway Data Connections<em class="italic"> </em>recipe of&nbsp;<em class="italic">Chapter 12</em>,&nbsp;<em class="italic">Deploying and Distributing Power BI Content</em>, for details on this process.</p>
    <figure class="mediaobject"><img src="images/000484.png" alt="Graphical user interface, text, application  Description automatically generated" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 1.19: Successfully installed gateway</p>
    <h2 id="calibre_link-1358" class="calibre8">How it works</h2>
    <p class="book-title--packt">As new versions of the gateway become available, a notification is made available in the <strong class="screentext">Status</strong> tab of the <a id="calibre_link-1359" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>on-premises data gateway UI, as per&nbsp;<em class="italic">Figure 1.19</em>. The Power BI gateway team recommends that updates should be installed as they become available.</p>
    <p class="book-title--packt">The Standard mode on-premises data gateway, rather than the personal mode gateway, is required for the DirectQuery datasets created in this book and the use of other Azure services in the Microsoft business application platform.</p>
    <p class="book-title--packt">The Power BI service uses read-only connections to on-premises sources, but the other services (for example, Power Apps) can use the gateway to write, update, and delete these sources.</p>
    <p class="book-title--packt">The recovery key is used to generate both a symmetric and an asymmetric key, which encrypts data source credentials and stores them in the cloud. The credentials area is only decrypted by the gateway machine in response to a refresh or query request. The recovery key will <a id="calibre_link-682" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>be needed in the following scenarios:</p>
    <ul class="calibre9">
      <li class="bullet">Migrating a gateway and its configured data sources to a different machine.</li>
      <li class="bullet">Restoring a gateway to run the service under a different domain account or restoring a gateway from a machine that has crashed.</li>
      <li class="bullet">Taking over ownership of an existing gateway from an existing gateway administrator.</li>
      <li class="bullet">Adding a gateway to an existing cluster.</li>
    </ul>
    <p class="book-title--packt">It is important that the recovery key is stored in a secure location accessible to the BI/IT organization. Additionally, more than one user should be assigned as a gateway administrator in the Power BI service to provide redundancy.</p>
    <h2 id="calibre_link-1360" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">The final configuration screen for the Microsoft on-premises data gateway shown in <em class="italic">Figure 1.18</em> provides several advanced options, including the following:</p>
    <ul class="calibre9">
      <li class="bullet">Add to an existing gateway cluster</li>
      <li class="bullet">Change region</li>
      <li class="bullet">Provide relay details</li>
    </ul>
    <p class="book-title--packt">Gateway clusters remove single points of failure for on-premises data access. Since only a single standard gateway can be installed on a computer, each additional gateway cluster member <a id="calibre_link-512" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>must be installed on a different computer. If the primary gateway is not available, data refresh requests are routed to other gateway cluster members. When using gateway clusters, it is important that all gateway cluster members run the same gateway version and that offline gateway members are removed or disabled&mdash;offline gateway members will negatively impact performance.</p>
    <p class="book-title--packt">By default, the gateway is installed in the same Azure region as your Power BI tenant in the Power BI service. In almost all cases, this setting should not be changed. However, with multi-geo support in Power BI Premium, it may be necessary to install gateways in different Azure regions. The <strong class="screentext">Change Region</strong> option provides this flexibility.</p>
    <p class="book-title--packt">Azure relays are automatically provisioned for installed gateways at the time of installation. However, the <strong class="screentext">Provide relay details</strong> option allows you to provide your own relay details if you wish to associate the relay with your Azure subscription and manage the sender and listener keys for the relay. This is a very advanced option and you should fully understand Azure relays and what you are trying to accomplish before attempting this configuration. It is important to note that only WCF relays with NetTcp are supported for this feature.</p>
    <h2 id="calibre_link-1361" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Details of configuring and managing data sources through the on-premises gateway are covered in&nbsp;<em class="italic">Chapter 12</em>,&nbsp;<em class="italic">Deploying and Distributing Power BI Content</em></li>
      <li class="bullet">Set the Azure relay for on-premises data gateway: <a href="http://bit.ly/3rMJMvP%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3rMJMvP</span></a></li>
    </ul>
    <h1 id="calibre_link-1180" class="title">Installing Analyze in Excel from the Power BI Service </h1>
    <p class="book-title--packt">Excel-based data analysis and reporting artifacts, such as PivotTables, charts, and cell range formula expressions with custom formatting, remain pervasive in organizations. Although a <a id="calibre_link-61" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>significant portion of this content and its supporting processes can be migrated to Power BI, and despite the many <a id="calibre_link-820" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>additional features and benefits this migration could provide, Power BI is not intended as a replacement for all Excel-based reporting. Organizations, and in particular those departments that use Excel extensively (such as Finance and Accounting), may prefer to leverage these existing assets and quickly derive value from Power BI by both deploying Excel content to Power BI and analyzing Power BI-hosted data from within Excel.</p>
    <p class="book-title--packt">The Power BI service's Analyze in Excel feature replaces the deprecated Microsoft Power BI Publisher for Excel. The Analyze in Excel feature allows you to use Power BI datasets in Excel and use Excel features like PivotTables, charts, and slicers to interact with the datasets.</p>
    <h2 id="calibre_link-1362" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To get ready to install and use the Power BI service's Analyze in Excel feature, make sure that Microsoft Excel is installed on your computer and then sign in to the Power BI service.</p>
    <h2 id="calibre_link-1363" class="calibre8">How to install Analyze</h2>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the upper-right corner of any Power BI service page, click the ellipsis and then choose <strong class="screentext">Download</strong> and then <strong class="screentext">Analyze in Excel updates</strong>.<figure class="mediaobject"><img src="images/000495.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.20: Downloading Analyze in Excel</p>
      </li>
      <li class="calibre12">On the splash <a id="calibre_link-62" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>screen that appears, choose the <strong class="screentext">Download</strong> button.</li>
      <li class="calibre12">Once the file <a id="calibre_link-821" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>downloads, choose the <strong class="screentext">Open file</strong> link or run the file from your <strong class="screentext">Downloads</strong> folder.<figure class="mediaobject"><img src="images/000005.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.21: Analyze in Excel installer</p>
      </li>
      <li class="calibre12">The installation wizard for <strong class="screentext">Microsoft Analysis Services OLE DB Provider Setup</strong> launches. Click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Accept the licensing terms and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Click the <strong class="screentext">Install</strong> button to begin the installation.</li>
      <li class="calibre12">Once the installation finishes, click the <strong class="screentext">Finish</strong> button.<figure class="mediaobject"><img src="images/000017.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 1.22: Successful installation of the Analyze in Excel feature</p>
    <h2 id="calibre_link-1364" class="calibre8">How it works</h2>
    <p class="book-title--packt">Now that the Microsoft Analysis Services OLE DB provider is installed locally on your computer, you <a id="calibre_link-63" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>can use the <strong class="screentext">Analyze in Excel</strong> feature for reports. To use <strong class="screentext">Analyze in Excel</strong>, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Click on any workspace to see the dashboards, reports, and datasets available in that workspace.</li>
      <li class="calibre12">Hover over <a id="calibre_link-822" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a report or dataset, click the "more" menu (three vertical dots), and then choose <strong class="screentext">Analyze in Excel</strong>.<figure class="mediaobject"><img src="images/000029.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.23: Analyze in Excel</p>
      </li>
      <li class="calibre12">If you receive a splash screen informing you that you need some Excel updates, click the <strong class="screentext">I've already installed these updates</strong> link.</li>
      <li class="calibre12">The Power BI service creates and downloads an Excel file that is designed and structured <a id="calibre_link-64" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for use with <strong class="screentext">Analyze in Excel</strong>. The name of the Excel file will match the name of the Power BI report or <a id="calibre_link-1365" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>dataset from which the Excel file was created.</li>
      <li class="calibre12">Open the Excel file using the <strong class="screentext">Open file</strong> link, or open the file from your <strong class="screentext">Downloads</strong> folder.</li>
      <li class="calibre12">Make sure to click the <strong class="screentext">Enable Editing</strong> button in Excel, as the file will open in <strong class="screentext">PROTECTED VIEW</strong>.</li>
      <li class="calibre12">Finally, click the <strong class="screentext">Enable Content</strong> button to activate external data connections.<p class="packt_figref">The Excel file contains a single page/tab with the same name as the report or dataset from which the report/dataset was created. This page contains a PivotTable called <strong class="screentext">PivotTable1</strong> that is tied to the Power BI dataset in the Power BI service. Clicking on the PivotTable presents the dataset tables, columns, and measures in the PivotTable <strong class="screentext">Fields</strong> pane.</p>
      </li>
    </ol>
    <h2 id="calibre_link-1366" class="calibre8">There's moreâ¦ </h2>
    <p class="book-title--packt">Depending on the <a id="calibre_link-766" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Office license, users can also connect to Power BI datasets from the <strong class="screentext">Insert PivotTable</strong> option and from <strong class="screentext">Data - Get Data experience</strong> in Excel.</p>
    <p class="book-title--packt"><em class="italic">Table 1.1</em> lists blogs that contain many articles and examples on Power BI's tools and features.</p>
    <table id="calibre_link-1367" class="no-table-style">
      <colgroup class="calibre15">
        <col class="calibre16"></col>
        <col class="calibre16"></col>
        <col class="calibre16"></col>
      </colgroup>
      <tbody class="calibre17">
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Blogger(s)</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Blog</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">URL</p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Michael Carlo Seth Bauer</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">PowerBI.Tips</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="http://powerbi.tips" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://powerbi.tips</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Chris Webb</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Crossjoin</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://blog.crossjoin.co.uk" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://blog.crossjoin.co.uk</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Rob Collie and others</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">P3 Adaptive</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://powerpivotpro.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://powerpivotpro.com</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Alberto Ferrari Marco Russo</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">SQL BI</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="http://www.sqlbi.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://www.sqlbi.com</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Kasper De Jonge</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Kasper On BI</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://www.kasperonbi.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://www.kasperonbi.com</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Matt Allington</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">ExceleratorBI</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="http://exceleratorbi.com.au/blog" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://exceleratorbi.com.au/blog</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Ruth Martinez</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Curbal</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://curbal.com/blog" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://curbal.com/blog</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Reza Rad</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">RADACAD</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="http://radacad.com/blog" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://radacad.com/blog</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Imke Feldman</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">The BIccountant</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="http://www.thebiccountant.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://www.thebiccountant.com</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Brett Powell</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Insight Quest</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://insightsquest.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://insightsquest.com</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Gilbert Quevauvilliers</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Fourmoo</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://www.fourmoo.com/blog" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://www.fourmoo.com/blog</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Tom Martens</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Mincing Data</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://www.minceddata.info/blog" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://www.minceddata.info/blog</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Nicky van Vroenhoven</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Power BI, Power Platform, Data Platform</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://www.nickyvv.com/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://www.nickyvv.com/</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Debbie Edwards</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Debbie's Microsoft Power BI, SQL and Azure Blog</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="http://bit.ly/3eQsb2G" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3eQsb2G</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Zoe Douglas</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">DataZoe</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://www.datazoepowerbi.com/blog" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://www.datazoepowerbi.com/blog</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Ibarrau</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">LaDataWeb (Spanish)</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://blog.ladataweb.com.ar/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://blog.ladataweb.com.ar/</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Various</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Power BI Community Blog</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="http://bit.ly/3qIoDl9" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3qIoDl9</span></a></p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Various</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Power BI Weekly</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><a href="https://powerbiweekly.info/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://powerbiweekly.info/</span></a></p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="book-title--packt">Table 1.1: A list of blogs that detail Power BI features and tools, with examples on how to use them</p>
    <p class="book-title--packt">With the exception of <em class="italic">Kasper On BI</em>, all of these blogs are from non-Microsoft employees and thus do not necessarily reflect the views of Microsoft or recommended practices with its products. Additionally, several of these blogs are not exclusive to Power BI; they may also include coverage of other MSBI, Azure, SQL Server, and Office 365 tools and services.</p>
    <p class="book-title--packt">An additional resource for learning and deploying Power BI is Adam Saxton's&nbsp;and Patrick LeBlanc's <em class="italic">Guy in a Cube</em>&nbsp;video channel (<a href="http://bit.ly/2o2lRqU" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2o2lRqU</span></a>). These videos feature concise, hands-on reviews and resolutions to common issues and scenarios. They also have high-level summaries of recent Power BI updates and releases. As members of Microsoft, Adam and Patrick can incorporate specific guidance from Microsoft product and technical teams, and they regularly identify recent blog posts from the wider Power BI community. It is highly recommended that you subscribe to this channel so that you are always aware of new posts!</p>
    <h2 id="calibre_link-1368" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Analyze<a id="calibre_link-65" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in Excel: <a href="http://bit.ly/3bIMSeM" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3bIMSeM</span></a></li>
      <li class="bullet">Analyze in Excel &ndash; the Advanced Method: <a href="https://bit.ly/3bLbpzG" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3bLbpzG</span></a></li>
    </ul>
    <h1 id="calibre_link-1181" class="title">Installing and Configuring Additional Tools</h1>
    <p class="book-title--packt">Power BI professionals responsible <a id="calibre_link-17" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for the development <a id="calibre_link-21" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of semantic models (datasets) routinely utilize additional tools beyond Power BI Desktop to create and manage their models. For example, they use Tabular Editor to quickly implement changes to measures or add new objects, such as perspectives and calculation groups. Likewise, the ALM Toolkit is routinely used to deploy incremental and metadata-only changes to Power BI. </p>
    <p class="book-title--packt"><strong class="screentext">Another such tool is DAX Studio,</strong> a third-party tool used to query data models, edit and format code, browse <a id="calibre_link-1369" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the structure and metadata of data models, and analyze the performance and execution characteristics of DAX queries. For larger and more <a id="calibre_link-1370" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>complex data models and expressions, as well as projects involving multiple models, DAX Studio becomes an essential supplement to the development and performance-tuning processes.</p>
    <p class="book-title--packt"><strong class="screentext">DAX</strong>&nbsp;(<strong class="screentext">Data Analysis Expressions</strong>) is the "language of Power BI," as it is used to create the measures and queries visualized in Power BI reports and dashboards. Power BI generates and submits DAX queries to the source data model based on the structure of the visualization, user selections, and filters&mdash;just as other tools such as Excel generate MDX queries based on the <a id="calibre_link-340" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>selections and structure of pivot tables and slicers from workbooks. DAX expressions are also used to define security roles and can optionally be used to create columns and tables in data models based on other tables and columns in the model, which can be refreshed at processing time and used by measures and queries. DAX serves the same function in Azure Analysis Services (AAS) and SQL Server Analysis Services (SSAS) tabular models as well as Power Pivot for Excel models, it's essential that BI professionals have a robust tool for developing and analyzing DAX code and the data models containing these expressions.</p>
    <h2 id="calibre_link-1371" class="calibre8">How to Install and Configure Additional Tools</h2>
    <ol class="calibre9">
      <li class="calibre12" value="1">Download the latest version from the DAX Studio website: <a href="https://daxstudio.org/downloads/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://daxstudio.org/downloads/</span></a>. The installer version is a single file that provides a wizard-based installation and setup, while the portable version is a ZIP file that does not provide a wizard-based installation.</li>
      <li class="calibre12">Use the <strong class="screentext">Open file</strong> link or run the file from your <strong class="screentext">Downloads</strong> folder.<figure class="mediaobject"><img src="images/000041.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.24: DAX Studio installation file</p>
      </li>
      <li class="calibre12">Once the installation starts, select the option to <strong class="screentext">Install for all users (recommended)</strong>.</li>
      <li class="calibre12">Accept the license agreement and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Choose a folder path to install the tool and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Choose whether the DAX Studio add-in for Excel will also be installed. Click the <strong class="screentext">Next</strong> button. Note that:<ul class="calibre11">
          <li class="calibre12">The add-in for <a id="calibre_link-22" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Excel is required to connect to Power Pivot for Excel data models.</li>
          <li class="calibre12">Additionally, when <a id="calibre_link-18" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>DAX Studio is opened from Excel, query results can be exported directly to Excel tables.</li>
        </ul>
      </li>
      <li class="calibre12">Select the <strong class="screentext">Start menu</strong> folder (the default is DAX Studio) and then click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Check the box to <strong class="screentext">Create a desktop shortcut</strong> and then click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Finally, click the <strong class="screentext">Install</strong> button.<figure class="mediaobject"><img src="images/000053.png" alt="Graphical user interface, application  Description automatically generated" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 1.25: Successful installation of DAX Studio</p>
    <h2 id="calibre_link-1372" class="calibre8">How it works</h2>
    <p class="book-title--packt">Upon full installation, including the add-in for Excel, a DAX Studio icon will appear on the&nbsp;<strong class="screentext">Add-Ins</strong>&nbsp;tab in the Excel ribbon, like the one shown in <em class="italic">Figure 1.26</em>.</p>
    <figure class="mediaobject"><img src="images/000065.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 1.26: DAX Studio in the Add-Ins ribbon in Excel</p>
    <p class="book-title--packt">The full installation with the Excel add-in is recommended, as this enables direct output of DAX query results <a id="calibre_link-23" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to Excel workbook tables and is required for connecting to Power Pivot data models. For Power Pivot to be available, you must enable the <strong class="screentext">Microsoft Power Pivot for Excel COM Add-in</strong> using the <strong class="screentext">File</strong> menu in Excel, and then choose <strong class="screentext">Options</strong>. Click on the <strong class="screentext">Add-Ins</strong>&nbsp;tab. Select <strong class="screentext">COM Add-ins</strong> from the drop-down control at the bottom of the dialog box and then select the <strong class="screentext">Goâ¦</strong> button. The <a id="calibre_link-19" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>DAX Studio add-in can be deactivated using this same interface. To demonstrate how this works in Excel, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open an Excel workbook.</li>
      <li class="calibre12">Open a Power BI Desktop file.</li>
      <li class="calibre12">From the&nbsp;<strong class="screentext">Add-Ins</strong>&nbsp;tab of the Excel toolbar, activate DAX Studio.<figure class="mediaobject"><img src="images/000077.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.27: The DAX Studio add-in for the Excel Connect dialog</p>
      </li>
      <li class="calibre12">For now, click the <strong class="screentext">Cancel</strong> button and then close the Excel workbook.<p class="packt_figref">DAX Studio can also be used as a standalone application outside of Excel. The standalone application provides the same functionality as the Excel add-in, excluding connectivity to Power Pivot for Excel data models and Excel output options. To demonstrate this, follow these steps:</p>
      </li>
      <li class="calibre12">Launch the DAX Studio standalone Windows application.</li>
      <li class="calibre12">Connect to a Power BI Desktop file or SSAS tabular instance.<p class="packt_figref">The&nbsp;<strong class="screentext">Advanced Options</strong>&nbsp;settings of the&nbsp;<strong class="screentext">Connect</strong>&nbsp;dialog box allow you to control exactly how DAX Studio <a id="calibre_link-24" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>connects to the model, such as the ability to specify a security role, effective user name identity, and&nbsp;<strong class="screentext">locale</strong>&nbsp;when <a id="calibre_link-20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>defining connections to data models and when analyzing trace events associated with DirectQuery data models (that is, the SQL statements generated and passed to sources).</p>
        <figure class="mediaobject"><img src="images/000089.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 1.28: DAX Studio advanced connection options</p>
    <h2 id="calibre_link-1373" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">There are two additional tools that are useful for Power BI. Namely:</p>
    <ul class="calibre9">
      <li class="bullet">ALM Toolkit</li>
      <li class="bullet">Tabular Editor</li>
    </ul>
    <p class="book-title--packt">The ALM Toolkit is a third-party tool from MAQ Software that provides advanced features such <a id="calibre_link-50" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>as Power BI dataset comparison, code merging, partial deployments and bug fixes, source control integration for dataset metadata, and definition reuse between tabular models. To download and install the ALM Toolkit, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In a browser, navigate to <a href="http://alm-toolkit.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://alm-toolkit.com</span></a>.</li>
      <li class="calibre12">Near the top of <a id="calibre_link-51" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the page, click the <strong class="screentext">DOWNLOAD LATEST VERSION</strong> button.</li>
      <li class="calibre12">Use the <strong class="screentext">Open file</strong> link to launch <code class="code-in-text--packt">AlmToolkitSetup.msi</code> or open the file from your <strong class="screentext">Downloads</strong> folder.<figure class="mediaobject"><img src="images/000014.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.29: ALM Toolkit installer</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Next</strong> button on the initial installation screen.</li>
      <li class="calibre12">Accept the license agreement and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Choose a <strong class="screentext">Folder</strong> path and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">On the final installation screen, click the <strong class="screentext">Next</strong> button to start the installation.<figure class="mediaobject"><img src="images/000102.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 1.30: Successfully installed ALM Toolkit</p>
    <p class="book-title--packt">The Power BI ALM Toolkit can now be launched from the Windows Start menu. </p>
    <p class="book-title--packt">Another powerful tool is Tabular Editor. At the time of this book being published, Tabular Editor comes in two versions, the free, open source version 2 and the commercial version 3. Tabular Editor is an alternative to <strong class="screentext">SQL Server Data Tools</strong> (<strong class="screentext">SSDT</strong>) for authoring and editing tabular models for Analysis Services. Tabular Editor provides a hierarchical view of the objects in your tabular model metadata, such as columns, measures, and hierarchies. Tabular Editor integrates with Power BI Desktop, allowing <a id="calibre_link-1026" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>batch changes to DAX measures and enabling advanced capabilities such as calculation groups and perspectives. Finally, Tabular Editor also enables offline editing capabilities by allowing you to open the tabular model directly from <code class="code-in-text--packt">Model.bim</code> files. To install and use Tabular Editor, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Download the latest Tabular Editor from here: <a href="https://bit.ly/3bJFBvl" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3bJFBvl</span></a>.</li>
      <li class="calibre12">Scroll to the <a id="calibre_link-1092" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>bottom of the page and click the link for <strong class="screentext">TabularEditor.Installer.msi</strong>.</li>
      <li class="calibre12">Once the file downloads, use the <strong class="screentext">Open file</strong> link or open the file from your <strong class="screentext">Downloads</strong> folder.<figure class="mediaobject"><img src="images/000138.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 1.31: Tabular Editor installer</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Next</strong> button on the initial installation screen.</li>
      <li class="calibre12">Accept the license agreement and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Choose a <strong class="screentext">Folder</strong> path and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Check the boxes <strong class="screentext">Create Desktop shortcut</strong> and <strong class="screentext">Create Program Menu shortcut</strong>, and then click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">On the final installation screen, click the <strong class="screentext">Next</strong> button to start the installation.<figure class="mediaobject"><img src="images/000126.png" alt="Graphical user interface, text, application, email  Description automatically generated" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 1.32: Successfully installed Tabular Editor</p>
    <p class="book-title--packt">Tabular Editor can <a id="calibre_link-1093" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>now be launched from the Windows Start menu. </p>
    <h2 id="calibre_link-1374" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">DAX Studio tutorials <a id="calibre_link-367" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and documentation: <a href="https://daxstudio.org" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://daxstudio.org</span></a></li>
      <li class="bullet">ALM Toolkit <a id="calibre_link-52" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>documentation: <a href="http://alm-toolkit.com/HowToUse" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://alm-toolkit.com/HowToUse</span></a></li>
      <li class="bullet">Tabular Editor <a id="calibre_link-1094" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>documentation: <a href="https://docs.tabulareditor.com/%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://docs.tabulareditor.com/</span></a></li>
    </ul>
    <h1 id="calibre_link-1182" class="title">Conclusion</h1>
    <p class="book-title--packt">In this chapter, we walked through the installation and configuration of the primary tools that BI professionals utilize to design and develop Power BI content, including official Microsoft tools such as Power BI Desktop, the On-premises data gateway, and Analyze in Excel, as well as third-party tools such as DAX Studio, the ALM Toolkit, and Tabular Editor. These tools, coupled with the Power BI service, are the primary resources needed by BI professionals to be productive with Power BI. Later chapters of this book explore the use of these tools in developing and enhancing Power BI solutions.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-2">
<div id="calibre_link-1375" class="calibre2">
<div id="calibre_link-1376" class="calibre3"><div id="calibre_link-1377" class="calibre4">
    <h1 class="heading">2</h1>
    <h1 id="calibre_link-1183" class="title">Accessing and Retrieving Data</h1>
    <p class="book-title--packt">Power BI Desktop contains a rich set of connectors and transformation capabilities that support the integration and enhancement of data from many different sources. These features are all driven by a powerful functional language and query engine, M, which <a id="calibre_link-611" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>leverages source system resources when possible and can greatly extend the scope and robustness of the data retrieval process beyond what's possible via the standard query editor interface alone. As with almost all BI projects, the design and development of the data access and retrieval process has significant implications for the analytical value, scalability, and sustainability of the overall Power BI solution.</p>
    <p class="book-title--packt">In this chapter, we dive into Power BI Desktop's Get Data experience and walk through the process of establishing and managing data source connections and queries. Examples are provided of using the Power Query Editor interface and the M language directly, to construct and refine queries to meet common data transformation and cleansing needs. In practice and as per the examples, a combination of both tools is recommended to aid the query development process.</p>
    <p class="book-title--packt">A full explanation of the M language and its implementation in Power BI is outside the scope of this book, but additional resources and documentation are included in the sections titled <em class="italic">There's more...</em> and <em class="italic">See also</em>.</p>
    <p class="book-title--packt">The recipes included in this chapter are as follows:</p>
    <ul class="calibre9">
      <li class="bullet">Viewing and Analyzing M Functions</li>
      <li class="bullet">Managing Queries and Data Sources</li>
      <li class="bullet">Using DirectQuery</li>
      <li class="bullet">Importing Data</li>
      <li class="bullet">Applying Multiple Filters</li>
      <li class="bullet">Selecting and Renaming Columns</li>
      <li class="bullet">Transforming and Cleansing Source Data</li>
      <li class="bullet">Creating Custom Columns</li>
      <li class="bullet">Combining and Merging Queries</li>
      <li class="bullet">Selecting Column Data Types</li>
      <li class="bullet">Visualizing the M Library</li>
      <li class="bullet">Profile Source Data</li>
      <li class="bullet">Diagnosing Queries</li>
    </ul>
    <h1 id="calibre_link-1184" class="title">Technical Requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop</li>
      <li class="bullet">SQL Server 2019 or newer with the <strong class="screentext">AdventureWorksDW2019</strong> database installed. This database and instructions for installing it are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a></li>
    </ul>
    <h1 id="calibre_link-1185" class="title">Viewing and Analyzing M Functions</h1>
    <p class="book-title--packt">Every time you click on a button to connect to any of Power BI Desktop's supported data sources or apply any transformation to a data source object, such as changing a column's data type, one or multiple M expressions are created reflecting your choices. These M expressions are automatically written to dedicated M documents and, if saved, are stored within the Power BI Desktop file as Queries. M is <a id="calibre_link-612" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a functional programming language like F#, and it is important that Power BI developers become familiar with analyzing, understanding, and later, writing and enhancing the M code that supports their queries.</p>
    <h2 id="calibre_link-1378" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare<a id="calibre_link-601" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> for this recipe, we will first build a query through the user<a id="calibre_link-37" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> interface<a id="calibre_link-596" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> that connects to the <strong class="screentext">AdventureWorksDW2019</strong> SQL Server database, retrieves the <strong class="screentext">DimGeography</strong> table, and then filters this table to a single country, such as the United States: </p>
    <ol class="calibre9">
      <li class="calibre12">Open Power BI Desktop and click on <strong class="screentext">Get Data</strong> from the <strong class="screentext">Home</strong> tab of the ribbon. Select <strong class="screentext">SQL Server</strong> from the list of database sources. For future reference, if the data source is not listed in <strong class="screentext">Common data sources</strong>, more data sources are available by clicking <strong class="screentext">Moreâ¦</strong> at the bottom of the list.</li>
      <li class="calibre12">A dialog window is displayed asking for connectivity information. Ensure that <strong class="screentext">Data Connectivity mode</strong> is set to <strong class="screentext">Import</strong>. Enter the name of your SQL server as well as <a id="calibre_link-38" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">AdventureWorksDW2019</strong> database. In <em class="italic">Figure 2.1</em>, my SQL server is installed locally and running under the instance <strong class="screentext">MSSQLSERVERDEV</strong>. Thus, I set the server to be <strong class="screentext">localhost\MSSQLSERVERDEV</strong> to specify both the server (localhost) and the instance. If you leave the <strong class="screentext">Database</strong> field blank, this will simply result in an extra navigation step to select the desired database.<figure class="mediaobject"><img src="images/000151.png" alt="Graphical user interface, application  Description automatically generated" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.1: SQL Server Get Data dialog</p>
      </li>
      <li class="calibre12">If this is the<a id="calibre_link-602" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> first time connecting to this database from Power BI, you<a id="calibre_link-597" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> may be prompted for some credentials. In addition, you may also be warned that an encrypted connection cannot be made to the server. Simply enter the correct credentials for connecting and click the <strong class="screentext">Connect</strong> button. For the encryption warning, simply click the <strong class="screentext">OK</strong> button to continue.</li>
      <li class="calibre12">A navigation window will appear, with the different objects and schemas of the database. Select the <strong class="screentext">DimGeography</strong> table from the <strong class="screentext">Navigator</strong> window and click the <strong class="screentext">Transform Data</strong> button.</li>
      <li class="calibre12">The Power Query Editor launches in a new window with a query called <strong class="screentext">DimGeography</strong>; preview data from that table is displayed in the center of the window. In the Power Query Editor window, use the scroll bar at the bottom of the central display area to find the column called <strong class="screentext">EnglishCountryRegionName</strong>. You can also select a column and then click <strong class="screentext">Go to Column</strong> in the ribbon of the <strong class="screentext">View</strong> menu to search for and navigate to a column quickly. Click the small button in the column header next to this column to display a sorting and filtering drop-down<a id="calibre_link-1379" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> menu.<p class="packt_figref">Uncheck the <strong class="screentext">(Select All)</strong> option to deselect all <a id="calibre_link-598" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>values and then check the box next to a country, such as the <strong class="screentext">United States,</strong> before clicking the <strong class="screentext">OK</strong> button.</p>
        <figure class="mediaobject"><img src="images/000164.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 2.2: Filtering for United States only in the Query Editor</p>
    <p class="book-title--packt">Note that the button for the <strong class="screentext">EnglishCountryRegionName</strong> column changes to display a funnel icon. Also notice that, in the <strong class="screentext">Query Settings</strong> pane on the right side of the window, a new option under <strong class="screentext">APPLIED STEPS</strong> has appeared called <strong class="screentext">Filtered Rows</strong>.</p>
    <figure class="mediaobject"><img src="images/000177.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.3: The Query Settings pane in the Query Editor</p>
    <h2 id="calibre_link-1380" class="calibre8">How to View and Analyze M Functions</h2>
    <p class="book-title--packt">There are two <a id="calibre_link-603" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>methods for viewing and analyzing the M functions <a id="calibre_link-599" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>comprising a query; they are as follows:</p>
    <ul class="calibre9">
      <li class="bullet">Formula bar</li>
      <li class="bullet">Advanced Editor</li>
    </ul>
    <p class="book-title--packt">The formula bar<a id="calibre_link-510" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> exposes the M function for the current step only. This formula bar appears just above the column headers for the preview data in the central part of the window. If you do not see this formula bar, click the <strong class="screentext">View</strong> tab and check the box next to <strong class="screentext">Formula Bar</strong> in the <strong class="screentext">Layout</strong> section of the ribbon. All such areas of interest are boxed in red in <em class="italic">Figure 2.4</em>.</p>
    <figure class="mediaobject"><img src="images/000190.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.4: The Power Query Editor formula bar</p>
    <p class="book-title--packt">When the <strong class="screentext">Source</strong> step is selected under <strong class="screentext">APPLIED STEPS</strong> in the <strong class="screentext">Query Settings</strong> pane, as seen in <em class="italic">Figure 2.3</em>, we see the connection information specified on the initial dialog after selecting <strong class="screentext">Get Data</strong> and then <strong class="screentext">SQL Server</strong>. The M function being used is <code class="code-in-text--packt">Sql.Database</code>. This function is accepting two parameters: the server name, <code class="code-in-text--packt">localhost\MSSQLSERVERDEV</code>, and the database name, <code class="code-in-text--packt">AdventureWorksDW2019</code>. Clicking on other steps under <strong class="screentext">APPLIED STEPS</strong> exposes the formulas for those steps, which are technically individual M expressions.</p>
    <p class="book-title--packt">The formula <a id="calibre_link-1381" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>bar is useful to quickly understand the M code behind a particular <a id="calibre_link-1382" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query step. However, it is more convenient and often essential to view and edit all the <a id="calibre_link-1383" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>expressions in a centralized window. This is the purpose of the <strong class="screentext">Advanced Editor</strong>.<strong class="screentext"> </strong>To launch the <strong class="screentext">Advanced Editor</strong>, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Click on the <strong class="screentext">Home</strong> tab <a id="calibre_link-33" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and then select <strong class="screentext">Advanced Editor</strong> from the <strong class="screentext">Query</strong> section of the ribbon, as shown in <em class="italic">Figure 2.5</em>. Alternatively, the <strong class="screentext">Advanced Editor</strong> can also be accessed from the <strong class="screentext">View</strong> tab, shown in <em class="italic">Figure 2.4</em>.<figure class="mediaobject"><img src="images/000202.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.5: Advanced Editor on the Home tab of the Query Editor</p>
      </li>
      <li class="calibre12">The <strong class="screentext">Advanced Editor</strong> dialog is displayed, exposing all M functions and comments that comprise the query. The M code can be directly edited from within this dialog.<figure class="mediaobject"><img src="images/000213.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 2.6: The Advanced Editor view of the DimGeography query</p>
    <p class="book-title--packt">As shown in <em class="italic">Figure 2.6</em>, using <a id="calibre_link-34" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Advanced Editor</strong> will mean that all of the Power Query code that comprises the query can be viewed in one place.</p>
    <h2 id="calibre_link-1384" class="calibre8">How it works</h2>
    <p class="book-title--packt">The majority of queries<a id="calibre_link-604" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> created for Power BI follow the <code class="code-in-text--packt">let...in</code> structure, as per<a id="calibre_link-600" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe. Within the <code class="code-in-text--packt">let</code> block, there are multiple steps with dependencies among those steps. For example, the second step, <strong class="screentext">dbo_DimGeography</strong>, references the previous step, <strong class="screentext">Source</strong>. Individual expressions are separated by commas, and the expression referred to following the <code class="code-in-text--packt">in</code> keyword is the expression returned by the query. The individual step expressions are technically <a id="calibre_link-1122" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>known as "variables". </p>
    <p class="book-title--packt">Variable names in M expressions cannot have spaces without being preceded by a hash sign and enclosed in double quotes. When the Query Editor graphical interface is used to create M queries, this syntax is applied automatically, along with a name describing the M transformation applied. This behavior can be seen in the <strong class="screentext">Filtered Rows</strong> step in <em class="italic">Figure 2.6. </em>Applying short, descriptive variable names (with no spaces) improves the readability of M queries.</p>
    <p class="book-title--packt">Note the three lines below the <code class="code-in-text--packt">let</code> statement. These three lines correspond to the three <strong class="screentext">APPLIED STEPS</strong> in our query: <strong class="screentext">Source</strong>, <strong class="screentext">Navigation</strong>, and <strong class="screentext">Filtered Rows</strong>. The query returns the information from the last step of the query, <strong class="screentext">Filtered Rows</strong>. As more steps are applied, these steps will be inserted above the <code class="code-in-text--packt">in</code> statement and the line below this will change to reference the final step in the query.</p>
    <p class="book-title--packt">M is a case-sensitive language. This includes referencing variables in M expressions (<code class="code-in-text--packt">RenameColumns</code> versus <code class="code-in-text--packt">Renamecolumns</code>) as well as the values in M queries. For example, the values "Apple" and "apple" are considered unique values in an M query.</p>
    <p class="book-title--packt">It is recommended to use the Power Query Editor user interface when getting started with a new query and when learning the M language. After several steps have been applied, use <strong class="screentext">Advanced Editor</strong> to review and optionally enhance or customize the M query. As a rich, functional programming language, there are many M functions and optional parameters not exposed via the Power Query Editor's graphical user interface. Going beyond the limits of the Power Query Editor enables more robust data retrieval, integration, and data mashup processes.</p>
    <p class="book-title--packt">The M engine<a id="calibre_link-594" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> also<a id="calibre_link-606" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> has powerful "lazy evaluation" logic for ignoring any redundant <a id="calibre_link-605" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>or unnecessary variables, as well as short-circuiting evaluation (computation) once a result is determinate, such as when one side (operand) of an <code class="code-in-text--packt">OR</code> logical operator is computed as <code class="code-in-text--packt">True</code>. Lazy evaluation<a id="calibre_link-568" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> allows the M query engine to reduce the required resources for a given query by ignoring any unnecessary or redundant steps (variables). The order of evaluation of the expressions is determined at runtime&mdash;it doesn't have to be sequential from top to bottom.</p>
    <p class="book-title--packt">In the following example, presented in <em class="italic">Figure 2.7</em>, a step for retrieving <code class="code-in-text--packt">Canada</code> was added and the <code class="code-in-text--packt">"Filtered Rows"</code> step for filtering the results for the <code class="code-in-text--packt">United States</code> was ignored. Since the <code class="code-in-text--packt">CanadaOnly</code> variable satisfies the overall <code class="code-in-text--packt">let</code> expression of the query, only the <code class="code-in-text--packt">Canada</code> query is issued to the server as if the <code class="code-in-text--packt">"Filtered Rows"</code> step were commented out or omitted.</p>
    <figure class="mediaobject"><img src="images/000225.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.7: Revised query that ignores the "Filtered Rows" step to evaluate Canada only</p>
    <p class="book-title--packt">As a review of the concepts covered thus far and for future reference, <em class="italic">Table 2.1</em> presents a glossary of the main concepts of the M language utilized in this book.</p>
    <table id="calibre_link-1385" class="no-table-style">
      <colgroup class="calibre15">
        <col class="calibre16"></col>
        <col class="calibre16"></col>
      </colgroup>
      <tbody class="calibre17">
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Concept</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Definition</p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Expression</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Formulas evaluated <a id="calibre_link-471" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to yield a single value. Expressions can reference other values, such<a id="calibre_link-615" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> as functions, and may include operators.</p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Value</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">The result of<a id="calibre_link-1120" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> evaluating an expression. Values can be categorized into types which<a id="calibre_link-620" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are either primitive, such as text ("abc"), or structured kinds, such as tables and lists.</p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Function</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">A value that<a id="calibre_link-511" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> produces a new one based on the mapping of input values to the parameters of the <a id="calibre_link-616" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>function. Functions can be invoked by passing parameter values<strong class="screentext">.</strong></p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Type</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">A value<a id="calibre_link-1109" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> that classifies other values. The structure and behavior of values are restricted based on the <a id="calibre_link-619" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>classification of their type, such as Record, List, or Table.</p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><code class="code-in-text--packt1">let</code></p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">An expression that<a id="calibre_link-569" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> allows a set of unique expressions to be assigned names (variables) and evaluated (if necessary) when evaluating the expression<a id="calibre_link-617" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following the in expression in a let...in construct.</p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Variable</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">A unique, named<a id="calibre_link-1121" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> expression within an environment to be conditionally <a id="calibre_link-621" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>evaluated. Variables are represented as Applied Steps in the Query Editor.</p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Environment</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">A set of variables to <a id="calibre_link-613" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>be evaluated. The global environment<a id="calibre_link-441" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> containing the M library is exposed to root expressions.</p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Evaluation</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">The computation of expressions. Lazy evaluation<a id="calibre_link-442" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is applied to expressions <a id="calibre_link-614" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>defined within let expressions; evaluation occurs only if needed.</p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Operators</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">A set of <a id="calibre_link-618" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>symbols used in expressions to define the computation. The evaluation of operators<a id="calibre_link-690" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> depends on the values to be operated on.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="book-title--packt">Table 2.1: M Language elements</p>
    <h2 id="calibre_link-1386" class="calibre8">There's more...</h2>
    <p class="book-title--packt">M queries are not intended as a substitute for the data loading and transformation workloads typically handled by enterprise data integration and orchestration tools such as <strong class="screentext">Azure Data Factory</strong> (<strong class="screentext">ADF</strong>), Azure Databricks, or <strong class="screentext">SQL Server Integration Services</strong> (<strong class="screentext">SSIS</strong>). However, just as BI professionals carefully review the logic and test the performance of SQL stored procedures and ETL packages supporting their various cubes and reporting environments, they should also review the M queries created to support Power BI models and reports. When developing retrieval processes for Power BI models, consider these common ETL questions:</p>
    <ul class="calibre9">
      <li class="bullet">How are queries <a id="calibre_link-791" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>impacting the source systems?</li>
      <li class="bullet">Can we make our queries more resilient to changes in source data so that they avoid failure?</li>
      <li class="bullet">Are our queries efficient and simple to follow and support, or are there unnecessary steps and queries?</li>
      <li class="bullet">Are our queries delivering sufficient performance to the BI application?</li>
      <li class="bullet">Is our process flexible, such that we can quickly apply changes to data sources and logic?</li>
      <li class="bullet">Can some or all of the required transformation logic be implemented in a source system such as the loading process for a data warehouse table or a SQL view?</li>
    </ul>
    <p class="book-title--packt">One of the top performance and scalability features of M's query engine is called Query Folding. If possible, the <a id="calibre_link-914" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>M queries developed in Power BI Desktop are converted ("folded") into SQL statements and passed to source systems for processing. </p>
    <p class="book-title--packt">If we use the original version of the query from this recipe, as shown in <em class="italic">Figure 2.6</em>, we can see Query Folding in action. The query from this recipe was folded into the following SQL statement and sent to the server for processing, as opposed to the M query engine performing the processing locally. To see how this works, perform the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Right-click on the <strong class="screentext">Filtered Rows</strong> step in the <strong class="screentext">APPLIED STEPS</strong> section of the <strong class="screentext">Query Settings</strong> pane, and select <strong class="screentext">View Native Query.</strong>
        <figure class="mediaobject"><img src="images/000236.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.8: View Native Query in Query Settings</p>
      </li>
      <li class="calibre12">The <strong class="screentext">Native Query</strong> dialog is then <a id="calibre_link-669" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>displayed, as shown in <em class="italic">Figure 2.9</em>.<figure class="mediaobject"><img src="images/000249.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 2.9: The SQL statement generated from the DimGeography M query</p>
    <p class="book-title--packt">Finding and<a id="calibre_link-670" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> revising queries that are not being folded to source systems is a top technique for enhancing large Power BI datasets. See the <em class="italic">Pushing Query Processing Back to Source Systems</em> recipe of <em class="italic">Chapter 11</em>, <em class="italic">Enhancing and Optimizing Existing Power BI Solutions</em>, for an example of this process.</p>
    <p class="book-title--packt">The M query engine also supports <a id="calibre_link-715" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>partial query folding. A query can be "partially folded", in which a SQL statement is created resolving only part of an overall query. The results of this SQL statement would be returned to Power BI Desktop (or the on-premises data gateway) and the remaining logic would be computed using M's in-memory engine with local resources. M queries can be designed to maximize the use of the source system resources, by using standard expressions supported by query folding early in the query process. Minimizing the use of local or on-premises data gateway resources is a top consideration for improving query performance.</p>
    <p class="book-title--packt">There are limits, however, to query folding. For example, no folding takes place once a native SQL query has been passed to the source system, such as when passing a SQL query directly through the <strong class="screentext">Get Data</strong> dialog using the <strong class="screentext">Advanced options</strong>. <em class="italic">Figure 2.10</em> displays a query specified in the <strong class="screentext">Get Data</strong> dialog, which is included in the <strong class="screentext">Source</strong> step.</p>
    <figure class="mediaobject"><img src="images/000260.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.10: Providing a user-defined native SQL query</p>
    <p class="book-title--packt">Any<a id="calibre_link-1111" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> transformations applied after this native query will use local system resources. Therefore, the general implication for query development with native or user-defined SQL queries is that if they are used, try to include all required transformations (that is, joins and derived columns), or use them to utilize an important feature of the source database that is not being utilized by the folded query, such as an index.</p>
    <p class="book-title--packt">Some other things to keep in mind regarding Query Folding are the following:</p>
    <ul class="calibre9">
      <li class="bullet">Not all data sources support <a id="calibre_link-915" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Query Folding, such as text and Excel files.</li>
      <li class="bullet">Not all transformations available in the Query Editor or via M functions are directly supported by some data sources.</li>
      <li class="bullet">The privacy levels defined for the data sources will also impact whether folding is used or not.</li>
      <li class="bullet">SQL statements are not<a id="calibre_link-1387" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> parsed before they are sent to the source system.</li>
      <li class="bullet">The <code class="code-in-text--packt">Table.Buffer</code> function can be used to avoid query folding. The table output of this function is loaded into local memory, and transformations against it will remain local.</li>
    </ul>
    <h2 id="calibre_link-1388" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power Query M language <a id="calibre_link-848" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>specification: <a href="https://docs.microsoft.com/en-gb/powerquery-m/power-query-m-language-specification" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2oaJWwv</span></a></li>
      <li class="bullet">Power Query M Function<a id="calibre_link-847" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> reference: <a href="http://bit.ly/3bLKJ1M" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3bLKJ1M</span></a></li>
    </ul>
    <h1 id="calibre_link-1186" class="title">Managing Queries and Data Sources</h1>
    <p class="book-title--packt">There are two primary components of queries in Power BI: the data source and the query logic executed against this source. The<a id="calibre_link-291" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> data source includes the connection method (<strong class="screentext">DirectQuery</strong> or <strong class="screentext">Import</strong>), a privacy setting, and the authentication credentials. The query logic<a id="calibre_link-920" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> consists of the M expressions represented as queries in the Query Editor and stored internally as M documents.</p>
    <p class="book-title--packt">In a typical corporate BI tool, such <a id="calibre_link-1030" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>as <strong class="screentext">SQL Server Reporting Services</strong> (<strong class="screentext">SSRS</strong>), the properties of a data source such as the server and database name are defined separately from the queries that reference them. In Power BI Desktop, however, by default, each individual query created explicitly references a given data source (for example, server A and database B). This creates an onerous, manual process of revising each query if it becomes necessary to change the source environment or database.</p>
    <p class="book-title--packt">This issue is <a id="calibre_link-894" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>addressed in the following steps by using dedicated M queries to <a id="calibre_link-292" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>centralize and isolate the data source information from the individual queries. Additionally, detail and reference information is provided on managing source credentials and data source privacy levels.</p>
    <h2 id="calibre_link-1389" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, we will create a query from a database, which will serve as the source for other queries via the standard <strong class="screentext">Get Data</strong> and Power Query Editor experience described in the previous recipe. To create this query, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">If you have already connected to your SQL Server, you can find the connection under <strong class="screentext">Recent sources</strong> on the <strong class="screentext">Home</strong> tab. Otherwise, on the <strong class="screentext">Home</strong> tab, select <strong class="screentext">Get Data</strong> from the ribbon, and choose <strong class="screentext">SQL Server</strong>.</li>
      <li class="calibre12">Select a table or view, and click on <strong class="screentext">Transform Data</strong> to import the data.</li>
      <li class="calibre12">The <strong class="screentext">Power Query Editor</strong> window will launch and a preview of the data will appear. In this example, we have chosen the <code class="code-in-text--packt">DimEmployee</code> table from the <strong class="screentext">AdventureWorksDW2019</strong> database on our local SQL Server instance <strong class="screentext">MSSQLSERVERDEV</strong>. The full code of the query can be viewed in the <strong class="screentext">Advanced Editor</strong> window but is also shown below.
        <pre class="programlisting"><code class="hljs">let
<code class="codehighlighted">    </code><span><strong class="screentext">Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019"),</strong></span>
    dbo_DimEmployee = Source{[Schema="dbo",Item="DimEmployee"]}[Data]
in
    dbo_DimEmployee
</code></pre>
      </li>
      <li class="calibre12">Copy just the <strong class="screentext">Source</strong> line (in bold in the previous step).</li>
      <li class="calibre12">Close the <strong class="screentext">Advanced Editor</strong> window by clicking the <strong class="screentext">Cancel</strong> button.</li>
      <li class="calibre12">Remain in the <strong class="screentext">Power Query Editor</strong> window.</li>
    </ol>
    <h2 id="calibre_link-1390" class="calibre8">How to Manage Queries and Data Sources</h2>
    <p class="book-title--packt">In this example, a<a id="calibre_link-895" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> separate data source connection query is created and utilized by <a id="calibre_link-293" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>individual queries. By associating many individual queries with a single (or a few) data source queries, it is easy to change the source system or environment, such as when switching from a <strong class="screentext">Development</strong> environment <a id="calibre_link-382" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to a <strong class="screentext">User Acceptance Testing</strong> (<strong class="screentext">UAT</strong>) environment. We will then<a id="calibre_link-1110" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> further separate out our data source queries and our data load queries using query groups. To start isolating our data source queries<a id="calibre_link-288" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> from our data load queries, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a new, blank query by selecting <strong class="screentext">New Source</strong> from the ribbon of the <strong class="screentext">Home</strong> tab and then select <strong class="screentext">Blank Query</strong>.</li>
      <li class="calibre12">Open the <strong class="screentext">Advanced Editor</strong> and replace the <strong class="screentext">Source</strong> line with the line copied from the query created in <strong class="screentext">Getting ready</strong>. Be certain to remove the comma (,) at the end of the line. The line prior to the <code class="code-in-text--packt">in</code> keyword should never have a comma at the end of it. Your query should look like the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Done</strong> button to close the <strong class="screentext">Advanced Editor</strong> window.</li>
      <li class="calibre12">Rename <a id="calibre_link-289" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the query by clicking on the query and editing the <strong class="screentext">Name</strong> in the <strong class="screentext">Query Settings </strong>pane. Alternatively, in the <strong class="screentext">Queries</strong> pane, right-click the query and choose <strong class="screentext">Rename</strong>. Give the source query an intuitive name, such as <code class="code-in-text--packt">AdWorksDW</code>.</li>
      <li class="calibre12">Now click on the original query created in the <em class="italic">Getting ready</em> section above. Open the <strong class="screentext">Advanced Editor</strong>. Replace the <strong class="screentext">Source</strong> step expression of the query with the name of the new query. As you type the name of the query, <strong class="screentext">AdWorksDW</strong>, you will notice that IntelliSense will suggest possible values. The query should now look like the following:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimEmployee = Source{[Schema="dbo",Item="DimEmployee"]}[Data]
in
    dbo_DimEmployee
</code></pre>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Done</strong> button to come out of <strong class="screentext">Advanced Editor</strong>. The preview data refreshes but continues to display the same data as before.</li>
    </ol>
    <p class="book-title--packt">We can take this concept <a id="calibre_link-896" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of isolating our data source queries from data loading queries<a id="calibre_link-294" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> further by organizing our queries into query groups. You should also use query groups to help isolate data source and staging queries from queries loaded to the dataset. To see how query groups work, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Duplicate the revised data loading query that loads the <strong class="screentext">DimEmployee</strong> table, created in <strong class="screentext">Getting ready</strong>. Simply right-click the query in the <strong class="screentext">Queries</strong> pane and choose <strong class="screentext">Duplicate</strong>.</li>
      <li class="calibre12">With the new query selected in the <strong class="screentext">Queries</strong> pane, click the gear icon next to the <strong class="screentext">Navigation</strong> step in the <strong class="screentext">APPLIED STEPS</strong> area of the <strong class="screentext">Query Settings</strong> pane.</li>
      <li class="calibre12">Choose a different dimension table or view, such as <strong class="screentext">DimAccount</strong>, and then click the <strong class="screentext">OK</strong> button. Dimension tables and views start with "Dim".</li>
      <li class="calibre12">Rename this new query to reflect the new table or view being loaded.</li>
      <li class="calibre12">Create a new group by right-clicking in a blank area in the <strong class="screentext">Queries</strong> window and then selecting <strong class="screentext">New Groupâ¦</strong></li>
      <li class="calibre12">In the <strong class="screentext">New Group</strong> dialog, name the group <strong class="screentext">Data Sources</strong> and click the <strong class="screentext">OK</strong> button.</li>
      <li class="calibre12">Create another new group and name this group <strong class="screentext">Dimensions</strong>.</li>
      <li class="calibre12">Move the <strong class="screentext">AdWorksDW</strong> query to the <strong class="screentext">Data Sources</strong> group by either dragging and dropping in the <strong class="screentext">Queries</strong> pane or right-clicking the query and choosing <strong class="screentext">Move To Groupâ¦</strong>, and then select the group.</li>
      <li class="calibre12">Move the other queries to the <strong class="screentext">Dimensions</strong> group.</li>
      <li class="calibre12">Finally, ensure<a id="calibre_link-290" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> that the query in the <strong class="screentext">Data Source</strong> group <a id="calibre_link-1391" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is not actually loaded as a separate table in the data model. Right-click on the query and uncheck the <strong class="screentext">Enable Load</strong> option. This makes the query available to support data retrieval queries but makes the query invisible to the model and report layers. The query name will now be italicized in the <strong class="screentext">Queries</strong> pane.</li>
    </ol>
    <p class="book-title--packt">Your <strong class="screentext">Queries</strong><strong class="screentext"><a id="calibre_link-897" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong> pane should <a id="calibre_link-295" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>now look similar to that in <em class="italic">Figure 2.11</em>:</p>
    <figure class="mediaobject"><img src="images/000271.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.11: Queries organized into query groups</p>
    <h2 id="calibre_link-1392" class="calibre8">How it works</h2>
    <p class="book-title--packt">The <strong class="screentext">Query Dependencies</strong> view<a id="calibre_link-903" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in Power Query provides a visual representation of the relationships between the various queries. You can access this dialog by using the <strong class="screentext">View</strong> tab and then selecting <strong class="screentext">Query Dependencies</strong> in the ribbon.</p>
    <figure class="mediaobject"><img src="images/000284.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.12: The Query Dependencies View in Query Editor</p>
    <p class="book-title--packt">In this <a id="calibre_link-904" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>example, a single <a id="calibre_link-898" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query with only one expression is used by multiple queries, but <a id="calibre_link-296" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>more complex interdependencies can be designed to manage the behavior and functionality of the retrieval and analytical queries. This recipe illustrates the broader concept used in later recipes called "composability", where functions call other functions; this is one of the primary strengths of functional programming languages such as M, DAX, R, and F#.</p>
    <h2 id="calibre_link-1393" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Power BI Desktop saves data source credentials for each data source defined, as well as a privacy level for that source. It is often necessary to modify these credentials as passwords change. In addition, setting privacy levels on data sources helps prevent confidential information from being exposed to external sources during the Query Folding process. Data source credentials and settings are not stored in the PBIX file, but rather on the computer of the installed application.</p>
    <p class="book-title--packt">To manage data source credentials and privacy levels, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">From<a id="calibre_link-285" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Power BI Desktop (not the Power Query Editor), click on <strong class="screentext">File</strong> in the menu, then click <strong class="screentext">Options and settings</strong>, and finally click <strong class="screentext">Data source settings</strong>.</li>
      <li class="calibre12">Click on the <strong class="screentext">Global Permissions</strong> radio button such that your settings are persisted into other Power BI Desktop reports.</li>
      <li class="calibre12">Select a data source.</li>
      <li class="calibre12">Click the <strong class="screentext">Edit Permissions</strong> button.</li>
      <li class="calibre12">From the <strong class="screentext">Edit Permissions </strong>dialog, you can click the <strong class="screentext">Edit</strong> button under the <strong class="screentext">Credentials</strong> heading to set the authentication credentials for the data source. In addition, you can set the privacy level for the data source using the drop-down under the <strong class="screentext">Privacy Level</strong> heading. Click <strong class="screentext">OK</strong> to save your settings.<figure class="mediaobject"><img src="images/000296.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 2.13: Edit credentials and privacy level for a data source</p>
    <p class="book-title--packt">Definitions of the available <strong class="screentext">Privacy Level</strong> settings are provided in <em class="italic">Table 2.2</em>.</p>
    <table id="calibre_link-1394" class="no-table-style">
      <colgroup class="calibre15">
        <col class="calibre16"></col>
        <col class="calibre16"></col>
      </colgroup>
      <tbody class="calibre17">
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><strong class="screentext">Privacy Setting</strong></p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><strong class="screentext">Description</strong></p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">None</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">No<a id="calibre_link-853" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> privacy level defined.</p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Private</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">A Private data <a id="calibre_link-855" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>source is completely isolated from <a id="calibre_link-858" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>other data sources during query retrieval. For example, marking a text file Private would prevent that data from being processed on an external server.</p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Organizational</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">An Organizational data source<a id="calibre_link-854" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is isolated from all <a id="calibre_link-694" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>public data sources but is visible to other organizational data sources during retrieval.</p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Public</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">A Public data source <a id="calibre_link-856" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is visible to other sources. Only files, internet <a id="calibre_link-862" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>sources, and workbook data can be marked as Public.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="book-title--packt">Table 2.2: Privacy Level Settings</p>
    <p class="book-title--packt">Just as relational databases such as SQL Server consider many potential query plans, the M engine also searches for the most efficient methods of executing queries, given that the data sources and query logic are defined. In the absence of data source privacy settings, the M engine is allowed to consider plans that merge disparate data sources. For example, a local text file of customer names can be merged with an external or third-party server, given the better performance of the server. Defining privacy settings isolates data sources from these operations thus increasing the likelihood of local resource usage, and hence query performance may be reduced.</p>
    <h2 id="calibre_link-1395" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Authentication <a id="calibre_link-98" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>with a data source: <a href="http://bit.ly/30It2tV" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/30It2tV</span></a></li>
      <li class="bullet">Power BI Desktop<a id="calibre_link-857" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> privacy levels: <a href="http://bit.ly/29blFBR" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/29blFBR</span></a></li>
    </ul>
    <h1 id="calibre_link-1187" class="title">Using DirectQuery</h1>
    <p class="book-title--packt">One of the most<a id="calibre_link-392" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> valuable features of Power BI is its deep support for real-time and streaming datasets, with the ability to provide immediate visibility to business processes and events as this data is created or updated. As Power BI Desktop's data modeling engine reflects the<a id="calibre_link-60" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> latest <strong class="screentext">Analysis Services</strong> features, it becomes feasible to design DirectQuery models or composite models (DirectQuery and import) in Power BI Desktop, and thus avoid the scalability limitations and scheduled refresh requirements of models based on importing data.</p>
    <p class="book-title--packt">The three most common candidates for DirectQuery or composite model projects<a id="calibre_link-168" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are as follows:</p>
    <ul class="calibre9">
      <li class="bullet">The data model would consume an exorbitant amount of memory if all tables were fully loaded into memory. Even if the memory size is technically supported by large Power BI Premium capacity nodes, this would be a very inefficient and expensive use of company resources as most BI queries only access aggregated data representing a fraction of the size. Composite models which mix DirectQuery and Dual storage mode tables with in-memory aggregation tables is the recommended architecture for large models going forward.</li>
      <li class="bullet">Access to near-real-time data is of actionable or required value to users or other applications, such as is the case with notifications. For example, an updateable Nonclustered Columnstore index could be created on OLTP disk-based tables or memory-optimized tables in SQL Server to provide near-real-time access to database transactions.</li>
      <li class="bullet">A high-performance and/or read-optimized system is available to service report queries, such as a SQL Server or Azure SQL Database, with the Clustered Columnstore index applied to fact tables.</li>
    </ul>
    <p class="book-title--packt">This recipe walks through the primary steps in designing the data access layer that supports a DirectQuery model in Power BI Desktop. As these models are not cached into memory and dynamically convert the DAX queries from report visualizations to SQL statements, guidance is provided to maintain performance. Additional details, resources, and documentation on DirectQuery's current limitations and comparisons with the default import mode are also included to aid your design decision.</p>
    <h2 id="calibre_link-1396" class="calibre8">Getting ready</h2>
    <ol class="calibre9">
      <li class="calibre12" value="1">Choose a database to serve<a id="calibre_link-393" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> as the source for the DirectQuery data model.</li>
      <li class="calibre12">Create a logical and physical design of the fact and dimension tables of the model including the relationship keys and granularity of the facts. The AdventureWorksDW database is a good example of data designed in this manner.</li>
      <li class="calibre12">Determine or confirm that each fact-to-dimension relationship has referential integrity. Providing this information to the DirectQuery model allows for more performant inner join queries.</li>
      <li class="calibre12">Create view objects in the source database to provide efficient access to the dimensions and facts defined in the physical design.</li>
    </ol>
    <p class="book-title--packt">Be aware that DirectQuery models are limited to a single source database and not all databases are supported for DirectQuery. If multiple data sources are needed, such as SQL Server and Oracle, or Teradata and Excel, then the default Import mode model, with a scheduled refresh to the Power BI Service, will be the only option.</p>
    <h2 id="calibre_link-1397" class="calibre8">How to use DirectQuery</h2>
    <p class="book-title--packt">For this recipe, we will use the <strong class="screentext">AdventureWorksDW2019</strong> database that has been used thus far in this chapter. To implement this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a new Power BI Desktop file.</li>
      <li class="calibre12">From the <strong class="screentext">Home</strong> tab, click on <strong class="screentext">Get Data</strong> in the ribbon and then <strong class="screentext">SQL Server</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Data Connectivity</strong> <strong class="screentext">mode</strong> section, choose the <strong class="screentext">DirectQuery</strong> radio option.<figure class="mediaobject"><img src="images/000308.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.14: Creating a DirectQuery data source</p>
      </li>
      <li class="calibre12">Select a table or view to be<a id="calibre_link-394" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> used by the model via the <strong class="screentext">Navigator </strong>dialog, such as the <strong class="screentext">FactResellerSales</strong> table, and then click the <strong class="screentext">Transform Data</strong> button.</li>
      <li class="calibre12">Duplicate the initial query and revise the <strong class="screentext">Navigation</strong> step to reference an additional view supporting the model, such as the <strong class="screentext">DimReseller</strong>. This can be done by editing the <code class="code-in-text--packt">Item</code> in the formula bar or by clicking on the gear icon next to the <strong class="screentext">Navigation</strong> step under <strong class="screentext">APPLIED STEPS</strong> in the <strong class="screentext">Query Settings</strong> pane. Also, rename this query to reflect the data being referenced.<figure class="mediaobject"><img src="images/000320.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.15: Editing the Navigation step in the formula bar</p>
      </li>
      <li class="calibre12">Repeat <em class="italic">step 5</em> for all required facts and dimensions. For example:<ul class="calibre11">
          <li class="calibre12"><code class="code-in-text--packt">DimEmployee</code></li>
          <li class="calibre12"><code class="code-in-text--packt">DimPromotion</code></li>
          <li class="calibre12"><code class="code-in-text--packt">DimCurrency</code></li>
          <li class="calibre12"><code class="code-in-text--packt">DimSalesTerritory</code></li>
        </ul>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Close</strong> <strong class="screentext">and</strong> <strong class="screentext">Apply</strong> button.</li>
    </ol>
    <p class="book-title--packt">The <strong class="screentext">Report Canvas</strong> view will confirm that the model is in <strong class="screentext">DirectQuery</strong> mode via the status bar at the bottom right (see <em class="italic">Figure 2.16</em>). In addition, the <strong class="screentext">Data</strong> view in the left-hand pane, which is visible for import models, will not be visible.</p>
    <figure class="mediaobject"><img src="images/000108.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.16: DirectQuery Status in Power BI Desktop</p>
    <h2 id="calibre_link-1398" class="calibre8">How it works</h2>
    <p class="book-title--packt">The M transformation<a id="calibre_link-395" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> functions supported in DirectQuery are limited by compatibility with the source system. The Power Query Editor will advise when a transformation is not supported in <strong class="screentext">DirectQuery</strong> mode, per <em class="italic">Figure 2.17</em>.</p>
    <figure class="mediaobject"><img src="images/000157.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.17: A warning in Query Editor that the IsEven function is not supported in DirectQuery mode</p>
    <p class="book-title--packt">Given this limitation and the additional complexity the M-based transforms would add to the solution, it is recommended that you embed all the necessary logic and transforms in the source relational layer. Ideally, the base tables in the source database themselves would reflect these needs. As a secondary option, a layer of views can be created to support the DirectQuery model.</p>
    <p class="book-title--packt">If the database objects themselves cannot be revised, the <code class="code-in-text--packt">Value.Native</code> M function can be used to directly pass the SQL statement from Power BI Desktop to the source database, as per <em class="italic">Figure 2.18</em>.</p>
    <figure class="mediaobject"><img src="images/000058.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.18: The Value.Native function used to pass a SQL statement to a source system</p>
    <p class="book-title--packt">As report visualizations are<a id="calibre_link-1399" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> refreshed or interacted with in Power BI, the DAX queries from each visualization are translated into SQL statements, utilizing the source SQL statements to return the results. Be aware that Power BI does cache query results with DirectQuery models. Therefore, when accessing a recently utilized visual, a local cache may be used rather than a new query sent to the source.</p>
    <p class="book-title--packt">The SQL statements passed from Power BI to the DirectQuery data source include all columns from the tables referenced by the visual. </p>
    <p class="book-title--packt">For example, a Power BI visual with <strong class="screentext">SalesAmount</strong> from the <strong class="screentext">FactResellerSales</strong> table grouped by <strong class="screentext">ResellerName</strong> from <strong class="screentext">DimReseller</strong> would result in a SQL statement that selects the columns from both tables and implements the join defined in the model. However, as the SQL statement passed embeds these source views as derived tables, the relational engine is able to generate a query plan that only scans the required columns to support the join and aggregation.</p>
    <h2 id="calibre_link-1400" class="calibre8">There's more...</h2>
    <p class="book-title--packt">The performance and scalability of DirectQuery models are primarily driven by the relational data source. A denormalized star schema with referential integrity and a system that is isolated from OLTP workloads is recommended if near real-time visibility is not required. Additionally, in-memory and columnar features available to supported DirectQuery sources are recommended for reporting and analytical queries.</p>
    <p class="book-title--packt">By default, DirectQuery models <a id="calibre_link-940" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>generate outer join SQL queries to ensure that measures return the correct value even if there's not a related dimension. However, you can configure DirectQuery models to send inner join queries. This is done by editing the relationship between tables in the modeling view by checking the <strong class="screentext">Assume referential integrity</strong> setting (see <em class="italic">Figure 2.19</em>). Along with source system resources, this is one of the top factors contributing to the DirectQuery model's performance.</p>
    <figure class="mediaobject"><img src="images/000046.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.19: Activating referential integrity assumption in relationships</p>
    <p class="book-title--packt">Of course, you should ensure that there is referential integrity in the source before enabling this setting; otherwise, incorrect results could be returned.</p>
    <p class="book-title--packt">The design of the source relational schema and the hardware resources of this system can, of course, greatly impact the performance of DirectQuery models. </p>
    <p class="book-title--packt">A classic star-schema design with denormalized tables is recommended to reduce the required join operations at query time. Optimizing relational fact tables with column store technologies such as the Clustered Columnstore Index for SQL Server and table partitions will also significantly benefit DirectQuery models.</p>
    <h2 id="calibre_link-1401" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop <a id="calibre_link-784" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>DirectQuery documentation: <a href="http://bit.ly/2nUoLOG" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2nUoLOG</span></a></li>
      <li class="bullet">The <em class="italic">Power BI data sources</em> documentation provides a detailed list of data sources broken down by the connectivity options supported: <a href="http://bit.ly/30N5ofG%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/30N5ofG</span></a></li>
    </ul>
    <h1 id="calibre_link-1188" class="title">Importing Data</h1>
    <p class="book-title--packt">Import is the default<a id="calibre_link-549" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> data connectivity mode for Power BI Desktop. Import models created in Power BI Desktop use the same in-memory, columnar compressed storage engine (VertiPaq) featured in Analysis Services Tabular 2016+ import models. Import mode models support the integration of disparate data sources (for example, SQL Server and DB2) and allow more flexibility in developing metrics and row-level security roles via full support for all DAX functions.</p>
    <p class="book-title--packt">There are some limits for Import mode datasets, however. For example, Power BI Pro license users cannot publish Power BI Desktop files to shared capacity in the Power BI service that are larger than 1GB. Power BI Premium (dedicated, isolated hardware) supports datasets of 10GB in <a id="calibre_link-227" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>size and larger (with large datasets enabled, dataset size is limited by the Premium capacity size or the maximum size set by the administrator). With such large datasets, it is important to consider employing incremental refresh where only new and changed data is refreshed and imported, instead of the entire dataset being refreshed.</p>
    <p class="book-title--packt">This recipe describes a process of using M and the Query Editor to develop the Import mode queries for a standard star-schema analytical model. A <strong class="screentext">staging query</strong> approach is introduced as a means of efficiently enhancing the<a id="calibre_link-1052" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> dimensions of a model. In addition, tips are included for using fewer resources during the refresh and avoiding refresh failures from revised source data. More details of these methods are included in other recipes in this chapter.</p>
    <h2 id="calibre_link-1402" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">In this example, the <strong class="screentext">DimProduct</strong>, <strong class="screentext">DimProductSubcategory</strong>, and <strong class="screentext">DimProductCategory</strong> tables from the <strong class="screentext">AdventureWorksDW2019</strong> database are integrated into a single import query. This query includes all product rows, only the English language columns, and user-friendly names. Many-to-one relationships have been defined in the source database.</p>
    <p class="book-title--packt">To prepare for this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Create an Import mode data source query called <strong class="screentext">AdWorksDW</strong>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query<a id="calibre_link-228" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in a query group called <strong class="screentext">Data Sources</strong>.</li>
      <li class="calibre12">Disable loading of this query.</li>
    </ol>
    <p class="book-title--packt">For additional details on performing these steps, see the <em class="italic">Managing Queries and Data Sources</em> recipe in this chapter.</p>
    <h2 id="calibre_link-1403" class="calibre8">How to import data</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Right-click <strong class="screentext">AdWorksDW</strong> and choose <strong class="screentext">Reference</strong>. This creates a new query that references the <strong class="screentext">AdWorksDW</strong> query as its source.</li>
      <li class="calibre12">Select this new query and, in the preview data, find the <strong class="screentext">DimProduct</strong> table in the <strong class="screentext">Name</strong> column. Click on the <strong class="screentext">Table</strong> link in the <strong class="screentext">Data</strong> column for this row.</li>
      <li class="calibre12">Rename this query <strong class="screentext">DimProduct</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">steps 1 &ndash; 3</em> for the <strong class="screentext">DimProductCategory</strong> and <strong class="screentext">DimProductSubcategory</strong> tables.</li>
      <li class="calibre12">Create a new query group called <strong class="screentext">Staging Queries</strong>.</li>
      <li class="calibre12">Move the <strong class="screentext">DimProduct</strong>, <strong class="screentext">DimProductCategory</strong>, and <strong class="screentext">DimProductSubcategory</strong> queries to the <strong class="screentext">Staging</strong> <strong class="screentext">Queries</strong> group.</li>
      <li class="calibre12">Disable loading for all queries in the <strong class="screentext">Staging Queries</strong> group. Your finished set of queries should look similar to <em class="italic">Figure 2.20</em>.<figure class="mediaobject"><img src="images/000144.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.20: Staging Queries</p>
        <p class="packt_figref">The italics indicate that the queries will not be loaded into the model.</p>
      </li>
      <li class="calibre12">Create a new <strong class="screentext">Blank Query</strong> and name this query <strong class="screentext">Products</strong>.</li>
      <li class="calibre12">Open the <strong class="screentext">Advanced Editor</strong> for the <strong class="screentext">Products</strong> query.</li>
      <li class="calibre12">In the <strong class="screentext">Products</strong> query, use the <code class="code-in-text--packt">Table.NestedJoin</code> function to join the <code class="code-in-text--packt">DimProduct</code> and <code class="code-in-text--packt">DimProductSubcategory</code> queries. This is the same function that is used if you were to select the <strong class="screentext">Merge Queries</strong> option in the ribbon of the <strong class="screentext">Home</strong> tab. A left outer <a id="calibre_link-229" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>join is required to preserve all <code class="code-in-text--packt">DimProduct</code> rows, since the foreign key column to <code class="code-in-text--packt">DimProductCategory</code> allows null values.</li>
      <li class="calibre12">Add a <code class="code-in-text--packt">Table.ExpandColumns</code> expression to retrieve the necessary columns from the <code class="code-in-text--packt">DimProductSubcategory</code> table. The <strong class="screentext">Products</strong> query should now have the following code:
        <pre class="programlisting"><code class="hljs">let
    ProductSubCatJoin = 
        Table.NestedJoin(
            DimProduct,"ProductSubcategoryKey",
            DimProductSubcategory,"ProductSubcategoryKey",
            "<span><strong class="screentext">SubCatColumn</strong></span>",JoinKind.LeftOuter
        ),
    ProductSubCatColumns =
        Table.ExpandTableColumn(
            ProductSubCatJoin,"SubCatColumn",
            {"EnglishProductSubcategoryName","ProductCategoryKey"},
            {"<span><strong class="screentext">Product Subcategory</strong></span>", "ProductCategoryKey"}
        )
in
    ProductSubCatColumns
</code></pre>
        <p class="packt_figref">The <code class="code-in-text--packt">NestedJoin</code> function <a id="calibre_link-230" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>inserts the results of the join into a column (<code class="code-in-text--packt">SubCatColumn</code>) as table values. The second expression converts these table values into the necessary columns from the <strong class="screentext">DimProductSubcategory</strong> query and provides the simple <code class="code-in-text--packt">Product Subcategory</code> column name, as shown in <em class="italic">Figure 2.21</em>.</p>
        <figure class="mediaobject"><img src="images/000095.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.21: Product Subcategory Columns Added</p>
        <p class="packt_figref">The query preview in the <strong class="screentext">Power Query Editor</strong> will expose the new columns at the far right of the preview data.</p>
      </li>
      <li class="calibre12">Add another expression beneath the <code class="code-in-text--packt">ProductSubCatColumns</code> expression with a <code class="code-in-text--packt">Table.NestedJoin</code> function that joins the previous expression (the <strong class="screentext">Product to Subcategory</strong> join) with the <code class="code-in-text--packt">DimProductCategory</code> query.</li>
      <li class="calibre12">Just like <em class="italic">step 8</em>, use a <code class="code-in-text--packt">Table.ExpandTableColumn</code> function in a new expression to expose the required <strong class="screentext">Product Category</strong> columns.
        <pre class="programlisting"><code class="hljs">        ),
    
    ProductCatJoin = 
        Table.NestedJoin(
            ProductSubCatColumns,"ProductCategoryKey",
            DimProductCategory,"ProductCategoryKey",
            "ProdCatColumn",JoinKind.LeftOuter
        ),
    ProductCatColumns = 
        Table.ExpandTableColumn(
            ProductCatJoin,"ProdCatColumn",
            {"EnglishProductCategoryName"}, {"Product Category"}
        )
in
    ProductCatColumns
</code></pre>
        <p class="packt_figref">Be certain to add a<a id="calibre_link-231" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> comma after the <code class="code-in-text--packt">ProductSubCatColumns</code> expression. In addition, be sure to change the line beneath the <code class="code-in-text--packt">in</code> keyword to <code class="code-in-text--packt">ProductCatColumns</code>.</p>
        <p class="packt_figref">The expression <code class="code-in-text--packt">ProductCatJoin</code> adds the results of the join to <code class="code-in-text--packt">DimProductCategory</code> (the right table) to the new column (<code class="code-in-text--packt">ProdCatColumn</code>). The next expression, <code class="code-in-text--packt">ProductCatColumns</code> adds the required <strong class="screentext">Product Category</strong> columns and revises the <code class="code-in-text--packt">EnglishProductCategoryName</code> column to <code class="code-in-text--packt">Product Category</code>. A left outer join was necessary with this join operation as well since the product category foreign key column on <code class="code-in-text--packt">DimProductSubcategory</code> allows null values.</p>
      </li>
      <li class="calibre12">Add an expression after the <code class="code-in-text--packt">ProductCatColumns</code> expression that selects the columns needed for the load to the data model with a <code class="code-in-text--packt">Table.SelectColumns</code> function.</li>
      <li class="calibre12">In addition, add a final expression to rename these columns via <code class="code-in-text--packt">Table.RenameColumns</code> to eliminate references to the English language and provide spaces between words.
        <pre class="programlisting"><code class="hljs">        ),
    SelectProductColumns = 
        Table.SelectColumns(ProductCatColumns,
            {
                "ProductKey", "EnglishDescription",
                "EnglishProductName", "Product Subcategory", "Product 
Category"
            }
        ),
    RenameProductColumns = 
        Table.RenameColumns(SelectProductColumns,
            {
                {"EnglishDescription", "Product Description"}, 
                {"EnglishProductName", "Product Name"}
            }
        )
in
    RenameProductColumns
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">Be certain to add a comma after the <code class="code-in-text--packt">ProductCatColumns</code> expression. In addition, change the line beneath the <code class="code-in-text--packt">in</code> keyword to <code class="code-in-text--packt">RenameProductColumns</code>.</p>
    <p class="book-title--packt">The preview in the <strong class="screentext">Power</strong> <strong class="screentext">Query Editor</strong> for the <strong class="screentext">Products</strong> query should now be similar to that shown in <em class="italic">Figure 2.22</em>.</p>
    <figure class="mediaobject"><img src="images/000241.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.22: Product Query Results</p>
    <p class="book-title--packt">It is not necessary<a id="calibre_link-232" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to rename the <code class="code-in-text--packt">ProductKey</code> column since this column will be hidden from the reporting layer. In practice, the product dimension would include many more columns. Closing and applying the changes results in only the <strong class="screentext">Products</strong> table being loaded into the model.</p>
    <p class="book-title--packt">The denormalized <code class="code-in-text--packt">Products</code> table now supports a three-level hierarchy in the Power BI Desktop model to significantly benefit reporting and analysis.</p>
    <figure class="mediaobject"><img src="images/000195.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.23: Product Hierarchy</p>
    <h2 id="calibre_link-1404" class="calibre8">How it works</h2>
    <p class="book-title--packt">The default join kind for <code class="code-in-text--packt">Table.NestedJoin</code> is a left outer join. However, as other join kinds are supported (for example, inner, anti, and full outer), explicitly specifying this parameter in expressions is recommended. Left outer joins are required in the <strong class="screentext">Products</strong> table example, as the foreign key columns on <code class="code-in-text--packt">DimProduct</code> and <code class="code-in-text--packt">DimProductSubcategory</code> both allow null values. Inner joins implemented either via <code class="code-in-text--packt">Table.NestedJoin</code> or <code class="code-in-text--packt">Table.Join</code> functions are recommended for performance purposes otherwise. Additional details on the joining functions as well as tips on designing inline queries as an alternative to staging queries are covered in the <em class="italic">Combining and Merging Queries</em> recipe in this chapter.</p>
    <p class="book-title--packt">When a <a id="calibre_link-1405" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query joins two tables via a <code class="code-in-text--packt">Table.NestedJoin</code> or <code class="code-in-text--packt">Table.Join</code> function, a column is added to the first table containing a <strong class="screentext">Table</strong> object that contains the joined rows from the second table. This column must be expanded using a <code class="code-in-text--packt">Table.ExpandTableColumn</code> function, which generates additional rows as specified by the join operation.</p>
    <p class="book-title--packt">Once all rows are generated by the join and column expansion operations, the specific columns desired in the end result can be specified by the <code class="code-in-text--packt">Table.SelectColumns</code> operation; these columns can then be renamed as desired using the <code class="code-in-text--packt">Table.RenameColumns</code> function.</p>
    <h2 id="calibre_link-1406" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Using <strong class="screentext">Import</strong> mode, we <a id="calibre_link-550" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>can do many things to enhance our queries to aid in report development and display. One such example is that we can add additional columns to provide automatic sorting of an attribute in report visuals. Specifically, suppose that we wish for the United States regional organizations to appear next to one another by default in visualizations. By default, since the <strong class="screentext">Organization</strong> column in the <strong class="screentext">DimOrganization</strong> table in <strong class="screentext">AdventureWorksDW2019</strong> is a text column, the Central Division (a part of the USA), appears between Canada and France based upon the default alphabetical sorting of text columns. We can modify a simple query that pulls the <strong class="screentext">DimOrganization</strong> table to add a<a id="calibre_link-695" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> numeric sorting column. To see how this works, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Using the same Power BI file used for this recipe, open the <strong class="screentext">Power Query Editor</strong>, right-click the <strong class="screentext">AdWorksDW</strong> query, and select <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Choose the <strong class="screentext">DimOrganization</strong> table and rename the query to <strong class="screentext">DimOrganization</strong>.</li>
      <li class="calibre12">Open the <strong class="screentext">Advanced Editor</strong> window for the <strong class="screentext">DimOrganization</strong> query.</li>
      <li class="calibre12">Add a <code class="code-in-text--packt">Table.Sort</code> expression to the import query for the <strong class="screentext">DimOrganization</strong> dimension. The columns for the sort should be at the parent or higher level of the hierarchy.</li>
      <li class="calibre12">Add an expression with the <code class="code-in-text--packt">Table.AddIndexColumn</code> function that will add a sequential integer based on the table sort applied in the previous step. The completed query should look something like the following:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimOrganization = 
        Source{[Schema="dbo",Item="DimOrganization"]}[Data],
    OrgSorted = 
        Table.Sort(
            dbo_DimOrganization,
            {
                {"ParentOrganizationKey", Order.Ascending},
                {"CurrencyKey", Order.Ascending}
            }
        ),
    OrgSortIndex = Table.AddIndexColumn(OrgSorted,"OrgSortIndex",1,1) 
in
    OrgSortIndex
</code></pre>
      </li>
      <li class="calibre12">Finally, with the Ctrl key pressed, select<a id="calibre_link-1407" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">OrganizationKey</strong>, <strong class="screentext">OrganizationName</strong>, and <strong class="screentext">OrgSortIndex</strong> columns by clicking their column headers. Right-click on the <strong class="screentext">OrgSortIndex</strong> column and choose to <strong class="screentext">Remove Other Columns</strong>. The preview data should now show as presented in <em class="italic">Figure 2.24</em>.<figure class="mediaobject"><img src="images/000115.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 2.24: Modified Organization Dimension Query</p>
    <p class="book-title--packt">With this expression, the table is<a id="calibre_link-696" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> first sorted by the <code class="code-in-text--packt">ParentOrganizationKey</code> column and then by the <code class="code-in-text--packt">CurrencyKey</code> column. The new index column starts at the first row of this sorted table with an incremental growth of one per row. The net effect is that all of the US divisions are grouped together at the end of the table.</p>
    <p class="book-title--packt">We can now use this new index column to adjust the default alphanumeric sorting behavior of the <strong class="screentext">OrganizationName</strong> column. To see how this works, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Choose <strong class="screentext">Close &amp; Apply</strong> to exit Power Query Editor to load the <strong class="screentext">DimOrganization</strong> table.</li>
      <li class="calibre12">In the <strong class="screentext">Data View</strong>, select the <code class="code-in-text--packt">OrganizationName</code> column.</li>
      <li class="calibre12">From the <strong class="screentext">Column tools</strong> tab, set the <strong class="screentext">Sort by column</strong> drop-down to the <strong class="screentext">OrgSortIndex</strong> column.<figure class="mediaobject"><img src="images/000184.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.25: Sort By in Data View</p>
      </li>
      <li class="calibre12">Finally, right-click on<a id="calibre_link-697" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">OrgSortIndex</strong> column and select <strong class="screentext">Hide in report view</strong>.</li>
    </ol>
    <p class="book-title--packt">Visuals using the <code class="code-in-text--packt">OrganizationName</code> column will now sort the values by their parent organization such that the USA organizations appear together (but not alphabetically).</p>
    <figure class="mediaobject"><img src="images/000343.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.26: Organization automatically sorted</p>
    <h2 id="calibre_link-1408" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Dataset modes in the<a id="calibre_link-279" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Power BI service: <a href="http://bit.ly/30P2HKF" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/30P2HKF</span></a></li>
      <li class="bullet">Data reduction techniques for<a id="calibre_link-278" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Import modeling: <a href="http://bit.ly/30RsMZI" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/30RsMZI</span></a></li>
    </ul>
    <h1 id="calibre_link-1189" class="title">Applying Multiple Filters</h1>
    <p class="book-title--packt">The application of <a id="calibre_link-661" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>precise and often complex filter conditions has always been at the heart of business intelligence, and Power BI Desktop supports rich filtering capabilities across its query, data model, and visualization components. In many scenarios, filtering at the query level via the Query Editor and M functions is the optimal choice, as this reduces the workload of both Import and DirectQuery data models and eliminates the need for re-applying the same filter logic across multiple reports or visualizations.</p>
    <p class="book-title--packt">Although the Query Editor graphical interface can be used to configure filtering conditions, this recipe demonstrates M's core filtering functions and the use of M in common multi-condition filter scenarios. The M expression queries constructed in this recipe are intended to highlight some of the most common filtering use cases.</p>
    <p class="book-title--packt">Note that applying data transformations as part of a data warehouse ETL (extract-transform-load) or ELT (extract-load-transform) process is generally preferable to using Power Query (M). BI teams and developers should be careful to avoid creating Power BI datasets that significantly deviate from existing "sources of truth".</p>
    <p class="book-title--packt">The following eight filtering queries will be developed in this recipe:</p>
    <ul class="calibre9">
      <li class="bullet">United States customers only</li>
      <li class="bullet">Customers with three or more children</li>
      <li class="bullet">Customers with null values for either the middle name or title columns</li>
      <li class="bullet">Customers with first purchase dates between 2012 and 2013</li>
      <li class="bullet">Customers in management with the female gender or a bachelor's education</li>
      <li class="bullet">The top 100 customers based on income</li>
      <li class="bullet">A list of distinct sales territory countries</li>
      <li class="bullet">Dates less than or equal to the current date and more than ten years prior to the current date</li>
    </ul>
    <h2 id="calibre_link-1409" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this <a id="calibre_link-662" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>recipe, import the <code class="code-in-text--packt">DimCustomer</code> and <strong class="screentext">DimDate</strong> tables from the <strong class="screentext">AdventureWorksDW2019</strong> database by doing the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop and choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">Create an <strong class="screentext">Import</strong> mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong>.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Choose the <code class="code-in-text--packt">DimCustomer</code> table and rename the query <code class="code-in-text--packt">DimCustomer</code>.</li>
      <li class="calibre12">Repeat <em class="italic">steps 4</em> and <em class="italic">5</em> for the <code class="code-in-text--packt">DimDate</code> table.</li>
      <li class="calibre12">Group the dimension queries into a query group called <strong class="screentext">Base Queries</strong>.</li>
      <li class="calibre12">Disable the loading of all queries.</li>
      <li class="calibre12">For the <code class="code-in-text--packt">DimCustomer</code> query, find <a id="calibre_link-663" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <code class="code-in-text--packt">DimGeography</code> column. In the column header, click the diverging arrows icon, uncheck <strong class="screentext">(Select All Columns)</strong>, and then check the box next to <code class="code-in-text--packt">CountryRegionCode</code> and <strong class="screentext">DimSalesTerritory</strong> before clicking the <strong class="screentext">OK</strong> button.<figure class="mediaobject"><img src="images/000172.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.27: Expanding DimGeography to Include CountryRegionCode and DimSalesTerritory</p>
      </li>
      <li class="calibre12">Now expand <strong class="screentext">DimGeography.DimSalesTerritory</strong> and only select the <strong class="screentext">SalesTerritoryCountry</strong> column.</li>
      <li class="calibre12">Rename the <strong class="screentext">DimGeography.CountryRegionCode</strong> column to <strong class="screentext">CountryCode</strong> and the <strong class="screentext">DimGeography.DimSalesTerritory.SalesTerritoryCountry </strong>column to <strong class="screentext">SalesTerritoryCountry</strong>.</li>
    </ol>
    <p class="book-title--packt">For additional details on<a id="calibre_link-1410" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> performing these steps, see the <em class="italic">Managing Queries and Data Sources</em> recipe in this chapter.</p>
    <h2 id="calibre_link-1411" class="calibre8">How to Apply Multiple Functions</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Right-click the <strong class="screentext">DimCustomer</strong> query, choose <strong class="screentext">Reference</strong>,<strong class="screentext"> </strong>and then open the <strong class="screentext">Advanced Editor</strong> window for this query. Use the <code class="code-in-text--packt">Table.SelectRows</code> function to apply the US query predicate and rename the query <strong class="screentext">United States Customers</strong>. The finished query should appear the same as the following:
        <pre class="programlisting"><code class="hljs">let
    Source = DimCustomer,
    USCustomers = Table.SelectRows(Source, each [CountryCode] = "US")
in
    USCustomers
</code></pre>
      </li>
      <li class="calibre12">Repeat <em class="italic">step 1</em>, but this time filter on the <code class="code-in-text--packt">TotalChildren</code> column for <code class="code-in-text--packt">&gt;=</code><strong class="screentext"> 3</strong> and rename this query <strong class="screentext">Customers w3+ Children</strong>:
        <pre class="programlisting"><code class="hljs">let
    Source = DimCustomer,
    ThreePlusChildFamilies = Table.SelectRows(Source, each [TotalChildren] &gt;=3)
in
    ThreePlusChildFamilies
</code></pre>
      </li>
      <li class="calibre12">Repeat <em class="italic">step 1</em>, but this time <a id="calibre_link-664" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>use the conditional logic operator <code class="code-in-text--packt">or</code> to define the filter condition for blank values in the <code class="code-in-text--packt">MiddleName</code> or <code class="code-in-text--packt">Title</code> columns. Use lowercase literal <code class="code-in-text--packt">null</code> to represent blank values. Name this query <strong class="screentext">Missing Titles or Middle Names</strong>:
        <pre class="programlisting"><code class="hljs">let
    Source = DimCustomer,
    MissingTitleorMiddleName = 
        Table.SelectRows(
            Source, each [MiddleName] = null or [Title] = null
        )
in
    MissingTitleorMiddleName
</code></pre>
      </li>
      <li class="calibre12">Repeat <em class="italic">step 1</em>, but this time use the <code class="code-in-text--packt">#date</code> literal to apply the <strong class="screentext">2012-2013</strong> filter on the <code class="code-in-text--packt">DateFirstPurchase</code> column. Rename this query <strong class="screentext">2012-2013 First Purchase Customers</strong>:
        <pre class="programlisting"><code class="hljs">let
    Source = DimCustomer,
    BetweenDates = 
        Table.SelectRows(
            Source,
            each [DateFirstPurchase] &gt;= #date(2012,01,01) and
                 [DateFirstPurchase] &lt;= #date(2013,12,31)
        )
in
    BetweenDates
</code></pre>
      </li>
      <li class="calibre12">Repeat <em class="italic">step 1</em>, but this time use parentheses to define the filter conditions for an <code class="code-in-text--packt">EnglishOccupation</code> of <code class="code-in-text--packt">Management</code>, and either the female gender (<code class="code-in-text--packt">F</code>), or <code class="code-in-text--packt">Bachelors</code> education. The parentheses ensure that the <code class="code-in-text--packt">or</code> condition filters are isolated from the filter on <code class="code-in-text--packt">Occupation</code>. Rename this query <strong class="screentext">Management and Female or Bachelors</strong>:
        <pre class="programlisting"><code class="hljs">let
    Source = DimCustomer,
    MgmtAndFemaleOrBachelors = 
        Table.SelectRows(
            Source,
            each [EnglishOccupation] = "Management" and
            ([Gender] = "F" or [EnglishEducation] = "Bachelors")
        )
in
    MgmtAndFemaleOrBachelors
</code></pre>
      </li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">United States Customers</code> query, select <strong class="screentext">Reference</strong>, and open the <strong class="screentext">Advanced Editor</strong>. This time, use the <code class="code-in-text--packt">Table.Sort</code> function to order this table by the <code class="code-in-text--packt">YearlyIncome</code> column. Finally, use the <code class="code-in-text--packt">Table.FirstN</code> function to retrieve the top 100 rows. Rename this<a id="calibre_link-665" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> query to <strong class="screentext">Top US Customers by Income</strong>.
        <pre class="programlisting"><code class="hljs">let
    Source = #"United States Customers",
    SortedByIncome = 
        Table.Sort(
            Source,
            {{"YearlyIncome", Order.Descending}}
        ),
    TopUSIncomeCustomers = Table.FirstN(SortedByIncome,100)
in
    TopUSIncomeCustomers
</code></pre>
      </li>
      <li class="calibre12">Repeat <em class="italic">step 1</em>, but this time use the <code class="code-in-text--packt">List.Distinct</code> and <code class="code-in-text--packt">List.Sort</code> functions to retrieve a distinct list of values from the <code class="code-in-text--packt">SalesTerritoryCountry</code> column. Rename this query <strong class="screentext">Customer Sales Territory List</strong>.
        <pre class="programlisting"><code class="hljs">let
    Source = DimCustomer,
    SalesTerritoryCountryList = List.Distinct(Source[SalesTerritoryCountry]),
    OrderedList = List.Sort(SalesTerritoryCountryList,Order.Ascending)
in
    OrderedList
</code></pre>
      </li>
      <li class="calibre12">Group the queries created thus far into a <strong class="screentext">Customer Filter Queries</strong> query group.</li>
      <li class="calibre12">Create a new query by referencing <strong class="screentext">DimDate</strong> and open the <strong class="screentext">Advanced Editor</strong>. Use the <code class="code-in-text--packt">DateTime.LocalNow</code>, <code class="code-in-text--packt">DateTime.Date</code>, and <code class="code-in-text--packt">Date.Year</code> functions to retrieve the trailing ten years from the current date. Rename this query <strong class="screentext">Trailing Ten Years from Today</strong> and place<a id="calibre_link-666" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this query in its own group, <strong class="screentext">Date Filter Queries</strong>.
        <pre class="programlisting"><code class="hljs">let
    Source = DimDate,
    TrailingTenYearsFromToday = 
        Table.SelectRows(
            Source,
            each 
                [FullDateAlternateKey] &lt;= DateTime.Date(DateTime.LocalNow) and
                [CalendarYear] &gt;= Date.Year(DateTime.LocalNow) - 10
        )
in
    TrailingTenYearsFromToday
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1412" class="calibre8">How it works</h2>
    <p class="book-title--packt">The <code class="code-in-text--packt">Table.SelectRows</code> function is the primary table-filtering function in the M language, and is functionally aligned with the <code class="code-in-text--packt">FROM</code> and <code class="code-in-text--packt">WHERE</code> clauses of SQL. Observe that variable names are used as inputs to M functions, such as the <code class="code-in-text--packt">Source</code> line being used as the first parameter to the <code class="code-in-text--packt">Table.SelectRows</code> function.</p>
    <p class="book-title--packt">Readers should not be concerned with the <code class="code-in-text--packt">each</code> syntax of the <code class="code-in-text--packt">Table.SelectRows</code> function. In many languages, this would suggest row-by-row iteration, but when possible, the M engine <em class="italic">folds</em> the function into the <code class="code-in-text--packt">WHERE</code> clause of the SQL query submitted to the source system.</p>
    <p class="book-title--packt">In the queries <strong class="screentext">United States Customers</strong>, <strong class="screentext">Customers w3+ Children</strong>, <strong class="screentext">Missing Titles or Middle Names</strong>, and <strong class="screentext">Management and Female or Bachelors</strong>, notice the various forms of the <code class="code-in-text--packt">each</code> selection condition. The syntax supports multiple comparison operators as well as complex logic, including the use of parenthesis to isolate logical tests.</p>
    <p class="book-title--packt">In the <strong class="screentext">2012-2013 First Purchase Customers</strong> query, the <code class="code-in-text--packt">#date</code> literal function is used to generate the comparison values. Literals are also available for <code class="code-in-text--packt">DateTime </code>(<code class="code-in-text--packt">#datetime</code>), <code class="code-in-text--packt">Duration </code>(<code class="code-in-text--packt">#duration</code>), <code class="code-in-text--packt">Time </code>(<code class="code-in-text--packt">#time</code>), and <code class="code-in-text--packt">DateTimeZone </code>(<code class="code-in-text--packt">#datetimezone</code>).</p>
    <p class="book-title--packt">In the <strong class="screentext">Top US Customers by Income</strong> query, the <code class="code-in-text--packt">Table.Sort</code> function is used to sort the rows by a specified column and sort order. The <code class="code-in-text--packt">Table.Sort</code> function also supports multiple columns as per the <em class="italic">Importing Data </em>recipe in this chapter. The <code class="code-in-text--packt">Table.FirstN</code> function is then used to return 100 rows starting from the very top of the sorted table. In this example, the set returned is not deterministic due to ties in income.</p>
    <p class="book-title--packt">The <strong class="screentext">Customer Sales Territory List</strong> query returns a list instead of a table. This is evident from the different icon present in the <strong class="screentext">Queries</strong> pane for this query versus the others. Lists are distinct from tables in M, and one must use a different set of functions when dealing with lists rather than tables. A list of distinct values can be used in multiple ways, such as a dynamic source of available input values to parameters.</p>
    <p class="book-title--packt">Finally, in the <strong class="screentext">Trailing 10 Yrs from Today</strong> query, the <a id="calibre_link-667" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>current date and year are retrieved from the <code class="code-in-text--packt">DateTime.LocalNow</code> function and then compared to columns from the date dimension with these values.</p>
    <h2 id="calibre_link-1413" class="calibre8">There's more...</h2>
    <p class="book-title--packt">With simple filtering conditions, as well as in proof-of-concept projects, using the UI to develop filter conditions may be helpful to expedite query development. However, the developer should review the M expressions generated by these interfaces, as they are only based on the previews of data available at design time, and logical filter assumptions can be made under certain conditions.</p>
    <p class="book-title--packt">To access the <strong class="screentext">Filter Rows</strong> dialog, click on <a id="calibre_link-486" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the drop-down button in a column header and then choose the <strong class="screentext">Text</strong> <strong class="screentext">Filters</strong> option, before specifying a starting filtering condition.</p>
    <figure class="mediaobject"><img src="images/000015.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.28: Accessing the Filter Rows dialog</p>
    <p class="book-title--packt">The <strong class="screentext">Basic</strong> option of the <strong class="screentext">Filter Rows</strong> dialog only allows you to work with the currently selected column. However, by <a id="calibre_link-36" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>clicking on the <strong class="screentext">Advanced</strong> radio button, you can work with any column in the table.</p>
    <figure class="mediaobject"><img src="images/000098.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.29: Advanced Filter Rows dialog in the Query Editor</p>
    <p class="book-title--packt">Despite this, even the <strong class="screentext">Advanced</strong> version of the <strong class="screentext">Filter Rows</strong> dialog does not provide the ability to group logical filtering criteria. While the dialog in <em class="italic">Figure 2.29</em> looks like it recreates the query for <strong class="screentext">Management and Female or Bachelors</strong>, the generated M code does not include the parenthesis that groups the <strong class="screentext">Gender</strong> and <strong class="screentext">EnglishEducation</strong> clauses. Thus, the code generated would have to be edited manually in the <strong class="screentext">Advanced Editor</strong> to return the same results as the original <strong class="screentext">Management and Female or Bachelors</strong> query. The M code generated by the <strong class="screentext">Filter Rows</strong> dialog shown in <em class="italic">Figure 2.29</em> generates the following code:</p>
    <pre class="programlisting"><code class="hljs">        Table.SelectRows(
            Source, 
            each 
                [EnglishOccupation] = "Management" and 
                [Gender] = "F" or 
                [EnglishEducation] = "Bachelors"
        )
</code></pre>
    <h2 id="calibre_link-1414" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><code class="code-in-text--packt">Table.SelectRows</code>: <a href="http://bit.ly/3bSkEyj" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3bSkEyj</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.Sort</code>:<a href="https://docs.microsoft.com/en-us/powerquery-m/table-sort" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url"> http://bit.ly/3qPaeUo</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.FirstN</code>: <a href="http://bit.ly/3ttb0In" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3ttb0In</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">List.Distinct</code>: <a href="http://bit.ly/3lnCqwq%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3lnCqwq</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">List.Sort</code>: <a href="http://bit.ly/30QLEb1" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/30QLEb1</span></a></li>
      <li class="bullet"><em class="italic">10 Common Mistakes You Do In #PowerBI #PowerQuery &ndash; Pitfall #3</em>: <a href="http://bit.ly/2nLX6QW%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2nLX6QW</span></a></li>
    </ul>
    <h1 id="calibre_link-1190" class="title">Selecting and Renaming Columns</h1>
    <p class="book-title--packt">The columns selected in data retrieval queries impact the performance and scalability of both import and DirectQuery data models. For Import models, the resources required by the refresh process and the size of the compressed data model are directly impacted by column selection. Specifically, the cardinality of columns drives their individual memory footprint and memory per column. This correlates closely to query duration when these columns are referenced in measures and report visuals. For DirectQuery models, the performance of report queries is directly affected. Regardless of the model type, the way in which this selection is implemented also impacts the robustness of the retrieval process. Additionally, the names assigned to columns (or accepted from the source) directly impact the Q&amp;A or natural language query experience. </p>
    <p class="book-title--packt">This recipe identifies columns to include <a id="calibre_link-155" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>or exclude in a data retrieval process and demonstrates how to select those columns as well as the impact of those choices on the data model. In addition, examples are provided for applying user-friendly names and other considerations for choosing to retrieve or eliminate columns of data for retrieval.</p>
    <h2 id="calibre_link-1415" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To get ready for this recipe, import the <strong class="screentext">DimCustomer</strong> table from the <strong class="screentext">AdventureWorksDW2019</strong> database by doing the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop and choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">Create an <strong class="screentext">Import</strong> mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong>.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Select the <code class="code-in-text--packt">DimCustomer</code> table in the data preview area and rename this query <code class="code-in-text--packt">DimCustomer</code>.</li>
    </ol>
    <p class="book-title--packt">For additional details on performing these steps, see the <em class="italic">Managing Queries and Data Sources</em> recipe in this chapter.</p>
    <h2 id="calibre_link-1416" class="calibre8">How to Select and Rename Columns</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps in Advanced Editor: </p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a name column<a id="calibre_link-162" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> from the first and last names via the <code class="code-in-text--packt">Table.AddColumn</code> function.
        <pre class="programlisting"><code class="hljs">    CustomerNameAdd = 
        Table.AddColumn(
            dbo_DimCustomer, "Customer Name",
            each [FirstName] &amp; " " &amp; [LastName]<code class="codehighlighted">,</code>
<code class="codehighlighted">            </code><span><strong class="screentext">type text</strong></span>
        )
</code></pre>
      </li>
      <li class="calibre12">Use the <code class="code-in-text--packt">Table.SelectColumns</code> function to select 10 of the 30 available columns now available in the <strong class="screentext">DimCustomer</strong> table.
        <pre class="programlisting"><code class="hljs">    SelectCustCols = 
        Table.SelectColumns(CustomerNameAdd,
            {
                "CustomerKey", "Customer Name", "Annual Income", 
                "Customer Gender", "Customer Education", "MaritalStatus", 
                "Customer Phone Number", "CommuteDistance", "AddressLine1", 
                "TotalChildren"
            }, MissingField.UseNull
        )
</code></pre>
        <p class="packt_figref">Note that some of the column names specified do not actually exist. This is on purpose and will be fixed in the next step. But note that instead of generating an error, <code class="code-in-text--packt">null</code> values are displayed for those columns.</p>
        <figure class="mediaobject"><img src="images/000403.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 30: Non-existent columns return null instead of error</p>
    <p class="book-title--packt">Use the <code class="code-in-text--packt">Table.RenameColumns</code> function to apply intuitive names for users and benefit the Q&amp;A engine for natural language queries. Insert this statement above your <code class="code-in-text--packt">SelectCustCols</code> statement and<a id="calibre_link-163" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> adjust as appropriate. The full query should now be<a id="calibre_link-164" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> similar to the following:</p>
    <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimCustomer = Source{[Schema="dbo",Item="DimCustomer"]}[Data],
    CustomerNameAdd = 
        Table.AddColumn(
            dbo_DimCustomer, "Customer Name",
            each [FirstName] &amp; " " &amp; [LastName],
            type text
        ),
    #"Renamed Columns" = 
        Table.RenameColumns(CustomerNameAdd,
            {
                {"YearlyIncome", "Annual Income"}, 
                {"Gender", "Customer Gender"},
                {"EnglishEducation", "Customer Education"},
                {"Phone", "Customer Phone Number"}
            }
        ),
    SelectCustCols = 
        Table.SelectColumns(#"Renamed Columns",
            {
                "CustomerKey", "Customer Name", "Annual Income", 
                "Customer Gender", "Customer Education", "MaritalStatus", 
                "Customer Phone Number", "CommuteDistance", "AddressLine1", 
                "TotalChildren"
            }, MissingField.UseNull
        )
in
    SelectCustCols
</code></pre>
    <h2 id="calibre_link-1417" class="calibre8">How it works</h2>
    <p class="book-title--packt">The <code class="code-in-text--packt">Table.AddColumn</code> function <a id="calibre_link-1418" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>concatenates the <code class="code-in-text--packt">FirstName</code> and <code class="code-in-text--packt">LastName</code> columns and includes an<a id="calibre_link-1419" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> optional final parameter that specifies the <a id="calibre_link-1073" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>column type as <code class="code-in-text--packt">text</code>.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">Table.SelectColumns</code> function specifies <a id="calibre_link-1087" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the columns to retrieve from the data source. Columns not specified are excluded from retrieval. </p>
    <p class="book-title--packt">A different method of accomplishing <a id="calibre_link-1079" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this same effect would be to use the <code class="code-in-text--packt">Table.RemoveColumns</code> function. However, in this case, 20 columns would need to be removed versus explicitly defining 10 columns to keep. To avoid query failure if one of the source columns changes or is missing, it is better to specify and name 10 than 20 columns. Query resilience can further be improved by using the optional parameter for <code class="code-in-text--packt">Table.SelectColumns</code>, <code class="code-in-text--packt">MissingField.UseNull</code>. Using this parameter, if the column selected is not available, the query still succeeds and simply inserts <code class="code-in-text--packt">null</code> values for this column for all rows.</p>
    <p class="book-title--packt">Another advantage of using the <code class="code-in-text--packt">Table.SelectColumns</code> function is that columns can be reordered as selected columns are retrieved and presented in the order specified. This can be helpful for the query design process and avoids the need for an additional expression with a <code class="code-in-text--packt">Table.ReorderColumns</code> function. The<a id="calibre_link-1080" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> initial column order of a query loaded to the data model is respected in the <strong class="screentext">Data</strong> view. However, the field list exposed in the <strong class="screentext">Fields</strong> pane in both the <strong class="screentext">Report</strong> and <strong class="screentext">Data</strong> views of Power BI Desktop is automatically alphabetized.</p>
    <p class="book-title--packt">For import data models, you might consider removing a column that represents a simple expression of other columns from the same table. For example, if the <code class="code-in-text--packt">Extended Amount</code> column is equal to the multiplication of the <code class="code-in-text--packt">Unit Price</code> and <code class="code-in-text--packt">Order Quantity</code> columns, you can choose to only import these latter two columns. A DAX measure can instead compute the <code class="code-in-text--packt">Extended Amount</code> value. This might be done to keep model sizes smaller. This technique is not recommended for DirectQuery models, however.</p>
    <p class="book-title--packt">Use the <code class="code-in-text--packt">Table.RenameColumns</code> function to rename columns in order to remove any source system indicators, add a space between words for non-key columns, and apply dimension-specific names such as <code class="code-in-text--packt">Customer Gender</code> rather than <code class="code-in-text--packt">Gender</code>. The <code class="code-in-text--packt">Table.RenameColumns</code> function also offers the <code class="code-in-text--packt">MissingField.UseNull</code> option.</p>
    <h2 id="calibre_link-1420" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Import models are internally stored in a columnar compressed format. The compressed data for each column contributes to the total disk size of the file. The primary factor of data size is a column's cardinality. Columns with many unique values do not compress well and thus consume more space. Eliminating<a id="calibre_link-156" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> columns with high cardinality can reduce the size of the data model and thus the overall file size of a PBIX file. However, it is the size of the individual columns being accessed by queries that, among other factors, drives query performance for import models.</p>
    <h2 id="calibre_link-1421" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><code class="code-in-text--packt">Table.SelectColumns</code>: <a href="http://bit.ly/38Qk7Lt" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/38Qk7Lt</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.RenameColumns</code>: <a href="http://bit.ly/3rTVfd4" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3rTVfd4</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.RemoveColumns</code>: <a href="http://bit.ly/3cJju7p" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cJju7p</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.ReorderColumns</code>: <a href="http://bit.ly/3cEoOJg%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cEoOJg</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.AddColumn</code>: <a href="http://bit.ly/3vGJZ6b" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3vGJZ6b</span></a></li>
      <li class="bullet">Power BI Documentation on preparing data for Q&amp;A: <a href="http://bit.ly/2nBLAGc" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2nBLAGc</span></a></li>
    </ul>
    <h1 id="calibre_link-1191" class="title">Transforming and Cleansing Data</h1>
    <p class="book-title--packt">The transformations applied within Power BI's M queries serve to protect the integrity of the data model and to support enhanced analysis and visualization. The specific transformations to <a id="calibre_link-233" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>implement varies based on data quality, integration needs, and the goals of the overall solution. However, at a minimum, developers should look to<a id="calibre_link-224" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> protect the integrity of the model's relationships and to simplify the user experience via denormalization and standardization. Additionally, developers should check with owners of the data source to determine whether certain required transformations can be implemented in the source, or perhaps made available via SQL view objects such that Power Query (M) expressions are not necessary.</p>
    <p class="book-title--packt">This recipe demonstrates how to protect a model from duplicate values within the source data that can prevent forming proper relationships within the data model, which may even result in query failures. While a simple scenario is used, this recipe demonstrates scenarios you may run into while attempting to merge multiple data sources and eliminating duplicates.</p>
    <h2 id="calibre_link-1422" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare, start by <a id="calibre_link-1423" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>importing the <strong class="screentext">DimProduct</strong> and <strong class="screentext">FactResellerSales</strong> tables from<a id="calibre_link-1424" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">AdventureWorksDW2019</strong> database by doing the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop and choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">Create an <strong class="screentext">Import</strong> mode data source query called <strong class="screentext">AdWorksDW</strong>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong>.</li>
      <li class="calibre12">Right-click <strong class="screentext">AdWorksDW</strong> and choose <strong class="screentext">Reference</strong>, select the <strong class="screentext">DimProduct</strong> table in the data preview area, and rename this query <strong class="screentext">DimProduct</strong>. Right-click the <strong class="screentext">EnglishProductName</strong> column and select <strong class="screentext">Remove Other Columns</strong>.</li>
      <li class="calibre12">Repeat the previous step, but this time choose <strong class="screentext">FactResellerSales</strong>. Expand the <strong class="screentext">DimProduct</strong> column and only choose <strong class="screentext">EnglishProductName</strong>. Rename this column to <strong class="screentext">EnglishProductName</strong>.</li>
      <li class="calibre12">Drag the <strong class="screentext">DimProduct</strong> and <strong class="screentext">FactResellerSales</strong> queries into the <strong class="screentext">Other Queries</strong> group and apply the queries to the data model.</li>
      <li class="calibre12">In the <strong class="screentext">Model</strong> view of Power BI Desktop, attempt to form a relationship between the tables using the <strong class="screentext">EnglishProductName</strong> columns from both tables. Note the warning that is displayed.<figure class="mediaobject"><img src="images/000470.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 2.31: Many-Many relationship cardinality warning</p>
    <p class="book-title--packt">For additional details on performing these steps, see the <em class="italic">Managing Queries and Data Sources</em> recipe in this chapter.</p>
    <h2 id="calibre_link-1425" class="calibre8">How to Transform and Cleanse Data</h2>
    <p class="book-title--packt">We wish to remove <a id="calibre_link-234" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>duplicates from the <strong class="screentext">EnglishProductName</strong> column in our <strong class="screentext">DimProduct</strong> query. To<a id="calibre_link-225" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Remove any leading and trailing empty spaces in the <code class="code-in-text--packt">EnglishProductName</code> column with a <code class="code-in-text--packt">Text.Trim</code> function.</li>
      <li class="calibre12">Create a duplicate column of the <code class="code-in-text--packt">EnglishProductName</code> key column with the <code class="code-in-text--packt">Table.DuplicateColumn</code> function and name this new column <code class="code-in-text--packt">Product Name</code>.</li>
      <li class="calibre12">Add an expression to force uppercase on the <code class="code-in-text--packt">EnglishProductName</code> column via the <code class="code-in-text--packt">Table.TransformColumns</code> function. This new expression must be applied before the duplicate removal expressions are applied.</li>
      <li class="calibre12">Add an expression to the <strong class="screentext">DimProduct</strong> query with the <code class="code-in-text--packt">Table.Distinct</code> function to remove duplicate rows.</li>
      <li class="calibre12">Add another <code class="code-in-text--packt">Table.Distinct</code> expression to specifically remove duplicate values from the <code class="code-in-text--packt">EnglishProductName</code> column.</li>
      <li class="calibre12">Drop the capitalized <code class="code-in-text--packt">EnglishProductName</code> column via <code class="code-in-text--packt">Table.RemoveColumns</code>.<p class="packt_figref">The final query should resemble the following:</p>
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimProduct = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    RemoveColumns = Table.SelectColumns(dbo_DimProduct,{"EnglishProductName"}),
    TrimText = 
        Table.TransformColumns(
            RemoveColumns,{"EnglishProductName",Text.Trim}
        ),
    DuplicateKey = 
        Table.DuplicateColumn(
            TrimText,"EnglishProductName","Product Name"
        ),
    UpperCase = 
        Table.TransformColumns(
            DuplicateKey,{{"EnglishProductName", Text.Upper}}
        ),
    DistinctProductRows = Table.Distinct(UpperCase),
    DistinctProductNames = 
        Table.Distinct(
            DistinctProductRows, {"EnglishProductName"}
        ),
    RemoveEnglishProductName = 
        Table.RemoveColumns(
            DistinctProductNames,"EnglishProductName"
        )
in
    RemoveEnglishProductName
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1426" class="calibre8">How it works</h2>
    <p class="book-title--packt">In the <code class="code-in-text--packt">TrimText</code> expression, the <code class="code-in-text--packt">Trim.Text</code> function removes white space from the beginning and end of a column. Different amounts of empty space make those rows distinct within the query engine, but not necessarily distinct within the model. Therefore, it is always a good idea to use <code class="code-in-text--packt">Trim.Text</code> first and then remove duplicate rows and values.</p>
    <p class="book-title--packt">In the next <a id="calibre_link-235" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>expression, <code class="code-in-text--packt">DuplicateKey</code>, the <code class="code-in-text--packt">Table.DuplicateColumn</code> function is used to duplicate the column where we will be removing duplicate values. We <a id="calibre_link-226" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>give this new column the name that we desire for our final column. This is done because we will need to transform the values in the column we are removing duplicates from, in order to account for mixed cases such as "Fender Set" and "Fender set". Thus, we wish to preserve the original values and casing by using this duplicate column.</p>
    <p class="book-title--packt">In order to eliminate mixed casing issues, the <code class="code-in-text--packt">UpperCase</code> expression changes all values in the <code class="code-in-text--packt">EnglishProductName</code> column to uppercase using the <code class="code-in-text--packt">Table.TransformColumns</code> function, and specifying <code class="code-in-text--packt">Text.Upper</code>. The M engine considers mixed casing values unique, but the data model engine does not.</p>
    <p class="book-title--packt">The next two expressions, <code class="code-in-text--packt">DistinctProductRows</code> and <code class="code-in-text--packt">DistinctProductNames</code>, simply demonstrate two different methods of using the <code class="code-in-text--packt">Table.Distinct</code> function. The first, <code class="code-in-text--packt">DistinctProductRows</code>, eliminates rows where the entire row (all column values) are identical. The second version looks only at the values in a single column when determining whether or not the row is a duplicate.</p>
    <p class="book-title--packt">At this point, the query is now resilient to duplicate values and rows, mixed cases, and spaces. However, the <code class="code-in-text--packt">EnglishProductName</code> column is now in the uppercase format. Since we preserved a copy of the original values and casing in our <code class="code-in-text--packt">Product Name</code> column, we can simply drop the <code class="code-in-text--packt">EnglishProductName</code> column using the <code class="code-in-text--packt">Table.RemoveColumns</code> function. </p>
    <p class="book-title--packt">We can now form a one-to-many relationship between our <strong class="screentext">DimProduct</strong> and <strong class="screentext">FactResellerSales</strong> tables.</p>
    <figure class="mediaobject"><img src="images/000185.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.32: Simple one-to-many relationship model</p>
    <h2 id="calibre_link-1427" class="calibre8">There's more...</h2>
    <p class="book-title--packt">To support troubleshooting, create a query that accesses the same source table and retrieves the values from the <code class="code-in-text--packt">EnglishProductName</code> column with more than one row.</p>
    <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimProduct = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    RemoveColumns = Table.SelectColumns(dbo_DimProduct,{"EnglishProductName"}),
    TrimText = 
        Table.TransformColumns(
            RemoveColumns,{"EnglishProductName",Text.Trim}
        ),
    UpperCase = 
        Table.TransformColumns(
            TrimText,{{"EnglishProductName", Text.Upper}}
        ),
    GroupedRows = 
        Table.Group(
            UpperCase, {"EnglishProductName"},
            {{"Rows", each Table.RowCount(_), Int64.Type}}
        ),
    Duplicates = Table.SelectRows(GroupedRows, each [Rows] &gt; 1)
in
    Duplicates
</code></pre>
    <p class="book-title--packt">The <code class="code-in-text--packt">EnglishProductName</code> column is selected, trimmed, converted to uppercase, grouped, and then filtered to always retrieve any duplicate key values. Disable the loading of this query, as the query would only exist for troubleshooting purposes.</p>
    <h2 id="calibre_link-1428" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><code class="code-in-text--packt">Table.SelectColumns</code>: <a href="http://bit.ly/38Qk7Lt" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/38Qk7Lt</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.RemoveColumns</code>: <a href="http://bit.ly/3cJju7p" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cJju7p</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.TransformColumns</code>: <a href="http://bit.ly/3tsdxm2" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3tsdxm2</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.DuplicateColumn</code>: <a href="http://bit.ly/3cIF63X" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cIF63X</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.Distinct</code>: <a href="http://bit.ly/38V8mmN" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/38V8mmN</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Text.Trim</code>: <a href="http://bit.ly/3eUmAZ0%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3eUmAZ0</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Text.Upper</code>:<a href="https://docs.microsoft.com/en-us/powerquery-m/text-upper" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url"> http://bit.ly/3vFW2R6</span></a></li>
      <li class="bullet">M functions reference for text: <a href="https://docs.microsoft.com/en-gb/powerquery-m/text-functions" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2nUYjnw</span></a></li>
    </ul>
    <h1 id="calibre_link-1192" class="title">Creating Custom Columns</h1>
    <p class="book-title--packt">Business users often extend the<a id="calibre_link-203" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> outputs of existing reports and data models with additional columns to help them analyze and present data. The logic of these columns is generally implemented through Excel formulas or as calculated DAX columns. A superior solution, particularly if the logic cannot quickly be migrated to a data warehouse or IT resource, is to create the columns via the Power Query Editor and M language.</p>
    <p class="book-title--packt">Developing custom columns can also significantly enhance the ease of use and analytical power of data models and the visualizations they support. In this recipe, columns are created to apply a custom naming format and simplify the analysis of a customer dimension via existing columns.</p>
    <h2 id="calibre_link-1429" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To get ready for this recipe, import the <code class="code-in-text--packt">DimCustomer</code> table from the <strong class="screentext">AdventureWorksDW2019</strong> database by doing the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop and choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong>.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>, select the <code class="code-in-text--packt">DimCustomer</code> table in the data preview area, and rename this query <code class="code-in-text--packt">DimCustomer</code>.</li>
    </ol>
    <p class="book-title--packt">For additional details on <a id="calibre_link-204" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>performing these steps, see the <em class="italic">Managing Queries and Data Sources</em> recipe in this chapter.</p>
    <h2 id="calibre_link-1430" class="calibre8">How to Create Custom Columns</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Use <code class="code-in-text--packt">Table.SelectColumns</code> to retrieve the required source columns from the <code class="code-in-text--packt">DimCustomer</code> table, <code class="code-in-text--packt">FirstName</code>, <code class="code-in-text--packt">LastName</code>, <code class="code-in-text--packt">MiddleName</code>, <code class="code-in-text--packt">Title</code> and <code class="code-in-text--packt">BirthDate</code>.
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimCustomer = Source{[Schema="dbo",Item="DimCustomer"]}[Data],
    SelectColumns = 
        Table.SelectColumns(dbo_DimCustomer,
            {"FirstName", "LastName", "MiddleName", "Title", "BirthDate"}
        )
in
    SelectColumns
</code></pre>
      </li>
      <li class="calibre12">Write a <code class="code-in-text--packt">Table.AddColumns</code> function with an <code class="code-in-text--packt">if...then</code> expression that accounts for the different scenarios given a target format of <code class="code-in-text--packt">Mr. John A. Doe</code>:
        <pre class="programlisting"><code class="hljs">    NameFormatTble = 
        Table.AddColumn(
            SelectColumns,"Formatted Name", each
                if [Title] = null and [MiddleName] = null 
                    then [FirstName] &amp; " " &amp; [LastName] 
                else if [Title] = null 
                    then [FirstName] &amp; " " &amp; Text.Range([MiddleName],0,1) 
                            &amp; ". " &amp; [LastName]
                else
                    [Title] &amp; " " &amp; [FirstName] &amp; " " 
                        &amp; Text.Range([MiddleName],0,1) &amp; ". " &amp; [LastName]
        )
</code></pre>
      </li>
      <li class="calibre12">Add variables that allow the expression to support the comparison between the current system date and the <code class="code-in-text--packt">BirthDate</code> column.
        <pre class="programlisting"><code class="hljs">let
    CurrentDate = DateTime.Date(DateTime.LocalNow()),
    CurrentYear = Date.Year(CurrentDate),
    CurrentMonth = Date.Month(CurrentDate),
    CurrentDay = Date.Day(CurrentDate),
    Source = AdWorksDW,
</code></pre>
      </li>
      <li class="calibre12">Use the <code class="code-in-text--packt">Table.AddColumn</code> function <a id="calibre_link-205" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to create <code class="code-in-text--packt">Customer</code> <code class="code-in-text--packt">Year</code>, <code class="code-in-text--packt">Customer</code> <code class="code-in-text--packt">Month</code>, and <code class="code-in-text--packt">Customer</code> <code class="code-in-text--packt">Day</code> columns based upon the <code class="code-in-text--packt">BirthDate</code> column.
        <pre class="programlisting"><code class="hljs">    AddCustomerYear = 
        Table.AddColumn(
            NameFormatTble, "Customer Year", each Date.Year([BirthDate]),
            Int64.Type
        ),
    AddCustomerMonth = 
        Table.AddColumn(
            AddCustomerYear, "Customer Month", each Date.Month([BirthDate]),
            Int64.Type
        ),
    AddCustomerDay = 
        Table.AddColumn(
            AddCustomerMonth, "Customer Day", each Date.Day([BirthDate]),
            Int64.Type
        )
</code></pre>
      </li>
      <li class="calibre12">Add an <code class="code-in-text--packt">Age</code> column via an <code class="code-in-text--packt">if...then</code> expression.
        <pre class="programlisting"><code class="hljs">    CustomerAge = 
        Table.AddColumn(
            AddCustomerDay,"Customer Age", each
            if [Customer Month] &lt; CurrentMonth 
                then CurrentYear - [Customer Year]
            else if [Customer Month] &gt; CurrentMonth 
                then CurrentYear - [Customer Year] - 1
            else if [Customer Day] &lt; CurrentDay 
                then CurrentYear - [Customer Year]
            else CurrentYear - [Customer Year] - 1
        )
</code></pre>
      </li>
      <li class="calibre12">Add a <code class="code-in-text--packt">Customer Age Segment</code> column <a id="calibre_link-206" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>via the column computed in <em class="italic">step 4</em>.
        <pre class="programlisting"><code class="hljs">    CustomerSegment = 
        Table.AddColumn(
            CustomerAge, "Customer Age Segment", each
            if [Customer Age] &lt; 30 then "Less than 30"
            else if [Customer Age] &lt; 40 then "30 to 39"
            else if [Customer Age] &lt; 50 then "40 to 49"
            else if [Customer Age] &lt; 60 then "50 to 59"
            else "60 or Older"
        )
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1431" class="calibre8">How it works</h2>
    <p class="book-title--packt">In the <code class="code-in-text--packt">NameFormatTble</code> expression the <code class="code-in-text--packt">Table</code>.<code class="code-in-text--packt">AddColumn</code> function is used, coupled with an <code class="code-in-text--packt">if...then</code> expression. M is a case-sensitive language, so writing <code class="code-in-text--packt">IF</code> instead of <code class="code-in-text--packt">if</code> or <code class="code-in-text--packt">Table.Addcolumn</code> instead of <code class="code-in-text--packt">Table.AddColumn</code> will return an error. <code class="code-in-text--packt">if...then</code> expressions follow the following structure:</p>
    <p class="book-title--packt"><code class="code-in-text--packt">if &lt;condition1&gt; then &lt;result1&gt; else &lt;result2&gt;</code></p>
    <p class="book-title--packt">All three inputs (<code class="code-in-text--packt">condition1</code>, <code class="code-in-text--packt">result1</code>, and <code class="code-in-text--packt">result2</code>) accept M expressions. <code class="code-in-text--packt">if</code> expressions can be nested together with the following structure:</p>
    <p class="book-title--packt"><code class="code-in-text--packt">if &lt;condition1&gt; then &lt;result1&gt; else if &lt;condition2&gt; then &lt;result2&gt; else &lt;result3&gt;</code></p>
    <p class="book-title--packt">The equivalent of a SQL CASE expression is not available in M. However, the order of conditions specified in <code class="code-in-text--packt">if...then</code> expressions drives the evaluation process. Multiple conditions could be true but the second and later conditions will be discarded and not evaluated. If the value produced by the <code class="code-in-text--packt">if</code> condition is not a logical value, an error is raised.</p>
    <p class="book-title--packt">The three <code class="code-in-text--packt">if...then</code> conditions<a id="calibre_link-207" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in the <code class="code-in-text--packt">NameFormatTble</code> expression account for all scenarios to return the formatted name, since the query must account for nulls in the <code class="code-in-text--packt">Middle Name</code> and <code class="code-in-text--packt">Title</code> columns, as well as different values in the <code class="code-in-text--packt">Middle Name</code> column. <code class="code-in-text--packt">Text.Range</code> is used to extract the first character of the middle name.</p>
    <p class="book-title--packt">For the variables <code class="code-in-text--packt">CurrentDate</code>, <code class="code-in-text--packt">CurrentYear</code>, <code class="code-in-text--packt">CurrentMonth</code>, and <code class="code-in-text--packt">CurrentDay</code>, the <code class="code-in-text--packt">DateTime.LocalNow</code> function is used as the source for the current date; it is then used for year, month, and day.</p>
    <p class="book-title--packt">For the <code class="code-in-text--packt">AddCustomerYear</code>, <code class="code-in-text--packt">AddCustomerMonth</code>, and <code class="code-in-text--packt">AddCustomerDay</code> expressions, the <code class="code-in-text--packt">Int64.Type</code> value is passed to the optional type parameter of <code class="code-in-text--packt">Table</code>.<code class="code-in-text--packt">AddColumn</code> to set the new columns as whole numbers.</p>
    <p class="book-title--packt">For the <code class="code-in-text--packt">CustomerAge</code> and <code class="code-in-text--packt">CustomerSegment</code> expressions, nested <code class="code-in-text--packt">ifâ¦then</code> expressions are used. This method is used because, currently, the equivalent of a <code class="code-in-text--packt">DATEDIFF</code> function (T-SQL, DAX) with date intervals like <code class="code-in-text--packt">Year</code>, <code class="code-in-text--packt">Month</code>, <code class="code-in-text--packt">Week</code>, and so on, are not available in M. A <code class="code-in-text--packt">Duration.Days</code> function can be used for day intervals and additional duration functions are available for hour, minute, and second intervals.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">CustomerAge</code> expression compares the <code class="code-in-text--packt">CurrentMonth</code> and <code class="code-in-text--packt">CurrentDay</code> variables against the values of the customer columns created in the <code class="code-in-text--packt">AddCustomerMonth</code> and <code class="code-in-text--packt">AddCustomerDay</code> expressions in order to compute the age of the customer using the <code class="code-in-text--packt">CurrentYear</code> variable and the column created by the <code class="code-in-text--packt">AddCustomerYear</code> expression. The column created by the <code class="code-in-text--packt">CustomerAge</code> column is then used in the <code class="code-in-text--packt">CustomerSegement</code> expression to derive the age segmentation column. The new custom columns can be used to support various visualizations based upon the ages and segmentation of customers.</p>
    <h2 id="calibre_link-1432" class="calibre8">There's more...</h2>
    <p class="book-title--packt">The Power Query Editor provides graphical user interfaces for adding columns. These interfaces provide mechanisms for adding columns that are an alternative to writing out the code manually. In essence, the M code for the added columns is generated as an output from these interfaces. </p>
    <p class="book-title--packt">One such interface is the <strong class="screentext">Column From Examples</strong> feature, which allows users<a id="calibre_link-146" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to simply type examples of a desired column's output. The engine determines which M functions and series of steps to add to the query that return results consistent with the examples provided. To explore this feature, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a new query referencing the <strong class="screentext">AdWorksDW</strong> query.</li>
      <li class="calibre12">Select the <strong class="screentext">DimCustomer</strong> table.</li>
      <li class="calibre12">Select the <strong class="screentext">Title</strong>, <strong class="screentext">FirstName</strong>, <strong class="screentext">MiddleName</strong>, <strong class="screentext">LastName</strong>, and <strong class="screentext">BirthDate</strong> columns and remove all other columns.</li>
      <li class="calibre12">Select the <strong class="screentext">Add Column</strong> tab and then choose the <strong class="screentext">Column From Examples</strong> button in the ribbon.<figure class="mediaobject"><img src="images/000481.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.33: Column From Examples feature</p>
      </li>
      <li class="calibre12">Type the customer's <code class="code-in-text--packt">FirstName</code>, <code class="code-in-text--packt">MiddleName</code>, and <code class="code-in-text--packt">LastName</code> values into the first row and hit the <strong class="screentext">Enter</strong> key. Notice that the rest of the rows are automatically calculated based upon this first row.<figure class="mediaobject"><img src="images/000002.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.34: Column From Examples interface</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">OK</strong> button <a id="calibre_link-147" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to accept the transformation.</li>
    </ol>
    <p class="book-title--packt">Another interface for adding columns is the <strong class="screentext">Condition Column</strong> feature. This feature provides a method of creating conditional columns<a id="calibre_link-170" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> as an alternative to writing out the <code class="code-in-text--packt">if...then</code> expressions. To see how this feature operates, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">Add Column</strong> tab and then select <strong class="screentext">Conditional Column</strong> from the ribbon.<figure class="mediaobject"><img src="images/000492.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.35: Conditional Column feature</p>
      </li>
      <li class="calibre12">Fill in the fields on <a id="calibre_link-16" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Add Conditional Column</strong> dialog, using the <strong class="screentext">Add Clause</strong> button to add additional <code class="code-in-text--packt">else if</code> statements; click the <strong class="screentext">OK</strong> button to exit the dialog and create the new column.<figure class="mediaobject"><img src="images/000025.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 2.36: Add Conditional Column dialog</p>
    <p class="book-title--packt">Any column from the table can be referenced, and multiple created steps can be moved up or down the order of evaluation using the ellipses (<strong class="screentext">â¦</strong>). Open the <strong class="screentext">Advanced Editor</strong> to inspect the code created.</p>
    <figure class="mediaobject"><img src="images/000037.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.37: Added conditional column M code</p>
    <h2 id="calibre_link-1433" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><code class="code-in-text--packt">Table.AddColumn</code>: <a href="http://bit.ly/3vGJZ6b" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3vGJZ6b</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.SelectColumns</code>: <a href="http://bit.ly/38Qk7Lt" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/38Qk7Lt</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">DateTime</code> functions: <a href="http://bit.ly/3tPtKlJ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3tPtKlJ</span></a></li>
      <li class="bullet"><strong class="screentext">Add Column From</strong> examples: <a href="http://bit.ly/3eWTLv6%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3eWTLv6</span></a></li>
    </ul>
    <h1 id="calibre_link-1193" class="title">Combining and Merging Queries</h1>
    <p class="book-title--packt">The full power of Power BI's<a id="calibre_link-899" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> querying capabilities is in the integration of distinct queries representing different data sources via its merge and append transformations. Retrieval processes that consolidate files from multiple network locations or integrate data from multiple data sources can be developed efficiently and securely. Additionally, the<a id="calibre_link-885" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> same join types and data transformation patterns SQL and ETL developers are familiar with can be achieved with the M language. This recipe provides examples of combining sources into a single query and leveraging the table join functions of M to support common transformation scenarios.</p>
    <h2 id="calibre_link-1434" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To follow along with this recipe, you can use the <strong class="screentext">Merge Queries</strong> and <strong class="screentext">Append Queries</strong> icons on the <strong class="screentext">Home </strong>tab of the Power Query Editor to generate the join expressions used in this recipe. However, as joining queries is fundamental to the retrieval process, it is recommended to learn how to use the <code class="code-in-text--packt">Table.Join</code>, <code class="code-in-text--packt">Table.NestedJoin</code>, and <code class="code-in-text--packt">Table.Combine</code> functions.</p>
    <p class="book-title--packt">To get ready for this recipe, import the <code class="code-in-text--packt">DimCustomer</code> and <code class="code-in-text--packt">FactCallCenter</code> tables from the <strong class="screentext">AdventureWorksDW2019</strong> database by doing the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop and choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong>.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>, select the <code class="code-in-text--packt">DimEmployee</code> table in the data preview area, and rename this query <code class="code-in-text--packt">DimEmployee</code>.</li>
      <li class="calibre12">Repeat <em class="italic">step 4</em> but choose the <strong class="screentext">FactInternetSales</strong> table and name this query <strong class="screentext">Sales2011</strong>. Filter the <strong class="screentext">OrderDate</strong> column to be between January 1, 2011 and December 31, 2011.
        <pre class="programlisting"><code class="hljs">Let
    Source = AdWorksDW,
    dbo_FactInternetSales = Source{[Schema="dbo",Item="FactInternetSales"]}[Data],
    #"Filtered Rows" = 
        Table.SelectRows(
            dbo_FactInternetSales, each 
                [OrderDate] &gt;= #datetime(2011, 1, 1, 0, 0, 0) and 
                [OrderDate] &lt;= #datetime(2011, 12, 31, 0, 0, 0))
in
    #"Filtered Rows"
</code></pre>
      </li>
      <li class="calibre12">Right-click the <strong class="screentext">Sales2011</strong> query and choose <strong class="screentext">Duplicate</strong>. Name this query <strong class="screentext">Sales2012</strong>. Edit the <code class="code-in-text--packt">Table.SelectRows</code> expression to filter dates between January 1, 2012 and December 31, 2012.</li>
      <li class="calibre12">Repeat <em class="italic">step 6</em>, naming <a id="calibre_link-900" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this new query <strong class="screentext">Sales2013</strong> and filtering for dates between <a id="calibre_link-886" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>January 1, 2013 and December 31, 2013.</li>
    </ol>
    <p class="book-title--packt">For additional details on performing these steps, see the <em class="italic">Managing Queries and Data Sources</em> recipe in this chapter.</p>
    <h2 id="calibre_link-1435" class="calibre8">How to Combine Queries</h2>
    <p class="book-title--packt">The goal of this example is to produce an integrated table based on three "Sales" queries. While in this example the three queries come from the same data source, it is important to realize that the three queries could point to completely different data sources, such as three text files or even a text file, an Excel spreadsheet, and a SQL database. What is important is that the three queries have the same column names and number of columns. To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Move the <strong class="screentext">Sales2011</strong>, <strong class="screentext">Sales2012</strong>, and <strong class="screentext">Sales2013</strong> queries to a new query group called <strong class="screentext">Staging Queries</strong>.</li>
      <li class="calibre12">Disable the load for the <strong class="screentext">Sales2011</strong>, <strong class="screentext">Sales2012</strong>, and <strong class="screentext">Sales2013</strong> queries.</li>
      <li class="calibre12">Create a new <strong class="screentext">Blank</strong> query in the <strong class="screentext">Other Queries</strong> group and call this query <strong class="screentext">FactInternetSales2011to2012</strong>.</li>
      <li class="calibre12">Open the<strong class="screentext"> FactInternetSales2011to2012</strong> query in <strong class="screentext">Advanced Editor</strong>.</li>
      <li class="calibre12">Use the <code class="code-in-text--packt">Table.Combine</code> (or <strong class="screentext">Append Queries</strong> feature in the ribbon) function to return a single table based on the rows of the <strong class="screentext">Sales2011</strong>, <strong class="screentext">Sales2012</strong>, and <strong class="screentext">Sales2013</strong> queries.
        <pre class="programlisting"><code class="hljs">Let
    Source = Table.Combine( {Sales2011, Sales2012, Sales2013} )
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">DimEmployees</strong> query to the <strong class="screentext">Staging Queries</strong> group and disable loading.</li>
      <li class="calibre12">Duplicate the <strong class="screentext">DimEmployees</strong> query and call this new query <strong class="screentext">Managers</strong>.</li>
      <li class="calibre12">Disable <a id="calibre_link-887" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>loading for the <strong class="screentext">Managers</strong> query.</li>
      <li class="calibre12">Open the <strong class="screentext">Managers</strong> query in the <strong class="screentext">Advanced Editor</strong>.</li>
      <li class="calibre12">Add a <strong class="screentext">Manager Name</strong> column<a id="calibre_link-901" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> using the <code class="code-in-text--packt">Table.AddColumn</code> function.
        <pre class="programlisting"><code class="hljs">    ManagerName = 
        Table.AddColumn(
            dbo_DimEmployee,
            "Manager Name", each [FirstName] &amp; " " &amp; [LastName]
        )
</code></pre>
      </li>
      <li class="calibre12">Select only the <strong class="screentext">EmployeeKey</strong>, <strong class="screentext">Manager Name</strong>, and <strong class="screentext">Title</strong> columns using the <code class="code-in-text--packt">Table</code>.<code class="code-in-text--packt">SelectColumns</code> function.
        <pre class="programlisting"><code class="hljs">    SelectCols = 
        Table.SelectColumns(
            ManagerName, 
            { "EmployeeKey", "Manager Name", "Title" }
        )
</code></pre>
      </li>
      <li class="calibre12">Create a new <strong class="screentext">Blank</strong> query in the <strong class="screentext">Other Queries</strong> group and call this query <strong class="screentext">Employees</strong>.</li>
      <li class="calibre12">Open the <strong class="screentext">Employees</strong> query in <strong class="screentext">Advanced Editor</strong>.</li>
      <li class="calibre12">Join the <code class="code-in-text--packt">Managers</code> query and <code class="code-in-text--packt">DimEmployee</code> query using the <code class="code-in-text--packt">Table.NestedJoin</code> function or the <strong class="screentext">Merge Queries</strong> feature in the ribbon.
        <pre class="programlisting"><code class="hljs">Let
    Source = 
        Table.NestedJoin(
            DimEmployee, "ParentEmployeeKey", Managers, "EmployeeKey",
            "ManagerColumn", JoinKind.LeftOuter
        )
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Use the <code class="code-in-text--packt">Table</code>.<code class="code-in-text--packt">ExpandTableColumn</code> function to add the <code class="code-in-text--packt">Manager Name</code> and <code class="code-in-text--packt">Manager Title</code> columns.
        <pre class="programlisting"><code class="hljs">    ManagerColumns = 
        Table.ExpandTableColumn(
            Source, "ManagerColumn",
            { "Manager Name", "Title" },
            { "Manager Name", "Manager Title" }
        )
</code></pre>
      </li>
      <li class="calibre12">Add an <strong class="screentext">Employee Name</strong> column.
        <pre class="programlisting"><code class="hljs">    EmployeeName = 
        Table.AddColumn(
            ManagerColumns,
            "Employee Name", each [FirstName] &amp; " " &amp; [LastName]
        )
</code></pre>
      </li>
      <li class="calibre12">Rename<a id="calibre_link-902" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Title</strong> column <a id="calibre_link-888" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to <strong class="screentext">Employee Title</strong>.
        <pre class="programlisting"><code class="hljs">    RenameTitle = 
        Table.RenameColumns(
            EmployeeName,
            { "Title", "Employee Title" }
        )
</code></pre>
      </li>
      <li class="calibre12">Select the <code class="code-in-text--packt">EmployeeKey</code>, <code class="code-in-text--packt">Employee Name</code>, <code class="code-in-text--packt">Employee Title</code>, <code class="code-in-text--packt">Manager Name</code>, and <code class="code-in-text--packt">Manager Title</code> columns.
        <pre class="programlisting"><code class="hljs">    SelectCols =
        Table.SelectColumns(
            RenameTitle,
            { 
                "EmployeeKey", "Employee Name", "Employee Title",
                "Manager Name", "Manager Title"
            }
        )
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1436" class="calibre8">How it works</h2>
    <p class="book-title--packt">For the <strong class="screentext">FactInternetSales2011to2013</strong> query, only a single expression is required using the <code class="code-in-text--packt">Table.Combine</code> function. No other expressions are necessary in this example given that the staging queries have <a id="calibre_link-1437" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>identical column names and the same number of columns. The <code class="code-in-text--packt">Table.Combine</code> function<a id="calibre_link-1075" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> performs an append operation and does not remove duplicate rows similar to a SQL UNION statement. </p>
    <p class="book-title--packt">Any columns which are unique to one of the <a id="calibre_link-1438" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>input tables in a <code class="code-in-text--packt">Table.Combine</code> function will be added to the result set with null values for the rows from the other tables. Depending on the scenario, the developer could apply the <code class="code-in-text--packt">Table.Distinct</code> function<a id="calibre_link-1076" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to avoid any duplicate rows from reaching the data model.</p>
    <p class="book-title--packt">The <strong class="screentext">Employees</strong> query references the <strong class="screentext">DimEmployees</strong> query as the left table in a <code class="code-in-text--packt">Table.NestedJoin</code> function, and is <a id="calibre_link-1078" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>joined to the <code class="code-in-text--packt">Managers</code> query via a left outer join. The left join is required to retain all employee rows in this scenario, as the <code class="code-in-text--packt">DimEmployees</code> table includes one employee that does not have a parent employee key, the <code class="code-in-text--packt">Chief Executive Officer</code>.</p>
    <p class="book-title--packt">The join is performed on the <code class="code-in-text--packt">ParentEmployeeKey</code> column in the <strong class="screentext">DimEmployees</strong> query to the <code class="code-in-text--packt">EmployeeKey</code> column in the <strong class="screentext">Managers</strong> query. After this step, all of the rows from the matching <strong class="screentext">Managers</strong> table are stored within the row as a <code class="code-in-text--packt">Table</code> object<a id="calibre_link-1077" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in the column <strong class="screentext">ManagerColumn</strong>. When expanding the <strong class="screentext">ManagerColumn</strong> column using the <code class="code-in-text--packt">Table.ExpandTableColumn</code> function, the <strong class="screentext">Manager Name</strong> column can retain the same name, but the <strong class="screentext">Title</strong> column is renamed to <strong class="screentext">Manager Title</strong> in order to avoid conflicting with the <strong class="screentext">Title</strong> column in the <strong class="screentext">DimEmployees</strong> query. </p>
    <p class="book-title--packt">In implementing the table joins, you can choose to use the <code class="code-in-text--packt">Table.Join</code> and <code class="code-in-text--packt">Table.NestedJoin</code> functions. All six join types&mdash;inner, left outer, right outer, full outer, left anti, and right anti&mdash;are supported by both functions. The <code class="code-in-text--packt">Table.NestedJoin</code> function enters the results of the join (the right or second table) into a new column of table values and will use local resources to execute the join operation, unless the <code class="code-in-text--packt">Table.ExpandTableColumn</code> function is used to replace this new column with columns from the right table. A left outer join type is the default if the <code class="code-in-text--packt">JoinKind</code> parameter is not specified. For performance reasons, <code class="code-in-text--packt">Table.NestedJoin</code> should not be used without a <code class="code-in-text--packt">Table.ExpandTableColumn</code> function removing the column of tables.</p>
    <p class="book-title--packt">Conversely, the <code class="code-in-text--packt">Table.Join</code> function automatically expands the left table with the columns from the right table input (a flat join) and defaults to an inner join if the <code class="code-in-text--packt">JoinKind</code> parameter is not specified. The <code class="code-in-text--packt">Table.Join</code> function gets folded to the source without any additional functions but requires that there are no matching column names between the joined tables for a <code class="code-in-text--packt">JoinKind</code> other than inner join. For inner joins, the matching column names from both tables must be specified in the join key parameters. A <code class="code-in-text--packt">Table.SelectColumns</code> function<a id="calibre_link-1088" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is required to exclude any columns from the right table added with the join. </p>
    <p class="book-title--packt">Whether implemented via <code class="code-in-text--packt">Table.NestedJoin</code> or <code class="code-in-text--packt">Table.Join</code>, developers should look to use inner joins if the source tables have referential integrity, such as with foreign key constraints and whether this meets requirements. For joins against larger tables, developers should confirm that query folding is occurring and can evaluate the different query plans generated by alternative retrieval designs in terms of performance.</p>
    <p class="book-title--packt">Note that the two rows for Rob Walters are due to a <strong class="screentext">Slowly Changing Dimension</strong> (<strong class="screentext">SCD</strong>) Type 2 process applied in the source database. For more information on <a id="calibre_link-1014" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>SCDs, refer to this Wikipedia article: <a href="https://bit.ly/3yIQeI5" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3yIQeI5</span></a>.</p>
    <h2 id="calibre_link-1439" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Rather than creating separate lookup/join staging queries, it is possible to consolidate these expressions into a single <code class="code-in-text--packt">letâ¦in</code> M expression. For example, the following single query returns the exact same results as the <strong class="screentext">Sales2011</strong>, <strong class="screentext">Sales2012</strong>, <strong class="screentext">Sales2013</strong>, and <strong class="screentext">FactInternetSales2011to2013</strong> queries:</p>
    <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Sales = Source{[Sche"a=""bo",It"m="FactInternetSa"es"]}[Data],
    Sales2011Rows = 
        Table.SelectRows(
            Sales, each 
                [OrderDate] &gt;= #datetime(2011, 1, 1, 0, 0, 0) and 
                [OrderDate] &lt;= #datetime(2011, 12, 31, 0, 0, 0)
        ),
    Sales2012Rows = 
        Table.SelectRows(
            Sales, each 
                [OrderDate] &gt;= #datetime(2012, 1, 1, 0, 0, 0) and 
                [OrderDate] &lt;= #datetime(2012, 12, 31, 0, 0, 0)
        ),
    Sales2013Rows = 
        Table.SelectRows(
            Sales, each 
                [OrderDate] &gt;= #datetime(2013, 1, 1, 0, 0, 0) and 
                [OrderDate] &lt;= #datetime(2013, 12, 31, 0, 0, 0)
        ),
    Append = Table.Combine( {Sales2011Rows, Sales2012Rows, Sales2013Rows} )
in
    Append
</code></pre>
    <p class="book-title--packt">Inline query approaches are helpful in limiting the volume of queries, but you lose the management benefits provided by group folders and<a id="calibre_link-905" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Query Dependencies</strong> view. The graphical support makes it easier to explain and quickly troubleshoot a data retrieval process over a single but complex M expression. Staging queries are recommended for all but the most trivial projects and retrieval processes. Staging queries should generally never be loaded to the data model, as staging tables could both confuse the user and would require the data model to use additional resources to process and store the additional data.</p>
    <p class="book-title--packt">Similarly, merge queries can also be combined into a single query. The following table breaks down the six different join types that can be specified in both the <code class="code-in-text--packt">Table.NestedJoin</code> and <code class="code-in-text--packt">Table.Join</code> functions. Both the <strong class="screentext">Parameter</strong> and <strong class="screentext">Parameter Value</strong> can be used, though the recipes in this book use <strong class="screentext">Parameter</strong> as this makes the expressions easier to follow.</p>
    <table id="calibre_link-1440" class="no-table-style">
      <colgroup class="calibre15">
        <col class="calibre16"></col>
        <col class="calibre16"></col>
        <col class="calibre16"></col>
      </colgroup>
      <tbody class="calibre17">
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Join type</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Parameter</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Parameter value</p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Inner</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><code class="code-in-text--packt1">JoinKind.Inner</code></p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">0</p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Left Outer</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><code class="code-in-text--packt">JoinKind.LeftOuter</code></p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">1</p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Right Outer</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><code class="code-in-text--packt1">JoinKind.RightOuter</code></p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">2</p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Full Outer</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><code class="code-in-text--packt">JoinKind.FullOuter</code></p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">3</p>
          </td>
        </tr>
        <tr class="no-table-style3">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Left Anti</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><code class="code-in-text--packt1">JoinKind.LeftAnti</code></p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">4</p>
          </td>
        </tr>
        <tr class="no-table-style1">
          <td class="no-table-style2">
            <p class="table-column-heading--packt">Right Anti</p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt"><code class="code-in-text--packt">JoinKind.RightAnti</code></p>
          </td>
          <td class="no-table-style2">
            <p class="table-column-heading--packt">5</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="book-title--packt">Table 2.3: Power Query (M) join types, parameters, and parameter values</p>
    <p class="book-title--packt">One final note is that, for data source files with the same structure stored in the same network directory folder, Power BI offers the <strong class="screentext">Combine Binaries</strong> transformation, which can be used with text, CSV, Excel, JSON, and other file formats. This feature can be used when creating a <strong class="screentext">Folder</strong> query. The <strong class="screentext">Combine Binaries</strong> feature<a id="calibre_link-165" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> automatically creates an example query and a function linked to this query, such that any required modification to the source files can be applied to all files, and the source location of the files can be easily revised.</p>
    <h2 id="calibre_link-1441" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><code class="code-in-text--packt">Table.Combine</code>: <a href="http://bit.ly/3c6L2o0" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3c6L2o0</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.NestedJoin</code>: <a href="http://bit.ly/30ZO3jZ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/30ZO3jZ</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.Join</code>: <a href="http://bit.ly/3lxMRh7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3lxMRh7</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.ExpandTableColumn</code>: <a href="http://bit.ly/3eY6u0z" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3eY6u0z</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.AddColumn</code>:<a href="http://bit.ly/3vGJZ6b%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url"> http://bit.ly/3vGJZ6b</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.SelectColumns</code>: <a href="http://bit.ly/38Qk7Lt" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/38Qk7Lt</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.RenameColumns</code>: <a href="http://bit.ly/3rTVfd4" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3rTVfd4</span></a></li>
      <li class="bullet">M table function reference: <a href="https://docs.microsoft.com/en-gb/powerquery-m/table-functions" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2oj0k0I</span></a></li>
      <li class="bullet">Combining binaries in Power BI Desktop:<a href="https://docs.microsoft.com/en-us/power-bi/transform-model/desktop-combine-binaries" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url"> http://bit.ly/2oL2nM4</span></a></li>
    </ul>
    <h1 id="calibre_link-1194" class="title">Selecting Column Data Types</h1>
    <p class="book-title--packt">Setting the data <a id="calibre_link-141" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>types of columns in Power BI Desktop is usually the final step of data retrieval queries, and has great implications for all layers of the solution, including data refresh, data modeling, and visualization. Choosing appropriate data types reduces the risk of refresh failures, ensures consistent report results, and provides analytical flexibility to the data model and visualization layers.</p>
    <p class="book-title--packt">This recipe demonstrates how to choose and define data types to load to Power BI Desktop. Additional details on data types and the implications of data types for Power BI development are contained in the sections following these examples.</p>
    <h2 id="calibre_link-1442" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">In preparation for this recipe, import the <code class="code-in-text--packt">FactCallCenter</code> table from the <strong class="screentext">AdventureWorksDW2019</strong> database by doing the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop and choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong>.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>, select the <strong class="screentext">FactFinance</strong> table in the data preview area, and rename this query <strong class="screentext">FactFinance</strong>.</li>
      <li class="calibre12">Move the <strong class="screentext">FactFinance</strong> query to the <strong class="screentext">Other Queries</strong> group.</li>
    </ol>
    <p class="book-title--packt">For additional <a id="calibre_link-142" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>details on performing these steps, see the <em class="italic">Managing Queries and Data Sources</em> recipe in this chapter.</p>
    <h2 id="calibre_link-1443" class="calibre8">How to Select Column Data Types</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Use the <code class="code-in-text--packt">Table.TransformColumnTypes</code> function to revise the type of the numeric integer <strong class="screentext">FinanceKey</strong> column to text. Note that the column header for the <strong class="screentext">FinanceKey</strong> column is initially prefaced with a <strong class="screentext">123</strong> icon and changes to an <strong class="screentext">ABC</strong> icon. Also, note that the row values are initially left justified and italicized and after transformation to text are aligned to the right and not italicized.
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_FactFinance = Source{[Schema="dbo",Item="FactFinance"]}[Data],
    FinanceKeyText = 
        Table.TransformColumnTypes(
            dbo_FactFinance, {{"FinanceKey", Text.Type}}
        )
in
    FinanceKeyText
</code></pre>
      </li>
      <li class="calibre12">Add a numeric column from a source column stored as text using the <code class="code-in-text--packt">Number.FromText</code> and <code class="code-in-text--packt">Table.AddColumn</code> functions.
        <pre class="programlisting"><code class="hljs">    FinanceKeyNum = 
        Table.AddColumn(
            FinanceKeyText, "FinanceKeyNum",
            each Number.FromText([FinanceKey]),Int64.Type
        )
</code></pre>
      </li>
      <li class="calibre12">Change the fixed decimal <strong class="screentext">Amount</strong> column to currency using the <code class="code-in-text--packt">Table.TransformColumnTypes</code> function. Note that the column header icon changes from <strong class="screentext">1.2</strong> initially to a dollar sign, <strong class="screentext">$</strong>.
        <pre class="programlisting"><code class="hljs">    Currency = 
        Table.TransformColumnTypes(
            FinanceKeyNum,{{"Amount", Currency.Type}}
        )
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1444" class="calibre8">How it works</h2>
    <p class="book-title--packt">For the <code class="code-in-text--packt">FinanceKeyText</code> expression, the <code class="code-in-text--packt">Table.TransformColumnTypes</code> function takes two parameters. The <a id="calibre_link-143" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>first parameter is the table to operate upon; the second is a list of list pairs that include the column name to transform and then the transformation data type. Multiple pairs can be included in the form:</p>
    <pre class="programlisting"><code class="hljs">{ { "Column1", type }, { "Column2", type } }
</code></pre>
    <p class="book-title--packt">Additional valid values for the type parameter include the following:</p>
    <ul class="calibre9">
      <li class="bullet"><code class="code-in-text--packt">Currency.Type</code> sets the column as a <strong class="screentext">Fixed Decimal Number</strong> to two decimal places.</li>
      <li class="bullet"><code class="code-in-text--packt">Decimal.Type</code> or <code class="code-in-text--packt">type number</code> sets the new column as a <strong class="screentext">Decimal Number</strong>.</li>
      <li class="bullet"><code class="code-in-text--packt">Percentage.Type</code> sets the column as a <strong class="screentext">Percentage</strong> data type. Unlike <strong class="screentext">Whole Number</strong>, <strong class="screentext">Fixed Decimal Number</strong>, and <strong class="screentext">Decimal Number</strong>, this type does not have a corresponding type in the data model. When loaded to the data model, the <strong class="screentext">Percentage</strong> data type is represented as a <strong class="screentext">Decimal Number</strong> type.</li>
      <li class="bullet"><code class="code-in-text--packt">Text.Type</code> or <code class="code-in-text--packt">type text</code> sets the column to a <strong class="screentext">Text</strong> data type.</li>
      <li class="bullet"><code class="code-in-text--packt">Date.Type</code> or <code class="code-in-text--packt">type date</code> sets the column to a <strong class="screentext">Date</strong> data type.</li>
      <li class="bullet"><code class="code-in-text--packt">DateTime.Type</code> or <code class="code-in-text--packt">type datetime</code> sets the column to a <strong class="screentext">Date Time</strong> data type.</li>
      <li class="bullet"><code class="code-in-text--packt">DateTimeZone.Type</code> or <code class="code-in-text--packt">type datetimezone</code> sets the column to a <strong class="screentext">Date/Time/Timezone</strong> data type.</li>
      <li class="bullet"><code class="code-in-text--packt">Time.Type</code> or <code class="code-in-text--packt">type time</code> sets the column to a <strong class="screentext">Time</strong> data type.</li>
      <li class="bullet"><code class="code-in-text--packt">Duration.Type</code> or <code class="code-in-text--packt">type</code> <code class="code-in-text--packt">duration</code> sets the column to a <strong class="screentext">Duration</strong> data type.</li>
      <li class="bullet"><code class="code-in-text--packt">Logical.Type</code> or <code class="code-in-text--packt">type</code> <code class="code-in-text--packt">logical</code> sets the column to a <strong class="screentext">True/False</strong> data type.</li>
      <li class="bullet"><code class="code-in-text--packt">Binary.Type</code> or <code class="code-in-text--packt">type binary</code> sets the column to a <strong class="screentext">Binary</strong> data type.</li>
    </ul>
    <p class="book-title--packt">Like all M expressions, data type declarations are case-sensitive.</p>
    <p class="book-title--packt">For the <code class="code-in-text--packt">FinanceKeyNum</code> expression, the type parameter for the <code class="code-in-text--packt">Table</code>.<code class="code-in-text--packt">AddColumn</code> function is optional. Leaving this parameter blank results in an <strong class="screentext">Any</strong> data type, which would be loaded into the data model as a <strong class="screentext">Text</strong> data type. By specifying <code class="code-in-text--packt">Int64.Type</code> as the optional type parameter to <code class="code-in-text--packt">Table.AddColumn</code>, the new column stores whole numbers instead of text.</p>
    <p class="book-title--packt">Great care should be taken when choosing data types. For example, convert <strong class="screentext">Decimal Number</strong> to <strong class="screentext">Fixed Decimal Number</strong> data types if consistent rounding results are required. Also, converting from <strong class="screentext">Decimal Number</strong> to <strong class="screentext">Fixed Decimal Number</strong> can marginally improve data compression and query performance. A <strong class="screentext">Decimal</strong> data type is approximate and can produce inconsistent reporting results due to rounding. <strong class="screentext">Decimal Number</strong> data types are floating-point (approximate) data types with 15 digits of precision. <strong class="screentext">Fixed Decimal Number</strong> data types store 19 digits of precision and four significant digits after the decimal. <strong class="screentext">Whole Number</strong> data types store up to 19 digits of precision.</p>
    <p class="book-title--packt">Revising <strong class="screentext">Text</strong> data types to <strong class="screentext">Numeric</strong> data types impacts the DAX metrics that can be written. For example, if a <code class="code-in-text--packt">Calendar Year</code> column is stored as a <strong class="screentext">Text</strong> data type, the following DAX metric will fail<a id="calibre_link-144" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> due to the type incompatibility of the number 2016:</p>
    <figure class="mediaobject"><img src="images/000049.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.38: DAX measure expression</p>
    <p class="book-title--packt">Revising <code class="code-in-text--packt">Calendar Year</code> to a whole number type avoids the need to use <code class="code-in-text--packt">VALUE</code> or <code class="code-in-text--packt">FORMAT</code> functions in each DAX measure. Power BI Desktop provides rich analysis capabilities for columns of the <strong class="screentext">Date</strong> data type, including drill-down hierarchies, visual calendar pickers for filters, custom date filtering logic in slicers, and calculations such as for the first and last date. Given these capabilities, as well as DAX functionality with <strong class="screentext">Date </strong>data types, converting <strong class="screentext">Text</strong> and <strong class="screentext">Numeric</strong> types to <strong class="screentext">Date</strong> data types can provide significantly more options to develop Power BI content.</p>
    <h2 id="calibre_link-1445" class="calibre8">There's more...</h2>
    <p class="book-title--packt">While there are many topics that can be discussed regarding data types in Power Query, two are worth exploring in greater detail: <strong class="screentext">automatic data type detection</strong> and <strong class="screentext">date with locale</strong>. When enabled, automatic <a id="calibre_link-100" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>data type detection occurs when using unstructured data sources, such as flat files and Excel workbooks. When importing such data, a <strong class="screentext">Changed Type</strong> step is added that uses a sampling or preview of each source column to determine the appropriate type. </p>
    <figure class="mediaobject"><img src="images/000061.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.39: Automatic Data Type Selection Step</p>
    <p class="book-title--packt">If the data sample does not reflect the full or future set of values for the column, the data type selected may be incorrect. Automatic type detection is <a id="calibre_link-1446" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>not used with structured relational database systems such as SQL Server.</p>
    <p class="book-title--packt">You can avoid automatic type detection via the <strong class="screentext">Data Load</strong> options in the <strong class="screentext">File | Options and settings | Options</strong> dialog. </p>
    <p class="book-title--packt">As automatic detection is a <strong class="screentext">CURRENT FILE</strong> option only, and since the setting is enabled by default, you currently need to disable this automatic type detection for each new file. It is recommended that you disable this for each file or manually remove the <strong class="screentext">Changed Type</strong> step and make your own decisions regarding data type transformations.</p>
    <p class="book-title--packt">Power Query also supports different locales or cultures. If there's any potential for <strong class="screentext">Date</strong> data types to be sourced from a region with a different date standard than your local system, you should apply the <strong class="screentext">Locale </strong>option to<a id="calibre_link-572" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <code class="code-in-text--packt">Table</code><strong class="screentext">.</strong><code class="code-in-text--packt">TransformColumnTypes</code> function; for example, when a date column stores date values in the format <code class="code-in-text--packt">dd/mm/yyyy</code>, whereas the local system uses <code class="code-in-text--packt">mm/dd/yyyy</code>. Trying to convert this date directly on a desktop configured for US English causes an error as the first two digits are greater than 12. However, specifying the source locale in the transform expression allows for successful conversion. The Query Editor provides a simple interface for the source locale. Simply right-click on the column, expand <strong class="screentext">Change Type</strong>,<strong class="screentext"> </strong>and then select <strong class="screentext">Using Localeâ¦.</strong></p>
    <figure class="mediaobject"><img src="images/000085.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.40: Change Type with Locale interface</p>
    <p class="book-title--packt">Alternatively, you can add the locale to the expression itself directly:</p>
    <pre class="programlisting"><code class="hljs">DateLocale = 
    Table.TransformColumnTypes(
        PreviousStep, {{ "Date", type date }}, "en-GB"
    )
</code></pre>
    <h2 id="calibre_link-1447" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><code class="code-in-text--packt">Table.AddColumn</code>: <a href="http://bit.ly/3vGJZ6b" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3vGJZ6b</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">Table.TransformColumnTypes</code>: <a href="http://bit.ly/3s5AfjC" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3s5AfjC</span></a></li>
      <li class="bullet">Data types in Power Query: <a href="http://bit.ly/392iWIP%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/392iWIP</span></a></li>
      <li class="bullet">Language ID and tag reference: <a href="http://bit.ly/3cXpPfw" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cXpPfw</span></a> </li>
      <li class="bullet">10 Common Mistakes You Do In #PowerBI #PowerQuery &ndash; Pitfall #2: <a href="http://bit.ly/2otDbcU%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2otDbcU</span></a></li>
      <li class="bullet">Choosing Numeric Data Types in DAX: <a href="http://bit.ly/2nOWYAm" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2nOWYAm</span></a></li>
    </ul>
    <h1 id="calibre_link-1195" class="title">Visualizing the M library</h1>
    <p class="book-title--packt">To implement complex and less common data transformation requirements, it is often necessary to browse the M <a id="calibre_link-622" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>library to find a specific function or review the parameters of a specific function. </p>
    <p class="book-title--packt">This short recipe provides a pre-built M query expression you can use to retrieve the M library into a table for analysis in Power BI Desktop. Additionally, an example is provided of visualizing and cross-filtering this table of functions on the Power BI report canvas.</p>
    <h2 id="calibre_link-1448" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To get ready for this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Click the <strong class="screentext">Transform data</strong> icon in the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a new <strong class="screentext">Blank Query</strong> and call this query <strong class="screentext">MLibrary</strong>.</li>
    </ol>
    <h2 id="calibre_link-1449" class="calibre8">How to Visualize M library</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Enter the following M code in the <strong class="screentext">Advanced Editor</strong>:
        <pre class="programlisting"><code class="hljs">let
    Source = Record.ToTable(#shared),
    Rename = Table.RenameColumns(Source, {{"Name", "Function"}}),
    Sort = Table.Sort(Rename, {{"Function", Order.Ascending}}),
    Dupe = Table.DuplicateColumn(Sort, "Function", "Function2"),
    Split = 
        Table.SplitColumn(
            Dupe, "Function2",
            Splitter.SplitTextByDelimiter(".", QuoteStyle.Csv),
            {"Group", "Detail"}
        ),
    MLibraryTable = 
        Table.TransformColumnTypes(
            Split, {{"Group", Text.Type}, {"Detail", Text.Type}}
        )
in
    MLibraryTable
</code></pre>
      </li>
      <li class="calibre12">Click the <strong class="screentext">OK</strong> button to<a id="calibre_link-623" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> close the <strong class="screentext">Advanced Editor</strong>. The preview area should now look similar to that shown in <em class="italic">Figure 2.41</em>.<figure class="mediaobject"><img src="images/000073.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.41: Query Editor view of library table function</p>
      </li>
      <li class="calibre12">Click on <strong class="screentext">Close and Apply</strong> from <a id="calibre_link-1450" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the Query Editor.</li>
      <li class="calibre12">The 1,000+ rows from the M library are now loaded to the <strong class="screentext">Data</strong> mode.</li>
      <li class="calibre12">Create a <strong class="screentext">visualization </strong>that uses the <code class="code-in-text--packt">Function Groups</code> column for filtering.<figure class="mediaobject"><img src="images/000111.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 2.42: Report page of M standard library</p>
    <h2 id="calibre_link-1451" class="calibre8">How it works</h2>
    <p class="book-title--packt">The M expression leverages<a id="calibre_link-624" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <code class="code-in-text--packt">#shared</code> variable, which returns a record of the names and values currently in scope. The record is converted to a table value and then the <code class="code-in-text--packt">Function</code> column, originally <code class="code-in-text--packt">Name</code> in the context of the library, is split based on the period delimiter to allow for the <code class="code-in-text--packt">Group</code> column.</p>
    <h2 id="calibre_link-1452" class="calibre8">There's more...</h2>
    <p class="book-title--packt">M library details for every function are made available by entering the function without any parameters.</p>
    <figure class="mediaobject"><img src="images/000122.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.43: Library Function Details</p>
    <h2 id="calibre_link-1453" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power Query function<a id="calibre_link-845" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> reference: <a href="http://bit.ly/3bLKJ1M" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3bLKJ1M</span></a></li>
    </ul>
    <h1 id="calibre_link-1196" class="title">Profiling Source Data</h1>
    <p class="book-title--packt">The topic of data quality<a id="calibre_link-1016" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> deals with the overall utility of datasets, and the ability to easily process and use the data for certain purposes, including analytics and reporting. Data quality is<a id="calibre_link-276" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> an essential component of data governance, ensuring that business data is accurate, complete, consistent, and valid. Good data quality is an essential element of any data analytics and reporting endeavor. Poor data quality can lead to incorrect analysis and decisions by the business&mdash;hence the phrase "garbage in, garbage out". Luckily, the Power Query Editor provides powerful data profiling tools to assist in quickly determining the quality of the data with which you are working. This recipe demonstrates how to unlock the powerful tools within the Power Query Editor for profiling columns and gaining a sense of the quality of the data being worked upon.</p>
    <h2 id="calibre_link-1454" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To get ready for this recipe, import the<code class="code-in-text--packt"> FactCallCenter</code> table from the <strong class="screentext">AdventureWorksDW2019</strong> database by doing the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop and choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">Create an <strong class="screentext">Import</strong> mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong>.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>, select the <strong class="screentext">FactFinance</strong> table in the data preview area, and rename this query <strong class="screentext">FactFinance</strong>.</li>
      <li class="calibre12">Move the <strong class="screentext">FactFinance</strong> query to the <strong class="screentext">Other Queries</strong> group.</li>
    </ol>
    <p class="book-title--packt">For additional details<a id="calibre_link-1017" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> on performing these steps, see the <em class="italic">Managing Queries and Data Sources</em> recipe in this chapter.</p>
    <h2 id="calibre_link-1455" class="calibre8">How to Profile Source Data</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">FactFinance</strong> query.</li>
      <li class="calibre12">In the <strong class="screentext">View</strong> tab, check the box for <strong class="screentext">Column profile</strong> in the <strong class="screentext">Data Preview</strong> area of the ribbon.</li>
      <li class="calibre12">Select a column to view the column statistics similar to those in <em class="italic">Figure 2.44</em>:<figure class="mediaobject"><img src="images/000134.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 2.44: Column profile information</p>
    <h2 id="calibre_link-1456" class="calibre8">How it works</h2>
    <p class="book-title--packt">By default, the M query engine pulls the first 1,000 rows of data from the specified data source. This is the data used in the data preview area. The default of using only the first 1,000 rows of data can be changed by clicking on <strong class="screentext">Column profiling based on top 1000 rows</strong> in the status bar in the bottom right and choosing <strong class="screentext">Column profiling based on the entire data set</strong>. Statistics are collected on each column in the data source. When the <strong class="screentext">Column profile</strong> feature is <a id="calibre_link-1457" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>enabled, selecting a column causes column statistics and value distribution to display in the bottom half of the data preview area, including alongside this error counts, the number of distinct and unique values, minimum values, maximum values, and additional information that depends upon the data type of the column, as shown in <em class="italic">Figure 2.44</em>.</p>
    <h2 id="calibre_link-1458" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Additional data quality dialogs are available in the Power Query Editor. From the <strong class="screentext">View</strong> tab, check the box next<a id="calibre_link-154" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to <strong class="screentext">Column quality</strong> and <strong class="screentext">Column distribution</strong>. Small visuals <a id="calibre_link-145" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>appear under the column headings. Hovering your mouse over this area provides a pop-up dialog that provides suggested actions as well as common data cleansing activities via the ellipsis menu (â¦).</p>
    <figure class="mediaobject"><img src="images/000147.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 2.45: Column quality and Column distribution visuals</p>
    <h2 id="calibre_link-1459" class="calibre8">See Also</h2>
    <ul class="calibre9">
      <li class="bullet"><em class="italic">Using the </em><em class="italic"><a id="calibre_link-275" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></em><em class="italic">data profiling tools</em>: <a href="http://bit.ly/3c46s5g%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3c46s5g</span></a></li>
    </ul>
    <h1 id="calibre_link-1197" class="title">Diagnosing Queries</h1>
    <p class="book-title--packt">The Power Query M engine is an<a id="calibre_link-846" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> extremely powerful and fast data transformation and data preparation engine used across an array of products, including:</p>
    <ul class="calibre9">
      <li class="bullet">Excel for Windows</li>
      <li class="bullet">Excel for Mac</li>
      <li class="bullet">Power BI</li>
      <li class="bullet">Power Apps</li>
      <li class="bullet">Power Automate</li>
      <li class="bullet">Azure Data Factory</li>
      <li class="bullet">SQL Server Integration Services</li>
      <li class="bullet">SQL Server Analysis Services</li>
      <li class="bullet">Dynamics 365 Customer Insights</li>
    </ul>
    <p class="book-title--packt">While both fast and powerful, there are times when you may find that a particular query is not as performant as desired. In these instances, Query Diagnostics can help you pinpoint problematic expressions and better understand what Power Query is doing in order to identify areas for query optimization. This recipe demonstrates how the user can use Query Diagnostics to troubleshoot a query and identify how the query might be optimized to be more performant.</p>
    <h2 id="calibre_link-1460" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To get ready, import<a id="calibre_link-889" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <code class="code-in-text--packt">FactCallCenter</code> table from the <strong class="screentext">AdventureWorksDW2019</strong> database by doing the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop and choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong>.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>; select the <strong class="screentext">FactCurrencyRate</strong> table in the data preview area, and rename the AdWorksDW query to <strong class="screentext">FactCurrencyRate</strong>.</li>
      <li class="calibre12">Move the <strong class="screentext">FactCurrencyRate</strong> query to the <strong class="screentext">Other Queries</strong> group.</li>
      <li class="calibre12">In the <strong class="screentext">Power Query Editor</strong>, select the <strong class="screentext">Tools</strong> tab and then <strong class="screentext">Diagnostic Options</strong>.</li>
      <li class="calibre12">Ensure that the radio button for <strong class="screentext">Enable in Query Editor (does not require running as admin) </strong>is selected and check all the boxes under the <strong class="screentext">Diagnostics Level</strong> and <strong class="screentext">Additional Diagnostics</strong> sub-headings.<figure class="mediaobject"><img src="images/000160.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 2.46: Query Diagnostic options</p>
    <p class="book-title--packt">For additional details on <a id="calibre_link-890" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>performing these steps, see the <em class="italic">Managing Queries and Data Sources</em> recipe in this chapter.</p>
    <h2 id="calibre_link-1461" class="calibre8">How to Diagnose Queries</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">FactCurrencyRate</strong> query, open <strong class="screentext">Advanced Editor, </strong>and modify the query to calculate the daily change in currency rates.
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_FactCurrencyRate = Source{[Schema="dbo",Item="FactCurrencyRate"]}[Data],
    Sort = 
        Table.Sort(
            dbo_FactCurrencyRate,
            {{"CurrencyKey", Order.Ascending}, {"DateKey", Order.Ascending}}
        ),
    Index = 
        Table.TransformColumnTypes(
            Table.AddIndexColumn(Sort, "Row Index", 1, 1),
            {{ "Row Index", Int64.Type }}
        ),
    PrevIndex = 
        Table.TransformColumnTypes(
            Table.AddIndexColumn(Index, "Prev Index", 0, 1),
            {{ "Prev Index", Int64.Type }}
        ),
    SelfJoin = 
        Table.NestedJoin(
            PrevIndex, {"Prev Index"}, PrevIndex, {"Row Index"}, 
            "NewColumn", JoinKind.LeftOuter
        ),
    PrevColumns = 
        Table.ExpandTableColumn(
            SelfJoin, "NewColumn", 
            {"EndOfDayRate", "CurrencyKey"}, {"PrevRate", "PrevKey"}
        ),
    AddChange = 
        Table.AddColumn(
            PrevColumns, "Daily Change", each
            if [CurrencyKey] = [PrevKey] then [EndOfDayRate] - [PrevRate]
            else null, type decimal
        ),
    SelectColumns = 
        Table.SelectColumns(
            AddChange,
            {"CurrencyKey", "EndOfDayRate", "Date", "Daily Change"}
        )
in
    SelectColumns
</code></pre>
      </li>
      <li class="calibre12">You may have to wait several minutes for the preview data to display. To investigate what is going on, click on the <strong class="screentext">Tools</strong> tab and then <strong class="screentext">Start Diagnostics</strong>.</li>
      <li class="calibre12">Click back on the <strong class="screentext">Home</strong> tab and click <strong class="screentext">Refresh Preview</strong>.</li>
      <li class="calibre12">Wait for the preview<a id="calibre_link-891" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> data to refresh and then click back on the <strong class="screentext">Tools</strong> tab and <strong class="screentext">Stop Diagnostics</strong>.<figure class="mediaobject"><img src="images/000173.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.47: Diagnostics processing display</p>
      </li>
      <li class="calibre12">When the <strong class="screentext">Diagnostics</strong> processing completes, you will have a new query group called <strong class="screentext">Diagnostics</strong> containing four queries for <strong class="screentext">Diagnostics_Counters</strong>, <strong class="screentext">Diagnostic_Detailed</strong>, <strong class="screentext">Diagnostic_Aggregated</strong>, and <strong class="screentext">Diagnostic_Partitions</strong>. Each of these queries is suffixed with a date and time stamp of when the diagnostics were run, and each has loading disabled.<figure class="mediaobject"><img src="images/000186.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 2.48: Diagnostics queries</p>
      </li>
      <li class="calibre12">Click on the <strong class="screentext">Diagnostics_Aggregated</strong> query. Select the <strong class="screentext">Step</strong>, <strong class="screentext">Category</strong>, <strong class="screentext">Start Time</strong>, <strong class="screentext">End Time</strong>, <strong class="screentext">Exclusive Duration (%)</strong>, and <strong class="screentext">Exclusive Duration</strong> columns and remove the other columns.</li>
      <li class="calibre12">Sort the <strong class="screentext">Exclusive Duration</strong> column in descending order.<figure class="mediaobject"><img src="images/000198.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 49: Diagnostic results</p>
      </li>
      <li class="calibre12">Look for large <a id="calibre_link-892" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>jumps in the <strong class="screentext">Exclusive Duration</strong> column; we see two such jumps between lines 3 and 4, and 4 and 5, with the larger jump being between lines 3 and 4. Also, note the high <strong class="screentext">Exclusive Duration (%)</strong> value for row 3.</li>
      <li class="calibre12">Look at the <strong class="screentext">Start Time</strong> and <strong class="screentext">End Time</strong> columns for row 3 and note that this operation took 4 minutes and 26 seconds to complete. The <strong class="screentext">Step</strong> column shows that the query step for row 3 is the <strong class="screentext">PrevColumns</strong> step.</li>
      <li class="calibre12">Having zeroed in on the <strong class="screentext">PrevColumns</strong> step of the query, click on the <strong class="screentext">Diagnostics_Detailed</strong> query and filter the <strong class="screentext">Step</strong> column to just show <strong class="screentext">PrevColumns</strong>. If the <strong class="screentext">PrevColumns</strong> value does not appear in the filtering dialog, use the <strong class="screentext">Load More</strong> link or edit the query in <strong class="screentext">Advanced Editor</strong> to add the <strong class="screentext">Table.SelectRows</strong> expression manually: <code class="code-in-text--packt">Table.SelectRows(#"Changed Type", each [Step] = "PrevColumns")</code>.</li>
      <li class="calibre12">Sort the query by the <strong class="screentext">Exclusive Duration (%)</strong> column in <strong class="screentext">Descending</strong> order.</li>
      <li class="calibre12">Note that the <strong class="screentext">Operation</strong> column for the top row is <strong class="screentext">DbDataReader</strong>.</li>
    </ol>
    <p class="book-title--packt">At this point, it should be evident that this query would likely be better done in the source database system as a view or stored procedure.</p>
    <h2 id="calibre_link-1462" class="calibre8">How it works</h2>
    <p class="book-title--packt">The <strong class="screentext">FactCurrencyRate</strong> query joins the base table with itself in order to compare subsequent rows of data. The goal is to compare the values of one row with the previous row in order to compute a value for a change in currency rate between days. This is done by sorting the table by first the currency and then the date using the <code class="code-in-text--packt">Table.Sort</code> function. Next, the <code class="code-in-text--packt">Table</code>.<code class="code-in-text--packt">AddIndexColumn</code> function is used twice, once to add an index column starting from 1 (<strong class="screentext">Row Index</strong> column) and a second time to add an index column starting from 0 (<strong class="screentext">Prev Inde</strong>x column). These two index columns are then used in a <code class="code-in-text--packt">Table</code>.<code class="code-in-text--packt">NestedJoin</code> function to join the table to itself. The <code class="code-in-text--packt">Table</code>.<code class="code-in-text--packt">ExpandTableColumn</code> function is used to expose the previous row's <strong class="screentext">CurrencyKey</strong> and <strong class="screentext">EndOfDayRate</strong> columns of the previous row. This information can then be used to create the <strong class="screentext">Daily Change </strong>column using the <code class="code-in-text--packt">Table</code>.<code class="code-in-text--packt">AddColumns</code> function, and finally, only the essential columns are selected using the <code class="code-in-text--packt">Table</code>.<code class="code-in-text--packt">SelectColumns</code> function.</p>
    <p class="book-title--packt">When you start Query Diagnostics, query diagnostic information is logged to JSON and CSV files stored in the application's directory. These files can be located by looking at the <strong class="screentext">Source</strong> step for aggregated, detailed, and partition diagnostic queries and the <strong class="screentext">CsvFiles</strong> step of the <strong class="screentext">Counters</strong> diagnostic query. For the Power BI Desktop Store App, the path should be similar to the following:</p>
    <pre class="programlisting"><code class="hljs">C:\Users\[user]\Microsoft\Power BI Desktop Store App\Traces\Diagnostics
</code></pre>
    <p class="book-title--packt">These files record<a id="calibre_link-893" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> diagnostic information performed by the query engine during processes such as refreshing the preview data. Stopping Query Diagnostics ends logging of the diagnostic data and generates queries for each enabled Query Diagnostics feature: <strong class="screentext">Aggregated</strong>, <strong class="screentext">Detailed</strong>, <strong class="screentext">Performance counters</strong>, and <strong class="screentext">Data privacy partitions</strong>. As diagnostic logging is costly in terms of performance and system resources, it is recommended to only use Query Diagnostics when troubleshooting a query's performance. In addition, only enable the minimal amount of diagnostic logging required to identify the problem&mdash;for example, often just starting with the <strong class="screentext">Aggregated</strong> diagnostic data is enough to identify the problematic step(s).</p>
    <h2 id="calibre_link-1463" class="calibre8">There's more...</h2>
    <p class="book-title--packt">There is also a <strong class="screentext">Diagnose Step</strong> feature<a id="calibre_link-383" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> available for Query Diagnostics. To see how <strong class="screentext">Diagnose Step</strong> can be used, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <strong class="screentext">Diagnostic Options</strong> from the ribbon of the Tools tab and uncheck the <strong class="screentext">Performance counters</strong> and <strong class="screentext">Data privacy</strong> partitions.</li>
      <li class="calibre12">In the <strong class="screentext">Query Settings</strong> pane, select the <strong class="screentext">SelfJoin</strong> step. You can now either right-click the <strong class="screentext">SelfJoin</strong> step and select <strong class="screentext">Diagnose</strong> or select <strong class="screentext">Diagnose Step</strong> in the ribbon of the <strong class="screentext">Tools</strong> tab.</li>
      <li class="calibre12">Once complete, two additional queries are added to the Diagnostics query group, <strong class="screentext">FactCurrencyRate_SelfJoin_Detailed</strong> and <strong class="screentext">FactCurrencyRate_SelfJoin_Aggregated</strong>, each suffixed with a date and time stamp.</li>
      <li class="calibre12">Click on the <strong class="screentext">FactCurrencyRate_SelfJoin_Aggregated</strong> query.</li>
      <li class="calibre12">Add an <strong class="screentext">Index</strong> column.</li>
      <li class="calibre12">Sort the <strong class="screentext">Exclusive Duration</strong> column in descending order.</li>
      <li class="calibre12">Here we can see that the most expensive operation occurs early on in the process, at index 15 out of 3,000+ rows, and appears to be the initial selection of columns with the Data Source Query being the following:
        <pre class="programlisting"><code class="hljs">select [_].[CurrencyKey],
    [_].[DateKey],
    [_].[AverageRate],
    [_].[EndOfDayRate],
    [_].[Date]
from [dbo].[FactCurrencyRate] as [_]
order by [_].[CurrencyKey],
        [_].[DateKey]
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">It should be evident that <a id="calibre_link-384" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>diagnosing a single step of a query is faster and consumes fewer system resources than analyzing the entire query. Thus, it is recommended that you run only <strong class="screentext">Aggregated</strong> diagnostics over an entire query to identify problematic steps, and then run <strong class="screentext">Detailed</strong> diagnostics on those steps individually. If you look at the <strong class="screentext">FactCurrencyRate_SelfJoin_Detailed</strong>, the most expensive operation is on line <strong class="screentext">60</strong>, and it is the <strong class="screentext">DbDataReader</strong> operation. The SQL statement identified is actually on line <strong class="screentext">59</strong> with the operation <strong class="screentext">Execute Query</strong>. Thus, we can conclude that the most expensive operation performed was not in executing the query, but rather reading the data generated by the query.</p>
    <h2 id="calibre_link-1464" class="calibre8">See Also</h2>
    <ul class="calibre9">
      <li class="bullet"><em class="italic">Recording Query Diagnostics in Power BI</em>: <a href="http://bit.ly/2ND2yqF" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2ND2yqF</span></a></li>
      <li class="bullet"><em class="italic">Query Diagnostics</em>: <a href="http://bit.ly/3lFz8ET" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3lFz8ET</span></a></li>
      <li class="bullet">Reading query diagnostics: <a href="http://bit.ly/3s8IFXA" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3s8IFXA</span></a></li>
    </ul>
    <h1 id="calibre_link-1198" class="title">Conclusion</h1>
    <p class="book-title--packt">In this chapter, we dove into Power BI Desktop's Get Data experience and walked through the process of establishing and managing data source connections and queries. The ability to ingest and access data is crucial to every BI project. In Power BI, this data ingest and access is driven by a powerful functional language and query engine, M. The Power Query M language provides a robust, scalable, and flexible engine for data retrieval, cleansing, and transformation. </p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-3">
<div id="calibre_link-1465" class="calibre2">
<div id="calibre_link-1466" class="calibre3"><div id="calibre_link-1467" class="calibre4">
    <h1 class="heading">3</h1>
    <h1 id="calibre_link-1199" class="title">Building a Power BI Data Model</h1>
    <blockquote class="packt_quote pcalibre6">"The data model is what feeds and what powers Power BI."<p class="cite">- Kasper de Jonge, Senior Program Manager, Microsoft</p></blockquote>
    
    <p class="book-title--packt">The data models developed in Power BI Desktop are at the center of Power BI projects. These data models support data exploration and drive the analytical queries visualized in reports and dashboards. Properly designed data models leverage the data connectivity and transformation capabilities described in <em class="italic">Chapter 2</em>, <em class="italic">Accessing and Retrieving Data</em>, to provide an integrated view of distinct business processes and entities. Additionally, data models contain predefined calculations, hierarchies and groupings, and metadata to greatly enhance both the analytical power of the dataset and its ease of use. The combination of accessing and retrieving data coupled with the additional enhancements available in the data model serves as the foundation for the BI and analytical capabilities of Power BI.</p>
    <p class="book-title--packt">In this chapter, we explore the primary processes of designing and developing robust data models. Common challenges in dimensional modeling are mapped to corresponding features and approaches in Power BI Desktop, including multiple grains and many-to-many relationships. Examples are also provided on how to embed business logic and definitions, develop analytical calculations with the DAX language, and configure metadata settings to increase the value and sustainability of models.</p>
    <p class="book-title--packt">In this chapter, we will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Designing a Data Model</li>
      <li class="bullet">Implementing a Data Model</li>
      <li class="bullet">Creating Relationships</li>
      <li class="bullet">Configuring Model Metadata</li>
      <li class="bullet">Hiding Columns and Tables</li>
      <li class="bullet">Enriching a Model with DAX</li>
      <li class="bullet">Supporting Virtual Table Relationships</li>
      <li class="bullet">Creating Hierarchies and Groups</li>
      <li class="bullet">Designing Column Level Security</li>
      <li class="bullet">Leveraging Aggregation Tables</li>
    </ul>
    <h1 id="calibre_link-1200" class="title">Technical Requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop</li>
      <li class="bullet">Tabular Editor</li>
      <li class="bullet">SQL Server with the <strong class="screentext">AdventureWorksDW2019</strong> database installed. This database and instructions for installing it are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a></li>
      <li class="bullet">Code samples and other materials can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a></li>
    </ul>
    <h1 id="calibre_link-1201" class="title">Designing a Data Model</h1>
    <p class="book-title--packt">Power BI <a id="calibre_link-250" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Desktop lends itself to rapid, agile development in which significant data insights can be obtained quickly despite both imperfect data sources and an incomplete understanding of business requirements and use cases. However, rushing through the design phase can undermine the sustainability of the solution, as future needs cannot be met without structural revisions to the model or complex workarounds. A balanced design phase in which fundamental decisions, such as DirectQuery versus in-memory, are analyzed, while simultaneously using a limited prototype model to generate visualizations and business feedback can address both short- and long-term needs.</p>
    <p class="book-title--packt">This recipe describes a process for designing a data model and identifies some of the primary questions and factors to consider while doing so.</p>
    <h2 id="calibre_link-1468" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">Visually and analytically impressive examples of Power BI's reporting capabilities can often cause stakeholders to underestimate the effort and complexity associated with data integration and data modeling. </p>
    <p class="book-title--packt">It is important to rein in any unrealistic expectations and confirm feasibility. Power BI is not the right tool for every job, so it is important to approach tasks through a methodical design approach. It is important to identify the top pain points and any unanswered business questions in the current state. Contrast this input with an assessment of feasibility and complexity (for example, data quality and analytical needs) along with targeting realistic and sustainable deliverables. A good design process will do just that.</p>
    <p class="book-title--packt">Dimensional <a id="calibre_link-251" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>modeling best practices and star schema designs are directly applicable to Power BI data models. Short, collaborative modeling sessions can be scheduled with subject matter experts and the main stakeholders. With the design of the model in place, an informed decision about the model's data mode (Import or DirectQuery) can be <a id="calibre_link-385" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>made prior to development. The four-step dimensional design process is as follows:</p>
    <ol class="calibre9">
      <li class="calibre12"><strong class="screentext">Choose the business process(es)</strong>: The number and nature of processes to include depends on the scale of the sources and scope of the project. Business processes might include planning, sales, time reporting, general ledger, and many others.</li>
      <li class="calibre12"><strong class="screentext">Declare the granularity</strong>: For each business process (or fact) to be modeled, define the meaning of each row. These should be clear, concise business definitions, and each fact table should only contain one grain. Consider scalability limitations with Power BI Desktop and balance the needs between detail and history, such as choosing to have greater history but less granularity. Examples include:<ul class="calibre11">
          <li class="calibre12">One Row per Sales Order Line</li>
          <li class="calibre12">One Row per General Ledger Account Balance per fiscal month</li>
        </ul>
        <p class="packt_figref">In the first example, the granularity is at the sales order line versus, perhaps, the purchase order header; in the second, the granularity is at the fiscal month versus per day or fiscal quarter.</p>
        <p class="packt_figref">Separate business processes, such as planning and sales, should never be integrated into the same table. Likewise, a single fact table should not contain distinct processes, such as shipping and receiving. Fact tables can be related to common dimensions but should generally never be related to each other in the data model (for example, <strong class="screentext">PO Header</strong> and <strong class="screentext">Line level</strong>).</p>
      </li>
      <li class="calibre12"><strong class="screentext">Identify the dimensions</strong>: Dimensions should have a natural relationship with the business process or event at the given granularity. Compare the dimension with any existing dimensions and hierarchies in the organization (for example, <strong class="screentext">Store</strong>). If so, determine whether there is a conflict, or whether additional columns may be required. Be aware of the query performance implications with large, high-cardinality dimensions, such as in customer tables with over two million rows. It may be necessary to optimize this relationship in the model or the measures and queries that use this relationship. See <em class="italic">Chapter 11</em>, <em class="italic">Enhancing and Optimizing Existing Power BI Solutions</em>, for more details.</li>
      <li class="calibre12"><strong class="screentext">Identify the facts</strong>:<strong class="screentext"> </strong>Facts<a id="calibre_link-386" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> should align with the business processes being modeled; for example, the sum of a quantity or a unique count of a dimension. Document the business and technical definition of the primary facts and compare this with any existing reports or metadata repository (for example, <em class="italic">Net Sales = Extended Amount - Discounts</em>). At this stage, you should be able to walk through top business questions and check whether the planned data model will support them. For example, the business might wish to answer the following question, "<em class="italic">What was the variance between Sales and Plan for last month for Bikes?</em>". Any clear gaps can be handled in&nbsp;one of three ways:<ul class="calibre11">
          <li class="calibre12">Revisit and modify the prior steps of this process</li>
          <li class="calibre12">Remove the question from the scope of the data model</li>
          <li class="calibre12">Plan to address the issue with additional logic in the model (M or DAX) </li>
        </ul>
        <p class="packt_figref">Focus only <a id="calibre_link-252" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>on the primary facts at this stage, such as the individual source columns that comprise the cost facts. If the business definition or logic for a core fact has multiple steps and conditions, check whether the data model will naturally simplify it or whether the logic can be developed during data retrieval in order to avoid complex measures.</p>
      </li>
    </ol>
    <h2 id="calibre_link-1469" class="calibre8">How to Design a Data Model</h2>
    <p class="book-title--packt">The Power BI model should preferably align with a corporate data architecture framework of standard facts and dimensions that can be shared across models. Though consumed by Power BI Desktop, existing data definitions and governance should be observed. Any new facts, dimensions, and measures developed with Power BI should supplement this architecture. To implement this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1"><strong class="screentext">Create a data warehouse bus matrix</strong>: A matrix of business processes (facts) and standard dimensions <a id="calibre_link-302" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is a primary tool for designing and managing data models, while also communicating the overall BI architecture. In this example, the business processes selected for the model are <strong class="screentext">Internet Sales</strong>, <strong class="screentext">Reseller Sales</strong>, and <strong class="screentext">General Ledger</strong>.<figure class="mediaobject"><img src="images/000209.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.1: Data Warehouse Bus Matrix</p>
      </li>
      <li class="calibre12"><strong class="screentext">Create an implementation bus matrix</strong>: An outcome of the model design process should <a id="calibre_link-253" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>include a more detailed implementation bus matrix. Clarity and <a id="calibre_link-548" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>approval of the grain of the fact tables, the definitions of the primary measures, and all dimensions gives confidence when entering the development phase.<figure class="mediaobject"><img src="images/000221.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.2: Implementation Bus Matrix: Internet Sales, Reseller Sales, and General Ledger</p>
        <p class="packt_figref">Power BI queries (M) and analysis logic (DAX) should not be considered as long-term substitutes for issues with data quality, master data management, and the data warehouse. If it is necessary to move forward, document the "technical debts" incurred and <a id="calibre_link-587" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>consider long-term solutions such as <strong class="screentext">Master Data Services</strong> (<strong class="screentext">MDS</strong>).</p>
      </li>
      <li class="calibre12"><strong class="screentext">Choose the dataset storage mode&mdash;Import, DirectQuery, or Composite</strong>: With the logical design of a<a id="calibre_link-284" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> model in place, one of the top design questions is whether to implement this model with DirectQuery mode or with the default imported In-Memory mode.<p class="packt_figref">The default Import mode <a id="calibre_link-1470" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is highly optimized for query performance and supports additional modeling and development flexibility with DAX functions. With compression, columnar storage, parallel query plans, and other techniques an import mode model is able to support a large amount of data (for example, 50 million rows) and still perform well with complex analysis expressions. Multiple data sources can be accessed and integrated into a single data model and all DAX functions are supported for measures, columns, and role security. The chief<a id="calibre_link-1471" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> disadvantages of import mode are dataset size limitations (1 GB for Pro, 10 GB for Premium) and the fact that data refreshes must be scheduled (eight times per day for Pro, 48 per day for Premium). An alternative to scheduled refreshes in the Power BI service is the use of REST APIs to trigger a data refresh of a published dataset. For example, an HTTP request to a Power BI REST API calling for the refresh of a dataset can be added to the end of a nightly update or ETL process script such that published Power BI content remains aligned with the source systems. </p>
        <p class="packt_figref">A DirectQuery mode model<a id="calibre_link-387" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> provides the same semantic layer interface for users and contains the same metadata that drives model behaviors as Import mode models do. The performance of DirectQuery models, however, is dependent on the source system and how this data is presented to the model. By eliminating the import or refresh process, DirectQuery provides a means to expose reports and dashboards to source data as the data changes.</p>
        <p class="packt_figref">This also avoids the file size limit of import mode models. However, there are several limitations<a id="calibre_link-391" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and restrictions to be aware of with DirectQuery:</p>
        <ul class="calibre11">
          <li class="calibre12">Only a single source from a single, supported data source can be used in a DirectQuery model.</li>
          <li class="calibre12">When deployed for widespread use, a high level of network traffic can be generated, thus impacting performance, as Power BI visualizations will need to query the source system, potentially via an on-premises data gateway.</li>
          <li class="calibre12">Some DAX functions cannot be used in calculated columns or with role security. Additionally, several common DAX functions are not optimized for DirectQuery performance.</li>
          <li class="calibre12">Many M query transformation functions cannot be used with DirectQuery.</li>
          <li class="calibre12">MDX client <a id="calibre_link-1472" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>applications, such as Excel, are supported, but less metadata (for example, hierarchies) are exposed.</li>
        </ul>
        <p class="packt_figref">Given these limitations and the importance of a "speed of thought" user experience with Power BI, DirectQuery should generally be used only on centralized and smaller projects in which visibility of updates of the source data is essential. If a supported DirectQuery system (for example, Teradata or Oracle) is available, the performance of core measures and queries should be tested. Also, confirm referential integrity in the <a id="calibre_link-97" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>source database and use the <strong class="screentext">Assume Referential Integrity</strong> relationship setting in DirectQuery mode models. This will generate more efficient inner join SQL queries against the source database.</p>
        <p class="packt_figref">Composite models allow mixing DirectQuery and Import sources, or even multiple DirectQuery sources. While more complex, when configured correctly, composite models can combine the ability to retrieve near-real-time data from DirectQuery sources with the high query performance of Import models. When using composite models, the storage mode for each table can be specified within the model. It is best to designate dimension-type tables as <strong class="screentext">Import</strong> or <strong class="screentext">Dual</strong> storage mode, and fact-type tables as <strong class="screentext">DirectQuery</strong> mode. </p>
      </li>
    </ol>
    <p class="book-title--packt">As an example, consider<a id="calibre_link-254" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> a model from this recipe with fact tables, Reseller Sales, Internet Sales, and General Ledger, along with dimensions such as Product and Sales Territory. Setting the dimension tables to Dual mode and the Internet Sales fact table to DirectQuery mode would allow the dimension tables to be quickly and efficiently retrieved from the in-memory (Import) model for rendering in a slicer, while simultaneously the Internet Sales table could use DirectQuery mode with the related dimension tables to enable real-time sales reporting via a single, efficient native SQL query.</p>
    <h2 id="calibre_link-1473" class="calibre8">How it works</h2>
    <p class="book-title--packt">Power BI can be fully delivered and managed by corporate BI professionals from data retrieval through visualization and content distribution. </p>
    <p class="book-title--packt">Some BI and analytics organizations also adopt hybrid approaches in which different components of Power BI are developed and owned by different teams, such as the BI/IT teams providing an optimized data source, its supporting ETL process, and the analytical data model, including its measure definitions, relationships, and data refresh process.</p>
    <p class="book-title--packt">Business teams can then leverage these assets in developing Power BI reports and dashboards, plus, optionally, Excel reports.</p>
    <p class="book-title--packt">As Power BI projects can have widely varying and often overlapping needs (for example, security, data refresh, and scalability) it is important to adopt a process for allocating the appropriate resources and planning for the longer-term deployment, such as migrating important, relatively mature Power BI datasets <a id="calibre_link-59" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to <strong class="screentext">Analysis Services</strong> Tabular.</p>
    <p class="book-title--packt">Power BI datasets and <strong class="screentext">SSAS</strong> share<a id="calibre_link-767" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the same database engine and architecture. Both tools support both Import and DirectQuery data models, and along with DAX and MDX<a id="calibre_link-1041" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> client applications such as Power BI (DAX) and Excel (MDX). The DAX query engine comprises a formula and a storage engine for both Import and DirectQuery modes. The formula engine produces query plans, requests data from the storage engine, and performs any remaining complex logic not supported by the storage engine against this data.</p>
    <p class="book-title--packt">In DirectQuery <a id="calibre_link-255" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>models, the source database is the storage engine&mdash;it receives SQL queries from the formula engine and returns the results to it. For In-Memory (Import) models, the imported and compressed columnar memory cache is the storage engine. See <em class="italic">Chapter 11</em>, <em class="italic">Enhancing and Optimizing Existing Power BI Solutions</em>, for more details.</p>
    <h2 id="calibre_link-1474" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Several topics and specific questions are so common that a standard "project ingestion" form or document can be created to support design and planning meetings. These topics and questions include the following:</p>
    <ul class="calibre9">
      <li class="bullet"><strong class="screentext">Data Sources</strong>: Is all the data required in a given system? What other sources are required or currently used?</li>
      <li class="bullet"><strong class="screentext">Security:</strong> Will the data model contain PCII or sensitive data? Does any data need to be secured from certain users?</li>
      <li class="bullet"><strong class="screentext">Version Control</strong>: Are there existing reports or models with the same measures?</li>
      <li class="bullet"><strong class="screentext">Complexity</strong>: Can the source data be used directly or are transformations required?</li>
      <li class="bullet"><strong class="screentext">Analytics</strong>: Are any custom or advanced analytics required (for example, exception measures, statistical analyses)?</li>
      <li class="bullet"><strong class="screentext">Data Refresh</strong>: Is there a need for real-time access? If not, how frequently does the data need to be refreshed?</li>
      <li class="bullet"><strong class="screentext">Model Scale</strong>: How much historical data is required? How many rows per week/month/year are in the largest fact table?</li>
      <li class="bullet"><strong class="screentext">Distribution</strong>: Approximately how many users will need to access the reports and dashboards that this model will support?</li>
    </ul>
    <p class="book-title--packt">The <em class="italic">Planning a Power BI Enterprise Deployment</em> whitepaper identifies the fundamental decisions and factors that guide Power BI deployments, including licensing, scalability and performance, data sources (cloud and on-premises), report visualization options, administration, and more.</p>
    <h2 id="calibre_link-1475" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Planning a Power BI Enterprise Deployment: <a href="http://bit.ly/2NJ55Qg" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2NJ55Qg</span></a></li>
      <li class="bullet">The Ten Essential Rules of Dimensional Modeling: <a href="http://bit.ly/1QijUwM" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/1QijUwM</span></a></li>
      <li class="bullet">Using DirectQuery in Power BI Desktop: <a href="http://bit.ly/2nUoLOG" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2nUoLOG</span></a></li>
      <li class="bullet">DirectQuery in SSAS Tabular 2016 whitepaper: <a href="http://bit.ly/2oe4Xcn" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2oe4Xcn</span></a></li>
      <li class="bullet">Announcing Data Refresh APIs: <a href="http://bit.ly/2rOUd3a" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2rOUd3a</span></a></li>
      <li class="bullet">Dataset modes in Power BI: <a href="http://bit.ly/30P2HKF" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/30P2HKF</span></a></li>
      <li class="bullet">Use composite models in Power BI: <a href="http://bit.ly/3tKFTbr" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3tKFTbr</span></a></li>
      <li class="bullet">Composite model guidance in Power BI: <a href="http://bit.ly/3sd3aCz" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3sd3aCz</span></a></li>
    </ul>
    <h1 id="calibre_link-1202" class="title">Implementing a Data Model</h1>
    <p class="book-title--packt">The implementation of a<a id="calibre_link-256" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> data model proceeds from the design phase described in the previous recipe. The design process and its supporting documentation clarify which entities to model, their granularity, the fact-to-dimension relationships, and the fact measures that must be developed. Additionally, the model mode (Import or DirectQuery) has already been determined, and any additional business logic to be implemented via M or DAX functions is also known. The different components of the model can now be developed, including data source connectivity, queries, relationships, measures, and metadata.</p>
    <p class="book-title--packt">In this recipe, we walk through all the primary steps in the physical implementation of a model design. Three fact tables and their related dimensions are retrieved, relationships are created, and the core measures and metadata are added. When complete, the multi-fact data model can be exposed to business users for initial testing and feedback.</p>
    <h2 id="calibre_link-1476" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a SQL view for each fact and dimension table to be represented in the data model. If you're unfamiliar with SQL views, see the <em class="italic">See also</em> section of this recipe.<p class="packt_figref">The views should only select the columns required of the model and apply the model's column names. Create views for the fact tables <strong class="screentext">FactResellerSales</strong>, <strong class="screentext">FactInternetSales</strong>, and <strong class="screentext">FactFinance</strong>, as well as the dimensions <strong class="screentext">DimEmployee</strong>, <strong class="screentext">DimReseller</strong>, <strong class="screentext">DimPromotion</strong>, <strong class="screentext">DimProduct</strong>, <strong class="screentext">DimSalesTerritory</strong>, <strong class="screentext">DimDepartmentGroup</strong>, <strong class="screentext">DimOrganization</strong>, <strong class="screentext">DimAccount</strong>, <strong class="screentext">DimCustomer</strong>, and <strong class="screentext">DimDate</strong>.</p>
        <p class="packt_figref">The layer of views protects the model from changes in the source system and provides visibility to administrators of the model's dependencies. Additionally, the views can de-normalize source tables via joins to conform to the structure of the model tables, and potentially include derived columns not available in the source. In the<a id="calibre_link-257" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following SQL example, the product dimension view joins three tables, <strong class="screentext">DimProduct</strong>, <strong class="screentext">DimProductCategory</strong>, and <strong class="screentext">DimProductSubcategory</strong>, and applies model column names.</p>
        <pre class="programlisting"><code class="hljs">select [$Outer].[ProductKey] as [ProductKey],
    [$Outer].[ProductSubcategoryKey2] as [ProductSubcategoryKey],
    [$Outer].[EnglishProductName] as [EnglishProductName],
    [$Outer].[Color] as [Color],
    [$Outer].[ListPrice] as [ListPrice],
    [$Outer].[Weight] as [Weight],
    [$Outer].[DaysToManufacture] as [DaysToManufacture],
    [$Outer].[EnglishDescription] as [EnglishDescription],
    [$Outer].[EnglishProductSubcategoryName] as [EnglishProductSubcategoryName],
    [$Outer].[ProductCategoryKey2] as [ProductCategoryKey],
    [$Inner].[EnglishProductCategoryName] as [DimProductCategory.EnglishProductCategoryName]
from 
(
    select [$Outer].[ProductKey] as [ProductKey],
        [$Outer].[ProductSubcategoryKey2] as [ProductSubcategoryKey2],
        [$Outer].[EnglishProductName] as [EnglishProductName],
        [$Outer].[Color] as [Color],
        [$Outer].[ListPrice] as [ListPrice],
        [$Outer].[Weight] as [Weight],
        [$Outer].[DaysToManufacture] as [DaysToManufacture],
        [$Outer].[EnglishDescription] as [EnglishDescription],
        [$Inner].[EnglishProductSubcategoryName] as [EnglishProductSubcategoryName],
        [$Inner].[ProductCategoryKey] as [ProductCategoryKey2]
    from 
    (
        select [ProductKey] as [ProductKey],
            [ProductSubcategoryKey] as [ProductSubcategoryKey2],
            [EnglishProductName] as [EnglishProductName],
            [Color] as [Color],
            [ListPrice] as [ListPrice],
            [Weight] as [Weight],
            [DaysToManufacture] as [DaysToManufacture],
            [EnglishDescription] as [EnglishDescription]
        from [dbo].[DimProduct] as [$Table]
    ) as [$Outer]
    left outer join [dbo].[DimProductSubcategory] as [$Inner] on ([$Outer].[ProductSubcategoryKey2] = [$Inner].[ProductSubcategoryKey])
) as [$Outer]
left outer join [dbo].[DimProductCategory] as [$Inner] on
[$Outer].ProductCategoryKey2 = [$Inner].ProductCategoryKey
</code></pre>
        <p class="packt_figref">Defining the <a id="calibre_link-258" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>SQL views is especially important if a DirectQuery model is being supported. For DirectQuery model views, evaluate the efficiency of the query plans and the referential integrity between the views to support inner join DirectQuery queries.</p>
      </li>
      <li class="calibre12">Open Power BI Desktop.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong> and disable loading.</li>
      <li class="calibre12">Both of these can be done by right-clicking the query in the<strong class="screentext"> Queries </strong>pane.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Build an M query for each dimension and fact table that accesses the SQL views defined in <em class="italic">step 1</em>. In this example, the <code class="code-in-text--packt">AdWorksDW</code> query contains the data source information, and a <strong class="screentext">vCH3R2_Products</strong> view is accessed:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Data = Source{[Schema="dbo",Item="vCH3R2_Products"]}[Data]
in
    Data
</code></pre>
      </li>
      <li class="calibre12">Duplicate this query and replace the <code class="code-in-text--packt">Item</code> parameter with the source view for each remaining fact and dimension.</li>
      <li class="calibre12">Separate the<a id="calibre_link-259" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> fact queries into a <strong class="screentext">Facts</strong> query group.</li>
      <li class="calibre12">Separate the dimension queries into a <strong class="screentext">Dimensions</strong> query group.<figure class="mediaobject"><img src="images/000232.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.3: Dimensions, Facts, and Data Sources queries in Power Query Editor</p>
      </li>
      <li class="calibre12">Confirm that the column data types align with the design (for example, a fixed decimal number to avoid rounding issues).</li>
      <li class="calibre12">Close the Power Query Editor and load the tables into the Power BI model by choosing <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
    </ol>
    <h2 id="calibre_link-1477" class="calibre8">How to Implement a Data Model</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In Power BI Desktop, select <strong class="screentext">Manage Relationships</strong> from the <strong class="screentext">Modeling</strong> tab of the <strong class="screentext">Report</strong> view or the <strong class="screentext">Table tools</strong> tab of the <strong class="screentext">Data</strong> view and click the <strong class="screentext">New</strong> button.</li>
      <li class="calibre12">Create<a id="calibre_link-260" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> many-to-one, single-direction relationships from each fact table to its corresponding dimension table. Bidirectional relationships should only be implemented with clear guidance and evaluation. Date data type columns should be used for the <code class="code-in-text--packt">Date</code> table relationships.<figure class="mediaobject"><img src="images/000245.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.4: Relationships view of a multi-fact data model</p>
      </li>
      <li class="calibre12">Write the core measures for each fact table identified in the planning phase and validate them for accuracy. If complex DAX expressions are needed for the core measures, then the source and retrieval should be reviewed. Give each measure an intuitive name and a standard format (for example, two decimal places, a thousands separator).</li>
      <li class="calibre12">Add multi-level hierarchies in commonly used dimension tables such Product and Date. Hierarchies are essentially just groups of columns that allow for report authors to more easily navigate or drill between different levels of detail.</li>
      <li class="calibre12">Set the <strong class="screentext">Default Summarization</strong> and <strong class="screentext">Sorting of columns</strong>, such as <strong class="screentext">Month Name</strong>, sorted by <strong class="screentext">Month Number</strong>.</li>
      <li class="calibre12">Assign <strong class="screentext">Data Categories</strong> to columns such as <strong class="screentext">Address</strong> or <strong class="screentext">Postal Code</strong> to support geographical visualization.</li>
      <li class="calibre12">Hide columns from the fact tables such that only measure groups are visible.</li>
      <li class="calibre12">Validation and user testing of the new model should follow implementation.</li>
      <li class="calibre12">Model documentation can be developed via <strong class="screentext">Dynamic Management Views</strong> (<strong class="screentext">DMVs</strong>) to provide users with definitions and relationships. See the <em class="italic">Importing and visualizing dynamic management view (DMV) data </em>recipe of <em class="italic">Chapter 10</em>, <em class="italic">Administering and Monitoring Power BI</em>, for a detailed example of this pattern.</li>
    </ol>
    <h2 id="calibre_link-1478" class="calibre8">How it works</h2>
    <p class="book-title--packt">The steps in this recipe align with the logical flow of model development and can be implemented in discrete phases across teams or by an individual Power BI developer. Given the different lead times associated with the components of the model, it can be advantageous to move forward with a more mature or simple component such that business teams can engage and provide feedback as enhancements and other components are deployed.</p>
    <p class="book-title--packt">Details on all<a id="calibre_link-261" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> primary metadata settings are included in this chapter in the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Configuring Model Metadata</li>
      <li class="bullet">Hiding Columns and Tables</li>
      <li class="bullet">Creating Hierarchies and Groups</li>
    </ul>
    <p class="book-title--packt">All of these settings impact the usability and functionality of the data model and should not be neglected.</p>
    <h2 id="calibre_link-1479" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">If a model's source view is shared with other applications and may change or include columns not needed by the model, the <code class="code-in-text--packt">Table.SelectColumns()</code> M function can be used:</p>
    <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    InternetSales = Source{[Schema="dbo",Item="vInternetSales"]}[Data],
    SalesColumns = 
        Table.SelectColumns(
            InternetSales,{"ProductKey","OrderDateKey"},MissingField.UseNull
        )
in
    SalesColumns
</code></pre>
    <p class="book-title--packt">Each column required by the table in the model is explicitly selected, and the <code class="code-in-text--packt">MissingField.UseNull</code> parameter allows the query to refresh successfully despite a specified column being missing&mdash;such as when a column's name has changed.</p>
    <h2 id="calibre_link-1480" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Create SQL Views: <a href="https://bit.ly/2T3FzHF" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2T3FzHF</span></a></li>
      <li class="bullet">Create and manage relationships in Power BI: <a href="http://bit.ly/3tLwcJM" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3tLwcJM</span></a></li>
      <li class="bullet">Model view in Power BI: <a href="http://bit.ly/3vUXwag" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3vUXwag</span></a></li>
      <li class="bullet">Model data in Power BI: <a href="http://bit.ly/3f8p7yT" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3f8p7yT</span></a></li>
      <li class="bullet">Design a data model in Power BI: <a href="http://bit.ly/3d28LVW%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3d28LVW</span></a></li>
    </ul>
    <h1 id="calibre_link-1203" class="title">Creating Relationships</h1>
    <p class="book-title--packt">One of the most <a id="calibre_link-943" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>important data modeling features of Power BI, as well as Analysis Services Tabular, is the control the modeler has over defining the filtering behavior between tables via relationships. In addition to one-to-many, single-direction relationships, Power BI models can contain bidirectional relationships, one-to-one relationships, many-to-many relationships, and even DAX measures that contain their own relationship filtering logic via functions such as <code class="code-in-text--packt">USERELATIONSHIP</code> and <code class="code-in-text--packt">CROSSFILTER</code>. These relationship tools, along with modifying the filter context of measures through DAX, can be used to support many-to-many modeling scenarios and provide alternative model behaviors for multiple business requirements.</p>
    <p class="book-title--packt">In this recipe, we look at single-direction relationships, as well as the primary use cases for bidirectional relationships, and DAX-based cross-filtering.</p>
    <h2 id="calibre_link-1481" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop and choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">Create an <strong class="screentext">Import</strong> mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong> and disable loading.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">FactInternetSales</strong> table and name this query <strong class="screentext">Internet Sales</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">4</em> and <em class="italic">5</em> to create a <strong class="screentext">Customers</strong> query that imports <strong class="screentext">DimCustomer</strong>, and a <strong class="screentext">Dates</strong> query that imports <strong class="screentext">DimDate</strong> tables.</li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query based on the <strong class="screentext">DimProduct</strong>, <strong class="screentext">DimProductCategory</strong>, and <strong class="screentext">DimProductSubcategory</strong> tables using the following code. Alternatively, use the SQL view for<a id="calibre_link-1482" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> products from the previous recipe in this chapter, <em class="italic">Implementing a Data Model</em>.
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName"}, {"Product Category"}
        )
in
   Category
</code></pre>
      </li>
      <li class="calibre12">Separate the fact query <strong class="screentext">Internet Sales</strong> into a <strong class="screentext">Facts</strong> query group by right-clicking the query in the Queries pane and choosing Move to Group and then New Group</li>
      <li class="calibre12">Separate the dimension queries, <strong class="screentext">Customers</strong>, <strong class="screentext">Dates</strong>, and <strong class="screentext">Products</strong> into a <strong class="screentext">Dimensions</strong> query group.</li>
      <li class="calibre12">Create a <strong class="screentext">Blank</strong> <strong class="screentext">Query</strong> called <strong class="screentext">Calculations</strong> in the <strong class="screentext">Other Queries</strong> group.</li>
      <li class="calibre12">Choose <strong class="screentext">Close &amp; Apply</strong> in the ribbon of the <strong class="screentext">Home</strong> tab to load the tables to the data model.</li>
    </ol>
    <h2 id="calibre_link-1483" class="calibre8">How to Create Relationships</h2>
    <p class="book-title--packt">To implement <a id="calibre_link-944" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a relationship between the <strong class="screentext">Products</strong> table and the <strong class="screentext">Internet Sales</strong> table. This can be done in the <strong class="screentext">Model</strong> view by dragging and dropping the <strong class="screentext">ProductKey</strong> column in the <strong class="screentext">Products</strong> table to the <strong class="screentext">ProductKey</strong> column in the <strong class="screentext">Internet Sales</strong> table. Alternatively, select <strong class="screentext">Manage relationships</strong> in the ribbon of the <strong class="screentext">Modeling</strong> tab while in the <strong class="screentext">Report</strong> view or from the ribbon of the <strong class="screentext">Table tools</strong> tab while in the <strong class="screentext">Data</strong> view. This relationship should be one-to-many relationships between the <strong class="screentext">Products</strong> table on the <strong class="screentext">One </strong>side and the <strong class="screentext">Internet Sales</strong> table on the <strong class="screentext">Many</strong> side. The <strong class="screentext">Cross-filter direction</strong> should be set to <strong class="screentext">Single</strong>.<figure class="mediaobject"><img src="images/000256.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.5: Creating a relationship between Products and Internet Sales</p>
      </li>
      <li class="calibre12">Create <a id="calibre_link-945" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>additional relationships between the other dimension tables and the <strong class="screentext">Internet Sales</strong> table until your <strong class="screentext">Manage relationships</strong> dialog box has the same relationships checked as shown in <em class="italic">Figure 3.6</em>.<figure class="mediaobject"><img src="images/000267.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.6: Table relationships in the Manage relationships dialog</p>
      </li>
      <li class="calibre12">The <strong class="screentext">Model</strong> view <a id="calibre_link-946" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of the dataset should now present, as shown in <em class="italic">Figure 3.7</em>:<figure class="mediaobject"><img src="images/000279.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.7: Model view of relationships</p>
      </li>
      <li class="calibre12">Right-click the <strong class="screentext"><a id="calibre_link-1484" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">Dates</strong> table and choose <strong class="screentext">Mark as date table</strong> using <strong class="screentext">FullDateAlternateKey</strong> as the <strong class="screentext">Date</strong> column.</li>
      <li class="calibre12">Create the following four DAX measures by right-clicking the <strong class="screentext">Calculations</strong> table in the <strong class="screentext">Data</strong> view and selecting <strong class="screentext">New</strong> <strong class="screentext">measure</strong>:
        <pre class="programlisting"><code class="hljs">Sales Table Rows = COUNTROWS('Internet Sales')
Customers Table Rows = COUNTROWS('Customers')
Dates Table Rows = COUNTROWS('Dates')
Products Table Rows = COUNTROWS('Products')
</code></pre>
      </li>
      <li class="calibre12">Right-click the <strong class="screentext">Calculations</strong> column in the <strong class="screentext">Calculations</strong> table and choose <strong class="screentext">Hide in report view</strong>.</li>
      <li class="calibre12">Use a <strong class="screentext">Multi-row card</strong> visualization <a id="calibre_link-947" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to display these four measures.</li>
      <li class="calibre12">Add a <strong class="screentext">Slicer</strong> visualization for <strong class="screentext">CalendarYear</strong> from the <strong class="screentext">Dates</strong> table, <strong class="screentext">Product Category</strong> from the <strong class="screentext">Products</strong> table, and <strong class="screentext">Gender</strong> from the <strong class="screentext">Customers</strong> table.<figure class="mediaobject"><img src="images/000292.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.8: Relationship and cross-filter testing visualizations</p>
      </li>
      <li class="calibre12">Select slicer values in the <strong class="screentext">Slicer</strong> visualizations and note that with single-direction relationships, a selection on any of the slicers only impacts the row counts in the table used in the slicer and the <strong class="screentext">Internet Sales</strong> table.</li>
      <li class="calibre12">Open the <strong class="screentext">Manage relationships</strong> dialog and edit the <strong class="screentext">Cross-filter direction</strong> of the relationship between the <strong class="screentext">Internet </strong><strong class="screentext">Sales and Products</strong> tables.<figure class="mediaobject"><img src="images/000304.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.9: Bidirectional Relationship Configuration (Both) from the Edit Relationships Dialog</p>
      </li>
      <li class="calibre12">Slicer selections for <strong class="screentext">CalendarYear</strong> and <strong class="screentext">Gender</strong> now also filter the <code class="code-in-text--packt">Products</code> table.</li>
      <li class="calibre12">Create a DAX measure that applies an alternative cross-filter behavior to the relationship in the model:
        <pre class="programlisting"><code class="hljs">Products Table Rows (CF) = 
    CALCULATE([Products Table Rows], 
       CROSSFILTER('Internet Sales'[ProductKey],'Products'[ProductKey],OneWay) )
</code></pre>
      </li>
      <li class="calibre12">Add this <a id="calibre_link-948" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>measure to the <strong class="screentext">Multi-row card</strong> visualization and observe that this measure is unaffected by the <strong class="screentext">Gender</strong> and <strong class="screentext">CalendarYear</strong> slicers.</li>
      <li class="calibre12">Write a DAX measure to propagate filter context. The following measure respects the filters applied to the <code class="code-in-text--packt">Internet Sales</code> table, such as <code class="code-in-text--packt">Customer Gender = "M"</code>:
        <pre class="programlisting"><code class="hljs"><span><strong class="screentext">Products Rows (Sales)</strong></span> = CALCULATE(COUNTROWS('Products'),'Internet Sales') 
</code></pre>
      </li>
      <li class="calibre12">Add this measure to the <strong class="screentext">Multi-row card</strong> visualization and observe that this measure returns the same results as the bidirectional relationship when selecting values in the <strong class="screentext">Gender</strong> and <strong class="screentext">CalendarYear</strong> slicers, except when there are no slicer selections at all&mdash;then the measure returns <strong class="screentext">158</strong>.</li>
      <li class="calibre12">Write a DAX measure to use an inactive relationship between the <strong class="screentext">Dates</strong> and <strong class="screentext">Internet Sales</strong> tables:
        <pre class="programlisting"><code class="hljs">Sales Table (Orders) = 
    CALCULATE([Sales Table Rows],
        USERELATIONSHIP('Dates'[DateKey],'Internet Sales'[OrderDateKey]) )
</code></pre>
      </li>
      <li class="calibre12">Add this measure to the <strong class="screentext">Multi-row card</strong> visualization and notice that different numbers are returned from the <strong class="screentext">Sales Table Rows</strong> measure when selecting <strong class="screentext">CalendarYear</strong> 2010 or higher.</li>
    </ol>
    <h2 id="calibre_link-1485" class="calibre8">How it works</h2>
    <p class="book-title--packt">Single-direction cross-filter relationships only propagate filters in the direction of the relationship. Thus, when <strong class="screentext">Products</strong> is set to filter <strong class="screentext">Internet Sales</strong> in a single-direction, other filters affecting <strong class="screentext">Internet Sales</strong> are not propagated to the <strong class="screentext">Products</strong> table. With bidirectional cross-filter relationships, filters affecting one side of the relationship are always propagated to the other side of the relationship unless DAX measures use functions such as CROSSFILTER() to override the default behavior defined by the model relationships.</p>
    <p class="book-title--packt">Bidirectional relationships between fact and dimension tables should generally be avoided when the given dimension table is also related to other fact tables. This can cause over-filtering or unintended filter contexts. However, bidirectional relationships are an integral part of efficient solutions to common (and otherwise complex) modeling scenarios, such as actual versus budget and classic many-to-many scenarios.</p>
    <p class="book-title--packt">Regarding the <strong class="screentext">Date</strong> table<a id="calibre_link-1486" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> relationships, the DAX time intelligence functions, such as <code class="code-in-text--packt">DATESYTD</code>, <code class="code-in-text--packt">DATEADD</code>, and <code class="code-in-text--packt">SAMEPERIODLASTYEAR</code>, all require either a relationship based on a date data type or a <strong class="screentext">Mark as date table</strong> setting. Since the relationships for the <strong class="screentext">Date</strong> table were formed on surrogate keys (20150101), the <strong class="screentext">Date</strong> table needs to be marked as a <strong class="screentext">date table</strong> in order for DAX time intelligence functions to operate properly.</p>
    <p class="book-title--packt">The measure <strong class="screentext">Product Table Rows (CF)</strong> overrides the bidirectional relationship to apply single-direction cross-filtering using the DAX function <code class="code-in-text--packt">CROSSFILTER</code>. Though limited to specific measures, the <code class="code-in-text--packt">CROSSFILTER</code> function can provide a simple and powerful supplement to the relationship cross-filtering defined in the model. The <code class="code-in-text--packt">CROSSFILTER</code> function requires an existing relationship (active or inactive) and always overrides the relationship settings of the model. The third parameter accepts the following values: </p>
    <ul class="calibre9">
      <li class="bullet"><code class="code-in-text--packt">OneWay</code></li>
      <li class="bullet"><code class="code-in-text--packt">Both</code></li>
      <li class="bullet"><code class="code-in-text--packt">None</code></li>
    </ul>
    <p class="book-title--packt">Both bidirectional relationships and the <code class="code-in-text--packt">CROSSFILTER</code> function can be used with DirectQuery models. The <strong class="screentext">Global DirectQuery</strong> setting <strong class="screentext">Allow unrestricted measures</strong> needs to be enabled to use <code class="code-in-text--packt">CROSSFILTER</code>.</p>
    <p class="book-title--packt">The <strong class="screentext">Products Rows (Sales)</strong> measure implements bidirectional cross-filtering between the <strong class="screentext">Products</strong> and <strong class="screentext">Internet Sales</strong> tables by using the <code class="code-in-text--packt">CALCULATE</code> function to evaluate the <strong class="screentext">Products</strong> table in the context of the <strong class="screentext">Internet Sales</strong> table. Thus, filters affecting the<strong class="screentext"> Internet Sales</strong> table also impact the result of the <code class="code-in-text--packt">COUNTROWS</code> function on the <strong class="screentext">Products</strong> table. This is true even when no slicers have selections, which is why the <strong class="screentext">Product Rows (Sales)</strong> measure returns <strong class="screentext">158</strong>, because only <strong class="screentext">158</strong> products were sold over the internet. Keep in mind that relationships on their own only propagate active filters against a table. This is why the <strong class="screentext">Products Table Rows</strong> measure returns all <strong class="screentext">606</strong> products when no slicer selections are active.</p>
    <p class="book-title--packt">The <strong class="screentext">Sales Table (Orders)</strong> measure uses the <code class="code-in-text--packt">USERELATIONSHIP</code> function to utilize an inactive relationship in the model. Power BI data models reject ambiguous relationships, in which there are multiple possible cross-filtering paths between two tables. These duplicate relationships are set to an inactive status, but can still be used in DAX. As with the <code class="code-in-text--packt">CROSSFILTER</code> function, the <code class="code-in-text--packt">USERELATIONSHIP</code> function requires an existing relationship (active or inactive) and always overrides the relationship settings of the model.</p>
    <h2 id="calibre_link-1487" class="calibre8">There's more...</h2>
    <p class="book-title--packt">In the many-to-many model<a id="calibre_link-585" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> shown in <em class="italic">Figure 3.10</em>, multiple customers are associated with a given account, and some customers have multiple accounts.</p>
    <figure class="mediaobject"><img src="images/000351.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.10: Many-to-many model with single-direction cross-filtering relationships</p>
    <p class="book-title--packt">Given the highlighted single-direction relationship from the <strong class="screentext">Accounts</strong> table to the <strong class="screentext">CustomerAccount </strong>bridge table, a filter selection on the <strong class="screentext">Customer</strong> table does not filter the <strong class="screentext">Transactions</strong> table. By modifying the cross-filter direction of the relationship between <code class="code-in-text--packt">Accounts</code> and <code class="code-in-text--packt">CustomerAccount</code> to <strong class="screentext">Both</strong>, a report visual by customer will now correctly display both the total amount from the fact table and the amounts associated with each customer.</p>
    <p class="book-title--packt">A DAX alternative to the bidirectional relationship is the following:</p>
    <pre class="programlisting"><code class="hljs">M2M Tran Amount = 
  CALCULATE([Tran Amount], SUMMARIZE(CustomerAccount,Accounts[Account ID]) ) 
</code></pre>
    <p class="book-title--packt">The <code class="code-in-text--packt">SUMMARIZE</code> function leverages the one-to-many relationships of <code class="code-in-text--packt">Customers</code> and <code class="code-in-text--packt">Accounts</code> with the bridge table, via the <code class="code-in-text--packt">CALCULATE</code> function, and passes the filter context of <code class="code-in-text--packt">Customers</code> to the <code class="code-in-text--packt">Accounts</code> table, which filters transactions. </p>
    <p class="book-title--packt">For similar <a id="calibre_link-586" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>many-to-many scenarios, bidirectional relationships are recommended over the DAX approach for manageability and performance reasons.</p>
    <h2 id="calibre_link-1488" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Create and manage relationships in Power BI Desktop: <a href="http://bit.ly/3tLwcJM" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3tLwcJM</span></a></li>
      <li class="bullet">Bidirectional cross-filtering whitepaper: <a href="http://bit.ly/2oWdwbG%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2oWdwbG</span></a></li>
    </ul>
    <h1 id="calibre_link-1204" class="title">Configuring Model Metadata</h1>
    <p class="book-title--packt">Metadata is information<a id="calibre_link-648" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> about information. There are many metadata<a id="calibre_link-595" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> settings in Power BI data models, such as column names, data types, object descriptions, and others. Four important metadata properties to configure for any column visible on the Power BI report canvas are the format, data category, default summarization, and the option to sort by column. The data formats should be consistent across data types and efficiently convey the appropriate level of detail. Data categories serve to enhance the data exploration experience by providing Power BI with information to guide its visualizations. Default summarization determines the aggregation, if any, to apply to the column when added to the report canvas. The ability to <strong class="screentext">Sort by Column</strong> enables <a id="calibre_link-1015" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the displaying of the values in a column based on the order of a separate column. Although all of these settings are relatively simple to configure, careful attention to these properties helps to deliver higher-quality Power BI visualizations and a more user-friendly platform for self-service. </p>
    <p class="book-title--packt">In this recipe, we demonstrate how to configure the format, data category, default summarization, and the <strong class="screentext">Sort by Column</strong> option for columns and measures within a data model&mdash;and show the impact of these settings on visualizations.</p>
    <h2 id="calibre_link-1489" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong> and disable loading.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Select<a id="calibre_link-1490" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">FactFinance</strong> table and name this query <strong class="screentext">General Ledger</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">4</em> and <em class="italic">5</em> to create a <strong class="screentext">Dates</strong> query that imports <strong class="screentext">DimDate</strong> and a <strong class="screentext">Departments</strong> query that imports <strong class="screentext">DimDepartmentGroup</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">4</em> and <em class="italic">5</em> to create a <strong class="screentext">Customers</strong> query that imports <strong class="screentext">DimCustomer</strong>.
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Data = Source{[Schema="dbo",Item="DimCustomer"]}[Data],
    #"Expanded DimGeography" = 
        Table.ExpandRecordColumn(
            Data, "DimGeography", 
            {"City", "StateProvinceName", 
             "EnglishCountryRegionName", "PostalCode"}, 
            {"City", "StateProvinceName", 
             "CountryRegionName", "PostalCode"}
        )
in
    #"Expanded DimGeography"
</code></pre>
      </li>
      <li class="calibre12">Separate the dimension queries, <strong class="screentext">Customers</strong>, and <strong class="screentext">Dates</strong> into a <strong class="screentext">Dimensions</strong> query group and the <strong class="screentext">General Ledger</strong> query into a query group called <strong class="screentext">Facts</strong>.</li>
      <li class="calibre12">Create a <strong class="screentext">Blank</strong> <strong class="screentext">Query</strong> called <strong class="screentext">Calculations</strong> in the <strong class="screentext">Other Queries</strong> group.</li>
      <li class="calibre12">Choose <strong class="screentext">Close &amp; Apply</strong> on the ribbon of the <strong class="screentext">Home</strong> tab to load the tables to the data model.</li>
      <li class="calibre12">Create the relationships shown in <em class="italic">Figure 3.11</em>, using the <strong class="screentext">Manage relationships</strong> dialog box.<figure class="mediaobject"><img src="images/000362.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 3.11: Relationships</p>
    <h2 id="calibre_link-1491" class="calibre8">How to Configure Model Metadata</h2>
    <p class="book-title--packt">To implement this<a id="calibre_link-649" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">Data</strong> view.</li>
      <li class="calibre12">Use the <strong class="screentext">Fields</strong> list on the right to navigate to the <strong class="screentext">Dates</strong> table and select the <strong class="screentext">FullDateAlternateKey</strong> column.</li>
      <li class="calibre12">Use the <strong class="screentext">Format</strong> drop-down in the ribbon of the <strong class="screentext">Column tools</strong> tab to change the format to <strong class="screentext">3/14/2001 (m/d/yyyy)</strong> or some other format.<figure class="mediaobject"><img src="images/000373.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.12: Column Formatting</p>
      </li>
      <li class="calibre12">Right-click the <strong class="screentext">Calculations</strong> table and click <strong class="screentext">New measure</strong> to create a measure with the code:
        <pre class="programlisting"><code class="hljs">Finance = SUM('General Ledger'[Amount])
</code></pre>
      </li>
      <li class="calibre12">Select the <strong class="screentext">Finance</strong> measure and change the format to <strong class="screentext">Currency</strong> using the <strong class="screentext">Format</strong> option in the <strong class="screentext">Measure tools</strong> tab.<figure class="mediaobject"><img src="images/000384.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.13: Measure Formatting</p>
      </li>
      <li class="calibre12">Right-click<a id="calibre_link-650" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> on the <strong class="screentext">Calculations</strong> column in the <strong class="screentext">Calculations</strong> table and choose <strong class="screentext">Hide in report view</strong>.</li>
      <li class="calibre12">While still in the <strong class="screentext">Data</strong> view, select the <strong class="screentext">StateProvinceName</strong> column in the <strong class="screentext">Customers</strong> table, and from the <strong class="screentext">Column tools</strong> tab change the <strong class="screentext">Data category</strong> to <strong class="screentext">State or Province</strong>.<figure class="mediaobject"><img src="images/000395.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.14: Data Category Selection</p>
      </li>
      <li class="calibre12">Repeat this procedure, setting the <strong class="screentext">City</strong> column to <strong class="screentext">City</strong>, the <strong class="screentext">CountryRegionName</strong> column to <strong class="screentext">Country</strong>, and the <strong class="screentext">PostalCode</strong> column to <strong class="screentext">Postal code</strong>. Note that a globe icon appears next to all of these columns in the field list.</li>
      <li class="calibre12">Switch to <strong class="screentext">Report</strong> view and create a <strong class="screentext">Map</strong> visualization with <strong class="screentext">CountryRegionName</strong> and <strong class="screentext">PostalCode</strong> in the <strong class="screentext">Location</strong> area and <strong class="screentext">CustomerKey</strong> in the <strong class="screentext">Size</strong> area. You can drill down to the postal code level and zoom in to investigate how many customers are in particular areas.<figure class="mediaobject"><img src="images/000407.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.15: Default Visual of the Geographical Data Category</p>
      </li>
      <li class="calibre12">While<a id="calibre_link-651" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> still in the <strong class="screentext">Report</strong> view, create a <strong class="screentext">Table</strong> visualization with the <strong class="screentext">EnglishMonthName</strong> column only. Note that the names of months appear in the table in alphabetical order.</li>
      <li class="calibre12">Select the <strong class="screentext">EnglishMonthName</strong> column in the <strong class="screentext">Fields</strong> list, and from the <strong class="screentext">Column tools</strong> tab change <strong class="screentext">Sort by column</strong> to the <strong class="screentext">MonthNumberOfYear</strong> column. After this action, the month<strong class="screentext"> </strong>names are sorted in the correct calendar order.<figure class="mediaobject"><img src="images/000419.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 16: Sort by column</p>
      </li>
      <li class="calibre12">Switch <a id="calibre_link-1492" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>back to the <strong class="screentext">Data</strong> view and select the <strong class="screentext">AccountKey</strong> column from the <strong class="screentext">General Ledger</strong> table.</li>
      <li class="calibre12">On the <strong class="screentext">Column tools</strong> tab, change the default <strong class="screentext">Summarization</strong> from <strong class="screentext">Count</strong> to <strong class="screentext">Don't</strong> <strong class="screentext">summarize</strong>.<figure class="mediaobject"><img src="images/000430.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 3.17: Default Summarization for Columns</p>
    <h2 id="calibre_link-1493" class="calibre8">How it works</h2>
    <p class="book-title--packt">The metadata settings for <strong class="screentext">Formatting</strong>, <strong class="screentext">Data category</strong>, <strong class="screentext">Summarization</strong>, and <strong class="screentext">Sort by column</strong> are all available from the <strong class="screentext">Column tools</strong> or <strong class="screentext">Measure tools</strong> tabs, whether you are in the <strong class="screentext">Data </strong>view or <strong class="screentext">Report</strong> view. Note that <strong class="screentext">Summarization</strong> and <strong class="screentext">Sort by column</strong> are not available for <strong class="screentext">Measures tools</strong>. These metadata settings cannot be modified in the Power BI service once the model is published. Reports can be created and edited in the service, but data types, names, and other metadata are not available.</p>
    <p class="book-title--packt">Formatting decisions should consider the impact of precision on visualizations. Fewer decimal places and more abbreviated date formats consume less space in reports and are easier to visually comprehend on <a id="calibre_link-509" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>dashboards. To understand how formatting works, consider a date data type. Date data types are actually stored as decimal numbers in the model engine. The integer portion of the number is the number of days since December 30, 1899. The decimal portion is the fraction of a day, with hours being 1/24 or <img src="images/000316.png" alt="" class="calibre18" />, minutes being 1/24/60 or <img src="images/000328.png" alt="" class="calibre19" />, and seconds being 1/24/60/60 or <img src="images/000339.png" alt="" class="calibre20" />. Thus, the display formats for dates simply visually change how the base data is displayed to the user while keeping the underlying data unchanged. The user may see <em class="italic">1/1/1900 00:00:00</em> displayed on their screen, but internally in the data model, this is simply stored as 2.</p>
    <p class="book-title--packt">Assigning <a id="calibre_link-652" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a location <strong class="screentext">Data category</strong> to columns assists Bing maps with geolocation and changes the default visualization for such columns to the <strong class="screentext">Map</strong> visualization. The <strong class="screentext">Web URL</strong> is important fo<a id="calibre_link-1149" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>r such things as <strong class="screentext">mailto</strong> email address<a id="calibre_link-547" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> links and any URL links exposed in reports. When the column is used in <strong class="screentext">Table</strong> visualizations, email and link icons are displayed, respectively. Similarly, assigning an <strong class="screentext">Image URL</strong> to a column displays the actual image when using <strong class="screentext">Table</strong> visualizations. The <strong class="screentext">Barcode</strong> data category can be useful for mobile applications.</p>
    <p class="book-title--packt">When considering the use of <strong class="screentext">Sort by</strong> columns, identify columns requiring custom sorting. Calendar text columns such as <code class="code-in-text--packt">Month</code> and <code class="code-in-text--packt">Weekday</code> are the most common candidates. Other columns may represent an organizational structure or entity hierarchy, such as general ledger accounts. The <strong class="screentext">Sort by column</strong> sort must contain only one distinct value for each value in the column to be sorted. It is recommended to embed the sorting logic as deep into the BI architecture as possible. For example, the sorting column could be added to a dimension table in a data warehouse or the SQL view used to load the data model. If these options are not available, M query transformations are recommended over DAX calculated columns.</p>
    <p class="book-title--packt">Text and date data type columns are set to <strong class="screentext">Don't summarize</strong> by default when first loaded to Power BI models. These data types have default summarizations of <strong class="screentext">Count</strong> and <strong class="screentext">Count (Distinct)</strong>. In addition, the <strong class="screentext">Report</strong> view provides the following aggregation options when using these data types in visualizations:</p>
    <ul class="calibre9">
      <li class="bullet"><strong class="screentext">Text</strong>: <strong class="screentext">First</strong>, <strong class="screentext">Last</strong>, <strong class="screentext">Count (Distinct)</strong>, or <strong class="screentext">Count</strong></li>
      <li class="bullet"><strong class="screentext">Date</strong>: <strong class="screentext">Earliest</strong>, <strong class="screentext">Latest</strong>, <strong class="screentext">Count (Distinct)</strong>, or <strong class="screentext">Count</strong></li>
    </ul>
    <p class="book-title--packt">By default, <strong class="screentext">Whole number</strong>, <strong class="screentext">Decimal number</strong>, and <strong class="screentext">Fixed decimal number</strong> are set to <strong class="screentext">Sum as the default summarization</strong>. For numeric columns with default summarization applied, the Fields list applies a summation symbol and aggregates the column's values according to the default summarization setting when used in a report visualization. The same symbol is applied regardless of the default summarization configured (for example, <strong class="screentext">Average</strong> and <strong class="screentext">Count</strong>).</p>
    <p class="book-title--packt">Simple DAX <a id="calibre_link-653" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>measures can deliver all <strong class="screentext">default summarization</strong> options (<strong class="screentext">Sum</strong>, <strong class="screentext">Min</strong>, <strong class="screentext">Max</strong>, <strong class="screentext">Average</strong>, <strong class="screentext">Count</strong>, and <strong class="screentext">Count Distinct</strong>). Additionally, measure names such as <strong class="screentext">Count of Products</strong> can help eliminate confusion regarding the default summarization icon. Many BI professionals prefer to replace fact columns with measures for this reason. Simple DAX expressions are used to perform the various aggregations or summarizations required in the data model; the fact columns are then hidden. When all fact columns are hidden, associated measures display at the top of the <strong class="screentext">Field</strong> list. Additionally, using measures allows business logic to be applied, such as including or excluding certain values. </p>
    <h2 id="calibre_link-1494" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">While serving as an intern at Microsoft, Chelsie Eiden solved a long-standing issue with Power BI involving duration by implementing custom format strings in the September 2019 release of Power BI Desktop. Since the release of Power BI Desktop, there was always an issue aggregating durations and displaying them in the format of <em class="italic">HH:MM:SS</em>. This was the result of the model engine not including a true <strong class="screentext">Duration</strong> data type, unlike the M query engine. You could convert durations to seconds to aggregate it, but you could not display aggregated durations that properly aggregated as numbers and displayed in the <em class="italic">hours, minutes, seconds</em> format in a visual. The reason was that there was no numeric formatting option for duration, and using the DAX <code class="code-in-text--packt">FORMAT</code> function turned a number into text. Custom format strings solved this issue by allowing the column to remain as a number, but also allowing the creation of a custom format for display purposes. Custom format strings can be applied to a column or measure using the <strong class="screentext">Properties</strong> pane of the <strong class="screentext">Model</strong> view, as shown in <em class="italic">Figure 3.18</em>.</p>
    <figure class="mediaobject"><img src="images/000441.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.18: Custom format strings</p>
    <p class="book-title--packt">DAX can be used to assist with sorting issues; for example, a DAX-calculated column can be created to support sorting of the <strong class="screentext">Calendar Yr-Mo</strong> column with values such as <em class="italic">2016-Jan</em>. The DAX formula to create a <strong class="screentext">CalYr-Mo Sort</strong> column is:</p>
    <pre class="programlisting"><code class="hljs">CalYr-Mo Sort = YEAR('Dates'[Date]) * 100 + MONTH('Dates'[Date])
</code></pre>
    <p class="book-title--packt">This <a id="calibre_link-654" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>calculation results in values such as <em class="italic">201601</em>. The <code class="code-in-text--packt">YEAR</code> function is applied against the <strong class="screentext">Date</strong> column and multiplied by 100 to add two digits. This product is then added to the results of the <code class="code-in-text--packt">MONTH</code> function applied against the <strong class="screentext">Date</strong> column, which returns a value between 1 and 12. Although this approach is simple to implement and inexpensive in terms of resource usage, the values of the new column are not sequential, thus limiting the use of the column in Time Intelligence measures (for example, trailing 3 months). Sequential surrogate key columns for each grain of the date dimension, including fiscal calendars, is an essential component of robust date intelligence logic. </p>
    <p class="book-title--packt">The DAX <code class="code-in-text--packt">RANKX</code> function can also be leveraged for sorting. For example, use the following DAX code to create a ranking column in the <strong class="screentext">Departments</strong> table based upon the funding each <strong class="screentext">Department Group</strong> receives in the <strong class="screentext">General Ledger</strong>.</p>
    <pre class="programlisting"><code class="hljs">	DeptGroupRank = RANKX('Departments',[Finance])
</code></pre>
    <p class="book-title--packt">The ranking is based on the <strong class="screentext">Finance</strong> measure created in this recipe. The <strong class="screentext">DeptGroupRank</strong> column is re-evaluated during each refresh and thus the sort order could change to reflect the source data.</p>
    <figure class="mediaobject"><img src="images/000452.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.19: RANKX Calculated Column</p>
    <p class="book-title--packt">The <strong class="screentext">DepartmentGroupName</strong> column <a id="calibre_link-1495" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>can now have a <strong class="screentext">Sort by column</strong> specified of <strong class="screentext">DeptGroupRank</strong> to order departments by their funding, with <strong class="screentext">Sales and Marketing</strong> being first (the most funding) and <strong class="screentext">Quality Assurance</strong> being last (the least funding).</p>
    <h2 id="calibre_link-1496" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Specify data categories in Power BI Desktop: <a href="http://bit.ly/2peNqPm" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2peNqPm</span></a></li>
      <li class="bullet">Tag barcode fields to enable barcode-scan filtering in mobile apps: <a href="http://bit.ly/3re4dAV" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3re4dAV</span></a></li>
      <li class="bullet">Add hyperlinks (URLs) to a table or matrix: <a href="http://bit.ly/39dxJ3r" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/39dxJ3r</span></a></li>
      <li class="bullet">Display images in a table or matrix in a report: <a href="http://bit.ly/2Pkx1dE" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2Pkx1dE</span></a></li>
      <li class="bullet">Sort by column in Power BI Desktop: <a href="http://bit.ly/2pFXhgh" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2pFXhgh</span></a></li>
      <li class="bullet">Chelsie Eiden's Duration: <a href="http://bit.ly/3lKFUtf" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3lKFUtf</span></a></li>
      <li class="bullet">Custom format strings: <a href="http://bit.ly/3sj648B" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3sj648B</span></a></li>
      <li class="bullet">Use custom format strings in Power BI Desktop: <a href="http://bit.ly/3cXAW8o" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cXAW8o</span></a></li>
    </ul>
    <h1 id="calibre_link-1205" class="title">Hiding Columns and Tables</h1>
    <p class="book-title--packt">Data models <a id="calibre_link-157" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>must balance the competing demands of functionality, scope, and usability. As <a id="calibre_link-1081" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>additional tables, columns, measures, and other structures are added to meet various analytical needs, a model can quickly become confusing to end users. Therefore, it is important to minimize the visibility of columns and tables to provide an intuitive interface.</p>
    <p class="book-title--packt">In this recipe, we demonstrate how to hide columns and even entire tables from report consumers.</p>
    <h2 id="calibre_link-1497" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open<a id="calibre_link-1498" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Power BI Desktop.</li>
      <li class="calibre12">Create an Import <a id="calibre_link-1499" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong> and disable loading.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">FactInternetSales</strong> table and name this query <strong class="screentext">Internet Sales</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">4</em> and <em class="italic">5</em> to create a <strong class="screentext">Departments</strong> query that imports <strong class="screentext">DimDepartmentGroup</strong> and an <strong class="screentext">Accounts</strong> query that imports <strong class="screentext">DimAccount</strong>.</li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query based upon the <strong class="screentext">DimProduct</strong>, <strong class="screentext">DimProductCategory</strong>, and <strong class="screentext">DimProductSubcategory</strong> tables using the following code. Alternatively, use the SQL view for products from a prior recipe in this chapter, <em class="italic">Implementing a Data Model</em>.
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName"}, {"Product Category"}
        ),
    RemoveColumns = 
        Table.SelectColumns(
            Category,
            {"ProductKey", "EnglishProductName", "DaysToManufacture", 
             "Product Subcategory", "Product Category"}
        )
in
   RemoveColumns
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> query to a query group called <strong class="screentext">Facts</strong> and the <strong class="screentext">Departments</strong>, <strong class="screentext">Accounts</strong>, and <strong class="screentext">Products</strong> queries to a query group called <strong class="screentext">Dimensions</strong>.</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> in the ribbon of the <strong class="screentext">Home</strong> tab to load the tables to the data model.</li>
      <li class="calibre12">Create<a id="calibre_link-158" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> a relationship based on the <strong class="screentext">ProductKey</strong> columns of both the <strong class="screentext">Products</strong> table<a id="calibre_link-1082" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and the <strong class="screentext">Internet Sales</strong> table.</li>
      <li class="calibre12">Create the following four measures in the <strong class="screentext">Internet Sales</strong> table:
        <pre class="programlisting"><code class="hljs">Internet Sales = SUM('Internet Sales'[SalesAmount])
Internet Sales Freight = SUM('Internet Sales'[Freight])
Internet Sales Order Quantity = SUM('Internet Sales'[OrderQuantity])
Internet Sales Distinct Products = 
    COUNTROWS(DISTINCT('Internet Sales'[ProductKey]) )
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1500" class="calibre8">How to Hide Columns and Tables</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Data</strong> view's <strong class="screentext">Fields</strong> pane, right-click a column in the <strong class="screentext">Internet Sales</strong> table and select <strong class="screentext">Hide</strong> in <strong class="screentext">Report</strong> view. Notice that the "visible" icon with a strike-through is displayed to the right of the column in the <strong class="screentext">Fields</strong> pane. Also, the columns are grayed out in the data viewing area.<figure class="mediaobject"><img src="images/000463.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.20: Hide in report view</p>
      </li>
      <li class="calibre12">Repeat this procedure for all columns (but not measures) in the <strong class="screentext">Internet Sales</strong> table.</li>
      <li class="calibre12">Once all the<a id="calibre_link-159" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> columns are hidden, switch to the <strong class="screentext">Report</strong> view and observe that<a id="calibre_link-1083" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Internet Sales</strong> table is now displayed above the other two tables, out of alphabetical order. In addition, the icon for this table is a calculator instead of a table.<figure class="mediaobject"><img src="images/000474.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.21: Measure table in the Report view Fields list</p>
      </li>
      <li class="calibre12">Switch back to the <strong class="screentext">Data</strong> view, right-click the <strong class="screentext">EnglishProductName</strong> column in the <strong class="screentext">Products</strong> table, and choose <strong class="screentext">Create hierarchy</strong>.</li>
      <li class="calibre12">Right-click the <strong class="screentext">Product Category</strong> column and choose <strong class="screentext">Add to hierarchy</strong>, then the <strong class="screentext">EnglishProductName Hierarchy</strong>.</li>
      <li class="calibre12">Add <strong class="screentext">Product Subcategory</strong> to the <strong class="screentext">EnglishProductName Hierarchy</strong>.</li>
      <li class="calibre12">Hide the <strong class="screentext">EnglishProductName</strong>, <strong class="screentext">Product Category</strong>, <strong class="screentext">Product Subcategory</strong>, and <strong class="screentext">ProductKey</strong> columns.</li>
      <li class="calibre12">Switch to <strong class="screentext">Report</strong> view and confirm that only the <strong class="screentext">DaysToManufacture</strong> column and the <strong class="screentext">EnglishProductName</strong> <strong class="screentext">Hierarchy</strong> are visible under the <strong class="screentext">Products</strong> table in the <strong class="screentext">Fields</strong> pane.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Model</strong> view, right-click the <strong class="screentext">Departments</strong> table, and choose <strong class="screentext">Hide in report</strong> view.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Report</strong> view and confirm that the <strong class="screentext">Departments</strong> table is no longer visible in the <strong class="screentext">Fields</strong> pane.</li>
    </ol>
    <h2 id="calibre_link-1501" class="calibre8">How it works</h2>
    <p class="book-title--packt">Hiding columns<a id="calibre_link-160" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and tables is an important step in developing professional data models that<a id="calibre_link-1084" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> can be easily consumed by end users for self-service purposes; too many columns and tables can be confusing to end users. In general, hide any column which is not directly required in Power BI reports. Relationship key columns, fact table columns represented via measures, custom <strong class="screentext">Sort by</strong><strong class="screentext"> </strong>columns, and any degenerate dimensions should be hidden. Additionally, hide any measure which exclusively supports other measures and is not used directly in reports. Also hide entire tables if they exist solely for data modeling purposes, such as a bridge table in a many-to-many relationship. As this is only a visibility metadata setting, the hidden columns, measures, and tables can still be used in measures and accessed from other tools via DAX queries. </p>
    <p class="book-title--packt">As demonstrated in this recipe, columns visible within hierarchies can be hidden as individual columns. Exposing both an individual column and a hierarchy that includes that same column can confuse users and lengthen the <strong class="screentext">Fields</strong> list. Conversely, not hiding the individual column contained within a hierarchy provides greater flexibility, such as viewing the columns in the hierarchy on separate axes. The same is true when grouping columns. The grouping of column values described in the <em class="italic">Creating Hierarchies and Groups</em> recipe in this chapter is still possible with hidden columns. It should be noted that <strong class="screentext">Groups</strong> and <strong class="screentext">Hierarchies</strong> can both be hidden from the <strong class="screentext">Fields</strong> list as well. In general, however, such structures would not have been created if those structures' visibility was not required.</p>
    <p class="book-title--packt">Hiding columns and tables should also be considered in role-based security scenarios involving <strong class="screentext">row-level security</strong> (<strong class="screentext">RLS</strong>). Users<a id="calibre_link-989" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> mapped to security roles that forbid them from accessing all the rows of a table are still able to see related metadata, such as the table name, the table's column names, and any metric names not hidden. New object-level security features of SSAS 2017 and later can eliminate this visibility. </p>
    <p class="book-title--packt">One option to simplify the <strong class="screentext">Fields</strong> list is to consolidate measures into fewer home tables and hide unused tables. Dedicated measure group tables can be created to organize and group similar measures. Dedicated measure groups are empty tables created with queries that do not return rows or other sources, and that do not require a refresh. One method of creating dedicated measure group tables is to create a <strong class="screentext">Blank Query</strong> called something along the lines of "<em class="italic">Calculations</em>", and then to load and apply this to the model. In the Desktop, create at least one measure in this table and hide the single column <a id="calibre_link-161" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>automatically created by the query that is named the same as the query/table. Measures <a id="calibre_link-1085" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>can be created directly in this table, or existing measures can be associated with any table of the model via the <strong class="screentext">Home table</strong> property available in the ribbon of the <strong class="screentext">Measure tools</strong> tab.</p>
    <figure class="mediaobject"><img src="images/000485.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.22: Measure Home table</p>
    <h2 id="calibre_link-1502" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Pages can <a id="calibre_link-700" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>also be hidden from report readers in the case of reports that include multiple pages. To hide pages, right-click the <strong class="screentext">Page</strong> tab and choose <strong class="screentext">Hide Page</strong>. This can be useful to preserve pages used during development and troubleshooting, or when using tooltip pages.</p>
    <p class="book-title--packt">Perspectives<a id="calibre_link-718" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are essentially view definitions of models such that only a defined set of tables, columns, and metrics of a model are exposed to a given view. Power BI Desktop supports perspectives, although they must be created using an external tool such as Tabular Editor. To see how perspectives can be created and used, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">From the <strong class="screentext">Report</strong> view, select <strong class="screentext">Tabular Editor</strong> in the ribbon of the <strong class="screentext">External Tools</strong> tab.</li>
      <li class="calibre12">In <strong class="screentext">Tabular Editor</strong>, note that only the visible tables are displayed&mdash;the <strong class="screentext">Departments</strong> table is missing. You can view hidden objects by choosing <strong class="screentext">Hidden Objects</strong> from the <strong class="screentext">View</strong> menu.</li>
      <li class="calibre12">Right-click the <strong class="screentext">Perspectives</strong> folder, choose <strong class="screentext">New Perspective</strong>, and name the perspective <strong class="screentext">New Perspective</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Tables</strong> folder, right-click the <strong class="screentext">Internet Sales</strong> table and choose <strong class="screentext">Show in Perspectives</strong>, then <strong class="screentext">All Perspectives</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">step 4</em> for the <strong class="screentext">Products</strong> table.</li>
      <li class="calibre12">Expand<a id="calibre_link-719" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Products</strong> table, right-click the <strong class="screentext">DaysToManufacture</strong> column, and choose <strong class="screentext">Hide in Perspectives</strong> and then <strong class="screentext">New Perspective</strong>.<figure class="mediaobject"><img src="images/000496.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.23: Tabular Editor</p>
      </li>
      <li class="calibre12">Right-click the <strong class="screentext">Accounts</strong> table, choose <strong class="screentext">Hide in Perspectives</strong>, and then <strong class="screentext">All Perspectives</strong>.</li>
      <li class="calibre12">Choose <strong class="screentext">Save</strong> from the <strong class="screentext">File</strong> menu.</li>
      <li class="calibre12">Close the <strong class="screentext">Tabular Editor</strong>.</li>
      <li class="calibre12">Back in Power BI Desktop, create a second page, and then save the report.</li>
      <li class="calibre12">Choose <strong class="screentext">Options and settings</strong> and then <strong class="screentext">Options</strong> from the <strong class="screentext">File</strong> menu.</li>
      <li class="calibre12">Under <strong class="screentext">CURRENT FILE</strong> in <strong class="screentext">Report</strong> settings, turn on the <strong class="screentext">Allow report readers to personalize visuals to suit their needs</strong> option.</li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> section of the <strong class="screentext">Visualizations</strong> pane<a id="calibre_link-1503" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> for your second page, notice the new <strong class="screentext">Personalize visual</strong> section.</li>
      <li class="calibre12">Set <strong class="screentext">Report-reader perspective</strong> to <strong class="screentext">New Perspective</strong>.</li>
    </ol>
    <p class="book-title--packt">As the report editor, you will continue to see the entire model of all tables and columns not hidden in the model while in <strong class="screentext">Report</strong> view in Power BI Desktop. However, when users are personalizing visuals on <strong class="screentext">Page 2</strong> in the Power BI service, the users will not see any tables and columns not included in the perspective. Note that perspectives should not be considered to be a security mechanism in any regard.</p>
    <figure class="mediaobject"><img src="images/000006.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.24: Personalize dialog visuals in Service</p>
    <h2 id="calibre_link-1504" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Let users personalize visuals in a report: <a href="http://bit.ly/3cljuvm" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cljuvm</span></a></li>
      <li class="bullet">Personalize visuals in a report: <a href="http://bit.ly/2OZX8a8" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OZX8a8</span></a> </li>
    </ul>
    <h1 id="calibre_link-1206" class="title">Enriching a Model with DAX</h1>
    <p class="book-title--packt">In order to drive user <a id="calibre_link-638" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>adoption and to provide a foundation to support more <a id="calibre_link-326" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>advanced analytics, it's essential that the logic embedded in core or 'base' DAX measures accurately reflect business definitions. These fundamental measures deliver version control across the many reports built from a data model and avoid the need for additional logic to be applied at the report layer. Clear definitions for required business metrics should be documented and the corresponding DAX measures should be validated for accuracy prior to deploying any reports using these new measures to a production environment.</p>
    <p class="book-title--packt">Performance, usability, and version control are all fundamental characteristics of effective data models, but it is often the additional analytical context that sets models apart. Once fundamental measures have been implemented, additional DAX measures can be developed to support common and high-priority business analysis. These measures can often replace ad hoc and manual data analysis for business users as well as dedicated custom reports maintained by the BI organization. As measures are stored within the data model, the logic can be re-used in various combinations and in future projects.</p>
    <p class="book-title--packt">When developing these metrics, it is important to identify the set of base measures to create, the data source to validate against, and the subject matter experts. Reconcile differences in definitions between source systems and any custom logic applied in reports. Request a project sponsor from a business organization to review and approve the definitions and validation. Finally, identify any conflicts with existing business definitions and advise of complexity in implementing the measures.</p>
    <p class="book-title--packt">In this recipe, DAX<a id="calibre_link-639" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> measures are created to represent business definitions and <a id="calibre_link-327" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>support deeper analysis. </p>
    <h2 id="calibre_link-1505" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong> and disable loading.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">FactResellerSales</strong> table and name this query <strong class="screentext">Reseller Sales</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">4</em> and <em class="italic">5</em> to create a <strong class="screentext">Currency Rates</strong> query that imports <strong class="screentext">FactCurrencyRates</strong>, an <strong class="screentext">Internet Sales</strong> query that imports <strong class="screentext">FactInternetSales</strong>, a <strong class="screentext">Dates</strong> query that imports <strong class="screentext">DimDate</strong>, and a <strong class="screentext">Customers</strong> query that imports <strong class="screentext">DimCustomer</strong>.</li>
      <li class="calibre12">Add an <strong class="screentext">Index</strong> column starting from 1 to the <strong class="screentext">Currency Rates</strong> query, and filter the <strong class="screentext">CurrencyKey</strong> column to <strong class="screentext">98</strong>.</li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query based on the <strong class="screentext">DimProduct</strong>, <strong class="screentext">DimProductCategory</strong>, and <strong class="screentext">DimProductSubcategory</strong> tables using the following code. Alternatively, use the SQL view for<a id="calibre_link-1506" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> products from<a id="calibre_link-1507" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> a prior recipe in this chapter, <em class="italic">Implementing a Data Model</em>.
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName"}, {"Product Category"}
        )
in
   Category
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Reseller Sales</strong>, <strong class="screentext">Internet Sales</strong>, and <strong class="screentext">Currency Rates</strong> queries to a query group called <strong class="screentext">Facts</strong> and the <strong class="screentext">Dates</strong>, <strong class="screentext">Products</strong>, and <strong class="screentext">Customers</strong> queries to a query group called <strong class="screentext">Dimensions</strong>.</li>
      <li class="calibre12">Create four blank queries called <strong class="screentext">Reseller Measures</strong>, <strong class="screentext">Pricing Measures</strong>, <strong class="screentext">Customer Measures</strong>, and<strong class="screentext"> Currency Measures</strong> in the<strong class="screentext"> Other Queries</strong> group.</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> in the ribbon of the <strong class="screentext">Home</strong> tab to load the tables to the data model.</li>
      <li class="calibre12">Create the relationships shown in <em class="italic">Figure 3.25</em>.<figure class="mediaobject"><img src="images/000018.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.25: Model relationships</p>
      </li>
      <li class="calibre12">All of these relationships' cross-filtering directions should be <strong class="screentext">Single</strong>, except for the <strong class="screentext">Internet Sales</strong> to <strong class="screentext">Customers</strong> relationship, which should be set to <strong class="screentext">Both</strong>.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Data</strong> view and hide the single columns in the <strong class="screentext">Reseller Measures</strong>, <strong class="screentext">Pricing Measures</strong>, <strong class="screentext">Customer Measures</strong>, and <strong class="screentext">Currency Measures</strong> tables.</li>
      <li class="calibre12">Right-click on the <strong class="screentext">Date</strong> table and choose <strong class="screentext">Mark as date table</strong> using <strong class="screentext">FullDateAlternateKey</strong> as the <strong class="screentext">Date column</strong>.</li>
    </ol>
    <h2 id="calibre_link-1508" class="calibre8">How to Enrich a Model with DAX</h2>
    <p class="book-title--packt">To implement<a id="calibre_link-640" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe, use the<a id="calibre_link-328" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Switch to the <strong class="screentext">Data</strong> view.</li>
      <li class="calibre12">Create the following eight sales and cost DAX measures in the <strong class="screentext">Reseller Measures</strong> table:
        <pre class="programlisting"><code class="hljs">Reseller Discount Amount = SUM('Reseller Sales'[DiscountAmount])
Reseller Gross Sales = 
    SUMX('Reseller Sales', 
        'Reseller Sales'[UnitPrice] * 'Reseller Sales'[OrderQuantity])
Reseller Net Sales = 
    CALCULATE( [Reseller Gross Sales] - [Reseller Discount Amount],
        'Reseller Sales'[ShipDate] &lt;&gt; DATEVALUE("12/31/2099") )
Reseller Product Cost = 
    SUMX('Reseller Sales',
        'Reseller Sales'[OrderQuantity]*'Reseller Sales'[ProductStandardCost])
Reseller Gross Margin % = 
    DIVIDE([Reseller Gross Sales] - [Reseller Product Cost],
        [Reseller Gross Sales])
Reseller Margin % = 
    DIVIDE([Reseller Net Sales] - [Reseller Product Cost],
        [Reseller Net Sales])
Reseller Count of Products Sold = 
    CALCULATE(DISTINCTCOUNT('Products'[ProductAlternateKey]),
        'Reseller Sales')
Reseller Count of Sales Orders = DISTINCTCOUNT('Reseller Sales'[SalesOrderNumber])
</code></pre>
      </li>
      <li class="calibre12">Create the<a id="calibre_link-1509" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following seven<a id="calibre_link-1510" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> sales and cost DAX measures in the <strong class="screentext">Pricing Measures</strong> table:
        <pre class="programlisting"><code class="hljs">Effective Unit Price = 
    DIVIDE(SUM('Reseller Sales'[ExtendedAmount]),
        SUM('Reseller Sales'[OrderQuantity]) )
25th Percentile Unit Price = PERCENTILE.INC('Reseller Sales'[UnitPrice],.25)
75th Percentile Unit Price = PERCENTILE.INC('Reseller Sales'[UnitPrice],.75)
Maximum Unit Price = MAX('Reseller Sales'[UnitPrice])
Median Unit Price = MEDIAN('Reseller Sales'[UnitPrice])
Minimum Unit Price = MIN('Reseller Sales'[UnitPrice])
Range of Unit Prices = [Maximum Unit Price] - [Minimum Unit Price]
</code></pre>
      </li>
      <li class="calibre12">Create the <a id="calibre_link-641" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>following three<a id="calibre_link-329" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> sales and cost DAX measures in the <strong class="screentext">Pricing Measures</strong> table:
        <pre class="programlisting"><code class="hljs">Count of Accessory But Not Bike Customers = 
VAR BikeCustomers = 
    SUMMARIZE(
        CALCULATETABLE('Internet Sales','Products'[Product Category] = "Bikes"),
        'Customers'[CustomerAlternateKey])
VAR AccessoryCustomers = 
    SUMMARIZE(
        CALCULATETABLE('Internet Sales',
            'Products'[Product Category] = "Accessories"), 
        'Customers'[CustomerAlternateKey])
RETURN
    CALCULATE(
        DISTINCTCOUNT('Customers'[CustomerAlternateKey]),
        EXCEPT(AccessoryCustomers,BikeCustomers) )
Count of Bike Only Customers = 
VAR BikeCustomers = 
    SUMMARIZE(
        CALCULATETABLE('Internet Sales','Products'[Product Category] = "Bikes"),
        'Customers'[CustomerAlternateKey]
    )
VAR ClothesAndAccessoryCustomers = 
    SUMMARIZE(
        CALCULATETABLE('Internet Sales',
            'Products'[Product Category] IN {"Accessories","Clothing"}
        ), 'Customers'[CustomerAlternateKey])
RETURN
    CALCULATE(
        DISTINCTCOUNT('Customers'[CustomerAlternateKey]),
        EXCEPT(BikeCustomers,ClothesAndAccessoryCustomers) )
Count of Last Year Customers ex Current Year = 
VAR CurrentYear = 2012 
VAR LastYear = CurrentYear - 1
VAR LYCustomers = 
    SUMMARIZE(
        CALCULATETABLE('Internet Sales',
            FILTER(ALL('Dates'),'Dates'[CalendarYear] = LastYear)
        ), 'Customers'[CustomerAlternateKey])
VAR CYCustomers = 
    SUMMARIZE(
        CALCULATETABLE(
            'Internet Sales',
            FILTER(ALL('Dates'),'Dates'[CalendarYear] = CurrentYear)
        ), 'Customers'[CustomerAlternateKey])
RETURN
    CALCULATE(
        DISTINCTCOUNT('Customers'[CustomerAlternateKey]),
        EXCEPT(LYCustomers,CYCustomers) )
</code></pre>
      </li>
      <li class="calibre12">Create the following two DAX columns in the <strong class="screentext">Dates</strong> table:
        <pre class="programlisting"><code class="hljs">YearMonth = [CalendarYear]*100 + [MonthNumberOfYear]
YearMonthIndex = 
    COUNTROWS(
        SUMMARIZE(FILTER('Dates',[YearMonth]&lt;EARLIER([YearMonth])),[YearMonth])
    ) + 1
</code></pre>
      </li>
      <li class="calibre12">Create<a id="calibre_link-642" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the following <a id="calibre_link-330" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>eleven sales and cost DAX measures in the <strong class="screentext">Currency Measures</strong> table:
        <pre class="programlisting"><code class="hljs">Max Daily Rate = MAX('Currency Rates'[EndOfDayRate])
Last Rate = 
    CALCULATE(DISTINCT('Currency Rates'[EndOfDayRate]),
        LASTNONBLANK('Dates'[FullDateAlternateKey],[Max Daily Rate]) )
Previous Daily Rate = 
    CALCULATE([Last Rate],
        FILTER(ALL('Currency Rates'),
            'Currency Rates'[Index] = MAX('Currency Rates'[Index]) &ndash; 1) )
Previous Monthly Rate = 
    CALCULATE([Last Rate],
        FILTER(ALL('Dates'),
            'Dates'[YearMonthIndex] = MAX('Dates'[YearMonthIndex]) &ndash; 1) )
Previous Year Rate = 
    CALCULATE([Last Rate],
        FILTER(ALL('Dates'),
            'Dates'[CalendarYear] = MAX('Dates'[CalendarYear]) - 1) )
Daily Change % = DIVIDE([Last Rate],[Previous Daily Rate])
Monthly Change % = DIVIDE([Last Rate],[Previous Monthly Rate])
Yearly Change % = DIVIDE([Last Rate],[Previous Year Rate])
Daily Geometric Return = GEOMEANX('Currency Rates',[Daily Change %])-1
Daily Geometric Change = GEOMEANX('Currency Rates',[Daily Change %])-1
Yearly Geometric Change = GEOMEANX(DISTINCT('Dates'[CalendarYear]),[Yearly Change %])-1
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1511" class="calibre8">How it works</h2>
    <p class="book-title--packt">Measure definitions<a id="calibre_link-643" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> can be straightforward when the data is internally managed with <a id="calibre_link-331" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>processes and tools such as a data governance <a id="calibre_link-588" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>council, <strong class="screentext">Master Data Services</strong> (<strong class="screentext">MDS</strong>), <strong class="screentext">Data Quality Services</strong>, and <strong class="screentext">Azure Data Catalog</strong>. As per the <em class="italic">Power BI Governance and Deployment whitepaper</em>, Power BI projects and all<a id="calibre_link-106" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> BI projects greatly benefit from these data cleansing<a id="calibre_link-277" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and information management tools. The data warehouse bus matrix and stakeholder matrix referenced in this chapter and <em class="italic">Chapter 4</em>, <em class="italic">Authoring Power BI Reports</em>, respectively, can help to focus the measure definition process on version control and transparency.</p>
    <p class="book-title--packt">The names used for measures should be intuitive and specific to the business process. Preferably, a naming standard is followed to balance the detail of the name with the impact of text on visualizations. In a real project scenario, several additional measures would likely be created following validation. These might include Net Sales as a percentage of Gross Sales, Sales per Order, Quantity per Order, and Sales Not Shipped. These measures and more advanced measures would all leverage the validated measures.</p>
    <p class="book-title--packt">For the <strong class="screentext">Reseller Measures</strong>, the following business definitions are specified:</p>
    <ul class="calibre9">
      <li class="bullet">Gross Sales is equal to Unit Price multiplied by Order Quantity with no discounts applied.</li>
      <li class="bullet">Net Sales are Gross Sales reduced by Discounts and must have been shipped.</li>
      <li class="bullet">Product Cost is equal to Product Standard Cost multiplied by Order Quantity.</li>
    </ul>
    <p class="book-title--packt">Two columns exist in the source database reflecting <strong class="screentext">Reseller Gross Sales</strong> and <strong class="screentext">Reseller Product Cost</strong>. Performance and memory usage can be improved only by importing the price and quantity<a id="calibre_link-644" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> columns and multiplying them within the measure. For the <strong class="screentext">Reseller Gross Sales</strong> measure, the <code class="code-in-text--packt">SUMX</code> function is used to iterate over the table <a id="calibre_link-332" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>specified in the first parameter. The calculation specified in the second parameter is performed for each row and then all rows are summed. The net sales measure deducts discounts from gross sales and only includes shipped products. Here it is assumed that the date value of <code class="code-in-text--packt">12/31/2099</code> is assigned for any sales orders that have not shipped.</p>
    <p class="book-title--packt">Margin percentage measures reflecting both gross and net sales (with discounts) are required. These are the <strong class="screentext">Reseller Gross Margin % </strong>and <strong class="screentext">Reseller Margin %</strong> measures, respectively. <strong class="screentext">Margin Amount</strong> measures might also be created and could replace the numerator of the <strong class="screentext">Margin %</strong> measures. <code class="code-in-text--packt">DISTINCTCOUNT</code> can be used directly against foreign key relationship columns and any degenerate dimension columns on the fact table, such as <strong class="screentext">SalesOrderNumber</strong>. Always use the <code class="code-in-text--packt">DIVIDE</code> function with the optional third parameter to avoid division by zero errors.</p>
    <p class="book-title--packt">The distinct count of sales orders and products sold are also core measures used in many reports and are referenced by other measures. These are the <strong class="screentext">Reseller Count of Products Sold</strong> and <strong class="screentext">Reseller Count of Sales Order</strong> measures. The <strong class="screentext">Reseller Count of Products Sold</strong> measure uses the natural key of the product in the filter context of the fact table to count unique products. Using the product key on the fact table would count multiple versions of a product, given slowly changing dimensions. </p>
    <p class="book-title--packt">The <strong class="screentext">Pricing Measures</strong> provide an example of supporting the deeper analysis of pricing trends. These measures are designed to accomplish the following: </p>
    <ul class="calibre9">
      <li class="bullet">Describe the central tendency and distribution of prices.</li>
      <li class="bullet">Account for the impact of product sales mix to support analysis of effective pricing versus product pricing.</li>
    </ul>
    <p class="book-title--packt">The <strong class="screentext">Effective Unit Price</strong> measure accounts for the impact of quantity sold and uses the existing sales and quantity metrics. The percentile and median measures <strong class="screentext">25th Percentile Unit Price</strong>, <strong class="screentext">75th Percentile Unit Price</strong>, and <strong class="screentext">Median Unit Price</strong> help to better describe the distribution of prices. The <code class="code-in-text--packt">MEDIAN</code> function returns the 50th percentile of values in a column. The <code class="code-in-text--packt">PERCENTILE.INC</code> function is used for the 25th and 75th percentile.</p>
    <p class="book-title--packt">The minimum, maximum, and range of unit prices provide additional context to the variability <a id="calibre_link-645" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of the prices. Visuals can be created that use these measures to <a id="calibre_link-333" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>analyze pricing; see <em class="italic">Figure 3.26</em> as an example.</p>
    <figure class="mediaobject"><img src="images/000030.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.26: Example Power BI Pricing Reports</p>
    <p class="book-title--packt">The visuals compare the average unit price metric to the new effective unit price metric. Pricing metrics are added to visual tooltips such that hovering over values in the charts provides additional context. Performance is not negatively impacted when adding measures to visuals from the same table due to measure fusion. The tooltip measures shown are from the same table and did not create additional DAX queries. </p>
    <p class="book-title--packt">Embedding hierarchies in visuals with supporting measures can allow users to investigate interesting values by drilling up and down. Additionally, exception reports and notifications can be developed using the new measures as thresholds. </p>
    <p class="book-title--packt">The <strong class="screentext">Customer Measures</strong> serve as an example for finding cross-selling opportunities, as well as lapsed customers. The objective of these measures is to identify customer segments based on their purchase history across product categories. For example, the business wants to identify customers who have purchased a bike, but no bike accessories.</p>
    <p class="book-title--packt">By creating a <strong class="screentext">Table</strong> visualization that includes the <strong class="screentext">Product</strong> <strong class="screentext">Category</strong> column from the <strong class="screentext">Products</strong> table and the distinct count of the <strong class="screentext">CustomerKey</strong> from the <strong class="screentext">Customers</strong> table, we can see that 18,484 distinct customers have made purchases across three product categories; this information can be seen in <em class="italic">Figure 3.27</em>.</p>
    <figure class="mediaobject"><img src="images/000042.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.27: Unique Customers by Product Category</p>
    <p class="book-title--packt">The <strong class="screentext">Count of Accessory But Not Bike Customers</strong> and <strong class="screentext">Count of Bike Only Customers</strong> measures help us to determine the number of customers that have bought clothing or accessories but not bikes, or bought bikes but not accessories, respectively. These measures can be used in <strong class="screentext">Card</strong> visuals to show that there are far fewer bike-only customers <a id="calibre_link-646" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>than customers that only buy clothing or accessories, but not <a id="calibre_link-334" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>bikes. In addition, these measures can be used in <strong class="screentext">Table</strong> visualizations that include the <strong class="screentext">CustomerAlternateKey</strong> column to identify individual customers; when these measures are calculated at the individual customer level, the measures return either zero, or one and zero values are automatically filtered from the <strong class="screentext">Table</strong> visualization by default. Note that you can click the drop-down arrow in the <strong class="screentext">Values</strong> area for <strong class="screentext">CustomerAlternateKey</strong> and choose <strong class="screentext">Show items with no data</strong> to change this default behavior.</p>
    <figure class="mediaobject"><img src="images/000054.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.28: Measures Count of Accessory But Not Bike Customers and Count of Bike Only Customers</p>
    <p class="book-title--packt">The <strong class="screentext">Count of Accessory But Not Bike Customers</strong> measure uses variables (VAR) to create the virtual tables <code class="code-in-text--packt">BikeCustomers</code> and <code class="code-in-text--packt">AccessoryCustomers</code> that store the distinct customer keys associated with the two product categories, Bikes and Accessories, respectively. The <code class="code-in-text--packt">SUMMARIZE</code> function groups the customer key values and <code class="code-in-text--packt">EXCEPT</code> performs the set-based operation. For the <strong class="screentext">Count of Bike Only Customers</strong> measure, the syntax aligns with the structure of the first measure except for the use of the DAX IN operator to include accessories and clothing in the same group of customer keys. Given the power of these measures, they could be candidates for sales and marketing dashboards and exception reports; sales teams could focus on cross-selling bike-only customers and selling bikes to non-bike customers.</p>
    <p class="book-title--packt">The <strong class="screentext">Count of Last Year Customers ex Current Year</strong> measure demonstrates how to identify customers who made a purchase last year but have not yet made a purchase this year. The structure of this measure is similar to the two previous measures, except for the use of the <code class="code-in-text--packt">CALCULATETABLE</code> function to create a filtered table set. In the recipe, the <code class="code-in-text--packt">CurrentYear</code> variable is hardcoded to be <code class="code-in-text--packt">2012</code>. In a production dataset, this would likely be changed to something like <code class="code-in-text--packt">YEAR(TODAY())</code> in order to get the current year or <code class="code-in-text--packt">YEAR(MAX('Dates'[Date]))</code> to get the most current year in context. This measure can be used in <strong class="screentext">Card</strong> or <strong class="screentext">Table</strong> visualizations as well.</p>
    <p class="book-title--packt">The <strong class="screentext">Currency Measures</strong> provide an example of computing the geometric mean at the day, month, and <a id="calibre_link-647" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>year grains. In the <strong class="screentext">Last Rate</strong> measure, the <code class="code-in-text--packt">LASTNONBLANK</code> function is needed for days where there might not be a rate logged in the data. This<a id="calibre_link-335" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> measure is used to compute the previous rate at the day, month, and year granularity (<strong class="screentext">Previous Daily Rate</strong>, <strong class="screentext">Previous Monthly Rate</strong>, and <strong class="screentext">Previous Year Rate</strong>). The percentage change measures, <strong class="screentext">Daily Change %</strong>, <strong class="screentext">Monthly Change %</strong>, and <strong class="screentext">Yearly Change %</strong> are the source values for the geometric mean calculations and thus are expressed as positive numbers. The <code class="code-in-text--packt">GEOMEANX</code> function iterates over tables at the different grains and computes the <code class="code-in-text--packt">Change %</code> measure for each row. The geometric mean (the product of values taken to the <em class="italic">N</em><sup class="calibre21">th</sup> root) is computed last against this list of values. The geometric change measures can be used in a multi-row card visualization, with 10 decimal points specified:</p>
    <figure class="mediaobject"><img src="images/000066.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.29: Geometric Mean Measures</p>
    <h2 id="calibre_link-1512" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">A common scenario with many data models is comparing tables with different grains, for example, when comparing actual versus budget, where actuals are reported daily and budgets are assigned monthly or quarterly. In such scenarios, you can create bridge tables where each bridge table contains the unique values of the dimension at the grain of the budget table. These bridge tables can potentially leverage the existing M queries in the model used to load the dimension tables. Take the following example, where the M expression references the <strong class="screentext">Dates</strong> table query as its source and selects only the distinct values of the <strong class="screentext">Calendar Yr-Mo</strong> column. If this is the grain of the budget table, this single-column table could be used as the bridge table. </p>
    <pre class="programlisting"><code class="hljs">let Source = Dates,
      YearMonthColumn = Table.SelectColumns(Source,{"Calendar Yr-Mo"}),
      RemoveDuplicates = Table.Distinct(YearMonthColumn)
in RemoveDuplicates
</code></pre>
    <p class="book-title--packt">Alternatively, a simple SQL view could be created (<code class="code-in-text--packt">'Select Distinct [Calendar Yr-Mo] From dbo.DimDate'</code>) that selects the distinct values of the column; this view could be accessed from a new bridge table M query.</p>
    <p class="book-title--packt">One-to-many relationships with single-direction cross-filtering from the bridge tables to the budget table can be created. Additional many-to-one relationships with bidirectional cross-filtering are then created between the bridge tables and their corresponding dimension tables. An example final model might look the same as that shown in <em class="italic">Figure 3.30</em>.</p>
    <figure class="mediaobject"><img src="images/000078.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.30: Internet Sales versus Budget Data Model</p>
    <p class="book-title--packt">The two bidirectional relationships highlighted in the image allow filters on the <strong class="screentext">Date</strong> and <strong class="screentext">Product</strong> tables to propagate to the <strong class="screentext">Internet Sales Budget</strong> table, in addition to the <strong class="screentext">Internet Sales</strong> fact table.</p>
    <p class="book-title--packt">The only remaining steps requiring some level of code are to avoid invalid filter contexts. For example, the <strong class="screentext">Internet Sales</strong> fact table <a id="calibre_link-563" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>can of course be filtered by individual products and dates, but this granularity is not available for the <strong class="screentext">Internet Sales Budget</strong> table<a id="calibre_link-562" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and thus a blank value should be returned. </p>
    <p class="book-title--packt">A filter test measure<a id="calibre_link-490" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> can be created to test for filter context. The filter test is used to protect against invalid sales to budget reports, with different filters applied to each fact table. The following measure checks whether filters have been applied at higher grains than the budget table:</p>
    <pre class="programlisting"><code class="hljs"><span><strong class="screentext">Budget Filter Test</strong></span> = 
 VAR CustomerFilter = ISCROSSFILTERED(Customer) 
 VAR ProductGrain = 
  ISFILTERED('Product'[Product Class]) || ISFILTERED('Product'[Product Color]) || 
  ISFILTERED('Product'[Product Subcategory]) || ISFILTERED('Product'[Product Name])
 VAR DateGrain = 
  ISFILTERED('Date'[Calendar Yr-Wk]) || ISFILTERED('Date'[Date]) || ISFILTERED('Date'[Wk End Date])
RETURN
IF(CustomerFilter = TRUE() || ProductGrain = TRUE() || DateGrain =TRUE(), 
 "Higher Grain", "Common Grain") 
</code></pre>
    <p class="book-title--packt">The <code class="code-in-text--packt">ISFILTERED</code> and <code class="code-in-text--packt">ISCROSSFILTERED</code> functions return Boolean values based on the filter context of the table or columns. The <code class="code-in-text--packt">ISFILTERED</code> function is limited to a single column in the model and is specific to the given column. The <code class="code-in-text--packt">ISCROSSFILTERED</code> function can check a single column or an entire table. Filters from other tables are included in the evaluation.</p>
    <p class="book-title--packt">The <strong class="screentext">Budget Filter Test</strong> measure<a id="calibre_link-113" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> can then be used to create a budget measure and an actual-to-budget variance measure:</p>
    <pre class="programlisting"><code class="hljs"><span><strong class="screentext">Internet Sales Budget</strong></span> = 
 VAR BudgetSales = sum('Internet Sales Budget'[Online Sales Budget])
RETURN
IF([Budget Filter Test] = "Common Grain", BudgetSales, BLANK()) 
Internet Sales Actual to Budget Variance = 
IF(ISBLANK([Internet Sales Budget]),BLANK(), [Internet Sales] - [Internet Sales Budget])
</code></pre>
    <p class="book-title--packt">In this scenario, the requirement is to only test for a common grain, and return a blank otherwise. It is possible to build allocation logic into the DAX budget measure to account for higher grains. In general, these allocation rules are better implemented in the budget process itself or via ETL tools and query languages, such as SQL and M. These measures can be used to visualize variances between actuals and budget.</p>
    <figure class="mediaobject"><img src="images/000090.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.31: Internet Sales Actual versus Budget by Product Category and Year-Month</p>
    <p class="book-title--packt">Matrix visuals provide functionality similar to Excel pivot tables and are therefore a good choice for budget versus actuals. </p>
    <h2 id="calibre_link-1513" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">DAX function reference: <a href="http://bit.ly/3rrQFlt" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3rrQFlt</span></a></li>
      <li class="bullet">Governance and deployment approaches: <a href="http://bit.ly/1VLWdVg" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/1VLWdVg</span></a> </li>
    </ul>
    <h1 id="calibre_link-1207" class="title">Supporting Virtual Table Relationships</h1>
    <p class="book-title--packt">Virtual table relationships <a id="calibre_link-1128" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>are DAX expressions implemented to filter one table from another when a relationship does not exist between the two. Report visualizations can then be constructed using both tables (and those related to it), and the DAX measures will update as though a normal relationship is defined. Virtual relationships are often used to address disparate grains of tables and to leverage performance segmentation tables. </p>
    <p class="book-title--packt">Although physical relationships are the preferred long-term solution for both performance and manageability, virtual relationships provide an attractive alternative when physical relationships are not feasible. In this recipe, we provide virtual relationship examples that use both a custom performance segmentation table and an aggregated table. </p>
    <h2 id="calibre_link-1514" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong> and disable loading.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Select<a id="calibre_link-1515" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">FactInternetSales</strong> table and name this query <strong class="screentext">Internet Sales</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">4</em> and <em class="italic">5</em> to create a <strong class="screentext">Dates</strong> query that imports <strong class="screentext">DimDates</strong>.</li>
      <li class="calibre12">Create a <strong class="screentext">Customers</strong> query using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimCustomer = Source{[Schema="dbo",Item="DimCustomer"]}[Data],
    Country = 
        Table.ExpandRecordColumn(
            dbo_DimCustomer, "DimGeography", 
            {"EnglishCountryRegionName"}, {"Country"})
in
    Country
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        )
in
   Subcategory
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> query to a query group called <strong class="screentext">Facts</strong>, and the <strong class="screentext">Dates</strong>, <strong class="screentext">Products</strong>, and <strong class="screentext">Customers</strong> queries to a query group called <strong class="screentext">Dimensions</strong>.</li>
      <li class="calibre12">Use an <strong class="screentext">Enter Data</strong> query to create a <strong class="screentext">GrowthTiers</strong> query in the<strong class="screentext"> Other Queries</strong> group.<figure class="mediaobject"><img src="images/000103.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.32: Sales Growth Segmentation Table, GrowthTiers</p>
      </li>
      <li class="calibre12">Create <a id="calibre_link-1129" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a <strong class="screentext">SubCatPlan</strong> query in the <strong class="screentext">Other Queries</strong> group with the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = Products,
    Sales = 
        Table.ExpandTableColumn(
            Source, "FactInternetSales", 
            {"SalesAmount", "OrderDate"}, {"SalesAmount", "OrderDate"}
        ),
    RemoveNulls = Table.SelectRows(Sales, each [SalesAmount] &lt;&gt; null),
    Year = 
        Table.AddColumn(
            RemoveNulls, "Calendar Year", each Date.Year([OrderDate])
        ),
    Month = 
        Table.AddColumn(
            Year, "Calendar Month", each Date.MonthName([OrderDate])
        ),
    Group = 
        Table.Group(
            Month, 
            {"Calendar Year", "Calendar Month", "Product Subcategory"}, 
            {{"SalesAmount", each List.Sum([SalesAmount]), 
                type nullable number}}
        ),
    Index = Table.AddIndexColumn(Group, "Index", 1, 1, Int64.Type),
    Plan = 
        Table.AddColumn(
            Index, "Plan Amt", 
            each if Number.IsEven([Index]) 
                then 1/Number.RandomBetween(5,10) * [SalesAmount] + [SalesAmount] 
                else (-1 * 1/Number.RandomBetween(5,10) * [SalesAmount]) + [SalesAmount]
        ),
    Remove = Table.RemoveColumns(Plan,{"SalesAmount", "Index"}),
    Currency = Table.TransformColumnTypes(Remove,{{"Plan Amt", Currency.Type}})
in
    Currency
</code></pre>
      </li>
      <li class="calibre12">Create a<a id="calibre_link-1130" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> <strong class="screentext">Blank Query</strong> called <strong class="screentext">Calculations</strong> in the <strong class="screentext">Other</strong> <strong class="screentext">Queries</strong> group.</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> in the ribbon of the <strong class="screentext">Home</strong> tab to load the tables to the data model.</li>
      <li class="calibre12">Create the single cross-filtering relationships shown in <em class="italic">Figure 3.33</em>; note that there are no relationships for the <strong class="screentext">GrowthTiers</strong> or <strong class="screentext">SubCatPlan</strong> tables:<figure class="mediaobject"><img src="images/000116.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.33: Model relationships</p>
      </li>
      <li class="calibre12">Switch to the <strong class="screentext">Data</strong> view and hide the single column in the <strong class="screentext">Calculations</strong> table.</li>
      <li class="calibre12">Create the following measures in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Sales Current Year = 
    CALCULATE(SUM('Internet Sales'[SalesAmount]),
        FILTER(ALLEXCEPT('Internet Sales','Customers'),
            YEAR('Internet Sales'[OrderDate]) = MAX('Dates'[CalendarYear]) ) )
Sales Previous Year = 
    CALCULATE(
        SUM('Internet Sales'[SalesAmount]),
        FILTER(ALLEXCEPT('Internet Sales','Customers'),
            YEAR('Internet Sales'[OrderDate]) = MAX('Dates'[CalendarYear])-1) )
Sales Growth = 
    DIVIDE([Sales Current Year] - [Sales Previous Year],
        [Sales Previous Year], BLANK() )
</code></pre>
      </li>
      <li class="calibre12">Right-click the <strong class="screentext">Date</strong> table and choose <strong class="screentext">Mark as date table</strong> using <strong class="screentext">FullDateAlternateKey</strong> as the <strong class="screentext">Date</strong> column.</li>
    </ol>
    <h2 id="calibre_link-1516" class="calibre8">How to Support Virtual Table Relationships</h2>
    <p class="book-title--packt">To <a id="calibre_link-1131" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create the <code class="code-in-text--packt">Sales Growth Tier</code> measure in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Sales Growth Tier = 
    VAR Growth = [Sales Growth]
    VAR Level1 = 
        CALCULATE(MIN('GrowthTiers'[Max]), 'GrowthTiers'[GrowthTierKey] = 1)
    VAR Level2 = 
        CALCULATE(MIN('GrowthTiers'[Max]), 'GrowthTiers'[GrowthTierKey] = 2)
    VAR Level3 = 
        CALCULATE(MIN('GrowthTiers'[Max]), 'GrowthTiers'[GrowthTierKey] = 3)
    VAR Level4 = 
        CALCULATE(MIN('GrowthTiers'[Max]), 'GrowthTiers'[GrowthTierKey] = 4)
RETURN 
    SWITCH(TRUE(),
        ISBLANK(Growth), BLANK(),
        Growth &lt;= Level1, CALCULATE(DISTINCT('GrowthTiers'[Growth Tier]),
                'GrowthTiers'[GrowthTierKey] = 1), 
        Growth &lt;= Level2, CALCULATE(DISTINCT('GrowthTiers'[Growth Tier]), 
                'GrowthTiers'[GrowthTierKey] = 2),
        Growth &lt;= Level3, CALCULATE(DISTINCT('GrowthTiers'[Growth Tier]),
                'GrowthTiers'[GrowthTierKey] = 3),
        Growth &lt;= Level4, CALCULATE(DISTINCT('GrowthTiers'[Growth Tier]),
                'GrowthTiers'[GrowthTierKey] = 4
            ),"Unknown")
</code></pre>
      </li>
      <li class="calibre12">Create<a id="calibre_link-1132" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the virtual table relationship measure <strong class="screentext">Customer Countries</strong> in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Customer Countries = 
    CALCULATE(DISTINCTCOUNT('Customers'[Country]),
        FILTER(ALL('Customers'[Country]),
            [Sales Growth] &gt; MIN('GrowthTiers'[Min]) &amp;&amp; 
            [Sales Growth] &lt; MAX('GrowthTiers'[Max]) ) )
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Slicer</strong> visualization that uses the <strong class="screentext">CalendarYear</strong> column from the <strong class="screentext">Dates</strong> table.</li>
      <li class="calibre12">Create a <strong class="screentext">Matrix</strong> visualization with the <strong class="screentext">Country</strong> column from the <strong class="screentext">Customers</strong> table as <strong class="screentext">Rows</strong> and the measures <strong class="screentext">Sales Growth</strong>, <strong class="screentext">Sales Current Year</strong>, <strong class="screentext">Sales Previous Year</strong>, and <strong class="screentext">Sales Growth Tier</strong> as <strong class="screentext">Values</strong>.</li>
      <li class="calibre12">Create a <strong class="screentext">Clustered column chart</strong> visualization with the <strong class="screentext">Growth Tier</strong> column from the <strong class="screentext">GrowthTiers</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">Customer Countries</strong> measure as <strong class="screentext">Values</strong>.<figure class="mediaobject"><img src="images/000127.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.34: Virtual relationship segmentation example</p>
      </li>
      <li class="calibre12">Save your work.</li>
    </ol>
    <h2 id="calibre_link-1517" class="calibre8">How it works</h2>
    <p class="book-title--packt">The goal of<a id="calibre_link-1133" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe is to apply the <strong class="screentext">Growth Tier</strong> segmentations from the disconnected <strong class="screentext">GrowthTiers</strong> table to the measures of the data model. Two measures are used to form this virtual relationship, <strong class="screentext">Sales Growth Tier</strong> and <strong class="screentext">Customer Countries</strong>. The measures apply filters based on the segmentation table thresholds and the <strong class="screentext">Sales Growth</strong> measure. In effect, these measures form the relationship between the tables in the data model through the calculations performed.</p>
    <p class="book-title--packt">The <strong class="screentext">Sales Growth Tier</strong> measure returns the text value of the <strong class="screentext">Growth Tier</strong> column for the specified <strong class="screentext">Sales Growth</strong> measure value in context. The existing <code class="code-in-text--packt">Sales Growth</code> measure and the four segment threshold values are stored in DAX variables (the <code class="code-in-text--packt">VAR</code> statements). The <code class="code-in-text--packt">SWITCH</code> function compares sales growth with the segment thresholds to assign the <strong class="screentext">Growth Tier</strong> value. Providing <code class="code-in-text--packt">TRUE()</code> as the first parameter of the <code class="code-in-text--packt">SWITCH </code>function allows independent logical conditions to be evaluated in order (from top to bottom). This is similar to the <code class="code-in-text--packt">CASE</code> expression in SQL. The <strong class="screentext">Customer Countries</strong> measure uses a simple <code class="code-in-text--packt">CALCULATE</code> statement to return a <code class="code-in-text--packt">DISTINTCOUNT</code> of countries filtered by the <code class="code-in-text--packt">MIN</code> and <code class="code-in-text--packt">MAX</code> limits of each <strong class="screentext">Growth Tier</strong>.</p>
    <p class="book-title--packt">The <strong class="screentext">Sales Growth Tier</strong> measure could be used for analyzing other dimensions of the model, and at different grains; for example, if <strong class="screentext">StateProvinceName</strong> was added to the <strong class="screentext">Customers</strong> table and a hierarchy created, you could drill down with the matrix visual and see growth tiers by state/province.</p>
    <figure class="mediaobject"><img src="images/000139.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.35: Drill Down into Problem Customer Country</p>
    <p class="book-title--packt">There are options to modify data models to support physical relationships and thus avoid the limitations of virtual relationships. For example, a concatenated column such as Year-Month could be created for each table via SQL, M, or a DAX-calculated column.</p>
    <p class="book-title--packt">Alternatively, bridge tables with bidirectional cross-filtering relationships provide simple solutions to many-to-many scenarios. Finally, for small fact tables, the <code class="code-in-text--packt">LOOKUPVALUE</code> function could be used in a<a id="calibre_link-1134" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> calculated column supporting the relationship.</p>
    <h2 id="calibre_link-1518" class="calibre8">There's more...â¦</h2>
    <p class="book-title--packt">The DAX <code class="code-in-text--packt">TREATAS</code> function was added in early 2017 and provides both simpler syntax and better performance than alternative virtual relationship methods involving <code class="code-in-text--packt">INTERSECT</code> or <code class="code-in-text--packt">FILTER</code> with a <code class="code-in-text--packt">CONTAINS</code> function parameter. We can use the <code class="code-in-text--packt">TREATAS</code> function to integrate a summary table, <strong class="screentext">SubCatPlan</strong>, into our Power BI data model. This is useful when a business wants to filter plan data via the same <strong class="screentext">Products </strong>and <strong class="screentext">Dates</strong> tables they use regularly and to create actual versus plan reports. The grain of the <code class="code-in-text--packt">SubCatPlan</code> table is <code class="code-in-text--packt">Product Subcategory</code> by <code class="code-in-text--packt">Calendar Year</code> and <code class="code-in-text--packt">Calendar Month</code>; this is shown in <em class="italic">Figure 3.36</em>.</p>
    <figure class="mediaobject"><img src="images/000152.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.36: Plan Summary Table for Virtual Relationships</p>
    <p class="book-title--packt">Relationships from the <strong class="screentext">SubCatPlan</strong> table to the <strong class="screentext">Date</strong> and <strong class="screentext">Product</strong> tables cannot be created directly given the many-to-many relationship. Each physical relationship in Power BI is based on a single column from each table, with one of the relationship columns uniquely identifying all the rows of its host table. This is consistent with SSAS Tabular and Power Pivot for Excel models.</p>
    <p class="book-title--packt">To create a<a id="calibre_link-1126" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> virtual table relationship with DAX, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create the <strong class="screentext">Subcat Plan Amt</strong> measure in the <strong class="screentext">Calculations</strong> table. This measure filters the subcategory plan measure by the <strong class="screentext">Products</strong> table and the <strong class="screentext">Dates</strong> table:
        <pre class="programlisting"><code class="hljs">Subcat Plan Amt = 
    VAR ProductSubCats = VALUES('Products'[Product Subcategory])
    VAR DateTbl = 
        SUMMARIZE('Dates','Dates'[CalendarYear],'Dates'[EnglishMonthName])
RETURN
    CALCULATE(
        SUM('SubCatPlan'[Plan Amt]), 
        TREATAS(ProductSubCats,'SubCatPlan'[Product Subcategory]),
        TREATAS(DateTbl,'SubCatPlan'[Calendar Year],'SubCatPlan'[Calendar Month]))
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Sales vs Plan</strong> measure:
        <pre class="programlisting"><code class="hljs">Sales vs Plan = SUM('Internet Sales'[SalesAmount]) - [Subcat Plan Amt]
</code></pre>
      </li>
      <li class="calibre12">Create <a id="calibre_link-1127" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a <strong class="screentext">Matrix</strong> visualization with the <strong class="screentext">Product Subcategory</strong> column from the <strong class="screentext">Products</strong> table as <strong class="screentext">Rows</strong>, the <strong class="screentext">EnglishMonthName</strong> column from the <strong class="screentext">Dates</strong> table as <strong class="screentext">Columns</strong>, and the <strong class="screentext">Subcat Plan Amt </strong>measure, <strong class="screentext">Sales vs Plan</strong> measure, and the <strong class="screentext">SUM</strong> of the <strong class="screentext">SalesAmount</strong> column from the <strong class="screentext">Internet Sales</strong> table as <strong class="screentext">Values</strong>.<figure class="mediaobject"><img src="images/000165.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 3.37: Subcategory Plan versus Actual Matrix Visual</p>
    <p class="book-title--packt">In the <strong class="screentext">Subcat Plan Amt</strong> measure, variables are used to store tables representing the filtered values of the <strong class="screentext">Products</strong> and <strong class="screentext">Dates</strong> dimension tables. The <code class="code-in-text--packt">TREATAS</code> function transfers the variables to the corresponding plan column(s), thus filtering the <strong class="screentext">SubCatPlan</strong> table. Any column with the same grain (or lower) than the <strong class="screentext">Product Subcategory</strong>, <strong class="screentext">Calendar Year</strong>, and <strong class="screentext">Calendar Month</strong> columns can be used. Columns from other tables or columns without a virtual relationship will not filter the <strong class="screentext">SubCatPlan</strong> table.</p>
    <p class="book-title--packt">Bridge tables to support physical relationships to the <strong class="screentext">Products</strong> and <strong class="screentext">Dates</strong> tables could be created in this scenario. The two bridge tables would contain the unique product subcategory and month values, and one-to-many relationships would link the bridge tables to the <strong class="screentext">SubCatPlan</strong>, <strong class="screentext">Product</strong>, and <strong class="screentext">Date</strong> tables. The <strong class="screentext">SubCatPlan</strong> and bridge tables could be hidden from the <strong class="screentext">Report</strong> view, and bidirectional relationships would be configured between the bridge tables and the <strong class="screentext">Products</strong> and <strong class="screentext">Dates</strong> tables. For better performance and manageability, physical relationships are recommended over virtual ones.</p>
    <h2 id="calibre_link-1519" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">DAX function reference: <a href="http://bit.ly/3rrQFlt" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3rrQFlt</span></a></li>
      <li class="bullet">Physical and Virtual Relationships in DAX: <a href="http://bit.ly/2oFpe8T" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2oFpe8T</span></a></li>
    </ul>
    <h1 id="calibre_link-1208" class="title">Creating Hierarchies and Groups</h1>
    <p class="book-title--packt">Hierarchies and groups are data model structures that can be implemented to simplify the user and report authoring<a id="calibre_link-539" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> experience. Hierarchies provide single-click access to multiple columns of a table, enabling users to navigate through pre-defined levels, such<a id="calibre_link-532" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> as the weeks within a given month. Groups comprise individual values of a column that enable analysis and visualization of the combined total as though it is a single value. Hierarchies and groups have useful applications in almost all data models, and it is important to understand the relationship of these structures to the data model and visualizations.</p>
    <p class="book-title--packt">This recipe provides an example of utilizing DAX parent- and child-hierarchy functions to create columns of a hierarchy. The hierarchy is then implemented into the data model, and a group is created to further benefit analysis.</p>
    <h2 id="calibre_link-1520" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong> and disable loading.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">FactInternetSales</strong> table and name this query <strong class="screentext">Internet Sales</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">4</em> and <em class="italic">5</em> to create a <strong class="screentext">General Ledger</strong> query that imports <strong class="screentext">FactFinance</strong>. </li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
in
   Subcategory
</code></pre>
      </li>
      <li class="calibre12">Create<a id="calibre_link-540" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> an <strong class="screentext">Accounts</strong> query using <a id="calibre_link-533" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimCustomer = Source{[Schema="dbo",Item="DimAccount"]}[Data],
    Parent = 
        Table.ExpandRecordColumn(
            dbo_DimCustomer, "DimAccount(ParentAccountKey)", 
            {"AccountDescription"}, {"ParentAccountDescription"})
in
    Parent
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">General Ledger</strong> queries to a query group called <strong class="screentext">Facts</strong>, and the <strong class="screentext">Products</strong> and <strong class="screentext">Accounts</strong> queries to a query group called <strong class="screentext">Dimensions</strong>.</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> in the ribbon of the <strong class="screentext">Home</strong> tab to load the tables to the data model.</li>
      <li class="calibre12">Create the <strong class="screentext">Single</strong> cross-filtering relationships shown in <em class="italic">Figure 3.38</em>.<figure class="mediaobject"><img src="images/000178.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 3.38: Model relationships</p>
    <h2 id="calibre_link-1521" class="calibre8">How to Create Hierarchies and Groups</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Data</strong> view, create<a id="calibre_link-541" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the following seven calculated columns<a id="calibre_link-534" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in the <strong class="screentext">Accounts</strong> table:
        <pre class="programlisting"><code class="hljs">Path = PATH('Accounts'[AccountKey],'Accounts'[ParentAccountKey])
Account Level 1 = 
    VAR __Key = PATHITEM('Accounts'[Path],1,1)
RETURN
    LOOKUPVALUE('Accounts'[AccountDescription],'Accounts'[AccountKey], __Key)
Account Level 2 = 
    VAR __Key = PATHITEM('Accounts'[Path],2,1)
RETURN
    LOOKUPVALUE('Accounts'[AccountDescription],'Accounts'[AccountKey], __Key)
Account Level 3 = 
    VAR __Key = PATHITEM('Accounts'[Path],3,1)
RETURN
    LOOKUPVALUE('Accounts'[AccountDescription],'Accounts'[AccountKey], __Key)
Account Level 4 = 
    VAR __Key = PATHITEM('Accounts'[Path],4,1)
RETURN
    LOOKUPVALUE('Accounts'[AccountDescription],'Accounts'[AccountKey], __Key)
Account Level 5 = 
    VAR __Key = PATHITEM('Accounts'[Path],5,1)
RETURN
    LOOKUPVALUE('Accounts'[AccountDescription],'Accounts'[AccountKey], __Key)
Account Level 6 = 
    VAR __Key = PATHITEM('Accounts'[Path],6,1)
RETURN
    LOOKUPVALUE('Accounts'[AccountDescription],'Accounts'[AccountKey], __Key)
</code></pre>
      </li>
      <li class="calibre12">In the <strong class="screentext">Fields</strong> list of the <strong class="screentext">Data </strong>view, right-click the <strong class="screentext">Account Level 1</strong> column and choose <strong class="screentext">Create hierarchy</strong>.</li>
      <li class="calibre12">Rename the <strong class="screentext">Account Level 1 Hierarchy</strong> to <strong class="screentext">Account Hierarchy</strong> by right-clicking the hierarchy and choosing <strong class="screentext">Rename</strong>.</li>
      <li class="calibre12">Right-click the <strong class="screentext"><a id="calibre_link-542" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">Account Level 2</strong> column and choose <strong class="screentext">Add to hierarchy</strong>, and then <strong class="screentext">Account Hierarchy</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">step 4</em> for<a id="calibre_link-535" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Account Level 3</strong>, <strong class="screentext">Account Level 4</strong>, <strong class="screentext">Account Level 5</strong>, and <strong class="screentext">Account Level 6</strong> columns in order.<figure class="mediaobject"><img src="images/000191.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.39: Hierarchy in the Fields list</p>
      </li>
      <li class="calibre12">Right-click the individual columns that comprise the hierarchy and choose <strong class="screentext">Hide in report view</strong>.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Report</strong> view and create a <strong class="screentext">Matrix</strong> visualization with <strong class="screentext">Account Hierarchy</strong> as <strong class="screentext">Rows</strong> and the <strong class="screentext">Amount</strong> column from the <strong class="screentext">General</strong> <strong class="screentext">Ledger</strong> table as <strong class="screentext">Values</strong>.<figure class="mediaobject"><img src="images/000203.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.40: Matrix Visual of Account Hierarchy</p>
      </li>
      <li class="calibre12">In <a id="calibre_link-543" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Fields</strong> list, right-click the <strong class="screentext">Product Subcategory</strong> column in <a id="calibre_link-536" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Products</strong> table and choose <strong class="screentext">New group</strong>.</li>
      <li class="calibre12">Rename the group <strong class="screentext">Product Subcategories</strong> by editing the <strong class="screentext">Name</strong> field.</li>
      <li class="calibre12">Select <strong class="screentext">Caps</strong> from the <strong class="screentext">Ungrouped values</strong> area, press the <strong class="screentext">Group</strong> button, and name the group <strong class="screentext">Bike Attire Accessories</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">Gloves</strong> from <strong class="screentext">Ungrouped values</strong>, select <strong class="screentext">Bike Attire Accessories</strong> from <strong class="screentext">Groups and members</strong>, and then click the <strong class="screentext">Group</strong> button to add <strong class="screentext">Gloves</strong> to the <strong class="screentext">Bike Attire Accessories</strong> group.</li>
      <li class="calibre12">Check the box for <strong class="screentext">Include Other group</strong> and click the <strong class="screentext">OK</strong> button.<figure class="mediaobject"><img src="images/000214.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.41: Groups Dialog</p>
      </li>
      <li class="calibre12">Create <a id="calibre_link-544" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a <strong class="screentext">Clustered bar chart</strong> visualization with the <strong class="screentext">Product Subcategories</strong> group in the <strong class="screentext">Products</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">SalesAmount</strong> column <a id="calibre_link-537" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>from the <strong class="screentext">Internet Sales</strong> table as the <strong class="screentext">Values</strong>.<figure class="mediaobject"><img src="images/000226.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 3.42: Product Subcategories Group with the Other group enabled</p>
    <h2 id="calibre_link-1522" class="calibre8">How it works</h2>
    <p class="book-title--packt">For the hierarchy created, the <code class="code-in-text--packt">PATH</code> function compares a child key column with the parent key column and returns a delimited text string containing all the parent members for the given row. The <code class="code-in-text--packt">PATHITEM</code> function returns the key value from a path from highest to lowest based on the position parameter. The third and final parameter of the <code class="code-in-text--packt">PATHITEM</code> function (1) specifies to return this value as an integer. The <code class="code-in-text--packt">LOOKUPVALUE</code> function compares the account key with the key returned by the <code class="code-in-text--packt">PATHITEM</code> function and returns the column specified by the first parameter, <strong class="screentext">AccountDescription</strong>. Some rows have blank values <a id="calibre_link-1523" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for a given column because it is higher in the structure; for example, the <strong class="screentext">Balance Sheet</strong> account does not have values for the columns of level 2 through 6. The<a id="calibre_link-1524" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> calculated columns will appear in the <strong class="screentext">Fields</strong> list with formula icons. </p>
    <p class="book-title--packt">The hierarchy can now be added to visuals with a single click. Drilldown is available to navigate all six columns. Alternatively, in <strong class="screentext">Matrix</strong> visualizations, the expand and collapse controls at the beginning of each row can be used to investigate the hierarchy. With the hierarchy in the <strong class="screentext">Fields</strong> list, usability may be improved by hiding the individual columns. However, individual columns are needed to view a different order of the columns or to view the individual columns of the hierarchy on opposing axes.</p>
    <p class="book-title--packt">Consider the hierarchy created in this recipe as a natural hierarchy versus an unnatural hierarchy. A natural hierarchy contains unique child values for each parent value and is the recommended structure of hierarchies. For example, each unique value in a <strong class="screentext">Fiscal Year</strong> column would have 12 unique child values, such as "2017-Mar". An unnatural hierarchy would have the same child value repeated across multiple parent values.</p>
    <p class="book-title--packt">In almost all scenarios, the SQL source views or M queries are preferable alternatives to DAX-calculated columns. The DAX parent-child functions used were developed for this scenario, and the <strong class="screentext">Accounts</strong> table only has 100 rows. </p>
    <p class="book-title--packt">Calculated columns and tables in DAX use the resources of the model during processing/refresh operations and are not compressed, thus increasing the memory footprint of the model. Thus, you should avoid calculated columns on large fact tables.</p>
    <p class="book-title--packt">Grouping can make Power BI reports and dashboards more intuitive and help simplify analyses. Often, grouping is used with less common dimension values that might clutter data visualizations. If a particular grouping created in Power BI Desktop becomes pervasive throughout reports and dashboards, it may be appropriate to build the equivalent into the data warehouse or the retrieval queries of the data model. The name for the new groups, Product Subcategories, is exposed in the <strong class="screentext">Fields</strong> list with a shape icon of a square segmented into four equal parts. In addition, the name for the new groups is also exposed in the <strong class="screentext">Data</strong> view as a column. </p>
    <p class="book-title--packt">By default, the <strong class="screentext">Include Other group</strong> option in the <strong class="screentext">Groups</strong> dialog box is not enabled. If enabled, all other distinct values or members of the column not included in a group are grouped into the <strong class="screentext">Other</strong> group. In the <strong class="screentext">Data</strong> view, members of the <strong class="screentext">Other</strong> group are displayed as having the value <strong class="screentext">(Blank)</strong>.</p>
    <p class="book-title--packt">Creating and <a id="calibre_link-545" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>editing groups and hierarchies is only available in Power BI Desktop with the <a id="calibre_link-538" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>data model loaded. Users accessing the data model in the Power BI service are only able to use the existing groups and hierarchies. Groups and hierarchies can also be created in DirectQuery data models. Calculated columns can be created in DirectQuery models too, though performance can be negatively impacted.</p>
    <h2 id="calibre_link-1525" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Grouping is also available <a id="calibre_link-525" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for date and <a id="calibre_link-110" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>numerical data type columns and includes the concept of "binning," or grouping based upon values falling into particular ranges. For example, the <strong class="screentext">ListPrice</strong> column from the <strong class="screentext">Products</strong> table can be divided into equally sized bins for analysis across the ranges of prices. The specific size of a bin or a set number of bins can be selected. A similar dialog is available for date data types.</p>
    <figure class="mediaobject"><img src="images/000237.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.43: Grouping Bins for Numeric Data Type Column</p>
    <h2 id="calibre_link-1526" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">DAX function reference: <a href="http://bit.ly/3rrQFlt" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3rrQFlt</span></a></li>
      <li class="bullet">Use grouping and binning in Power BI Desktop: <a href="http://bit.ly/2pALaBc" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2pALaBc</span></a></li>
    </ul>
    <h1 id="calibre_link-1209" class="title">Designing Column Level Security</h1>
    <p class="book-title--packt">While not as common<a id="calibre_link-150" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> as <strong class="screentext">row-level security</strong> (<strong class="screentext">RLS</strong>), there are times when you may wish to hide particular columns in a data model from one group of report viewers, but not others. Power BI Desktop does not natively support column security. However, a carefully designed data model can achieve column level security using Power BI's native RLS functionality.</p>
    <p class="book-title--packt">It should be noted that Microsoft has recently released <strong class="screentext">object-level security</strong> (<strong class="screentext">OLS</strong>) for securing tables and columns in Power BI Premium and Pro. This method of securing objects currently requires third-party tools, such as Tabular Editor. In addition, this method has the advantage of securing even the metadata about the objects such that report viewers without access will not even know that the tables and columns exist in the model. However, there are disadvantages to OLS as well; namely, by completely hiding the tables and columns in the model, it becomes difficult to create measures and report visualizations that work for a variety of users with and without access to certain tables and columns. This is such an issue that you may well conclude that it is not worth the time and trouble, and the reports should indeed be separate data models. </p>
    <p class="book-title--packt">This recipe demonstrates a method of implementing column level security in Power BI Desktop that does not require OLS and works natively with Power BI Desktop at any licensing level. While the metadata about the secured column is viewable with report viewers without access to the secured column's values, this method has the advantage of being easier to author measures and report visualizations that work at any level of security within the model.</p>
    <h2 id="calibre_link-1527" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <strong class="screentext">Data Sources</strong> and disable loading.</li>
      <li class="calibre12">Add a query <a id="calibre_link-151" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>called <strong class="screentext">Reseller Sales Intermediate</strong> that references the <strong class="screentext">AdWorksDW</strong> query, imports the <strong class="screentext">FactResellerSales</strong> table, and adds an <strong class="screentext">Index</strong> column starting at 1:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_FactResellerSales = Source{[Schema="dbo",Item="FactResellerSales"]}[Data],
    Index = 
        Table.AddIndexColumn(dbo_FactResellerSales, "Index", 1, 1, Int64.Type)
in
    Index
</code></pre>
      </li>
      <li class="calibre12">Add a query called <strong class="screentext">Reseller Sales</strong> that references the <strong class="screentext">Reseller Sales Intermediate</strong> query and removes the <strong class="screentext">ProductStandardCost</strong> and <strong class="screentext">TotalProductCost</strong> columns:
        <pre class="programlisting"><code class="hljs">let
    Source = #"Reseller Sales Intermediate",
    RemoveColumns = 
        Table.RemoveColumns(Source,{"ProductStandardCost", "TotalProductCost"})
in
    RemoveColumns
</code></pre>
      </li>
      <li class="calibre12">Add a query called <strong class="screentext">Reseller Costs</strong> that references the <strong class="screentext">Reseller Sales Intermediate</strong> query and selects the <strong class="screentext">ProductTotalCost</strong>, <strong class="screentext">TotalProductCost</strong>, and <strong class="screentext">Index</strong> columns.
        <pre class="programlisting"><code class="hljs">let
    Source = #"Reseller Sales Intermediate",
    SelectColumns = 
        Table.SelectColumns(
            Source,{"ProductStandardCost", "TotalProductCost", "Index"})
in
   SelectColumns
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Reseller Sales</strong> and <strong class="screentext">Reseller Sales</strong> queries to a query group called <strong class="screentext">Facts</strong>, and the <strong class="screentext">Reseller Sales Intermediate</strong> query to the <strong class="screentext">Other Queries</strong> query group.</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> in the ribbon of the <strong class="screentext">Home</strong> tab to load the tables to the data model.</li>
    </ol>
    <h2 id="calibre_link-1528" class="calibre8">How to Design Column Level Security</h2>
    <p class="book-title--packt">To implement this <a id="calibre_link-152" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a relationship between the <strong class="screentext">Reseller Costs</strong> and <strong class="screentext">Reseller Sales</strong> tables using the <strong class="screentext">Index</strong> columns in both tables. Set this relationship to be one-to-many with the <strong class="screentext">Reseller Sales</strong> table on the <strong class="screentext">One</strong> side and the <strong class="screentext">Reseller Costs</strong> table on the <strong class="screentext">Many</strong> side.<figure class="mediaobject"><img src="images/000250.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.44: Many-to-one relationship required</p>
      </li>
      <li class="calibre12">Click <strong class="screentext">Manage roles</strong> in the ribbon of the <strong class="screentext">Home</strong> tab in the <strong class="screentext">Model</strong> view or the <strong class="screentext">Modeling</strong> tab in the <strong class="screentext">Report</strong> view.</li>
      <li class="calibre12">Use the <strong class="screentext">Create</strong> button to create a <strong class="screentext">Sales Person</strong> role with RLS on the <strong class="screentext">Reseller Cost</strong> table with the DAX formula, <code class="code-in-text--packt">ISBLANK([Index])</code>, and <strong class="screentext">Save</strong> the role.<figure class="mediaobject"><img src="images/000261.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.45: Manage roles dialog box</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">Report</strong> view, create a simple <strong class="screentext">Table</strong> visualization using the <strong class="screentext">SalesOrderNumber</strong> and <strong class="screentext">SalesAmount</strong> columns from the <strong class="screentext">Reseller Sales</strong> table, and the <strong class="screentext">ProductStandardCost</strong> and <strong class="screentext">TotalProductCost</strong> columns from the <strong class="screentext">Reseller Costs</strong> table. Note that values are displayed for all columns.</li>
      <li class="calibre12">Click on <strong class="screentext">View</strong> <strong class="screentext">as</strong> in the ribbon of the <strong class="screentext">Modeling</strong> tab, select <strong class="screentext">Sales Person</strong>, and then click the <strong class="screentext">OK</strong> button.<figure class="mediaobject"><img src="images/000272.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.46: View as roles dialog</p>
      </li>
      <li class="calibre12">Wait for the <a id="calibre_link-153" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>visualization to refresh and notice that the <strong class="screentext">ProductStandardCost</strong> and <strong class="screentext">TotalProductCost</strong> columns are now blank.<figure class="mediaobject"><img src="images/000285.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 3.47: Viewing as a role</p>
    <h2 id="calibre_link-1529" class="calibre8">How it works</h2>
    <p class="book-title--packt">The keys to this recipe are the implementation of the <strong class="screentext">Index</strong> column in an intermediate query, the characteristics of the relationship between the <strong class="screentext">Reseller Sales</strong> and <strong class="screentext">Reseller</strong> <strong class="screentext">Costs</strong> tables, and the implementation of RLS via the <strong class="screentext">Sales Person</strong> role.</p>
    <p class="book-title--packt">Since the <strong class="screentext">Index</strong> column is created in an intermediate table that both the <strong class="screentext">Reseller Sales</strong> and <strong class="screentext">Reseller Costs</strong> queries reference as their <strong class="screentext">Source</strong>, we can be certain that there is a one-to-one match between the rows in the <strong class="screentext">Reseller Sales</strong> and <strong class="screentext">Reseller Costs</strong> tables.</p>
    <p class="book-title--packt">It is vitally important that the relationship between the <strong class="screentext">Reseller Sales</strong> and <strong class="screentext">Reseller Costs</strong> tables be one-to-many and have a <strong class="screentext">Single</strong> cross-filter direction, even though there is technically a one-to-one relationship between the tables. The reason is that one-to-one relationships must be bidirectional. This means that the DAX RLS rule that filters out all rows in the <strong class="screentext">Reseller Costs</strong> table would in turn filter out all rows in the <strong class="screentext">Reseller Sales</strong> table, which is not what is desired.</p>
    <p class="book-title--packt">The DAX RLS rule, <code class="code-in-text--packt">ISBLANK([Index])</code>, filters out all rows in the <strong class="screentext">Reseller Costs</strong> table for the <strong class="screentext">Sales Person</strong> role since <a id="calibre_link-1530" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Index</strong> column is never blank. Note that while the values are hidden, the metadata for the secured columns is still available in the model.</p>
    <h2 id="calibre_link-1531" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">There are alternative<a id="calibre_link-148" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> approaches to column level security. One such method is to have a single fact table and use measures to implement column security. In this approach, a dummy <strong class="screentext">Security</strong> table is created with a single column and row, containing a single value. A similar DAX RLS rule is created for roles such as <code class="code-in-text--packt">ISBLANK([Column])</code> for this dummy table. Using this method, all of the columns requiring security are hidden in the model and replaced with measures with a syntax similar to the following:</p>
    <pre class="programlisting"><code class="hljs">IF(ISBLANK(COUNTROWS('Security')),BLANK(),SUM('Reseller Sales'[TotalProductCost]))
</code></pre>
    <p class="book-title--packt">This approach could be extended to handle multiple roles requiring different column security for each role by having a single row per role in the <strong class="screentext">Security</strong> table with corresponding RLS rules such as <code class="code-in-text--packt">[Column] = "Sales Person"</code>, <code class="code-in-text--packt">[Column] = "Marketing"</code> and <code class="code-in-text--packt">[Column] = "Accounting"</code>. The DAX measures would be adjusted as appropriate. Note that while the values are hidden, the metadata for the secured columns is still available in the model. It&nbsp;is&nbsp;also possible to edit <strong class="screentext">Table Permissions</strong> in <strong class="screentext">Tabular Editor</strong>.</p>
    <figure class="mediaobject"><img src="images/000297.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.48: Table permissions for roles in Tabular Editor</p>
    <p class="book-title--packt">Unfortunately, this is<a id="calibre_link-149" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> not fully supported by Power BI Desktop.</p>
    <figure class="mediaobject"><img src="images/000309.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 3.49: Error in Power BI Desktop</p>
    <p class="book-title--packt">Finally, SSAS Tabular 2017 and newer versions implements true OLS that allows tables and columns to be completely shielded from <strong class="screentext">Roles</strong>, including their metadata. Azure Analysis Services and Power BI Premium also support OLS.</p>
    <h2 id="calibre_link-1532" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Column Level Security: <a href="http://bit.ly/2P5Gc20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2P5Gc20</span></a></li>
      <li class="bullet">Analysis Services tabular model object-level security: <a href="http://bit.ly/2PEbCMs" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2PEbCMs</span></a></li>
      <li class="bullet">Object Security in Analysis Services 2017: <a href="http://bit.ly/39m1P4S" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/39m1P4S</span></a></li>
      <li class="bullet">Announcing public preview of Object-Level Security in Power BI: <a href="https://bit.ly/3x182N0" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3x182N0</span></a></li>
    </ul>
    <h1 id="calibre_link-1210" class="title">Leveraging Aggregation Tables</h1>
    <p class="book-title--packt">DirectQuery mode <a id="calibre_link-396" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is a great tool for overcoming the scalability issues of Import mode, or for providing real-time reporting to business users. However, DirectQuery can be slow and place a lot of strain on the backend server system, since every visual refresh and interaction causes queries to be sent to the source system. Aggregation tables and dual-mode storage tables<a id="calibre_link-39" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> were designed to fix the speed issues associated with using DirectQuery against large datasets in the millions, billions, and trillions of rows. In essence, aggregation tables pre-aggregate data and store it in Import mode. Power BI uses these aggregation tables behind the scenes when possible to limit the number of queries sent to the data source.</p>
    <p class="book-title--packt">This recipe demonstrates how to create and configure an aggregation table for use in Power BI reports.</p>
    <h2 id="calibre_link-1533" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Create a DirectQuery query called <strong class="screentext">Internet Sales</strong> that accesses the <strong class="screentext">FactInternetSales</strong> table.</li>
      <li class="calibre12">Create a DirectQuery query called <strong class="screentext">Customers</strong> that accesses the <strong class="screentext">DimCustomers</strong> table.</li>
      <li class="calibre12">Create a DirectQuery query called <strong class="screentext">Dates</strong> that accesses the <strong class="screentext">DimDates</strong> table.</li>
      <li class="calibre12">Add a query called <strong class="screentext">Sales Agg </strong>using the following code (edit the <strong class="screentext">Source</strong> line):
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019"),
    Navigation = Source{[Schema="dbo",Item="FactInternetSales"]}[Data],
    Group = 
        Table.Group(Navigation, {"OrderDateKey", "CustomerKey"}, 
        {{"SalesAmount_Sum", each List.Sum([SalesAmount]), type number}, 
        {"UnitPrice_Sum", each List.Sum([UnitPrice]), type number}}),
    ChangeType = 
        Table.TransformColumnTypes(Group,
            {{"SalesAmount_Sum", Currency.Type}, 
             {"UnitPrice_Sum", Currency.Type}} )
in
    ChangeType
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> query to a query group called <strong class="screentext">Facts</strong>, the <strong class="screentext">Customers</strong> and <strong class="screentext">Dates</strong> queries to a query group called <strong class="screentext">Dimensions</strong>, and the <strong class="screentext">Sales Agg </strong>query to the <strong class="screentext">Other Queries</strong> query group.</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> on the ribbon of the <strong class="screentext">Home</strong> tab to load the tables to the data model.</li>
      <li class="calibre12">Create the<a id="calibre_link-40" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following <strong class="screentext">Single-direction</strong>, one-to-many relationships in the model, as shown in <em class="italic">Figure 3.50</em>.<figure class="mediaobject"><img src="images/000321.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 3.50: Model relationships</p>
    <p class="book-title--packt">Note that you may have to use <strong class="screentext">Database credentials</strong> for your data source instead of <strong class="screentext">Windows credentials</strong>. In testing, we experienced problems using <strong class="screentext">Windows credentials</strong> when attempting to create relationships with the <strong class="screentext">Sales Agg</strong> table and the dimension tables.</p>
    <h2 id="calibre_link-1534" class="calibre8">How to do it</h2>
    <p class="book-title--packt">To implement<a id="calibre_link-41" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Model</strong> view, right-click the <strong class="screentext">Sales Agg</strong> table and choose <strong class="screentext">Manage aggregations</strong>.</li>
      <li class="calibre12">Create the aggregations shown below for the <strong class="screentext">Sales Agg</strong> table and then click on the <strong class="screentext">Apply all</strong> button.<figure class="mediaobject"><img src="images/000332.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 3.51: Manage aggregations dialog</p>
      </li>
      <li class="calibre12">While in the <strong class="screentext">Model</strong> view, select the <strong class="screentext">Customers</strong> table, and in the <strong class="screentext">Advanced</strong> area of the <strong class="screentext">Properties</strong> pane, set the <strong class="screentext">Storage mode</strong> to <strong class="screentext">Dual</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">step 3</em> for the <strong class="screentext">Dates</strong> table.</li>
      <li class="calibre12">Open <strong class="screentext">SQL Server Profiler</strong> from the <strong class="screentext">Tools</strong> menu of SQL Server Management Studio and run a trace.</li>
      <li class="calibre12">Create a <strong class="screentext">Table</strong> visualization with the <strong class="screentext">EnglishEducation</strong> column from the <strong class="screentext">Customers</strong> table, and the <strong class="screentext">SalesAmount</strong> column from the <strong class="screentext">Internet Sales</strong> table. Note that nothing is logged in the trace.</li>
      <li class="calibre12">Create a <strong class="screentext">Clustered column chart</strong> with the <strong class="screentext">CalendarYear</strong> column from the <strong class="screentext">Dates</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">SalesAmount</strong> column from the <strong class="screentext">Internet Sales</strong> table as <strong class="screentext">Values</strong>. Again, nothing is logged.</li>
    </ol>
    <h2 id="calibre_link-1535" class="calibre8">How it works</h2>
    <p class="book-title--packt">It is imperative that <a id="calibre_link-42" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the core fact table, <strong class="screentext">Internet Sales</strong>, be set to <strong class="screentext">DirectQuery</strong> storage mode, as aggregation tables only work with detail tables that are set to <strong class="screentext">DirectQuery</strong> storage mode. The aggregation table itself, <strong class="screentext">Sales Agg</strong>, must be set to <strong class="screentext">Import</strong> storage mode. The two-dimensional tables, <strong class="screentext">Customers</strong> and <strong class="screentext">Dates</strong>, that have relationships to both the <strong class="screentext">Internet Sales</strong> table and the <strong class="screentext">Sales Agg</strong> table, should be set to <strong class="screentext">Dual</strong> storage mode so that these tables can operate optimally in either mode. Configuring aggregation for a table automatically hides the table in the data model, as aggregation tables must be hidden.</p>
    <p class="book-title--packt">Relationships must exist between the dimension tables and the aggregation table. This is because the aggregation table is used as a surrogate to the detailed, <strong class="screentext">DirectQuery</strong> mode fact table when possible, and thus the aggregation table should have the same relationships to dimension tables as the fact table.</p>
    <p class="book-title--packt">It is also important to keep column datatypes in mind when configuring aggregations. This is because the <strong class="screentext">Manage aggregations</strong> dialog box enforces the rule that the <strong class="screentext">Detail Column</strong> must have the same datatype as the <strong class="screentext">Aggregation Column</strong>. The only exception to this rule is for <strong class="screentext">Summarizations</strong> of <strong class="screentext">Count</strong> and <strong class="screentext">Count table rows</strong>. <strong class="screentext">Count</strong> and <strong class="screentext">Count table rows </strong>require<strong class="screentext"> </strong>integer aggregation columns but do not require matching datatypes for the <strong class="screentext">Detail Column</strong>. </p>
    <p class="book-title--packt">Additional restrictions include chained aggregations, the use of inactive relationships supported by the DAX <code class="code-in-text--packt">USERELATIONSHIP</code> function, and duplicate aggregations using the same <strong class="screentext">Summarization</strong>, <strong class="screentext">Detail Table</strong>, and <strong class="screentext">Detail Column</strong>. None of those scenarios are supported.</p>
    <h2 id="calibre_link-1536" class="calibre8">There's more...</h2>
    <p class="book-title--packt">In order to operate properly, RLS expressions should filter the detail table as well as the aggregation table. In fact, once aggregations have been set on a table, RLS expressions that only filter the aggregation table and not the associated <strong class="screentext">Detail Table</strong> are not allowed by the <strong class="screentext">Manage roles</strong> dialog box.</p>
    <p class="book-title--packt">The <strong class="screentext">Manage roles</strong> dialog box includes the ability to set <strong class="screentext">Precedence</strong>. This means that you can have multiple aggregation tables at different granularities, and set these aggregation tables' <strong class="screentext">Precedence</strong> to allow them to be considered by a single subquery. For example, if the <strong class="screentext">Products</strong> table was included in this model, you might create an aggregation table for <strong class="screentext">Product Category</strong> and a separate aggregation table for <strong class="screentext">Product Subcategory</strong>. You would set the granularity of the aggregation table for <strong class="screentext">Product Category</strong> to 10, and the granularity of the aggregation table for <strong class="screentext">Product Subcategory</strong> to 0. Subqueries will consider the aggregation table with the highest granularity first, and if that level of granularity is not sufficient, it will consider other aggregation tables of lower granularity.</p>
    <h2 id="calibre_link-1537" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Use aggregations in Power BI Desktop: <a href="http://bit.ly/2Pgckjp" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2Pgckjp</span></a></li>
      <li class="bullet">Power BI Fast and Furious with Aggregations: <a href="https://bit.ly/3cpReI1" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3cpReI1</span></a></li>
    </ul>
    <h1 id="calibre_link-1211" class="title">Conclusion</h1>
    <p class="book-title--packt">In this chapter, we explored the primary processes of designing and developing robust data models in Power BI Desktop. Common data modeling challenges, including multiple grains and many-to-many relationships, were shown to be handled relatively easily with standard Power BI features. In addition, examples were provided for adding business logic and definitions developed using the DAX language. Finally, use cases for increasing the value and sustainability of models via metadata settings and advanced features were explored.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-4">
<div id="calibre_link-1538" class="calibre2">
<div id="calibre_link-1539" class="calibre3"><div id="calibre_link-1540" class="calibre4">
    <h1 class="heading">4</h1>
    <h1 id="calibre_link-1212" class="title">Authoring Power BI&nbsp;Reports</h1>
    <p class="book-title--packt">Power BI reports serve as the basic building blocks for dashboards, data exploration, and content collaboration and distribution in Power BI. Power BI Desktop provides abundant data visualization features and options, enabling the construction of highly targeted, user-friendly reports across devices. As each Power BI Desktop report can contain multiple pages with each page including multiple visuals, a single Power BI report can support multiple use cases, audiences, and business needs. For example, a KPI visual can be pinned to a dashboard in the Power BI Service, while a report page can support detailed, domain-specific analysis. These capabilities compete directly with visualization offerings from competitor analytics platforms and can be further extended with custom visuals and report themes.</p>
    <p class="book-title--packt">The selection and configuration of Power BI visualization features in report design are essential to derive value from the data retrieval and modeling processes covered in <em class="italic">Chapter 2</em>, <em class="italic">Accessing and Retrieving Data</em>, and <em class="italic">Chapter 3</em>, <em class="italic">Building a Power BI Data Model</em>, respectively. In this chapter, we develop and describe the most fundamental report visualizations and design concepts. Additionally, guidance is provided to enhance and control the user experience when interacting with Power BI reports and consuming them on both Windows and mobile devices.</p>
    <p class="book-title--packt">In this chapter, we will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Building Rich and Intuitive Reports</li>
      <li class="bullet">Filtering at Different Scopes</li>
      <li class="bullet">Integrating Card Visualizations</li>
      <li class="bullet">Using Slicers</li>
      <li class="bullet">Controlling Visual Interactions</li>
      <li class="bullet">Utilizing Graphical Visualizations</li>
      <li class="bullet">Creating Table and Matrix visuals</li>
      <li class="bullet">Enhancing Reports</li>
      <li class="bullet">Formatting Reports for Publication</li>
      <li class="bullet">Designing Mobile Layouts</li>
      <li class="bullet">Creating Paginated Reports</li>
    </ul>
    <h1 id="calibre_link-1213" class="title">Technical Requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop and a Power BI service account.</li>
      <li class="bullet">Tabular Editor.</li>
      <li class="bullet">SQL Server with the AdventureWorksDW2019 database installed. This database and instructions for installing are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a>.</li>
      <li class="bullet"><code class="code-in-text--packt">CH4_Start.pbix</code> contains the model used for this chapter and can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a>.</li>
    </ul>
    <h1 id="calibre_link-1214" class="title">Building Rich and Intuitive Reports</h1>
    <p class="book-title--packt">Power BI Desktop provides the means to design reports that are both highly customized to specific use cases and requirements and aligned with a corporate BI standard. The design and development <a id="calibre_link-953" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>process for a report should naturally flow from the data modeling process as the measures, relationships, and dimensions from the model are utilized to visualize and analyze business questions. As the purpose and scope of Power BI reports can range widely, from dashboard visualizations to interactive analytical experiences to role-specific detail reporting, it is essential that report authoring features are aligned closely to these distinct use cases.</p>
    <p class="book-title--packt">In this recipe, a report design planning process is shared to bring clarity to the primary design elements of Power BI reports, such as visualization types. Two finished report pages are described with supporting details included in the <em class="italic">How it works</em> section, and additional report design features and practices are discussed in <em class="italic">There's more...</em>.</p>
    <h2 id="calibre_link-1541" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">A stakeholder matrix can help structure the report design planning process around the needs of the different parties accessing the model and reports. The stakeholders or business units, such as <strong class="screentext">Merchandising</strong>, appear on the columns axis and replace the conformed dimensions (that is, <strong class="screentext">Product</strong> or <strong class="screentext">Vendor</strong>) that were used in the data warehouse bus matrix described in <em class="italic">Chapter 3</em>, <em class="italic">Building a Power BI Data Model.</em></p>
    <figure class="mediaobject"><img src="images/000344.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.1: Stakeholder matrix</p>
    <p class="book-title--packt">In this example, the data model contains the four highlighted fact tables: <strong class="screentext">Internet Sales</strong>, <strong class="screentext">Internet Sales Plan</strong>, <strong class="screentext">Reseller Sales</strong>, and <strong class="screentext">General Ledger</strong>. When there can be multiple stakeholders within a given business function with their own unique needs and use cases, these stakeholders <a id="calibre_link-954" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>can be added as columns to the stakeholder matrix. In Power BI, there are many options for meeting the unique needs of different stakeholders with the same data model and underlying retrieval and data architecture.</p>
    <h2 id="calibre_link-1542" class="calibre8">How to Build Reports</h2>
    <p class="book-title--packt">While report development should be an agile process where feedback is regularly solicited from stakeholders as the report is designed and developed, having a solid planning and design process for a report upfront is extremely beneficial in understanding the scope and requirements of it. A single report should not attempt to address unrelated business questions or meet the needs of highly diverse users such as a corporate financial analyst or a store manager. Multi-scope reports can lead to convoluted user experiences and report-level customization that can be difficult to maintain and scale. The report planning and design process should answer the following five questions:</p>
    <ol class="calibre9">
      <li class="calibre12">Who will be accessing this report?</li>
      <li class="calibre12">What are the top priorities of this report in terms of business questions?</li>
      <li class="calibre12">How will the report be accessed and utilized?</li>
      <li class="calibre12">What is the velocity of data required, and does this impact the model?</li>
      <li class="calibre12">Is Power BI the right tool for the report?</li>
    </ol>
    <p class="book-title--packt">Regarding the first of these questions, just like a PowerPoint presentation, report pages should support a single theme <a id="calibre_link-955" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and target a specific audience. As per the stakeholder matrix, there are often many disparate users and use cases for a given data model. Consider the following:</p>
    <ul class="calibre9">
      <li class="bullet">If identified users have highly disparate needs, choose one user role and address the others separately.</li>
      <li class="bullet">Page-level filtering and row-level security can provide a robust solution for a single team.</li>
      <li class="bullet">Reports for various teams can be developed quickly if models include the required data and grain.</li>
      <li class="bullet">Users deeply familiar with the data require less in the way of titles and descriptive text and labels.</li>
      <li class="bullet">It is recommended to involve the business users or a representative early on in the report design process, and potentially before all elements of the data model are complete. Any initial iterations of the report and feedback can contribute to the design of the final report to be published.</li>
    </ul>
    <p class="book-title--packt">The second question can be addressed as follows: The prioritized business questions directly drive visualization choices, such as line/bar charts and tables. If the trend or fluctuations of measures is the top priority, then line charts, with custom scales and supporting trend and reference lines, may be chosen. If precise individual data points are required, either<em class="italic"> </em>as standalone numbers or in relation to one or two dimensions, then cards, KPIs, and tables or matrices should be used. The choice of visuals and the visuals' sizes, colors, and positioning on the canvas relative to other visuals should not be an arbitrary decision or guess. Consider the following:</p>
    <ul class="calibre9">
      <li class="bullet">Establish the starting point for the analysis, including measures and grain such as weekly sales.</li>
      <li class="bullet">Stakeholders often have many related questions and need to navigate the model quickly.</li>
      <li class="bullet">Additional drilling and filtering features can be added to a report's starting point.</li>
      <li class="bullet">Standard line, bar/column, and scatter chart visualizations have natural advantages in terms of visual perception and user comprehension. Other visuals should be utilized <a id="calibre_link-1543" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for their specific use cases and strengths, such as a Funnel visualization for stages of a process and a Waterfall visualization for the contributions of dimension values to an overall total.</li>
    </ul>
    <p class="book-title--packt">How will the report be accessed and utilized? How a report will be accessed and how business users desire to interact with the report are key questions that should be answered before beginning report development. Report access and interactivity are key components that a report designer should understand in order to ensure that the report contains the proper elements, views, filters, and measures. Consider the following:</p>
    <ul class="calibre9">
      <li class="bullet">Will users only view the report, or is the report a starting point for further analysis?</li>
      <li class="bullet">If there is no interaction or limited interaction desired, plan to embed conditional logic and exceptions in the report.</li>
      <li class="bullet">If there is high interaction, plan to use hierarchies, tooltips, and slicers to enable data exploration.</li>
      <li class="bullet">How does the report relate to existing dashboards?</li>
      <li class="bullet">Identify the components of the report that will contribute to an existing dashboard.</li>
      <li class="bullet">If creating a new dashboard based on the report, identify the tiles and interaction.</li>
      <li class="bullet">Will the report only be accessed via the web browser, or will mobile devices be used regularly?</li>
      <li class="bullet">If mobile consumption is expected, reports can be designed to optimize this experience.</li>
      <li class="bullet">Power BI dashboards can also be optimized for phone layout in the Power BI service.</li>
    </ul>
    <p class="book-title--packt">What is the velocity of data required, and does this impact the model? The velocity of data required can impact the chosen storage mode, whether that is Import, DirectQuery, or Dual mode, or even streaming datasets. An Import mode model may work fine for business users that only need data to be refreshed once or twice a day, but business users with more immediate velocity may be better served by a DirectQuery model. Other factors can also influence the need to revise a data model, including:</p>
    <ul class="calibre9">
      <li class="bullet">If a report requirement is systemic to all reports for a stakeholder group, consider revising the model.</li>
      <li class="bullet">If complex report-level customization is required, or if the performance is poor, consider revising the model.</li>
      <li class="bullet">These revisions often include new logical attributes or new DAX measures.</li>
    </ul>
    <p class="book-title--packt">Finally, it's critical to understand that Power BI reports created in Power BI Desktop are not appropriate for every report type. Report requirements such as multi-page printing, email subscriptions with data attached in various file formats, and pixel-perfect formatting control are much more closely aligned with paginated reports created in Power BI Report Builder. Similarly, financial statement and accounting reports with custom layouts involving cell-level control and formatting are generally more suited for Excel. Thankfully these other two report types are fully supported in Power BI such that solutions can be developed that include all three distinct report types. </p>
    <h2 id="calibre_link-1544" class="calibre8">How it works</h2>
    <p class="book-title--packt">In this example, the stakeholder is the European Sales Territory Group, comprised of France, Germany, and the United Kingdom. The planning process revealed two primary types of users. The first type of user is the Europe Sales Group manager, who manages the entire sales territory. The second type of user is those managers that are responsible for the individual countries.</p>
    <p class="book-title--packt">The top priorities identified are viewing and analyzing Internet Sales versus Plan, Reseller Sales, and sales margins at the monthly grain&mdash;by country and by product breakdowns in relation to category, subcategory, and model. The country managers desire a more granular geographic data at the state/province, city, and postal code levels. The overall organization operates on a fiscal calendar for accounting purposes, but the business stakeholders desire that the report uses calendar months when reporting data, instead of fiscal months. The business is also interested in comparing customers counts with internet sales over time.</p>
    <p class="book-title--packt">With regard to how the reports will be accessed and utilized, the Europe Sales Group Manager needs key facts, figures, and trends for the entire European Sales Territory; the manager is not expected to interact heavily with the report, but should still have the opportunity to drill into the data if desired. The Europe Sales Group Manager desires a mobile report that they can view on their phones, since this individual is often traveling between countries and so is constantly mobile. The individual country managers desire the ability to analyze their own data in a highly interactive manner. Country-level managers are also accountable for the sales plan, but are interested in greater self-service flexibility and require some detailed reporting in tabular formats to expose specific values for several measures. Country managers are expected to access the report from their desktops in a web browser.</p>
    <p class="book-title--packt">In terms of velocity, both Sales Group managers and country managers find it acceptable if the data is refreshed once or twice per day, given that the primary granularity of interest is monthly data. All parties also agree that using US English names, descriptions, and <a id="calibre_link-956" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>currency best meets the needs of the group. Given the requirements identified in the planning process, it is determined that the model must contain fact tables for Internet Sales, Reseller Sales, General Ledger, and Internet Sales Plan. In addition, the following dimensions are required: Products, Accounts, Customers with geographic data, Dates, Departments, Organizations, Employees, Resellers, Promotions, and Sales Territories. No single model currently contains all the information desired, and so it is determined that a new model will be developed.</p>
    <p class="book-title--packt">With the gathering of requirements completed, it is determined that the report will consist of two to four primary report pages, one page per country (or a single drill-through country page), and one page for the Europe Sales Group Manager. All the report pages will include the same four priority measures of Monthly Internet Sales, Monthly Internet Margin %, Monthly Reseller Sales, and Monthly Reseller Margin % in the top left, as well as an <strong class="screentext">Internet Sales to Plan</strong> chart displayed by calendar year and month. For the measures that do not have a target or goal (plan), a trailing 6-month average measure is used. </p>
    <p class="book-title--packt">Considering performance and usability, it is determined to limit the number of visuals per page to four or five and to avoid dense "data extract or dump" visuals. This limit does not apply to Cards, Gauges, and KPI visualizations. DAX queries are generated for report visuals, and the queries associated with dense visuals such as tables or matrices with many rows and columns are much slower than Cards and KPI visuals. Additionally, report pages with many visuals can appear crowded and be complex to use. Additionally, opportunities will be investigated to apply simple filters (<strong class="screentext">Current Year</strong> or <strong class="screentext">Prior Year</strong>) at the report and page levels to further aid performance. The report will be filtered by Europe at the report level and by the individual countries at the page level for these particular pages.</p>
    <p class="book-title--packt">A reliable predictor of a report's effectiveness is the ratio of business insights (measures, context, or analysis) to the user effort required to consume the information. Ideally, a report will offer out-of-the-box analytics that require nothing from the user beyond access and a basic knowledge of the terminology and domain. The more a user is required to scroll, click, and avoid unnecessary colors or data elements, the less effective the report will be.</p>
    <p class="book-title--packt">After planning and <a id="calibre_link-957" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>design, mock-ups of the report pages are created, shown to users, and refined.</p>
    <figure class="mediaobject"><img src="images/000355.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.2: Europe Monthly Sales and Margin Report page</p>
    <p class="book-title--packt"><em class="italic">Figure 4.2</em> is a mock-up of a report at a regional level, while <em class="italic">Figure 4.3</em> displays similar information at the country level.</p>
    <figure class="mediaobject"><img src="images/000366.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.3: United Kingdom report page</p>
    <p class="book-title--packt">Based on user feedback, a KPI visualization with a monthly trend and a goal measure is used to provide greater context compared to Card or Gauge visualizations. Overall, a standard visualization type with advantages in visual perception and additional analysis context was chosen. For example, KPIs were used instead of Card visuals; gauges, treemaps, and pie charts <a id="calibre_link-958" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>were avoided. A clustered column chart was chosen over a line chart for <strong class="screentext">Internet Sales to Plan</strong>, given the importance of the individual values for each month. At a glance, each country report page also offers values with the KPIs visuals updating automatically.</p>
    <p class="book-title--packt">Additional design decisions include the following:</p>
    <ul class="calibre9">
      <li class="bullet">The slicer visuals as well as the <strong class="screentext">Play</strong> axis on the scatter chart are organized on the left to support user filter selections. </li>
      <li class="bullet">By hovering over the bubbles in the map or the bars in the chart, additional measures are exposed as tooltips. </li>
      <li class="bullet">A textbox is used for the page titles, and the last refreshed date footer is a Card visual. An M query with the <code class="code-in-text--packt">DateTime.LocalNow</code> function is retrieved and passed to a DAX measure, returning text.</li>
      <li class="bullet">The chart titles are customized, and the <em class="italic">y</em>-axis is removed when possible.</li>
    </ul>
    <p class="book-title--packt">More details on the individual report components used in this example are contained within other recipes in this chapter.</p>
    <h2 id="calibre_link-1545" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Similar to the simple&mdash;yet important&mdash;details with data modeling shared in <em class="italic">Chapter 3</em>, <em class="italic">Building a Power BI Data Model</em>, a number of design practices significantly improve the value and user adoption of Power BI reports:</p>
    <ul class="calibre9">
      <li class="bullet"><strong class="screentext">Minimalism</strong>: Any report element that is not strictly required for comprehension should be removed. Examples include images, redundant chart axes, verbose text, and unnecessary <a id="calibre_link-811" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>data legends.</li>
      <li class="bullet"><strong class="screentext">Efficient visuals</strong>: Leverage visuals and features that provide additional insights with the same amount of space; examples include KPI and combination chart visuals, tooltips, trend lines, and color saturation.</li>
      <li class="bullet"><strong class="screentext">Meaningful colors</strong>: Colors should be used to convey meaning, such as high or low variances to a target or measure. Use colors selectively and avoid overwhelming or distracting users with color variety or density.</li>
      <li class="bullet"><strong class="screentext">Organized</strong>: Report visuals should be aligned, distributed evenly, and situated near related visuals. The most important visuals should be near the top-left corner of the canvas, and white space should separate visuals.</li>
      <li class="bullet"><strong class="screentext">Consistent</strong>: Layout and formatting choices, such as visual placement, fonts, and text alignment should be consistent. For example, slicer visuals should always be placed on the left or top of the visual.</li>
    </ul>
    <p class="book-title--packt">Regarding consistency, Power BI supports report themes that include a standard color palette, fonts, font sizes, and other metadata elements that control the defaults for reports and visualizations. Nearly every aspect of the default settings for a Power BI report can be controlled, including whether axis titles are shown, label orientation, legend markers, and essentially anything that appears in the <strong class="screentext">Format</strong> pane for pages and visualizations. </p>
    <p class="book-title--packt">Many organizations will have a standard report theme, or even standard report layouts. Often, these themes reflect the corporate brand and identity. In this example, a report theme is applied to a report such that users with color vision deficiency can comprehend it clearly:</p>
    <ul class="calibre9">
      <li class="bullet">Download the <strong class="screentext">Color Blind Friendly</strong> theme from the report theme gallery <a href="https://aka.ms/pbithemes" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://aka.ms/pbithemes</span></a>. Use <a id="calibre_link-140" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <code class="code-in-text--packt">ColorblindSafe-Longer.json</code> file.</li>
      <li class="bullet">Open <code class="code-in-text--packt">CH4_Start.pbix</code> in Power BI Desktop and save this file as <code class="code-in-text--packt">CH4_R1.pbix</code>.</li>
    </ul>
    <p class="book-title--packt">In the ribbon of the <strong class="screentext">View</strong> tab, click the drop-down arrow in the <strong class="screentext">Themes</strong> area and choose <strong class="screentext">Browse for themes</strong>:</p>
    <figure class="mediaobject"><img src="images/000377.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.4: Report Themes</p>
    <p class="book-title--packt">Browse to the downloaded JSON file, select it, and click <strong class="screentext">Open</strong>. A message will appear, stating that the theme was <a id="calibre_link-801" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>imported successfully. Theme settings will be applied to the report. The colors available for formatting visuals now reflect the theme's colors. Save <code class="code-in-text--packt">CH4_R1.pbix</code>.</p>
    <figure class="mediaobject"><img src="images/000387.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.5: Report Theme colors applied to Formatting Pane of Power BI Report</p>
    <p class="book-title--packt">Themes cannot be applied in the Power BI service, and some custom visuals do not apply report themes. Additionally, report themes do not impact the colors of images and do not override any custom color applied to a specific data point in a visual. It is important to apply themes early when developing reports to avoid situations where hours of formatting are suddenly undone after applying a theme!</p>
    <p class="book-title--packt">Each report theme JSON file has a structure of elements of color code mapping consistent with that shown in <em class="italic">Figure 4.6</em>.</p>
    <figure class="mediaobject"><img src="images/000399.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.6: Color Blind Report Theme JSON file structure</p>
    <p class="book-title--packt">Only the <strong class="screentext">Name</strong> field is required in the JSON file. Any number of distinct codes can be entered in the <code class="code-in-text--packt">dataColors</code> field.</p>
    <h2 id="calibre_link-1546" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Visualizations in Power BI reports: <a href="http://bit.ly/2poUeMv" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2poUeMv</span></a></li>
      <li class="bullet">Tips For <a id="calibre_link-800" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI Report Design &ndash; Best Practices: <a href="http://bit.ly/3fmfXPf" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3fmfXPf</span></a></li>
      <li class="bullet">Power BI Best Practices Guide: <a href="http://bit.ly/3cxCs29" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cxCs29</span></a></li>
      <li class="bullet">Power BI Community Themes Gallery: <a href="https://aka.ms/pbithemes" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://aka.ms/pbithemes</span></a></li>
      <li class="bullet">Use report themes in Power BI Desktop: <a href="http://bit.ly/31vBixz" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/31vBixz</span></a></li>
      <li class="bullet">Theme generator: <a href="https://themes.powerbi.tips/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://themes.powerbi.tips/</span></a></li>
    </ul>
    <h1 id="calibre_link-1215" class="title">Filtering at Different Scopes</h1>
    <p class="book-title--packt">Filters can be configured against Power BI reports at each level of the report architecture, including the entire report, the report page, and the individual visual. As report filters are configured at design time and not exposed on the canvas like slicers, filters provide a powerful, efficient <a id="calibre_link-698" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>method of customizing elements of reports to specific needs. Report- and page-level filters that align with the user or team accessing the report, or with specific entities to be analyzed, deliver <a id="calibre_link-951" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>immediate focus and a certain degree of organization. For example, a report page built for one product category can be duplicated for other <a id="calibre_link-487" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>product category pages, with each page containing a different page-level filter. Visual-level filters deliver greater flexibility, as complex filtering conditions, including measures, can be defined in addition to any report- and page-level filters.</p>
    <p class="book-title--packt">In this recipe, examples <a id="calibre_link-1107" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>are provided of implementing filters at the three different scopes. The <strong class="screentext">Top N</strong> visual-level filter condition is demonstrated in this section, and an example of the DAX queries generated by the filter types is shared in <em class="italic">How it works.</em></p>
    <h2 id="calibre_link-1547" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <code class="code-in-text--packt">CH4_R1.pbix</code> file and save it as <code class="code-in-text--packt">CH4_R2.pbix</code>.</li>
      <li class="calibre12">Rename <strong class="screentext">Page 1</strong> to <code class="code-in-text--packt">Europe</code> by right-clicking the page tab and choosing <strong class="screentext">Rename Page</strong>:<figure class="mediaobject"><img src="images/000411.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.7: Page renaming and creation</p>
      </li>
      <li class="calibre12">Use the <strong class="screentext">+</strong> icon to create <a id="calibre_link-488" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>four additional report pages named <strong class="screentext">France</strong>, <strong class="screentext">Germany</strong> and <strong class="screentext">United</strong><strong class="screentext"> </strong><strong class="screentext">Kingdom</strong>, and<strong class="screentext"> </strong><strong class="screentext">Scratch</strong>:<figure class="mediaobject"><img src="images/000423.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.8: Report pages</p>
      </li>
      <li class="calibre12">Save your work.</li>
    </ol>
    <h2 id="calibre_link-1548" class="calibre8">How to Filter at Different Scopes</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Switch to the <strong class="screentext">Europe </strong>page.</li>
      <li class="calibre12">In the <strong class="screentext">Fields</strong> pane, drag the <strong class="screentext">Sales Territory Group</strong> column from the <strong class="screentext">Sales</strong><strong class="screentext"> </strong><strong class="screentext">Territories </strong>table to the <strong class="screentext">Filters on all pages</strong> area in the <strong class="screentext">Filters</strong> pane.</li>
      <li class="calibre12">Select <strong class="screentext">Europe </strong>using <strong class="screentext">Basic filtering</strong>.<figure class="mediaobject"><img src="images/000434.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.9: Report-level filter for European Sales and Margin Monthly Report</p>
      </li>
      <li class="calibre12">Similarly, on the country pages for <strong class="screentext">France</strong>, <strong class="screentext">Germany</strong>, and <strong class="screentext">United</strong><strong class="screentext"> </strong><strong class="screentext">Kingdom</strong>, drag the <strong class="screentext">Sales Territory Country</strong> column from the <strong class="screentext">Sales Territories</strong> table in the <strong class="screentext">Fields</strong> pane to the <strong class="screentext">Filters on this page area</strong> in the <strong class="screentext">Filters</strong> pane,<strong class="screentext"> </strong>and select the respective <a id="calibre_link-1549" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>country for the page from <strong class="screentext">Basic filtering</strong>.</li>
      <li class="calibre12">Now select the <strong class="screentext">Scratch</strong> page.</li>
      <li class="calibre12">Create a <strong class="screentext">Table visualization</strong> by choosing the <strong class="screentext">Table visual</strong> from the <strong class="screentext">Visualizations</strong> pane, and then from the <strong class="screentext">Fields</strong> pane, add the <strong class="screentext">Sales Territory Country</strong> from the <strong class="screentext">Sales Territories</strong> table and the <strong class="screentext">Internet Gross Sales</strong> measure from the <strong class="screentext">Internet Sales</strong> table.</li>
      <li class="calibre12">Select the <strong class="screentext">Table visualization</strong>, and in the <strong class="screentext">Filters</strong> pane, expand the <strong class="screentext">Internet Gross Sales</strong> area in the <strong class="screentext">Filters on this visual</strong> section.</li>
      <li class="calibre12">Select <strong class="screentext">is greater than</strong> from the drop-down under <strong class="screentext">Show items when the value</strong>, and in the field below the drop-down type <code class="code-in-text--packt">3000000</code>.</li>
      <li class="calibre12">Click <strong class="screentext">Apply filter</strong> to apply the filter to the visual.<figure class="mediaobject"><img src="images/000445.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 4.10: Visual-level filter</p>
    <h2 id="calibre_link-1550" class="calibre8">How it works</h2>
    <p class="book-title--packt">Report-level filters affect all pages in a report; thus, when filters are applied to the <strong class="screentext">Filters on all pages</strong> area <a id="calibre_link-952" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of the <strong class="screentext">Filters</strong> pane, all visuals on all pages of the report respect this filter if a relationship to the dimension exists in the model and if DAX does not override the filter. For the report described in the previous recipe, it is determined that the European team does not need to view other sales groups or countries, and thus we filtered the <a id="calibre_link-489" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>entire report (all pages) for a <strong class="screentext">Sales Territory Group</strong> of <strong class="screentext">Europe</strong>. Similarly, page-level filters only affect the visuals on the page to which they are applied. Thus, we filtered each country page to the appropriate <strong class="screentext">Sales Territory Country</strong>. </p>
    <p class="book-title--packt">Report- and page-level filters are most commonly implemented at different levels of a dimension <a id="calibre_link-699" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>hierarchy that is relatively static and has few unique values, such as the example in this recipe. Date range filters should generally be applied either in the data <a id="calibre_link-324" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>retrieval queries or the report canvas, with visuals such as the date slicer. As these filters are applied to all visuals in the report or page, respectively, try to avoid filters against high-cardinality columns such as <strong class="screentext">ProductKey</strong> or <strong class="screentext">Sales Order Number</strong>. DAX measures cannot be used to define report- and page-level filters. </p>
    <p class="book-title--packt">Visual-level filters can be based on both measures and columns from the data model. These measures <a id="calibre_link-1146" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and columns can be present in the visualization or not present.</p>
    <p class="book-title--packt">The DAX queries created by Power BI reveal how the different layers of filters are implemented. Using DAX Studio, we can view the DAX variables used to store the report- and page-level filters (as well as slicer selections):</p>
    <figure class="mediaobject"><img src="images/000456.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.11: DAX report-level filter variable in DAX Studio</p>
    <p class="book-title--packt">Visual-level filters are also variables, but use the report- and page-level variables as inputs. The DAX queries created by Power BI take advantage of the latest functions and features, such as variables, <code class="code-in-text--packt">VAR</code>, and <code class="code-in-text--packt">TREATAS</code>.</p>
    <h2 id="calibre_link-1551" class="calibre8">There's more...</h2>
    <p class="book-title--packt">There are more advanced filtering options than just <strong class="screentext">Basic filtering</strong>. These include <strong class="screentext">Advanced filtering</strong> and <strong class="screentext">Top N</strong> filtering. Both text and numeric columns support AND conditions as <a id="calibre_link-1106" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>well as OR conditions to create more complex filter conditions. To see how <a id="calibre_link-35" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this works, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">Table </strong><strong class="screentext">vis</strong><strong class="screentext">ualization</strong> created on the <strong class="screentext">Scratch</strong> page.</li>
      <li class="calibre12">In the <strong class="screentext">Filters</strong> pane, clear the visual-level filter from <strong class="screentext">Internet Gross Sales</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">Sales Territory Country</strong> area in the <strong class="screentext">Filters on this visual</strong> section and switch the <strong class="screentext">Filter type</strong> to <strong class="screentext">Advanced filtering</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">contains</strong> from the <strong class="screentext">Show item when the value </strong>drop-down, type the letter <code class="code-in-text--packt">a</code><strong class="screentext"> </strong>in the field below, and then click <strong class="screentext">Apply filter</strong>. The <strong class="screentext">United Kingdom</strong> disappears from the <strong class="screentext">Table</strong> visualization.</li>
      <li class="calibre12">Clear this filter and change the <strong class="screentext">Filter type</strong> to <strong class="screentext">Top N</strong>.</li>
      <li class="calibre12">Under <strong class="screentext">Show items</strong>, choose <strong class="screentext">Top</strong> and type the number <code class="code-in-text--packt">2</code>.</li>
      <li class="calibre12">Drag the <strong class="screentext">Reseller Net Sales</strong> measure from the <strong class="screentext">Reseller Sales</strong> table to the <strong class="screentext">By value</strong> area and click <strong class="screentext">Apply filter</strong>. <strong class="screentext">Germany</strong> now disappears from the table.</li>
    </ol>
    <p class="book-title--packt">If complex filtering conditions are required, or if filters are needed against columns with many distinct values (for example, <strong class="screentext">Sales Order Number</strong>), it may be beneficial to account for this logic in the data retrieval or model, thus simplifying the DAX queries generated.</p>
    <p class="book-title--packt">Additionally, report-, page-, and visual-level filters can be overridden with DAX measures. To see how this works, create the following measure in the Sales Territories table:</p>
    <pre class="programlisting"><code class="hljs">Count Countries = COUNTROWS(ALL('Sales Territories'))
</code></pre>
    <p class="book-title--packt">Use a <strong class="screentext">Card </strong><strong class="screentext">visualization</strong> on the <strong class="screentext">Scratch</strong> page to display this new measure and observe that the measure's value is <strong class="screentext">11</strong>. Regardless of the report-, page-, and visual-level filters applied, this measure will always have a value of <strong class="screentext">11</strong>. The DAX function <code class="code-in-text--packt">ALL</code> overrides the filters being applied to the <strong class="screentext">Sales Territories</strong> table.</p>
    <h2 id="calibre_link-1552" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Filters and <a id="calibre_link-813" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>highlighting in Power BI reports: <a href="http://bit.ly/39y0msh" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/39y0msh</span></a></li>
      <li class="bullet">Types of filters in Power BI reports: <a href="http://bit.ly/3sBkMrQ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3sBkMrQ</span></a></li>
    </ul>
    <h1 id="calibre_link-1216" class="title">Integrating Card visualizations</h1>
    <p class="book-title--packt">Card and Multi-row Card visualizations are often positioned at the top and left sections of report pages, given the importance of individual measures and small sets of measures. Although less graphically powerful and interactive than other visuals, cards are also the most <a id="calibre_link-124" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>common tiles pinned to Power BI dashboards and are also used frequently in phone layouts for mobile consumption. A common practice in report design is to start with a few high-level measures represented as card or KPI visuals and build additional chart and Table visuals around these.</p>
    <p class="book-title--packt">This recipe demonstrates how to use card, Multi-row card, KPI, and Gauge visualizations&mdash;as well as text boxes.</p>
    <h2 id="calibre_link-1553" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <strong class="screentext">CH4_R2.pbix</strong> file and save it as <code class="code-in-text--packt">CH4_R3.pbix</code>.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Scratch</strong> page, and use <em class="italic">Ctrl-A</em> then <em class="italic">Delete</em> to remove any visuals.</li>
      <li class="calibre12">Check the <strong class="screentext">Filters</strong> pane and ensure that only the <strong class="screentext">Europe</strong> filter is active.</li>
    </ol>
    <h2 id="calibre_link-1554" class="calibre8">How to Integrate Card visualizations</h2>
    <p class="book-title--packt">To implement this recipe, carry out the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">Europe</strong> page.</li>
      <li class="calibre12">Create a <strong class="screentext">Card </strong><strong class="screentext">visualization</strong> using the <strong class="screentext">Visualizations</strong> pane and then in the <strong class="screentext">Fields</strong> list select the <strong class="screentext">Last Full Month</strong> measure from the <strong class="screentext">Calculations</strong> table.</li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, switch the <strong class="screentext">Category</strong> and <strong class="screentext">Background</strong> sliders to <strong class="screentext">Off</strong>.<figure class="mediaobject"><img src="images/000467.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.12: Format pane</p>
      </li>
      <li class="calibre12">Expand the <strong class="screentext">Data label</strong> section, set the <strong class="screentext">Text size</strong> to <strong class="screentext">18</strong> and the <strong class="screentext">Font family</strong> to <strong class="screentext">Segoe (Bold)</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">General</strong> section and set the <strong class="screentext">X Position</strong> to <strong class="screentext">0</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">0</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">448</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">48</strong>. It is generally considered better to set the <strong class="screentext">Width</strong> and <strong class="screentext">Height</strong> first, then the <strong class="screentext">X Position</strong> and <strong class="screentext">Y Position</strong>.</li>
      <li class="calibre12">Click a blank area of the page canvas and repeat steps <em class="italic">2</em>, <em class="italic">3</em>, and <em class="italic">4</em> to create another <strong class="screentext">Card </strong><strong class="screentext">visualization</strong> that displays the <strong class="screentext">Date Last Refreshed</strong> measure; in the <strong class="screentext">General</strong> section set the <strong class="screentext">X Position</strong> to <strong class="screentext">168</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">680</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">305</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">36</strong>.</li>
      <li class="calibre12">Click a blank area <a id="calibre_link-125" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of the page canvas, select <strong class="screentext">Text box</strong> in the ribbon of the <strong class="screentext">Insert</strong> tab, and type <code class="code-in-text--packt">Europe Monthly Sales and Margin Report</code>.</li>
      <li class="calibre12">Use <span>Ctrl-A</span> to select all of the text and then change the font to <strong class="screentext">Segoe (Bold)</strong>, set the text size to <strong class="screentext">18</strong>, and right-justify the text.<figure class="mediaobject"><img src="images/000478.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.13: Settings to select when formatting</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">Format text box</strong> pane, switch the <strong class="screentext">Background</strong> slider to <strong class="screentext">Off</strong>, and in the <strong class="screentext">General</strong> section set the <strong class="screentext">X Position</strong> to <strong class="screentext">624</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">0</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">656</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">48</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">Text box</strong> element just created and use <span>Ctrl-C</span> and then <span>Ctrl-V</span> to copy and paste the visual on the page.</li>
      <li class="calibre12">Reposition the new <strong class="screentext">Text box</strong> element, replace the text with <strong class="screentext">Last Refreshed:</strong> and left-justify the text.</li>
      <li class="calibre12">In the <strong class="screentext">General</strong> section of the <strong class="screentext">Format text box</strong> pane, set the <strong class="screentext">X Position</strong> to <strong class="screentext">0</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">675</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">190</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">45</strong>.</li>
      <li class="calibre12">Click a blank area of the canvas, and from the <strong class="screentext">Visualizations</strong> pane select the KPI visualization.</li>
      <li class="calibre12">From the <strong class="screentext">Fields</strong> list, expand the <strong class="screentext">Internet Sales</strong> Table and select the <strong class="screentext">Internet Monthly Net Sales</strong> measure as the <strong class="screentext">Indicator</strong>, and the <strong class="screentext">Internet Monthly Sales Goal</strong> measure as the <strong class="screentext">Target goals</strong>. From the <strong class="screentext">Dates</strong> table, use the <strong class="screentext">Year Month</strong> column as the <strong class="screentext">Trend axis</strong>.</li>
      <li class="calibre12">Format the KPI visual just created by expanding the <strong class="screentext">Title</strong> section, renaming the <strong class="screentext">Title</strong> to <strong class="screentext">Monthly Internet Sales</strong> and center-aligning the <strong class="screentext">Title</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Indicator</strong> section, set the <strong class="screentext">Display units</strong> to <strong class="screentext">Thousands</strong>, the <strong class="screentext">Value decimal places</strong> to <strong class="screentext">0</strong>, and the <strong class="screentext">Text size</strong> to <strong class="screentext">40</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">General</strong> section, set the <strong class="screentext">X Position</strong> to <strong class="screentext">0</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">48</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">225</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">122</strong>.</li>
      <li class="calibre12">Turn the <strong class="screentext">Border</strong> slider to <strong class="screentext">On</strong>, expand the <strong class="screentext">Border</strong> section, and set the <strong class="screentext">Radius</strong> to <strong class="screentext">5</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Goals</strong> section, change the <strong class="screentext">Label</strong> from <strong class="screentext">Percent</strong> to <strong class="screentext">Value</strong>.<figure class="mediaobject"><img src="images/000489.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.14: KPI visualization</p>
      </li>
      <li class="calibre12">Select the KPI visualization and use <span>Ctrl-C</span> and then <span>Ctrl-V</span> to copy and paste the visual.</li>
      <li class="calibre12">Reposition the <a id="calibre_link-126" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>new KPI visual on the page and replace the <strong class="screentext">Indicator</strong> and <strong class="screentext">Target goals</strong> with the <strong class="screentext">Internet Monthly Margin %</strong> and <strong class="screentext">Internet Monthly Margin % Goal</strong> measures from the <strong class="screentext">Internet Sales</strong> table, respectively.</li>
      <li class="calibre12">Format this new KPI visualization by changing <strong class="screentext">Title</strong> to <strong class="screentext">Monthly Internet Margin %</strong>, the <strong class="screentext">Indicator</strong> <strong class="screentext">Display units</strong> to <strong class="screentext">Auto</strong>, and in the <strong class="screentext">General</strong> section set the <strong class="screentext">X Position</strong> to <strong class="screentext">224</strong> and the <strong class="screentext">Y Position</strong> to <strong class="screentext">48</strong>.</li>
      <li class="calibre12">Hold down the <span>Ctrl</span> key and use your mouse to select both KPI visuals.</li>
      <li class="calibre12">Use <span>Ctrl-C</span> and <span>Ctrl-V</span><strong class="screentext"> </strong>to copy and paste both visuals<strong class="screentext"> </strong>and then reposition the visuals on the page.</li>
      <li class="calibre12">For the <strong class="screentext">Monthly Internet Sales</strong> visual, replace the <strong class="screentext">Indicator</strong> and <strong class="screentext">Target goals</strong> with the <strong class="screentext">Reseller Monthly Net Sales</strong> and <strong class="screentext">Reseller Monthly Sales Goal</strong> measures from the <strong class="screentext">Reseller Sales</strong> table, respectively.</li>
      <li class="calibre12">Format this new KPI visualization by changing <strong class="screentext">Title</strong> to <strong class="screentext">Monthly Reseller Sales</strong> and in the <strong class="screentext">General</strong> section set the <strong class="screentext">X Position</strong> to <strong class="screentext">0</strong> and the <strong class="screentext">Y Position</strong> to <strong class="screentext">168</strong>.</li>
      <li class="calibre12">For the <strong class="screentext">Monthly Internet Margin % </strong>visual, replace the <strong class="screentext">Indicator</strong> and <strong class="screentext">Target goals</strong> with the <strong class="screentext">Reseller Monthly Margin %</strong> and <strong class="screentext">Reseller Monthly Margin % Goal</strong> measures from the <strong class="screentext">Reseller Sales</strong> table, respectively.</li>
      <li class="calibre12">Format this new KPI visualization by changing <strong class="screentext">Title</strong> to <strong class="screentext">Monthly Reseller Margin %</strong> and in the <strong class="screentext">General</strong> section set the <strong class="screentext">X Position</strong> to <strong class="screentext">224</strong> and the <strong class="screentext">Y Position</strong> to <strong class="screentext">168</strong>.</li>
      <li class="calibre12">Click a blank <a id="calibre_link-127" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>area of the page canvas, then use <em class="italic">Ctrl-A</em> and <em class="italic">Ctrl-C</em> to select and copy all visualizations on the <strong class="screentext">Europe</strong> page.</li>
      <li class="calibre12">Switch to the <strong class="screentext">France</strong> page, use <em class="italic">Ctrl-V</em> to paste all of the visuals, and edit the <strong class="screentext">Text box</strong> in the upper right to read <strong class="screentext">France</strong> instead of <strong class="screentext">Europe</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">step 30</em> for the <strong class="screentext">Germany</strong> and <strong class="screentext">United Kingdom</strong> pages.</li>
      <li class="calibre12">Save your work.</li>
    </ol>
    <h2 id="calibre_link-1555" class="calibre8">How it works</h2>
    <p class="book-title--packt">To integrate Card visualizations most effectively, identify the following two items:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Which measures does the user need to have maximum visibility to (such as all devices, reports, and dashboards)?</li>
      <li class="calibre12">Which measures are available or can be created to serve as a target or goal to compare these measures to?</li>
    </ol>
    <p class="book-title--packt">Numbers without well-defined targets nor any trending indicators, such as standard Card visualizations, are simply less valuable than KPIs that provide this additional context. However, KPI visualizations require both an <strong class="screentext">Indicator</strong> and a <strong class="screentext">Trend axis</strong>. In addition, goal and target measures are one of the main benefits of integrating <strong class="screentext">Plan</strong> and <strong class="screentext">Budget</strong> fact tables into data models. If this integration is not an option, a historical average of the indicator measure such as the trailing three or six months can be used as the KPI's target goal. </p>
    <p class="book-title--packt">The data model used in this recipe actually does both. The <strong class="screentext">Internet Sales Plan</strong> table (hidden in <strong class="screentext">Report</strong> view) has internet sales plan numbers broken down by region, country, year, month, and product subcategory. This fact table is used for the <strong class="screentext">Internet Monthly Sales Goal </strong>measure. This measure looks at the <strong class="screentext">Today</strong> measure in the <strong class="screentext">Dates</strong> Table and determines the last fully completed month from <strong class="screentext">Today</strong>. Because we are dealing with the <strong class="screentext">AdventureWorksDW2019</strong> database where data is only posted until early 2014, we have set the <strong class="screentext">Today</strong> measure to be <strong class="screentext">1/28/2014</strong>. In a real-world scenario, the <strong class="screentext">Today</strong> measure would be set to be equal to the DAX <code class="code-in-text--packt">TODAY</code> function. The other goal measures are calculated using an average of the previous six months, after the last fully completed month. The measure that calculates this date is the <strong class="screentext">6 Months Ago</strong> measure in the <strong class="screentext">Dates</strong> table. </p>
    <p class="book-title--packt">Similarly, the target measures calculate their values for the most current, complete month, in this case December 2013. Alternatively, DAX measures could have been created that factored in <a id="calibre_link-1556" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the percentage of days completed in the month and applied that percentage to the target and goal measures.</p>
    <p class="book-title--packt">While the KPI visualization should be preferred when displaying numeric values, the Card visualization can also be used quite effectively to display dynamic text data, such as the <strong class="screentext">Date Last Refreshed</strong> column and <strong class="screentext">Last Refreshed</strong> measure. The formula for the <strong class="screentext">Last Refreshed</strong> measure is the following:</p>
    <pre class="programlisting"><code class="hljs">Last Full Month = "Last Full Month: " &amp; FORMAT(EOMONTH([Today],-1),"yyyy-mmm")
</code></pre>
    <p class="book-title--packt">The <strong class="screentext">Date Last Refreshed</strong> column was created using the following Power Query query:</p>
    <pre class="programlisting"><code class="hljs">let Source = #table(type table[Date Last Refreshed=datetime], {{DateTime.LocalNow()}}) in Source
</code></pre>
    <p class="book-title--packt">Static text information can be displayed using a simple <strong class="screentext">Text box</strong> element, such as the report/page title in the upper right and <strong class="screentext">Last Refreshed:</strong> in the lower left. However, text boxes can also be made dynamic via Q&amp;A functionality, accessed in the <strong class="screentext">Value</strong> and <strong class="screentext">Review</strong> dialogs of the <strong class="screentext">Text box</strong> formatting dialog.</p>
    <h2 id="calibre_link-1557" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Two additional card- and KPI-style visualizations are available in Power BI Desktop's default visualization <a id="calibre_link-567" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>library: the <strong class="screentext">Multi-row card</strong> and <strong class="screentext">Gauge</strong> visualizations. Multi-row cards are best organized around a common dimension and measure and are <a id="calibre_link-668" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>often placed to the right of <strong class="screentext">KPI</strong> or <strong class="screentext">Gauge</strong> visuals as supplemental details. To see <strong class="screentext">Multi-row Card </strong>visualizations in action, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Switch to the <strong class="screentext">Scratch</strong> page.</li>
      <li class="calibre12">Select the <strong class="screentext">Multi-row Card visualization</strong> from the <strong class="screentext">Visualizations</strong> pane and place the <strong class="screentext">Internet Customer Count France</strong>, <strong class="screentext">Internet Customer Count Germany</strong>, and <strong class="screentext">Internet Customer Count United Kingdom</strong> measures from the <strong class="screentext">Internet Sales</strong> table in the <strong class="screentext">Fields</strong> field of the visualization.<figure class="mediaobject"><img src="images/000415.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 4.15: Multi-row Card visualization</p>
    <p class="book-title--packt">Power BI Desktop also includes a <strong class="screentext">Gauge</strong> visualization that is a popular alternative to <strong class="screentext">Card</strong> and <strong class="screentext">KPI</strong> visualizations <a id="calibre_link-513" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for dashboards. To see the <strong class="screentext">Gauge</strong> visualization in action, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Copy the <strong class="screentext">Monthly Internet Sales</strong> KPI visualization from the <strong class="screentext">Europe</strong> page and paste it onto the <strong class="screentext">Scratch</strong> page.</li>
      <li class="calibre12">With the KPI visual selected, click the <strong class="screentext">Gauge</strong> visualization in the <strong class="screentext">Visualizations</strong> pane to convert the KPI visualization to a <strong class="screentext">Gauge</strong> visualization.</li>
      <li class="calibre12">Set the <strong class="screentext">Value</strong> to the <strong class="screentext">Internet Monthly Net Sales</strong> measure and the <strong class="screentext">Target value</strong> to the <strong class="screentext">Internet Monthly Sales Goal</strong> measure.<figure class="mediaobject"><img src="images/000448.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 4.16: Gauge visualization comparing two measures (Value to Target value)</p>
    <h2 id="calibre_link-1558" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><strong class="screentext">Key </strong><strong class="screentext"><a id="calibre_link-565" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">Performance Indicator</strong> (<strong class="screentext">KPI</strong>) visuals: <a href="http://bit.ly/3rFPxe7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3rFPxe7</span></a></li>
      <li class="bullet">Radial Gauge <a id="calibre_link-939" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>charts in Power BI: <a href="http://bit.ly/2PgtTjv" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2PgtTjv</span></a></li>
      <li class="bullet">Card <a id="calibre_link-123" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>visualizations (big number tiles): <a href="http://bit.ly/3uaMPib" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3uaMPib</span></a></li>
      <li class="bullet">Copy and paste <a id="calibre_link-195" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a visualization in Power BI: <a href="http://bit.ly/39vECNL" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/39vECNL</span></a></li>
      <li class="bullet">Get started <a id="calibre_link-824" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>formatting Power BI visualizations: <a href="http://bit.ly/3sGqzwm" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3sGqzwm</span></a></li>
    </ul>
    <h1 id="calibre_link-1217" class="title">Using Slicers</h1>
    <p class="book-title--packt">Slicer visuals are the primary means for users to apply filter selections to other visuals of a report page, and thus <a id="calibre_link-1005" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>their implementation greatly affects usability and analytical flexibility. Although user interaction with other visuals also applies cross-filtering to other visuals, slicers provide the fastest and most intuitive method to define specific filtering criteria, such as three specific months and two product categories. Slicer visuals also have unique formatting options for defining the selection behavior, including a <strong class="screentext">Select All</strong><strong class="screentext"> </strong>option.</p>
    <p class="book-title--packt">An alternative to slicers is the use of the Filter pane. While perhaps not as obvious to end users and requiring specific training, the use of the Filter pane as opposed to slicers does provide the benefit of preserving space on the Canvas. However, while the Filter pane can provide some of the basic usage scenarios common to slicers, slicers provide much greater flexibility in terms of interactions with different visuals on a page, synchronization of slicers across specific pages, and the layout and position of filtering elements relative to other visuals.</p>
    <p class="book-title--packt">In this recipe, we look at the primary use cases for slicers and the report design considerations, including selection properties and formatting options. The slicer filter configurations available for <strong class="screentext">Date</strong> data types are also reviewed, and additional details on text search and alternative slicer visuals are provided.</p>
    <h2 id="calibre_link-1559" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <code class="code-in-text--packt">CH4_R3.pbix</code> file and save the file as <code class="code-in-text--packt">CH4_R4.pbix</code>.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Scratch</strong> page and use <span>Ctrl-A</span> and then <em class="italic">Delete</em> to remove any visuals.</li>
      <li class="calibre12">Check the <strong class="screentext">Filters</strong> pane and ensure that only the <strong class="screentext">Europe</strong> filter is active.</li>
    </ol>
    <h2 id="calibre_link-1560" class="calibre8">How to Use Slicers</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">Europe</strong> page.</li>
      <li class="calibre12">Create a <strong class="screentext">Slicer</strong> visualization using the <strong class="screentext">Visualizations</strong> pane, and then in the <strong class="screentext">Fields</strong> list select the <strong class="screentext">Year Month</strong> column from the <strong class="screentext">Dates </strong>table.</li>
      <li class="calibre12">With the slicer selected, use the ellipses (<strong class="screentext">â¦</strong>) to change the sorting to <strong class="screentext">Sort descending</strong>.<figure class="mediaobject"><img src="images/000459.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.17: Slicer options</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, switch the <strong class="screentext">Slicer</strong> <strong class="screentext">header</strong> to <strong class="screentext">Off</strong>, the <strong class="screentext">Title</strong> to <strong class="screentext">On</strong>, and change the <strong class="screentext">Title</strong> to <strong class="screentext">Calendar Month</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, switch <strong class="screentext">Border</strong> to <strong class="screentext">On</strong> and set the <strong class="screentext">Radius</strong> to <strong class="screentext">5</strong>; in the <strong class="screentext">General</strong> section, set the <strong class="screentext">X Position</strong> to <strong class="screentext">0</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">295</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">160</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">178</strong>.</li>
      <li class="calibre12">Create a second <a id="calibre_link-1006" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>slicer for the <strong class="screentext">Product Category</strong> column in the <strong class="screentext">Products</strong> table. </li>
      <li class="calibre12">Right-click the <strong class="screentext">(Blank)</strong> option in the <strong class="screentext">Slicer</strong> and choose <strong class="screentext">Exclude</strong>. Repeat this for <strong class="screentext">Components</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, switch the <strong class="screentext">Slicer</strong> <strong class="screentext">header</strong> to <strong class="screentext">Off</strong>, the <strong class="screentext">Title</strong> to <strong class="screentext">On</strong>, and change the <strong class="screentext">Title</strong> to <strong class="screentext">Product Category</strong>.</li>
      <li class="calibre12">Also, in the <strong class="screentext">Format</strong> pane, switch <strong class="screentext">Border</strong> to <strong class="screentext">On</strong> and set the <strong class="screentext">Radius</strong> to <strong class="screentext">5</strong>; in the <strong class="screentext">General</strong> section, set the <strong class="screentext">X Position</strong> to <strong class="screentext">0</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">479</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">160</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">95</strong>.</li>
      <li class="calibre12">Use <span>Ctrl-C</span> and then <span>Ctrl-V</span> to copy and paste the <strong class="screentext">Product Category</strong> slicer.</li>
      <li class="calibre12">Reposition the new slicer on the page, replace the slicer's <strong class="screentext">Field</strong> with the <strong class="screentext">Sales Territory Country</strong> column from the <strong class="screentext">Sales Territories</strong> table, and edit the slicer's <strong class="screentext">Title</strong> to <strong class="screentext">Country</strong>.</li>
      <li class="calibre12">Edit the <strong class="screentext">Country</strong> slicer's <strong class="screentext">General</strong> settings to set the <strong class="screentext">X Position</strong> to <strong class="screentext">0</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">580</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">160</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">94</strong>.</li>
      <li class="calibre12">Select the three slicers and use <span>Ctrl-C</span> to copy.</li>
      <li class="calibre12">Switch to the <strong class="screentext">France</strong> page, use <span>Ctrl-V</span> to paste the slicers, and at the <strong class="screentext">Sync visuals</strong> prompt select <strong class="screentext">Sync</strong>.<figure class="mediaobject"><img src="images/000391.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.18: Sync visuals prompt</p>
      </li>
      <li class="calibre12">Select <strong class="screentext">Sync slicers</strong> from the ribbon of the <strong class="screentext">View</strong> tab, select the <strong class="screentext">Country</strong> slicer, and then uncheck <a id="calibre_link-1007" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the syncing for the <strong class="screentext">France</strong> page. The correct configuration is displayed in <em class="italic">Figure 4.19</em>.<figure class="mediaobject"><img src="images/000412.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.19: Sync slicer controls</p>
      </li>
      <li class="calibre12">Close the <strong class="screentext">Sync slicers</strong> pane, replace the <strong class="screentext">Country</strong> slicer's <strong class="screentext">Field</strong> with the <strong class="screentext">State/Province</strong> column from the <strong class="screentext">Customers</strong> table, and edit the <strong class="screentext">Title</strong> to be <strong class="screentext">Regions</strong>.</li>
      <li class="calibre12">Copy the <strong class="screentext">Calendar Month</strong> and <strong class="screentext">Product Category</strong> slicers to the <strong class="screentext">Germany</strong> and <strong class="screentext">United Kingdom</strong> pages, choosing to <strong class="screentext">Sync </strong>both times.</li>
      <li class="calibre12">Copy the <strong class="screentext">Regions</strong> slicer from the <strong class="screentext">France</strong> page to the <strong class="screentext">Germany</strong> and <strong class="screentext">United Kingdom</strong> pages, but this time choose <strong class="screentext">Don't sync</strong> in both instances.</li>
      <li class="calibre12">On the <strong class="screentext">Germany</strong> page, change the <strong class="screentext">Regions</strong> slicer's <strong class="screentext">Title</strong> to <strong class="screentext">States</strong>.</li>
      <li class="calibre12">On the <strong class="screentext">United Kingdom</strong> page, replace the <strong class="screentext">Regions</strong> slicer's <strong class="screentext">Field</strong> with the <strong class="screentext">City</strong> column from the <strong class="screentext">Customers</strong> table, and change the <strong class="screentext">Title</strong> to <strong class="screentext">Cities</strong>.</li>
      <li class="calibre12">On the <strong class="screentext">Europe</strong> page, select the following values in the <strong class="screentext">Calendar Month</strong> slicer: <strong class="screentext">2013-Dec</strong>,<strong class="screentext"> 2013-Nov</strong>,<strong class="screentext"> 2013-Oct</strong>,<strong class="screentext"> 2013-Sept</strong>,<strong class="screentext"> 2013-Aug</strong>, and <strong class="screentext">2013-Jul</strong>.</li>
      <li class="calibre12">When switching to other pages, the <strong class="screentext">Calendar Month</strong> slicer on those pages also has those selections.</li>
      <li class="calibre12">Save your work.</li>
    </ol>
    <h2 id="calibre_link-1561" class="calibre8">How it works</h2>
    <p class="book-title--packt">Slicers are important Power BI visuals, and so careful thought should be given when identifying slicer column(s). Typically, slicer columns are parent-level dimensions such as year or region with few individual values. Choosing a column with few values allows these items to be <a id="calibre_link-1008" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>exposed on the canvas as a list, instead of using a drop-down. Using too many slicers, or slicers with too many distinct values, detracts from the usability of report pages. Without significant DAX customization to interpret filter selections, users can be uncertain as to what filters have been applied. Measures cannot be used in slicers, but slicers support the use of hierarchies and ad hoc hierarchies in their <strong class="screentext">Field</strong> area.</p>
    <p class="book-title--packt">It is recommended to position slicers to the left of all other visuals on the page. Format the slicer visuals with borders and/or background colors to make the slicers stand out on the page. With regards to using the <strong class="screentext">Slicer header</strong> or the <strong class="screentext">Title</strong>, pick one of the two and be consistent for all slicers on the page. The <strong class="screentext">Slicer header</strong> provides a <strong class="screentext">Clear selections</strong> option (the eraser icon), as well as allowing you to switch a slicer from <strong class="screentext">List</strong> to <strong class="screentext">Drop-down</strong>, and vice versa.</p>
    <figure class="mediaobject"><img src="images/000424.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.20: Slicer header options</p>
    <p class="book-title--packt">Selecting items in the slicer cross-filters the other visuals on the page. Select the box next to an option once to select that value, and select the same box again to deselect the same value. Hold down the <span>Ctrl</span> key to select multiple values. This behavior can be controlled using the <strong class="screentext">Selection controls</strong> area of the <strong class="screentext">Format</strong> pane.</p>
    <figure class="mediaobject"><img src="images/000026.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.21: Slicer selection controls</p>
    <p class="book-title--packt">You can also force only <strong class="screentext">Single select</strong>. Turning off <strong class="screentext">Multi-select with CTRL</strong> makes multiple selection possible without holding down the <span>Ctrl</span> key on the keyboard. Slicer item selection <a id="calibre_link-1009" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>essentially becomes a set of checkboxes. The <strong class="screentext">Show "Select all" </strong>option provides a quick method to select and deselect all values. The <strong class="screentext">Select all</strong> option can be helpful if the slicer contains more than seven to 10 values. With <strong class="screentext">Select all</strong>, the user can easily construct a filter to exclude only a few items from a long list.</p>
    <figure class="mediaobject"><img src="images/000038.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.22: Select All Slicer Selection Control Turned On</p>
    <p class="book-title--packt">Slicers can be searched by activating the <strong class="screentext">Search</strong> option from the ellipses (<strong class="screentext">â¦</strong>) menu of the slicer.</p>
    <figure class="mediaobject"><img src="images/000050.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.23: Slicer Search option</p>
    <p class="book-title--packt">Activating this option presents a <strong class="screentext">Search</strong> bar at the top of the items list. <strong class="screentext">Search</strong> is useful for long lists of items.</p>
    <p class="book-title--packt">Slicers can also be synchronized between report pages. Sync'd slicers means that items selected in a slicer on <a id="calibre_link-1010" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>one page affect any other pages where there is a sync'd slicer. Copying and pasting a slicer between pages prompts the <strong class="screentext">Sync visuals</strong> dialog box but can also be controlled via the <strong class="screentext">Sync slicers</strong> pane. By default, slicers with the same <strong class="screentext">Field</strong> on different pages are "grouped," but you can use the <strong class="screentext">Advanced options</strong> to control these groupings. In addition to synchronization, the <strong class="screentext">Sync slicers</strong> dialog box allows you to control whether a slicer is visible on a page. Coupling sync'd slicers with making slicers invisible on pages can be used to free up page canvas space.</p>
    <h2 id="calibre_link-1562" class="calibre8">There's more...</h2>
    <p class="book-title--packt">There are many options when it comes to slicers. In addition to the options discussed so far, there are also special types of slicers, such as horizontal slicers, range slicers, and relative date slicers.</p>
    <p class="book-title--packt">Horizontal slicers are an <a id="calibre_link-1012" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>alternative design that can be <a id="calibre_link-546" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>activated by changing the <strong class="screentext">Orientation</strong> setting in the <strong class="screentext">General</strong> format section of the <strong class="screentext">Format</strong> pane. Horizontal orientation slicers are often placed along the top of report pages and can benefit mobile consumption.</p>
    <figure class="mediaobject"><img src="images/000062.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.24: Slicer visual with Horizontal Orientation</p>
    <p class="book-title--packt">Slicer visuals contain powerful filtering options when used with <strong class="screentext">Date</strong> data types, including graphical date selection, before/after criteria, relative dates, and relative times. The default slicer type for a <strong class="screentext">Date</strong> data type is a date range slicer or <strong class="screentext">Between</strong> slicer. The start and end points of the timeline can be selected and dragged to revise the filter condition. Alternatively, selecting the date input cells exposes a graphical calendar picker element for choosing a date. The <strong class="screentext">Before</strong> and <strong class="screentext">After</strong> filter options gray out the start and end date input cells of the <strong class="screentext">Between</strong> dialog, respectively. The <strong class="screentext">Relative Date</strong> option provides <a id="calibre_link-949" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>three input boxes. The first input box allows the selection of <strong class="screentext">Last</strong>, <strong class="screentext">Next</strong>, or <strong class="screentext">This</strong>. </p>
    <p class="book-title--packt">The middle <a id="calibre_link-1013" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>input box allows the entry of a number and the last input box provides a drop-down for various date intervals; see <em class="italic">Figure 4.25</em>.</p>
    <figure class="mediaobject"><img src="images/000074.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.25: Standard slicer based on a Date column configured for a Relative Date Filter</p>
    <p class="book-title--packt">In the <strong class="screentext">Format</strong> pane, you can <a id="calibre_link-1563" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>specify whether the current day is included in the relative date filter as well as an <strong class="screentext">Anchor Date</strong>. The relative date filtering options of slicer visuals are also available as report-, page-, and visual-level filters. The <strong class="screentext">Relative Time</strong> option function is similar to the <strong class="screentext">Relative Date</strong> option, only the intervals are in <strong class="screentext">Minutes and Hours</strong>. </p>
    <p class="book-title--packt">The default slicers format for numeric data types is also the <strong class="screentext">Between</strong> slicer. The <strong class="screentext">Less than or equal to</strong> and <strong class="screentext">Greater than or equal to</strong> options for numeric slicers are analogous to a Date slicer's <strong class="screentext">Before</strong> and <strong class="screentext">After</strong> options.</p>
    <h2 id="calibre_link-1564" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Slicers in Power BI: <a href="http://bit.ly/3mkZcFX" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3mkZcFX</span></a></li>
      <li class="bullet">Using <a id="calibre_link-1011" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>slicers in the Power BI service: <a href="http://bit.ly/3fsCdHr" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3fsCdHr</span></a></li>
    </ul>
    <h1 id="calibre_link-1218" class="title">Controlling Visual Interactions</h1>
    <p class="book-title--packt">Power BI report pages are interactive by default, with all visuals, excluding slicers, cross-filtered via the selections applied to one visual. While this dynamic filter context is often helpful in exploring <a id="calibre_link-1135" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and analyzing across dimensions, there is often also a need to exclude certain visuals from this behavior. For example, a high-priority measure reflected in a card or KPI visual may be configured to ignore any filter selections from slicers and other visuals on the page. Additionally, rather than the default highlighting of cross-filtered visuals, it can be beneficial to exclusively display the related values in other visuals.</p>
    <p class="book-title--packt">In this recipe, we provide examples of configuring interactivity between visuals.</p>
    <h2 id="calibre_link-1565" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <code class="code-in-text--packt">CH4_R4.pbix</code> file and save the file as <code class="code-in-text--packt">CH4_R5.pbix</code>.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Scratch</strong> page and use <span>Ctrl-A</span> and then <em class="italic">Delete</em> to remove any visuals.</li>
      <li class="calibre12">Check the <strong class="screentext">Filters</strong> pane and ensure that only the <strong class="screentext">Europe</strong> filter is active.</li>
    </ol>
    <h2 id="calibre_link-1566" class="calibre8">How to Control Visual Interactions</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">Europe</strong> page.</li>
      <li class="calibre12">Select any <a id="calibre_link-1136" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>visual and click <strong class="screentext">Edit interactions</strong> in the ribbon of the <strong class="screentext">Format</strong> tab.</li>
      <li class="calibre12">Select the <strong class="screentext">Calendar Month</strong> slicer.<figure class="mediaobject"><img src="images/000086.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.26: Edit interactions</p>
      </li>
      <li class="calibre12">Click on the <strong class="screentext">None</strong> circle icon for the four KPI visualizations.</li>
      <li class="calibre12">Repeat steps <em class="italic">3</em> and <em class="italic">4</em> with the <strong class="screentext">Product Category</strong> and <strong class="screentext">Country</strong> slicers.</li>
      <li class="calibre12">Repeat steps <em class="italic">3</em>, <em class="italic">4</em>, and <em class="italic">5</em> for the <strong class="screentext">France</strong>, <strong class="screentext">Germany</strong>, and <strong class="screentext">United Kingdom</strong> pages.</li>
      <li class="calibre12">Select any visual and click <strong class="screentext">Edit interactions</strong> in the ribbon of the <strong class="screentext">Format</strong> tab to toggle off editing interactions.</li>
      <li class="calibre12">Save your work.</li>
    </ol>
    <h2 id="calibre_link-1567" class="calibre8">How it works</h2>
    <p class="book-title--packt">In this example, it was determined that the KPI visualizations should always show the last full month's statistics <a id="calibre_link-1137" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for all products and all countries, states/provinces, and cities. To ensure this is the case, interactivity with all other visualizations on the pages is set to <strong class="screentext">None</strong> instead of the default <strong class="screentext">Filter</strong>, using the <strong class="screentext">Edit interactions</strong> feature on Power BI Desktop.</p>
    <p class="book-title--packt">It is important to realize that DAX measures can override cross-filtering behavior by using filter functions such as <code class="code-in-text--packt">ALL</code>, <code class="code-in-text--packt">ALLEXCEPT</code>, and <code class="code-in-text--packt">REMOVEFILTERS</code>. In fact, there actually was no need to set the interaction between the Calendar Month slicer and the KPI visuals to <strong class="screentext">None</strong> because the DAX measures that drive the KPI visuals include the use of the <code class="code-in-text--packt">ALL</code> function for the <strong class="screentext">Dates</strong> table as part of their calculations.</p>
    <h2 id="calibre_link-1568" class="calibre8">There's more...</h2>
    <p class="book-title--packt">The cross-filtering interactions between visualizations have the options of <strong class="screentext">Filter</strong>, <strong class="screentext">Highlight</strong>, and <strong class="screentext">None</strong>&mdash;some visualizations, such as KPI visualizations, only include <strong class="screentext">Filter</strong> and <strong class="screentext">None</strong> options, whereas <a id="calibre_link-196" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>other visualizations, such as bar and column charts, include a <strong class="screentext">Highlight</strong> option as well. To see the <strong class="screentext">Highlight</strong> option, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">From the <strong class="screentext">Visualizations</strong> pane, create a <strong class="screentext">Clustered column chart</strong>.</li>
      <li class="calibre12">From the <strong class="screentext">Fields</strong> list, add the <strong class="screentext">Year Month</strong> column from the <strong class="screentext">Dates</strong> table as the <strong class="screentext">Axis</strong>, and add the <strong class="screentext">Internet Net Sales</strong> and <strong class="screentext">Internet Plan</strong> measures from the <strong class="screentext">Internet Sales</strong> table as <strong class="screentext">Values</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, expand <strong class="screentext">Legend</strong> and change the <strong class="screentext">Position</strong> to <strong class="screentext">Bottom</strong>, turn off the <strong class="screentext">Title</strong> on the <strong class="screentext">X axis</strong>, turn the <strong class="screentext">Y axis</strong> completely off, expand <strong class="screentext">Data labels</strong>, and change the <strong class="screentext">Display units</strong> to <strong class="screentext">Thousands</strong>, the <strong class="screentext">Value decimal places</strong> to <strong class="screentext">0</strong>, and <strong class="screentext">Orientation</strong> to <strong class="screentext">Horizontal</strong>; expand the <strong class="screentext">Title</strong> section and change the <strong class="screentext">Title text</strong> to <strong class="screentext">Internet Sales to Plan</strong> with an <strong class="screentext">Alignment</strong> of <strong class="screentext">Center</strong>, and turn the <strong class="screentext">Background</strong> to <strong class="screentext">Off</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">General</strong> section, set the <strong class="screentext">X Position</strong> to <strong class="screentext">449</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">47</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">831</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">241</strong>.</li>
      <li class="calibre12">Create a <strong class="screentext">Stacked bar chart</strong> with the <strong class="screentext">Sales Territory Country</strong> column from the <strong class="screentext">Sales Territories</strong> table as the <strong class="screentext">Axis</strong>, and in the <strong class="screentext">Values</strong> field well, place the <strong class="screentext">Internet Net Sales</strong> measure from the <strong class="screentext">Internet Sales</strong> table, and the <strong class="screentext">Reseller Net Sales</strong> measure from <a id="calibre_link-1569" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Reseller Sales</strong> table.</li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, expand <strong class="screentext">Legend</strong> and change the <strong class="screentext">Position</strong> to <strong class="screentext">Bottom</strong>, turn off the <strong class="screentext">Title</strong> on the <strong class="screentext">Y axis</strong>, turn off the <strong class="screentext">Title</strong> on the <strong class="screentext">X axis</strong>, and then turn the <strong class="screentext">X axis</strong> completely off; expand <strong class="screentext">Data labels</strong> and change the <strong class="screentext">Display units</strong> to <strong class="screentext">Thousands</strong>, expand the <strong class="screentext">Title</strong> section and change the <strong class="screentext">Title text</strong> to <strong class="screentext">Internet and Reseller Sales by Country</strong> with an <strong class="screentext">Alignment</strong> of <strong class="screentext">Center</strong>, and turn the <strong class="screentext">Background</strong> to <strong class="screentext">Off</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">General</strong> section, set the <strong class="screentext">X Position</strong> to <strong class="screentext">753</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">295</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">527</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">212</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">Stacked bar chart</strong> visual and click <strong class="screentext">Edit interactions</strong> in the ribbon of the <strong class="screentext">Format</strong> tab.</li>
      <li class="calibre12">Change the cross-filtering on the <strong class="screentext">Clustered column chart</strong> visual from <strong class="screentext">Highlight</strong> to <strong class="screentext">Filter</strong>.<figure class="mediaobject"><img src="images/000099.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.27: Cross-filtering icons</p>
      </li>
      <li class="calibre12">Click on the <strong class="screentext">None</strong> circle icon for the four KPI visualizations.</li>
      <li class="calibre12">Select the <strong class="screentext">Clustered column chart</strong> visual and click on the <strong class="screentext">None</strong> circle icon for the four KPI visualizations.</li>
      <li class="calibre12">Select any visual and click on <strong class="screentext">Edit interactions</strong> in the ribbon of the <strong class="screentext">Format</strong> tab to toggle editing interactions off.</li>
      <li class="calibre12">Click on columns in the <strong class="screentext">Internet Sales Plan</strong> visual and observe the highlighting on the <strong class="screentext">Internet and Reseller Sales by Country</strong> visual.</li>
      <li class="calibre12">Similarly, click on the bars in the <strong class="screentext">Internet and Reseller Sales by Country</strong> visual and observe that the <strong class="screentext">Internet Sales Plan</strong> visual is filtered.</li>
      <li class="calibre12">Copy the <strong class="screentext">Internet Sales Plan</strong> visual to the <strong class="screentext">France</strong>, <strong class="screentext">Germany</strong>, and <strong class="screentext">United Kingdom</strong> pages.</li>
      <li class="calibre12">Save your work.</li>
    </ol>
    <h2 id="calibre_link-1570" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Change how <a id="calibre_link-1138" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>visuals interact in a report: <a href="http://bit.ly/3cGQazB" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cGQazB</span></a></li>
      <li class="bullet">Understand how visuals interact in a report: <a href="http://bit.ly/3wgsQR3%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3wgsQR3</span></a></li>
    </ul>
    <h1 id="calibre_link-1219" class="title">Utilizing Graphical Visualizations</h1>
    <p class="book-title--packt">Data visualization and exploration is central to Power BI, and the visualization types chosen in reports contribute greatly to user comprehension and adoption. Power BI Desktop includes an array of modern visuals, such as the Treemap and the Funnel, but also includes a set of rich <a id="calibre_link-520" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>formatting options for traditional line, bar/column, combination, and scatter charts. Additionally, five map visuals are available to analyze geographical data, and an entire library of custom visuals is available via the AppSource store, which is integrated into the Home ribbon and Visualizations pane of Power BI Desktop.</p>
    <p class="book-title--packt">A common mistake of inexperienced report developers is the overuse of fancy or complex graphical visuals. Report developers should choose visuals based on their alignment to the business questions within the scope of the report and should always prioritize simplicity and ease-of-use.</p>
    <p class="book-title--packt">This recipe provides examples of utilizing various graphical visualization types, such as the <strong class="screentext">Line chart</strong>, <strong class="screentext">Line and Clustered column chart</strong>, <strong class="screentext">Map</strong>, and <strong class="screentext">Shape map</strong>.</p>
    <h2 id="calibre_link-1571" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <code class="code-in-text--packt">CH4_R5.pbix</code> file and save the file as <code class="code-in-text--packt">CH4_R6.pbix</code>.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Scratch</strong> page and use <span>Ctrl-A</span> then <em class="italic">Delete</em> to remove any visuals.</li>
      <li class="calibre12">Check the <strong class="screentext">Filters</strong> pane and ensure that only the <strong class="screentext">Europe</strong> filter is active.</li>
    </ol>
    <h2 id="calibre_link-1572" class="calibre8">How to Utilize Graphical Visualizations</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">Europe</strong> page.</li>
      <li class="calibre12">From the <strong class="screentext">Visualizations</strong> pane, select the <strong class="screentext">Scatter chart</strong> visualization and add the <strong class="screentext">Sales Territory Country</strong> column from the <strong class="screentext">Sales Territories</strong> table as the <strong class="screentext">Legend</strong>.</li>
      <li class="calibre12">From the <strong class="screentext">Internet Sales</strong> table, add the <strong class="screentext">Internet Net Sales</strong> measure as the <strong class="screentext">X Axis</strong>, the <strong class="screentext">Internet Customer Count</strong> measure as the <strong class="screentext">Y Axis</strong>, and the <strong class="screentext">Internet Order Quantity Total</strong> measure as the <strong class="screentext">Size</strong>.</li>
      <li class="calibre12">From the <strong class="screentext">Dates</strong> table, add the <strong class="screentext">Date</strong> column (<em class="italic">not</em> a <strong class="screentext">Date</strong> hierarchy) to the <strong class="screentext">Play Axis</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">General</strong> section <a id="calibre_link-521" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of the <strong class="screentext">Format</strong> pane, set the <strong class="screentext">X Position</strong> to <strong class="screentext">160</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">295</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">594</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">381</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, set the <strong class="screentext">Legend</strong> to <strong class="screentext">Off</strong>, and expand the <strong class="screentext">Y Axis</strong> section, and change the <strong class="screentext">Axis title</strong> to <strong class="screentext">Distinct Customers</strong>; then expand the <strong class="screentext">Title</strong> section, change the <strong class="screentext">Title text</strong> to <strong class="screentext">Internet Sales and Customer Count Trend by Country</strong>, and set the <strong class="screentext">Alignment</strong> to <strong class="screentext">Center</strong>.<figure class="mediaobject"><img src="images/000112.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.28: Scatter chart visualization</p>
      </li>
      <li class="calibre12">Click a blank spot on the page canvas, and from the <strong class="screentext">Visualizations</strong> pane, select the <strong class="screentext">Line chart</strong>.</li>
      <li class="calibre12">Use the <strong class="screentext">Year Month</strong> column from the <strong class="screentext">Dates</strong> table as the <strong class="screentext">Axis</strong>, the <strong class="screentext">Sales Territory Country</strong> column from the <strong class="screentext">Sales Territories</strong> table as the <strong class="screentext">Legend</strong>, and the <strong class="screentext">Internet Margin %</strong> measure from the <strong class="screentext">Internet Sales</strong> table for <strong class="screentext">Values</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">General</strong> section of the <strong class="screentext">Format</strong> pane, set the <strong class="screentext">X Position</strong> to <strong class="screentext">754</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">508</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">526</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">212</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">Legend</strong> section, set the <strong class="screentext">Position</strong> to <strong class="screentext">Bottom</strong>, and delete the <strong class="screentext">Legend Name</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">X Axis</strong> and <strong class="screentext">Y Axis</strong> sections and toggle the <strong class="screentext">Title</strong> to <strong class="screentext">Off</strong> for both.</li>
      <li class="calibre12">Toggle <strong class="screentext">Data labels</strong> to <strong class="screentext">Off</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">Title</strong> section, change the <strong class="screentext">Title text</strong> to <strong class="screentext">Internet Sales Margin % by Country</strong>, and set the <strong class="screentext">Alignment</strong> to <strong class="screentext">Center</strong>.<figure class="mediaobject"><img src="images/000123.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.29: Line chart visualization</p>
      </li>
      <li class="calibre12">Switch to the <strong class="screentext">France</strong> page.</li>
      <li class="calibre12">From the <strong class="screentext">Visualizations</strong> pane, select the <strong class="screentext">Map</strong> visualization, add the <strong class="screentext">Location</strong> column <a id="calibre_link-522" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>from the <strong class="screentext">Customers</strong> table as the <strong class="screentext">Location</strong>, and the <strong class="screentext">Internet Customer Count</strong> measure from the <strong class="screentext">Internet Sales</strong> table as the <strong class="screentext">Size</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">General</strong> section of the <strong class="screentext">Format</strong> pane, set the <strong class="screentext">X Position</strong> to <strong class="screentext">160</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">295</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">288</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">381</strong>.</li>
      <li class="calibre12">Toggle the <strong class="screentext">Category</strong> labels to <strong class="screentext">Off </strong>and the <strong class="screentext">Title </strong>to<strong class="screentext"> Off</strong>.</li>
      <li class="calibre12">Click a blank area of the canvas and choose the <strong class="screentext">Line and clustered column chart</strong> from the <strong class="screentext">Visualizations</strong> pane.</li>
      <li class="calibre12">From the <strong class="screentext">Fields</strong> list, add the <strong class="screentext">Year Month</strong> column from the <strong class="screentext">Dates</strong> table as the <strong class="screentext">Axis</strong>.</li>
      <li class="calibre12">From the <strong class="screentext">Reseller Sales</strong> table, add the <strong class="screentext">Reseller Net Sales</strong> measure as the <strong class="screentext">Column values</strong> and the <strong class="screentext">Reseller Margin %</strong> measure as the <strong class="screentext">Line values</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">General</strong> section of the <strong class="screentext">Format</strong> pane, set the <strong class="screentext">X Position</strong> to <strong class="screentext">448</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">295</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">832</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">232</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">Legend</strong> section and change the <strong class="screentext">Position</strong> to <strong class="screentext">Bottom</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">X Axis</strong> and <strong class="screentext">Y Axis</strong> sections and toggle the <strong class="screentext">Title</strong> to <strong class="screentext">Off</strong> for both, and then toggle the <strong class="screentext">Y Axis</strong> to <strong class="screentext">Off</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">Data labels</strong> section and change the <strong class="screentext">Orientation</strong> to <strong class="screentext">Horizontal</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">Title</strong> section and change the <strong class="screentext">Title text</strong> to <strong class="screentext">Reseller Sales and Margin %</strong>,<strong class="screentext"> </strong>with an <strong class="screentext">Alignment</strong> of <strong class="screentext">Center</strong>.</li>
      <li class="calibre12">Turn the <strong class="screentext">Background</strong> to <strong class="screentext">Off</strong>.</li>
      <li class="calibre12">Copy the <strong class="screentext">Map</strong> and the <strong class="screentext">Line and clustered column chart</strong> and paste onto the <strong class="screentext">Germany</strong> and <strong class="screentext">United Kingdom</strong> pages.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Germany</strong> page and select the <strong class="screentext">Map</strong> visual.</li>
      <li class="calibre12">Change to using the <strong class="screentext">State/Province</strong> column from the <strong class="screentext">Customers</strong> table for <strong class="screentext">Location</strong>.</li>
      <li class="calibre12">With the <strong class="screentext">Map</strong> visual selected, select <strong class="screentext">Shape map</strong> from the <strong class="screentext">Visualizations</strong> pane. If <strong class="screentext">Shape map</strong> is not <a id="calibre_link-523" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>present, this visualization can be activated using <strong class="screentext">Preview features</strong>, found by selecting <strong class="screentext">File</strong> from the menu/ribbon, then <strong class="screentext">Options and settings</strong>, and finally <strong class="screentext">Options</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, expand the <strong class="screentext">Shape</strong> section and change the <strong class="screentext">Map</strong> to <strong class="screentext">Germany states</strong>.</li>
      <li class="calibre12">Save your work.<figure class="mediaobject"><img src="images/000135.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 4.30: Shape map visualization</p>
    <h2 id="calibre_link-1573" class="calibre8">How it works</h2>
    <p class="book-title--packt">Choose column charts when individual values and their comparison is more important than the trend. Select bar charts when the axis category labels are long, as bar charts will display more of the label text than column charts. Use line charts when the trend or shape of data is more important than individual values and their comparison. Select scatter charts to demonstrate a correlation of a dimension between two measures. Choose special-purpose visuals such as Treemaps and Waterfall charts as supplements to standard visuals.</p>
    <p class="book-title--packt">It is generally recommended to avoid pie charts, donut charts, gauges, and treemap visuals, given the advantages in visual perception and comprehension of other visuals. For example, the curved shapes of pie charts and gauges are more difficult to interpret than straight lines and the distance between points in column/bar and scatter charts, respectively.</p>
    <p class="book-title--packt">On the <strong class="screentext">Scatter chart</strong> visual, you can click the <strong class="screentext">Play</strong> button to have the measures calculated for <a id="calibre_link-524" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>each date in the <strong class="screentext">Play</strong> axis. The shapes will move and change sizes over time.</p>
    <p class="book-title--packt">For the <strong class="screentext">Shape map</strong> visuals, states with higher sales have greater color saturation by default, and the tooltips display when hovering over states. The available shape maps include a <strong class="screentext">Map keys</strong> dialog that is used to plot your location column. Map keys can be viewed by clicking <strong class="screentext">View map keys</strong> from the <strong class="screentext">Shape</strong> option in the <strong class="screentext">Formatting</strong> pane. Ensure that your location data matches the keys before using the given shape map. </p>
    <p class="book-title--packt">The <strong class="screentext">Map</strong> and <strong class="screentext">Filled map</strong> visuals can be used when a custom shape map is either not available for the location data or is not appropriate for the given use case. Both visuals use Bing to plot location points. </p>
    <h2 id="calibre_link-1574" class="calibre8">There's more...</h2>
    <p class="book-title--packt">The waterfall chart visual is best used to show the contributions of individual values to an overall total. To see <a id="calibre_link-1147" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>how the waterfall chart works, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Switch to the <strong class="screentext">Scratch</strong> page.</li>
      <li class="calibre12">Create a <strong class="screentext">Waterfall chart</strong> using the <strong class="screentext">Sales Territory Country</strong> column from the <strong class="screentext">Sales Territories</strong> table as the <strong class="screentext">Category</strong> and the <strong class="screentext">Internet Plan Variance</strong> measure from the <strong class="screentext">Internet Sales</strong> table as the <strong class="screentext">Values</strong>.<figure class="mediaobject"><img src="images/000148.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 4.31: Waterfall chart</p>
    <p class="book-title--packt">Waterfall charts should be sorted by the measure in order to support an intuitive "walk" from the components to the <strong class="screentext">Total</strong> column. The default color formatting of red for negative and green for <a id="calibre_link-1148" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>positive is usually appropriate. Additional columns can be added to the <strong class="screentext">Category</strong> field in order to enable a drill-down dimension. The <strong class="screentext">Year Month</strong> column from the <strong class="screentext">Dates</strong> table or the <strong class="screentext">Product Category</strong> from the <strong class="screentext">Products</strong> table are good candidates. Additionally, a column can also be added to the <strong class="screentext">Breakdown</strong> field. The <strong class="screentext">Breakdown</strong> field calculates the variance and percentage variance of an individual dimension value between two category values. Adding the <strong class="screentext">Product Category</strong> column to the <strong class="screentext">Breakdown</strong> field displays the product categories with the most significant variances between the countries, with details available in tooltips.</p>
    <p class="book-title--packt">Many chart types, such as line charts, have useful analytics options. To demonstrate these analytics capabilities, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">On the <strong class="screentext">Scratch</strong> page, create a <strong class="screentext">Line chart</strong> with the <strong class="screentext">Year Month</strong> column from the <strong class="screentext">Dates</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">Internet Net Sales</strong> measure from the <strong class="screentext">Internet</strong><strong class="screentext"> </strong><strong class="screentext">Sales</strong> table as the <strong class="screentext">Values</strong>.</li>
      <li class="calibre12">Select the line chart and choose the <strong class="screentext">Analytics</strong> tab.<figure class="mediaobject"><img src="images/000161.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.32: Analytics tab</p>
      </li>
      <li class="calibre12">Expand the <strong class="screentext">Average line</strong> section and click <strong class="screentext">Add</strong>.</li>
      <li class="calibre12">Toggle the <strong class="screentext">Data label</strong> to <strong class="screentext">On</strong> and change the <strong class="screentext">Text</strong> to <strong class="screentext">Name and value</strong>.</li>
      <li class="calibre12">A <strong class="screentext">Trend</strong> line is available but only when the x-axis is set to <strong class="screentext">Continuous</strong>. <strong class="screentext">Date</strong> columns are a good choice to provide a <strong class="screentext">Continuous</strong> axis. <strong class="screentext">Date</strong> columns also make a <strong class="screentext">Forecast</strong> analytic available.</li>
      <li class="calibre12">A useful trick with line chart visuals is using a measure to add conditional formatting. Create the following measure in the <strong class="screentext">Internet Sales</strong> table:
        <pre class="programlisting"><code class="hljs">Variance Less Than 12% = 
    IF(
        ABS([Internet Plan Variance]) &lt; [Internet Net Sales]*.12,
        [Internet Net Sales],BLANK()
    ) 
</code></pre>
      </li>
      <li class="calibre12">Add this measure to the <strong class="screentext">Values</strong> field well of the line chart. The conditional measure will be included in the line chart but will have a value (and not be blank) only when the condition is met. This approach follows general report design goals in providing more analytical value in the same space without impacting usability. Drill-down via the data hierarchy in the axis and additional measures in the tooltips provide further support in the same space on the report canvas.</li>
    </ol>
    <h2 id="calibre_link-1575" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Visualization types <a id="calibre_link-1145" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>in Power BI: <a href="http://bit.ly/3cHg2vh" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cHg2vh</span></a></li>
    </ul>
    <h1 id="calibre_link-1220" class="title">Creating Table and Matrix visuals</h1>
    <p class="book-title--packt">Table and Matrix visuals are appropriate when visibility of precise, individual values are needed, or when data <a id="calibre_link-1089" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is viewed at a detailed level, such as in individual transactions. Table visuals in Power BI conform to the classic "list" report format of columns <a id="calibre_link-590" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and rows but support powerful cross-highlighting and formatting options, including conditional formatting. Matrix visuals include Table visual features and correspond to the layout and general functionality of pivot tables in Excel: two-dimensional representations of measures with the ability to drill up and down the row and column axes.</p>
    <p class="book-title--packt">In this recipe, the various capabilities of Table and Matrix visualizations are demonstrated, including conditional formatting, drill-down, and cross-highlighting.</p>
    <h2 id="calibre_link-1576" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <code class="code-in-text--packt">CH4_R6.pbix</code> file and save the file as <code class="code-in-text--packt">CH4_R7.pbix</code>.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Scratch</strong> page and use <span>Ctrl-A</span> and then <em class="italic">Delete</em> to remove any visuals.</li>
      <li class="calibre12">Check the <strong class="screentext">Filters</strong> pane and ensure that only the <strong class="screentext">Europe</strong> filter is active.</li>
    </ol>
    <h2 id="calibre_link-1577" class="calibre8">How to Create Table and Matrix visuals</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">France</strong> page.</li>
      <li class="calibre12">From the <strong class="screentext">Visualizations</strong> pane, select the <strong class="screentext">Table </strong><strong class="screentext">visualization</strong>.</li>
      <li class="calibre12">Add the <strong class="screentext">Product Category</strong> column from the <strong class="screentext">Products</strong> table, the <strong class="screentext">Internet Net Sales</strong>, <strong class="screentext">Internet Margin %</strong>, and <strong class="screentext">Internet Customer Count</strong> measures from the <strong class="screentext">Internet Sales</strong> table, and the <strong class="screentext">Reseller Net Sales</strong> and <strong class="screentext">Reseller Margin %</strong> measures from the <strong class="screentext">Reseller Sales</strong> table.</li>
      <li class="calibre12">Rearrange the <a id="calibre_link-1578" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>measures as necessary in the <strong class="screentext">Values</strong> area for the visualization.</li>
      <li class="calibre12">In the <strong class="screentext">Values</strong> well for the visualization, double-click the <strong class="screentext">Internet Customer Count</strong> measure <a id="calibre_link-1579" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and rename it to <code class="code-in-text--packt">Internet</code> <code class="code-in-text--packt">Customers</code>.</li>
      <li class="calibre12">In the <strong class="screentext">General</strong> section of the <strong class="screentext">Format</strong> pane, set the <strong class="screentext">X Position</strong> to <strong class="screentext">448</strong>, <strong class="screentext">Y Position</strong> to <strong class="screentext">526</strong>, <strong class="screentext">Width</strong> to <strong class="screentext">832</strong>, and <strong class="screentext">Height</strong> to <strong class="screentext">194</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">Style</strong> section and choose <strong class="screentext">Contrast alternating rows</strong>.</li>
      <li class="calibre12">Copy this visual to the <strong class="screentext">Germany</strong>, <strong class="screentext">United Kingdom</strong>, and <strong class="screentext">Scratch</strong> pages.</li>
      <li class="calibre12">On the <strong class="screentext">Scratch</strong> page, use the drop-down for the <strong class="screentext">Reseller Margin %</strong> measure in the <strong class="screentext">Values</strong> well to apply <strong class="screentext">Conditional formatting</strong> to the <strong class="screentext">Background color</strong>.<figure class="mediaobject"><img src="images/000174.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.33: Conditional formatting</p>
      </li>
      <li class="calibre12">In the conditional formatting dialog, check the <strong class="screentext">Diverging</strong> checkbox, and then click the <strong class="screentext">OK</strong> button.<figure class="mediaobject"><img src="images/000187.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.34: Diverging colors for conditional formatting</p>
      </li>
      <li class="calibre12">Conditionally <a id="calibre_link-1090" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>format the background for <strong class="screentext">Internet Net Sales</strong>, but this time change <strong class="screentext">Format by</strong> to <strong class="screentext">Rules</strong> and in the <strong class="screentext">Rules</strong> change the <a id="calibre_link-591" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>drop-down to <strong class="screentext">is blank</strong>.<figure class="mediaobject"><img src="images/000199.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.35: Format by rules</p>
      </li>
      <li class="calibre12">Conditionally format the <strong class="screentext">Reseller Net Sales</strong> measure, but this time choose <strong class="screentext">Data</strong> <strong class="screentext">bars</strong> and click <strong class="screentext">OK</strong> in the <strong class="screentext">Data bars</strong> dialog to accept the default settings.<figure class="mediaobject"><img src="images/000210.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.36: Table with conditional formatting applied</p>
      </li>
      <li class="calibre12">Copy and paste the <strong class="screentext">Table </strong><strong class="screentext">visual</strong> on the <strong class="screentext">Scratch</strong> page and reposition.</li>
      <li class="calibre12">Remove the <strong class="screentext">Reseller Net Sales</strong> and <strong class="screentext">Reseller Margin %</strong> measures from this new visual and note that the <strong class="screentext">Components</strong> row disappears from the table.</li>
      <li class="calibre12">In the <strong class="screentext">Values</strong> well for the visual, expand the menu for <strong class="screentext">Product Category</strong>, choose <strong class="screentext">Show items with no data</strong>, and note that the <strong class="screentext">Components</strong> row reappears along with an entirely blank row.</li>
      <li class="calibre12">In the <strong class="screentext">Values</strong> well for the visual, expand the menu for <strong class="screentext">Internet Customers</strong>, choose <strong class="screentext">Show value as</strong> and then <strong class="screentext">Percent of grand total</strong>, and note that percentages <a id="calibre_link-1580" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>are now displayed in the <strong class="screentext">Internet Customers</strong> column, and the blank row and the <strong class="screentext">Components</strong> row disappear.</li>
      <li class="calibre12">Add a <strong class="screentext">Matrix </strong><strong class="screentext">visu</strong><strong class="screentext">alization</strong> to the <strong class="screentext">Scratch</strong> page.</li>
      <li class="calibre12">Use the Sales Territory Hierarchy from the Sales Territories table for the rows, the Product <a id="calibre_link-1581" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Category Hierarchy from the Products table for Columns, and the Internet Net Sales measure from the Internet Sales table for Values.</li>
      <li class="calibre12">Expand <strong class="screentext">Europe</strong> using the <strong class="screentext">+</strong> icon for the row.</li>
      <li class="calibre12">Switch <strong class="screentext">Drill on</strong> to <strong class="screentext">Columns</strong>, choose the down arrow to turn on <em class="italic">drill</em> mode and click on the <strong class="screentext">Bikes</strong> column.<figure class="mediaobject"><img src="images/000222.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.37: Matrix visualization</p>
      </li>
      <li class="calibre12">Save your work.</li>
    </ol>
    <h2 id="calibre_link-1582" class="calibre8">How it works</h2>
    <p class="book-title--packt">Table and Matrix visualizations automatically filter out rows and columns for which there is no data. In effect, if the aggregations or measures in the <strong class="screentext">Values</strong> area all evaluate to blank space, then the row is not displayed in the table. The <strong class="screentext">Show items with no data</strong> feature overrides this default behavior but is not foolproof, as shown in the case of using the <strong class="screentext">Show value as</strong> feature. An alternative approach is to construct measures in such a way that they return zero instead of a blank, as in the examples below:</p>
    <pre class="programlisting"><code class="hljs">Measure = 
    VAR __Sum = SUM('Internet Sales'[Sales Amount])
RETURN
    IF(ISBLANK(__Sum),0,__Sum)
</code></pre>
    <p class="book-title--packt">or</p>
    <pre class="programlisting"><code class="hljs">Measure = SUM('Internet Sales'[Sales Amount]) + 0
</code></pre>
    <p class="book-title--packt">or</p>
    <pre class="programlisting"><code class="hljs">Measure = 
    COALESCE(
        SUM('Internet Sales'[Sales Amount]),
        0
    )
</code></pre>
    <p class="book-title--packt">Data bars can be displayed with the measure values, as per this example, or as standalone bars. Specific minimum and maximum threshold values can also be entered to drive the <a id="calibre_link-1091" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>conditional formatting of the bars.</p>
    <p class="book-title--packt">In addition to conditionally formatting background colors and data bars, conditional formatting is <a id="calibre_link-592" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>also available for fonts as well as icons. If the same formatting logic and colors are used for both font color scales and background color scales, only the color of the value will be displayed, such as in a heat map.</p>
    <p class="book-title--packt">A <strong class="screentext">Show values as</strong> option is available for measures added to Table and Matrix visuals to display the measure value as a percentage of the row, column, or grand total. However, measures in Table and Matrix visuals cannot currently be formatted to display units, nor decimal places, such as thousands or millions. For Table visuals, only <strong class="screentext">Percent of grand total</strong> is available, given the single dimension of the visual.</p>
    <p class="book-title--packt">With Matrix visuals, the rows hierarchy can be navigated via the <strong class="screentext">+</strong> and <strong class="screentext">-</strong> icons at the start of each row. Alternatively, selecting <strong class="screentext">Rows</strong> for the <strong class="screentext">Drill on</strong> drop-down allows the drill-down icons to be used to navigate to the row hierarchy. Similarly, selecting <strong class="screentext">Columns</strong> for the <strong class="screentext">Drill on</strong> dropdown allows the columns to be navigated to via the same drill-down icons. There are four drill-down icons: the up arrow icon drills up one layer in the hierarchy; the down arrow icon turns on <em class="italic">drill</em> mode. When drill mode is active (solid circle), then clicking on a row or column drills one layer deeper into the hierarchy for that particular column, or row, only. The double down arrow icon drills one layer deeper into the hierarchy for all rows or columns, but the parent hierarchy context is lost in this case. To drill one layer deeper into the hierarchy for all rows or columns and preserve the parent hierarchy context, use the forked down arrow icon.</p>
    <h2 id="calibre_link-1583" class="calibre8">There's more...</h2>
    <p class="book-title--packt">An additional conditional formatting option for Table and Matrix visualizations is <strong class="screentext">Web URL</strong>. Using the <strong class="screentext">Web URL</strong> conditional formatting makes the displayed value into a live link. To demonstrate <a id="calibre_link-1150" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>how this works, do the following:</p>
    <ul class="calibre9">
      <li class="bullet">On the <strong class="screentext">Scratch</strong> page, create a <strong class="screentext">Table </strong><strong class="screentext">visualization</strong> using the <strong class="screentext">Customer Name</strong>, <strong class="screentext">Email</strong>, and <strong class="screentext">Service URL</strong> columns from the <strong class="screentext">Customers</strong> table.</li>
      <li class="bullet">In the <strong class="screentext">Values</strong> well for the <strong class="screentext">Table </strong><strong class="screentext">visual</strong>, access the <strong class="screentext">Conditional formatting</strong> for the <strong class="screentext">Customer Name</strong> measure and choose <strong class="screentext">Web URL</strong>.</li>
      <li class="bullet">In the <strong class="screentext">Web URL</strong> dialog box, change <strong class="screentext">Based on field</strong> to the <strong class="screentext">Email</strong> column in the <strong class="screentext">Customers</strong> table.<figure class="mediaobject"><img src="images/000233.png" alt="" class="calibre14" /></figure>
      </li>
    </ul>
    <p class="book-title--packt">Figure 4.38: Web URL conditional formatting</p>
    <ul class="calibre9">
      <li class="bullet">In the <strong class="screentext">Format</strong> pane, expand the <strong class="screentext">Values</strong> section and toggle the <strong class="screentext">URL icon</strong> setting to <strong class="screentext">On</strong>.<figure class="mediaobject"><img src="images/000246.png" alt="" class="calibre14" /></figure>
      </li>
    </ul>
    <p class="book-title--packt">Figure 4.39: Web URL conditional formatting and URL icons as live links</p>
    <p class="book-title--packt">A unique option for Matrix visualizations is the ability to show multiple measures displayed on the rows of Matrix visuals. This is a very common use case in financial reporting. To see how this works, do the following:</p>
    <ul class="calibre9">
      <li class="bullet">Create a Matrix visualization on the <strong class="screentext">Scratch</strong> page with the <strong class="screentext">Product Category</strong> from the <strong class="screentext">Products</strong> table in the <strong class="screentext">Rows</strong>, <strong class="screentext">Calendar Year</strong> from the <strong class="screentext">Dates</strong> table in the <strong class="screentext">Columns</strong>,<strong class="screentext"> </strong>and <a id="calibre_link-1151" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Total Net Sales</strong>, <strong class="screentext">Total Margin</strong>, and <strong class="screentext">Total Margin %</strong> measures from the <strong class="screentext">Calculations</strong> table as <strong class="screentext">Values</strong>.</li>
      <li class="bullet">In the <strong class="screentext">Format</strong> pane, expand the <strong class="screentext">Values</strong> section and toggle the <strong class="screentext">Show on rows</strong> option to <strong class="screentext">On</strong>.<figure class="mediaobject"><img src="images/000257.png" alt="" class="calibre14" /></figure>
      </li>
    </ul>
    <p class="book-title--packt">Figure 4.40: Matrix visual with three measures in the Values well displayed on rows</p>
    <h2 id="calibre_link-1584" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Table visualizations in Power BI reports and dashboards: <a href="http://bit.ly/3fzJ6a4" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3fzJ6a4</span></a></li>
      <li class="bullet">Create a <a id="calibre_link-589" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Matrix visual in Power BI: <a href="http://bit.ly/2PN4Cxd" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2PN4Cxd</span></a></li>
      <li class="bullet">Conditional table <a id="calibre_link-169" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>formatting in Power BI Desktop: <a href="http://bit.ly/3rMwvma" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3rMwvma</span></a></li>
    </ul>
    <h1 id="calibre_link-1221" class="title">Enhancing Reports</h1>
    <p class="book-title--packt">There are many <a id="calibre_link-959" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>report features that can add greater context and enhance the self-service data exploration experience. Three such features are Tooltips, Tooltip pages, and Drill through report pages. </p>
    <p class="book-title--packt">In this recipe, we walk through the using <strong class="screentext">Tooltips</strong>, <strong class="screentext">Tooltip</strong> pages, and <strong class="screentext">Drill through report</strong> pages to enhance our report.</p>
    <h2 id="calibre_link-1585" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this <a id="calibre_link-1586" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <code class="code-in-text--packt">CH4_R7.pbix</code> file and save the file as <code class="code-in-text--packt">CH4_R8.pbix</code>.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Scratch</strong> page and use <span>Ctrl-A</span> then <em class="italic">Delete</em> to remove any visuals.</li>
      <li class="calibre12">Check the <strong class="screentext">Filters</strong> pane and ensure that only the <strong class="screentext">Europe</strong> filter is active.</li>
    </ol>
    <h2 id="calibre_link-1587" class="calibre8">How to Enhance Reports</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">Germany</strong> page.</li>
      <li class="calibre12">Select the <strong class="screentext">Shape map</strong> visualization.</li>
      <li class="calibre12">In the <strong class="screentext">Fields</strong> well, add the <strong class="screentext">Internet Net Sales</strong>, <strong class="screentext">Internet Margin %</strong>, and <strong class="screentext">Internet Sales Per</strong> <strong class="screentext">Custome</strong>r measures from the <strong class="screentext">Internet Sales</strong> table to the <strong class="screentext">Tooltips</strong> field.</li>
      <li class="calibre12">Hover over a colored German state to see the new measures in the <strong class="screentext">Tooltip</strong> pop-up:<figure class="mediaobject"><img src="images/000268.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.41: Additional measures displayed in Tooltip</p>
      </li>
      <li class="calibre12">Create a <a id="calibre_link-960" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>new <strong class="screentext">Page</strong> called <strong class="screentext">Product Tooltip</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, expand the <strong class="screentext">Page Information</strong> section and toggle <strong class="screentext">Tooltip</strong> to <strong class="screentext">On</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">Page size</strong> section and change the <strong class="screentext">Type</strong> to <strong class="screentext">Tooltip</strong>.</li>
      <li class="calibre12">Create a <strong class="screentext">Clustered bar chart</strong> visualization and resize to consume the entire page.</li>
      <li class="calibre12">Add the <strong class="screentext">Product Subcategory</strong> column from the <strong class="screentext">Products</strong> table to the <strong class="screentext">Axis</strong>.</li>
      <li class="calibre12">Add the <strong class="screentext">Internet Net Sales</strong> measure from the <strong class="screentext">Internet Sales</strong> table to the <strong class="screentext">Values</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Filter</strong> pane, apply a visual-level filter on <strong class="screentext">Product Subcategory</strong>, choosing a <strong class="screentext">Top N</strong> filter <a id="calibre_link-1588" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>showing <code class="code-in-text--packt">5</code> items by <strong class="screentext">Internet Net Sales</strong>.<figure class="mediaobject"><img src="images/000280.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.42: Tooltip visual filter</p>
      </li>
      <li class="calibre12">On the <strong class="screentext">Germany</strong> page, select the <strong class="screentext">Table </strong><strong class="screentext">visual</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, toggle the <strong class="screentext">Tooltip</strong> to <strong class="screentext">On</strong>.</li>
      <li class="calibre12">Expand the <strong class="screentext">Tooltip</strong> section, set <strong class="screentext">Type</strong> to <strong class="screentext">Report</strong> page, and <strong class="screentext">Page</strong> to <strong class="screentext">Product</strong> <strong class="screentext">Tooltip</strong>.</li>
      <li class="calibre12">Hovering over any cell in the table brings up the <strong class="screentext">Product Tooltip</strong> page as a <strong class="screentext">Tooltip</strong> for the subcategories within the <strong class="screentext">Product Category</strong> for that row.<figure class="mediaobject"><img src="images/000293.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.43: Report page tooltip</p>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Page</strong> called <strong class="screentext">Customer Drill through</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Fields</strong> well for <a id="calibre_link-961" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the page, add the <strong class="screentext">State/Province</strong> column from the <strong class="screentext">Customers</strong> table to the drillthrough fields area.<figure class="mediaobject"><img src="images/000305.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.44: Page drillthrough fields</p>
      </li>
      <li class="calibre12">Note that a Back button is created automatically in the upper-left corner of the page.<figure class="mediaobject"><img src="images/000317.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.45: Back button</p>
      </li>
      <li class="calibre12">Create customer-centric visuals, such as those shown in <em class="italic">Figure 4.46</em>.<figure class="mediaobject"><img src="images/000329.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.46: Customer Drill through page</p>
      </li>
      <li class="calibre12">On the <strong class="screentext">Germany</strong> page, right-click one of the colored states, choose <strong class="screentext">Drill through</strong> and then <strong class="screentext">Customer Drill</strong> <strong class="screentext">through</strong>.</li>
      <li class="calibre12">Note that the <a id="calibre_link-962" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>drillthrough filters adopt the context passed in from the page and visual.<figure class="mediaobject"><img src="images/000340.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 4.47: Drillthrough filters after drilling through</p>
    <h2 id="calibre_link-1589" class="calibre8">How it works</h2>
    <p class="book-title--packt">Tooltips and report page tooltips are excellent methods for increasing the information and analytical density of reports, providing additional insights within the same amount of report page real estate. Both tooltips and report page tooltips inherit the context of the visual at the <a id="calibre_link-1590" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>granularity of the visual element being hovered over with the cursor. This means that any measures within tooltips and any visuals within a report page tooltip will reflect the current context of the user interacting with the report.</p>
    <p class="book-title--packt">Report authors can also design drillthrough report pages to enable users to quickly and easily explore the details associated with a specific item of interest. All visuals on the drillthrough report page update to reflect the filter context of the chosen item upon which drillthrough was initiated.</p>
    <p class="book-title--packt">Drillthrough is a very powerful and popular feature in that it effectively serves as a custom-generated report tailored to a user's questions as the user views the report. Therefore, multiple drillthrough report pages across common dimensions may be included with popular reports that are actively interacted with. Consider utilizing the Power BI templates (<code class="code-in-text--packt">.pbit</code> files) described in the <em class="italic">Working with templates</em> recipe of <em class="italic">Chapter 7</em>, <em class="italic">Parameterizing Power BI Solutions</em>, to leverage existing drillthrough report pages in new reports.</p>
    <p class="book-title--packt">Drillthrough pages are especially valuable for high-cardinality dimension columns, since the individual values of these columns will likely not have their own dedicated reports or report pages. For example, the <strong class="screentext">Product Category</strong> and <strong class="screentext">Product Subcategory</strong> columns may already have their own reports and dashboards, but an individual <strong class="screentext">Product Model</strong> (third level of this hierarchy) may be a good candidate for one or multiple drillthrough report pages.</p>
    <p class="book-title--packt">The back button is created automatically when a column is added to the <strong class="screentext">drillthrough filters</strong> field well. This button can be formatted or removed entirely but is often helpful, particularly with reports containing several pages. Alternatively, any <strong class="screentext">Shape</strong> or <strong class="screentext">Image</strong> that can be added via the <strong class="screentext">Insert</strong> tab of the ribbon in Power BI Desktop can also be used as a back button for a drillthrough page.</p>
    <h2 id="calibre_link-1591" class="calibre8">There's more...</h2>
    <p class="book-title--packt">In the drillthrough area <a id="calibre_link-197" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for a page, you may have noticed the <strong class="screentext">Cross-report</strong> toggle. Power BI does indeed allow you to drill through between reports, and not just pages. The source report must be enabled to use drillthrough targets from other reports, either in the <strong class="screentext">Report settings</strong> of the <strong class="screentext">CURRENT FILE</strong> in <strong class="screentext">Options and settings</strong>, or in the Power BI service. The target report would then be configured to <a id="calibre_link-1592" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>toggle the <strong class="screentext">Cross-report</strong> option to <strong class="screentext">On</strong> and the drillthrough fields configured appropriately. It is important to note that <strong class="screentext">Cross-report</strong> filtering requires that the dataset schema of the reports match.</p>
    <figure class="mediaobject"><img src="images/000352.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.48: Cross-report drill through</p>
    <h2 id="calibre_link-1593" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Using report <a id="calibre_link-979" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>tooltip pages in Power BI: <a href="http://bit.ly/2OdzeHA" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OdzeHA</span></a></li>
      <li class="bullet">Extend visuals with report page tooltips: <a href="http://bit.ly/3cGwBHC" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cGwBHC</span></a></li>
      <li class="bullet">Set up <a id="calibre_link-403" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>drill through in Power BI reports: <a href="http://bit.ly/31SH2lv" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/31SH2lv</span></a></li>
      <li class="bullet">Use report page drillthrough: <a href="http://bit.ly/3sKg5w0" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3sKg5w0</span></a></li>
      <li class="bullet">Use cross-report drillthrough in Power BI Desktop: <a href="http://bit.ly/3fzfQjJ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3fzfQjJ</span></a></li>
    </ul>
    <h1 id="calibre_link-1222" class="title">Formatting Reports for Publication</h1>
    <p class="book-title--packt">Power BI Desktop includes features to control and enhance the formatting and layout of reports at a detailed <a id="calibre_link-966" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>level. Prior to publishing reports to the Power BI service, visuals can be aligned, sized, and evenly spaced to deliver an organized, symmetrical layout. Additionally, supplemental report elements, such as shapes, text boxes, and images, can be added to further organize and enrich report pages with textual and visual aids.</p>
    <p class="book-title--packt">This recipe demonstrates how to control the positioning, alignment, and distribution of report visuals, as well as tips for presenting and working with visuals in groups. Additionally, helpful tips are presented for final clean-up items prior to publishing a report, as well as setting up Q&amp;A after publishing.</p>
    <h2 id="calibre_link-1594" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare <a id="calibre_link-967" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <code class="code-in-text--packt">CH4_R8.pbix</code> file and save the file as <code class="code-in-text--packt">CH4_R9.pbix</code>.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Scratch</strong> page and use <span>Ctrl-A</span>, then <em class="italic">Delete</em> to remove any visuals.</li>
      <li class="calibre12">Check the <strong class="screentext">Filters</strong> pane and ensure that only the <strong class="screentext">Europe</strong> filter is active.</li>
    </ol>
    <h2 id="calibre_link-1595" class="calibre8">How to Format Reports</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Copy and paste the four KPI visuals from the <strong class="screentext">Europe</strong> page to the <strong class="screentext">Scratch</strong> page.</li>
      <li class="calibre12">Move the KPI visuals around on the page, spacing them out vertically at different horizontal positions.</li>
      <li class="calibre12">Notice the automatic alignment guides (the dashed red lines called <em class="italic">smart guides</em>) that appear when moving or resizing visuals.<figure class="mediaobject"><img src="images/000363.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.49: Automatic alignment guides</p>
      </li>
      <li class="calibre12">Use <span>Ctrl-A</span> to select all of the KPI visuals.</li>
      <li class="calibre12">Select the <strong class="screentext">Format</strong> tab in the ribbon, choose <strong class="screentext">Align</strong>, and then <strong class="screentext">Align left</strong>.<figure class="mediaobject"><img src="images/000374.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.50: Arrange options in the Format ribbon</p>
      </li>
      <li class="calibre12">The visuals are all aligned to the leftmost visual.</li>
      <li class="calibre12">Select <strong class="screentext">Align</strong> again and choose <strong class="screentext">Distribute vertically</strong>.</li>
      <li class="calibre12">The visuals <a id="calibre_link-968" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>are distributed vertically on the page with equal spacing.</li>
      <li class="calibre12">Select <strong class="screentext">Group</strong> and then <strong class="screentext">Group</strong> from the ribbon of the <strong class="screentext">Format</strong> tab.</li>
      <li class="calibre12">The visuals can now be moved around on the page as a single unit.</li>
      <li class="calibre12">Select <strong class="screentext">Group</strong> and then <strong class="screentext">Ungroup</strong>.</li>
      <li class="calibre12">Stack the visuals roughly on top of one another.</li>
      <li class="calibre12">Click on a blank area of the page and then select the top visual.</li>
      <li class="calibre12">From the <strong class="screentext">Format</strong> tab, select <strong class="screentext">Send backward</strong> and then <strong class="screentext">Send to back</strong>.</li>
      <li class="calibre12">Click on a blank area of the page canvas and note that the visual is now beneath all of the other visuals.</li>
      <li class="calibre12">Select one of the visuals, and this time choose <strong class="screentext">Selection</strong> from the ribbon of the <strong class="screentext">Format</strong> tab to expose the <strong class="screentext">Selection</strong> pane.<figure class="mediaobject"><img src="images/000385.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.51: Selection pane</p>
      </li>
      <li class="calibre12">Use the up and down icons to change the <strong class="screentext">Layer order</strong> of the visuals.</li>
      <li class="calibre12">Switch to <strong class="screentext">Tab order</strong> and again use the up and down icons to change the tab order of the visuals.</li>
      <li class="calibre12">Close the <strong class="screentext">Selection</strong> pane.</li>
      <li class="calibre12">Space <a id="calibre_link-1596" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the KPI visualizations out horizontally on the page.</li>
      <li class="calibre12">Select all of the visuals using <em class="italic">Ctrl-A</em>.</li>
      <li class="calibre12">Select the <strong class="screentext">Format</strong> tab, and in the ribbon choose <strong class="screentext">Align</strong> | <strong class="screentext">Align top</strong> and then <strong class="screentext">Align</strong> | <strong class="screentext">Distribute horizontally</strong>.</li>
      <li class="calibre12">Convert each of the <strong class="screentext">KPI</strong> visuals to <strong class="screentext">Card visual</strong>s.</li>
      <li class="calibre12">Toggle the <strong class="screentext">Border</strong> and <strong class="screentext">Background </strong>to <strong class="screentext">Off</strong> for one of the KPI visuals.</li>
      <li class="calibre12">With the <strong class="screentext">Card visual</strong> selected, choose the <strong class="screentext">Format painter</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Note that the cursor is now a paintbrush; select one of the other <strong class="screentext">Card </strong><strong class="screentext">visuals</strong>.</li>
      <li class="calibre12">Click the <strong class="screentext">Format painter</strong> again and select the next <strong class="screentext">Card visual</strong>; repeat for the last <strong class="screentext">Card visual</strong> until all the <strong class="screentext">Card </strong><strong class="screentext">visuals</strong> no longer have a <strong class="screentext">Border</strong> or a <strong class="screentext">Background</strong>.</li>
      <li class="calibre12">Click on the <strong class="screentext">Insert</strong> tab and choose <strong class="screentext">Shapes</strong> in the ribbon and then <strong class="screentext">Rectangle</strong>.</li>
      <li class="calibre12">Enclose all of the <strong class="screentext">Card </strong><strong class="screentext">visuals</strong> in the rectangle.</li>
      <li class="calibre12">From the <strong class="screentext">Format</strong> tab, use <strong class="screentext">Send backward</strong> and then <strong class="screentext">Send to back</strong> to put the rectangle behind the <strong class="screentext">Card </strong><strong class="screentext">visuals</strong>.</li>
      <li class="calibre12">Select <span>Ctrl-A</span> and then choose <strong class="screentext">Group</strong> | <strong class="screentext">Group</strong> from the ribbon of the <strong class="screentext">Format</strong> tab.<figure class="mediaobject"><img src="images/000396.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.52: Grouped Card visuals with no Border or Background</p>
      </li>
      <li class="calibre12">From the <strong class="screentext">View</strong> tab, check the options for <strong class="screentext">Gridlines</strong> and <strong class="screentext">Snap to grid</strong> in the <strong class="screentext">Page options</strong> section of the ribbon.<figure class="mediaobject"><img src="images/000408.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.53: Page options in the View ribbon</p>
      </li>
      <li class="calibre12">Moving the <a id="calibre_link-969" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>group of visuals or resizing visuals now snaps to the grid points.</li>
      <li class="calibre12">Deactivate <strong class="screentext">Gridlines</strong> and <strong class="screentext">Snap to grid</strong>.</li>
      <li class="calibre12">Right-click the <strong class="screentext">Scratch</strong> page tab and choose <strong class="screentext">Hide Page</strong>.<figure class="mediaobject"><img src="images/000420.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.54: Hide Page</p>
      </li>
      <li class="calibre12">Repeat <em class="italic">step 32</em> for the <strong class="screentext">Product Tooltip</strong> and <strong class="screentext">Customer Drill through</strong> pages.</li>
      <li class="calibre12">Use the <strong class="screentext">+</strong> tab to add a page called <strong class="screentext">Information</strong>.</li>
      <li class="calibre12">On the <strong class="screentext">Information</strong> page, use the <strong class="screentext">Insert</strong> tab of the ribbon to create a <strong class="screentext">Text box</strong> similar to the image in <em class="italic">Figure 4.55</em>.<figure class="mediaobject"><img src="images/000431.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.55: Information page of report with active mailto link</p>
      </li>
      <li class="calibre12">In this case, <strong class="screentext">Helpdesk</strong> was selected and made into an active <strong class="screentext">mailto:</strong> link.</li>
      <li class="calibre12">From the <strong class="screentext">View</strong> tab, choose <strong class="screentext">Lock objects</strong> in the ribbon.</li>
      <li class="calibre12">Select the <strong class="screentext">Europe</strong> page and save your work.</li>
      <li class="calibre12">From the <strong class="screentext">Home</strong> tab, choose <strong class="screentext">Publish</strong> in the ribbon to publish the report to the Power BI service.</li>
    </ol>
    <h2 id="calibre_link-1597" class="calibre8">How it works</h2>
    <p class="book-title--packt">Once a report is ready to be published, it is a good idea to use the <strong class="screentext">Lock objects</strong> setting to prevent <a id="calibre_link-970" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>unintended movement or resizing of visual elements. It is important to note, however, that <strong class="screentext">Lock objects </strong>only affects the movement or resizing of visuals by mouse and keyboard. The <strong class="screentext">X Position</strong>, <strong class="screentext">Y Position</strong>, <strong class="screentext">Width</strong>, and <strong class="screentext">Height</strong> settings in the <strong class="screentext">General</strong> section of the <strong class="screentext">Format</strong> pane can still reposition and resize visuals. </p>
    <p class="book-title--packt">Before publishing a report, you should hide or remove pages used during development, such as the <strong class="screentext">Scratch</strong> page. Pages used for report page tooltips should also be hidden. Drillthrough pages may or may not be hidden, depending on their utility in the report. Hidden pages will not be shown to the report reader when viewing the report in the Power BI service. </p>
    <p class="book-title--packt">It is often a good idea to include an <strong class="screentext">Information</strong> page. Information pages can be used to describe the data sources used in the report, helpful tips for navigating the report, and even support information.</p>
    <p class="book-title--packt">Positioning and alignment are key qualities in a professional report. As demonstrated in this recipe, Power BI provides many options for ensuring that visuals are aligned and sized in symmetrical ways. The automatic alignment guides are present whenever moving or resizing a visual element on a page.</p>
    <p class="book-title--packt">These alignment guides appear relative to the edges of other <a id="calibre_link-971" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>visual elements on the page, as well as "common" edges, such as the center of the page. Alternatively, the <strong class="screentext">Align</strong> options present in the <strong class="screentext">Format</strong> ribbon offer a way to mass-align many visuals simultaneously. In addition, the distribution options present in the <strong class="screentext">Align</strong> options are a great way to ensure even spacing between similar visuals. The <strong class="screentext">Gridlines</strong> and <strong class="screentext">Snap to grid</strong> features available in the <strong class="screentext">View</strong> ribbon can also assist you in getting the visuals properly oriented on the page. </p>
    <p class="book-title--packt">Shapes can better organize visuals and can improve report aesthetics relative to the borders and backgrounds of each visual. Shapes are commonly used for report title backgrounds, and they can also customize the plot area of charts, such as by splitting a scatter chart into four squares, with each square having a distinct background color.</p>
    <h2 id="calibre_link-1598" class="calibre8">There's more...</h2>
    <p class="book-title--packt">With a report and dataset published to the Power BI service, we can now configure Q&amp;A for the report. To see <a id="calibre_link-882" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>how this works, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">View the <strong class="screentext">Germany</strong> page in the Power BI service. Hover over one of the KPI visuals and use the pin icon to pin the visual to a dashboard.<figure class="mediaobject"><img src="images/000442.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.56: Pin visual</p>
      </li>
      <li class="calibre12">Select <strong class="screentext">New dashboard</strong>, enter a name for the dashboard, and click the <strong class="screentext">Pin</strong> button.<figure class="mediaobject"><img src="images/000453.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.57: Pin to dashboard dialog</p>
        <p class="packt_figref">Q&amp;A natural language queries are submitted from dashboards against the underlying datasets. In order <a id="calibre_link-883" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for Q&amp;A queries to access a dataset and its dependent reports, at least one tile of the given Q&amp;A dashboard must be dependent on this dataset.</p>
      </li>
      <li class="calibre12">Navigate to the dashboard and note the <strong class="screentext">Ask a question</strong> <strong class="screentext">about your data </strong>prompt, then click the prompt.<figure class="mediaobject"><img src="images/000464.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.58: Dashboard Q&amp;A</p>
      </li>
      <li class="calibre12">Test Q&amp;A using your own questions, or one of the suggested questions; for example: <em class="italic">top Germany resellers by reseller net sales</em>.</li>
      <li class="calibre12">Click on the gear icon in the top-right corner of the Power BI service and select <strong class="screentext">Settings</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">Datasets</strong> tab and the specific dataset to be queried via Q&amp;A.</li>
      <li class="calibre12">Expand the <strong class="screentext">Featured Q&amp;A questions</strong> section and add questions; these questions will <a id="calibre_link-1599" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>now appear as suggestions when using Q&amp;A from the dashboard.<figure class="mediaobject"><img src="images/000475.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 4.59: Featured Q&amp;A questions option in Datasets Settings</p>
    <h2 id="calibre_link-1600" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power BI best <a id="calibre_link-1144" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>design practices for reports and visuals: <a href="http://bit.ly/2poUeMv" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2poUeMv</span></a></li>
      <li class="bullet">Words and terminology that Q&amp;A recognizes: <a href="http://bit.ly/2pRIZdQ%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2pRIZdQ</span></a></li>
    </ul>
    <h1 id="calibre_link-1223" class="title">Designing Mobile Layouts</h1>
    <p class="book-title--packt">Power BI reports can be optimized for consumption on mobile devices via the <strong class="screentext">Mobile layout</strong> view in Power <a id="calibre_link-635" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>BI Desktop. This layout allows users accessing reports through the Power BI mobile applications to more easily view and interact with the most important content of these reports on iOS, Android, or Windows mobile devices. Given the importance of the mobile experience and the unique design considerations for reports with multiple pages, optimizing Power BI reports for mobile access is essential.</p>
    <p class="book-title--packt">In this recipe, the <strong class="screentext">Europe</strong> and <strong class="screentext">United Kingdom</strong> report pages of the example report provided in the first recipe of this chapter are configured with the <strong class="screentext">Mobile layout</strong>. Additional details for optimizing Power BI dashboards are included in the <em class="italic">There's more...</em> section.</p>
    <h2 id="calibre_link-1601" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <code class="code-in-text--packt">CH4_R9.pbix</code> file and save the file as <code class="code-in-text--packt">CH4_R10.pbix</code>.</li>
      <li class="calibre12">Switch to <a id="calibre_link-1602" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Scratch</strong> page and use <em class="italic">Ctrl-A</em> and then <span>Delete</span> to remove any visuals.</li>
      <li class="calibre12">Check the <strong class="screentext">Filters</strong> pane and ensure that only the <strong class="screentext">Europe</strong> filter is active.</li>
    </ol>
    <h2 id="calibre_link-1603" class="calibre8">How to Design Mobile Layouts</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select the <strong class="screentext">Europe</strong> page.</li>
      <li class="calibre12">From the <strong class="screentext">View</strong> tab, select <strong class="screentext">Mobile layout</strong> in the ribbon.<figure class="mediaobject"><img src="images/000486.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.60: Mobile layout</p>
      </li>
      <li class="calibre12">Populate the Mobile layout view: click and drag the visualizations to the desired position in the device grid.<figure class="mediaobject"><img src="images/000497.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.61: Populated Mobile layout</p>
      </li>
      <li class="calibre12">Switch to <a id="calibre_link-636" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">United Kingdom</strong> page and also configure the <strong class="screentext">Mobile layout</strong>.<figure class="mediaobject"><img src="images/000007.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.62: United Kingdom Sales and Margin Mobile layout</p>
      </li>
      <li class="calibre12">Exit <strong class="screentext">Mobile layout</strong> by clicking on <strong class="screentext">Mobile layout</strong> in the ribbon of the <strong class="screentext">View</strong> tab.</li>
      <li class="calibre12">Save your work.</li>
      <li class="calibre12">Publish the report to the Power BI service.</li>
      <li class="calibre12">Test the mobile views using the Power BI app on your phone.</li>
    </ol>
    <h2 id="calibre_link-1604" class="calibre8">How it works</h2>
    <p class="book-title--packt">The utilization of Power BI reports often varies significantly across devices. For example, a report page with multiple slicers and table or Matrix visuals may be appropriate for a detailed, interactive <a id="calibre_link-637" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>experience on a laptop but may not lend itself well to mobile consumption. In many scenarios, the user prefers simple, easy access to only a few high-level visuals, such as Cards or KPIs on their mobile device, rather than a sub-optimal representation of all the visuals included on the page.</p>
    <p class="book-title--packt">If mobile consumption is expected, the report's authors should collaborate with users on this layout and overall experience. Given that the <strong class="screentext">Mobile layout</strong> is at the report page scope and visuals cannot be combined from multiple pages, a dedicated report page containing the most important measures or KPIs can be helpful. These report pages often contain only numbers via Card, Gauge, or KPI visuals to provide a single, at-a-glance mobile view of the most important data points.</p>
    <p class="book-title--packt">The phone layout presents a rectangular mobile device grid and a <strong class="screentext">Visualizations</strong> pane containing the different elements of the given report page, including text boxes and shapes. Though it is possible to design mobile-optimized layouts for each report page, for most reports it may only be necessary to design one or two mobile layouts that highlight the most important measures or trends of the report.</p>
    <p class="book-title--packt">The <strong class="screentext">Visualizations</strong> pane of <strong class="screentext">Mobile layout</strong> makes it easy to identify the elements to include or exclude. The visualizations snap to the grid at a default size and scale up or down on different sizes of mobile devices.</p>
    <p class="book-title--packt">Once saved and published back to the Power BI service, users accessing the report from mobile devices will see the defined phone layout. In the absence of a mobile layout, mobile users will be advised that this has not been configured, and can adjust the orientation of their devices (to horizontal) to view the report page in a landscape view. Switching to a landscape orientation will open the report in the standard desktop view, regardless of whether or not the phone layout has been configured. The pages of a Power BI report can be accessed via swiping gestures from the side of the screen or the pages icon.</p>
    <figure class="mediaobject"><img src="images/000019.png" alt="Image" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.63: Switch to landscape view</p>
    <h2 id="calibre_link-1605" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Many of the same interactive features of Power BI reports, such as drill mode and slicers, are also available through Power BI mobile applications. However, given the form factor limitations, it is important to evaluate the usability of these elements and consider whether mobile-friendly visuals, such as Cards or KPIs, can provide the necessary visibility.</p>
    <p class="book-title--packt">As dashboards are <a id="calibre_link-633" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>created and modified in Power BI, the service allows a similar mobile optimization authoring experience for dashboards. From a dashboard in the Power BI service, click on the <strong class="screentext">Edit</strong> drop-down, as demonstrated in <em class="italic">Figure 4.64</em>.</p>
    <figure class="mediaobject"><img src="images/000031.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.64: Mobile view for dashboard in the Power BI service</p>
    <p class="book-title--packt">The mobile view and functionality are very similar to the mobile layout in Power BI Desktop. A pinned live <a id="calibre_link-634" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>page to a dashboard becomes one dashboard tile, and thus only one mobile visual. Therefore, pinning individual report visuals to tiles in dashboards is necessary to effectively configure mobile-optimized dashboards.</p>
    <h2 id="calibre_link-1606" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power BI apps <a id="calibre_link-790" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for mobile devices: <a href="http://bit.ly/2q6SG8f" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2q6SG8f</span></a></li>
      <li class="bullet">Tips for Mobile Friendly Report Development with Power BI: <a href="https://bit.ly/3wpUJX8" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3wpUJX8</span></a></li>
    </ul>
    <h1 id="calibre_link-1224" class="title">Creating Paginated Reports</h1>
    <p class="book-title--packt">Microsoft has made <a id="calibre_link-701" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>great strides to ensure that paginated reports (SSRS-style reports) are first-class citizens in the Power BI universe. Power BI Premium supports such reports, as does the <strong class="screentext">Power BI Report Server</strong> (<strong class="screentext">PBIRS</strong>). The most recent evidence that Microsoft still <a id="calibre_link-812" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>embraces paginated reports for Power BI is the announcement of a planned report-building experience within Power BI Desktop for the creation of paginated reports and the <strong class="screentext">Paginated report </strong>visual released in May 2021. </p>
    <p class="book-title--packt">At this time, however, paginated reports must still be created in a separate tool, Power BI Report Builder. This recipe demonstrates how to download and install Power BI Report Builder and use this tool to build a paginated report.</p>
    <h2 id="calibre_link-1607" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Download Power BI Report <a id="calibre_link-803" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Builder from this location: <a href="https://bit.ly/2XOp1G1" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2XOp1G1</span></a>.</li>
      <li class="calibre12">Open the <strong class="screentext">PowerBIReportBuilder.msi</strong> file.</li>
      <li class="calibre12">Complete the installation using the wizard.</li>
    </ol>
    <p class="book-title--packt">When considering paginated reports, it is useful to confirm whether a paginated report should indeed be developed. The following questions can help confirm that a paginated report is required:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Does the report need to be printed across multiple pages? </li>
      <li class="calibre12">Is the report <a id="calibre_link-1608" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>more of a static operational report with just a table of data? </li>
      <li class="calibre12">Does the report data itself need to be delivered to people via email subscriptions?</li>
    </ol>
    <p class="book-title--packt">Yes answers to one or more of these questions can help provide confirmation that a paginated report is required.</p>
    <h2 id="calibre_link-1609" class="calibre8">How to Create Paginated Reports</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Run the <strong class="screentext">Power BI</strong> <strong class="screentext">Report Builder</strong> app.</li>
      <li class="calibre12">Upon opening <strong class="screentext">Power BI</strong> <strong class="screentext">Report Builder</strong>, choose <strong class="screentext">New Report</strong> and <strong class="screentext">Table or Matrix Wizard</strong>.<figure class="mediaobject"><img src="images/000043.png" alt="Graphical user interface, text, application, email  Description automatically generated" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.65: Report Builder Getting Started dialog</p>
      </li>
      <li class="calibre12">Choose <strong class="screentext">Create a dataset</strong> and click <strong class="screentext">Next</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">New</strong> to create a new data source connection.</li>
      <li class="calibre12">Choose the <a id="calibre_link-702" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>connection type <strong class="screentext">Microsoft SQL Server</strong>.</li>
      <li class="calibre12">Use the <strong class="screentext">Build</strong> option to configure the data source; when finished, click the <strong class="screentext">OK</strong> button.<figure class="mediaobject"><img src="images/000055.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.66: Creating a new data source</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">OK</strong> button.</li>
      <li class="calibre12">Click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Expand <strong class="screentext">Views</strong> and <a id="calibre_link-703" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>then expand the <strong class="screentext">vProducts</strong> view to select the following fields:<ul class="calibre11">
          <li class="calibre12"><strong class="screentext">ProductKey</strong></li>
          <li class="calibre12"><strong class="screentext">EnglishProductName</strong></li>
          <li class="calibre12"><strong class="screentext">EnglishProductCategoryName</strong></li>
          <li class="calibre12"><strong class="screentext">EnglishProductSubcategoryName</strong></li>
          <li class="calibre12"><strong class="screentext">DaysToManufacture</strong></li>
          <li class="calibre12"><strong class="screentext">Color</strong></li>
        </ul>
      </li>
      <li class="calibre12">Expand <strong class="screentext">Tables</strong>, and then expand the <strong class="screentext">FactInternetSales</strong> table to select the following fields:<ul class="calibre11">
          <li class="calibre12"><strong class="screentext">ProductKey</strong></li>
          <li class="calibre12"><strong class="screentext">OrderQuantity</strong></li>
          <li class="calibre12"><strong class="screentext">UnitPrice</strong></li>
          <li class="calibre12"><strong class="screentext">DiscountAmount</strong></li>
          <li class="calibre12"><strong class="screentext">SalesAmount</strong></li>
          <li class="calibre12"><strong class="screentext">TaxAmt</strong></li>
          <li class="calibre12"><strong class="screentext">Freight</strong></li>
          <li class="calibre12"><strong class="screentext">OrderDate</strong></li>
        </ul>
      </li>
      <li class="calibre12">Expand <a id="calibre_link-704" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Relationships</strong> area, deselect <strong class="screentext">Auto Detect</strong>, and press the <strong class="screentext">Add Relationship</strong> icon.<figure class="mediaobject"><img src="images/000067.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.67: Add Relationship</p>
      </li>
      <li class="calibre12">Select <strong class="screentext">vProducts</strong> for the <strong class="screentext">Left Table and</strong> <strong class="screentext">FactInternetSales</strong> as the <strong class="screentext">Right Table</strong>.<figure class="mediaobject"><img src="images/000079.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.68: Join tables</p>
      </li>
      <li class="calibre12">Double-click the area under <strong class="screentext">Join Fields</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Edit Related Fields</strong> dialog box, click the <strong class="screentext">Add Field</strong> icon and then choose the <strong class="screentext">ProductKey</strong> field from each table; click the <strong class="screentext">OK</strong> button.<figure class="mediaobject"><img src="images/000091.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.69: Edit related fields</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">Design a query</strong> dialog box, click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">In the <strong class="screentext">Arrange fields</strong> dialog, put the following fields into the <strong class="screentext">Row groups</strong> area, in this order:<ul class="calibre11">
          <li class="calibre12"><strong class="screentext">EnglishProductCategoryName</strong></li>
          <li class="calibre12"><strong class="screentext">EnglishProductSubcategoryName</strong></li>
          <li class="calibre12"><strong class="screentext">EnglishProductName</strong></li>
        </ul>
      </li>
      <li class="calibre12">Put the <a id="calibre_link-705" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>following fields into the <strong class="screentext">Values</strong> area:<ul class="calibre11">
          <li class="calibre12"><strong class="screentext">OrderQuantity</strong></li>
          <li class="calibre12"><strong class="screentext">UnitPrice</strong></li>
          <li class="calibre12"><strong class="screentext">DiscountAmount</strong></li>
          <li class="calibre12"><strong class="screentext">SalesAmount</strong></li>
          <li class="calibre12"><strong class="screentext">TaxAmt</strong></li>
          <li class="calibre12"><strong class="screentext">Freight</strong></li>
        </ul>
      </li>
      <li class="calibre12">Leave the aggregation as <strong class="screentext">Sum</strong>; this can also be changed using the drop-down for the <a id="calibre_link-804" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>field in the <strong class="screentext">Values</strong> area.</li>
      <li class="calibre12">Click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">In the <strong class="screentext">Choose the layout</strong> dialog, choose <strong class="screentext">Stepped, subtotal above</strong> and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Click <strong class="screentext">Finish &gt;&gt;</strong> on the <strong class="screentext">Preview</strong> screen.<figure class="mediaobject"><img src="images/000104.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.70: Report Builder design view</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Run</strong> button in the ribbon.<figure class="mediaobject"><img src="images/000117.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 4.71: Report matrix</p>
      </li>
      <li class="calibre12">Save the report as <code class="code-in-text--packt">CH4_R11.rdl</code>.</li>
    </ol>
    <h2 id="calibre_link-1610" class="calibre8">How it works</h2>
    <p class="book-title--packt">Report Builder is <a id="calibre_link-706" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the newest report-building tool in a long line of such tools that use the <strong class="screentext">Report Definition Language</strong> (<strong class="screentext">RDL</strong>). RDL files are actually XML files. Here <a id="calibre_link-950" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is the first part of the XML for the report just created:</p>
    <pre class="programlisting"><code class="hljs"><span>&lt;?xml</span> <span>version="1.0"</span> <span>encoding="utf-8"?&gt;</span>
<span>&lt;Report</span> <span>MustUnderstand="df"</span> <span>xmlns="http://schemas.microsoft.com/sqlserver/reporting/2016/01/reportdefinition"</span> <span>xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner"</span> <span>xmlns:df="http://schemas.microsoft.com/sqlserver/reporting/2016/01/reportdefinition/defaultfontfamily"&gt;</span>
  <span>&lt;df:DefaultFontFamily&gt;Segoe</span> <span>UI&lt;/df:DefaultFontFamily&gt;</span>
  <span>&lt;AutoRefresh&gt;0&lt;/AutoRefresh&gt;</span>
  <span>&lt;DataSources&gt;</span>
    <span>&lt;DataSource</span> <span>Name="DataSource1"&gt;</span>
      <span>&lt;ConnectionProperties&gt;</span>
        <span>&lt;DataProvider&gt;SQL&lt;/DataProvider&gt;</span>
        <span>&lt;ConnectString&gt;Data</span> <span>Source=localhost\MSSQLSERVERDEV;Initial</span> <span>Catalog=AdventureWorksDW2019&lt;/ConnectString&gt;</span>
        <span>&lt;IntegratedSecurity&gt;true&lt;/IntegratedSecurity&gt;</span>
      <span>&lt;/ConnectionProperties&gt;</span>
      <span>&lt;rd:SecurityType&gt;Integrated&lt;/rd:SecurityType&gt;</span>
      <span>&lt;rd:DataSourceID&gt;a781f7ac-7bae-4de2-bf08-240a90e5e558&lt;/rd:DataSourceID&gt;</span>
    <span>&lt;/DataSource&gt;</span>
  <span>&lt;/DataSources&gt;</span>
  <span>&lt;DataSets&gt;</span>
    <span>&lt;DataSet</span> <span>Name="DataSet1"&gt;</span>
      <span>&lt;Query&gt;</span>
        <span>&lt;DataSourceName&gt;DataSource1&lt;/DataSourceName&gt;</span>
</code></pre>
    <p class="book-title--packt">RDL files have been used in conjunction with SSRS since SSRS was first released. Power BI Report Server and Power BI Premium both support RDL files. If you have either Power BI Report Server or Power BI Premium, you can use the <strong class="screentext">Publish</strong> button in the ribbon of the <strong class="screentext">Home</strong> tab <a id="calibre_link-707" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to publish the report.</p>
    <p class="book-title--packt">Unlike Power BI Desktop, you do not import data into an RDL file. Datasets comprise the data source, queries, and field definitions stored within the RDL file. Thus, running a report always makes one or more queries back to the data source(s).</p>
    <h2 id="calibre_link-1611" class="calibre8">There's more...</h2>
    <p class="book-title--packt">There is a tremendous amount of functionality and capability present in Power BI Report Builder&mdash;functionality that <a id="calibre_link-806" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is far beyond the scope <a id="calibre_link-802" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of a single recipe. However, some of the highlights include the ability to use Power BI datasets in the service as data sources, numerous available visual elements, calculated fields, and formatting.</p>
    <p class="book-title--packt">When adding a <strong class="screentext">Data Source</strong>, the option exists to <strong class="screentext">Add Power BI Dataset Connection</strong>. After signing into the Power BI service, you can select any dataset in any workspace to which you have access. Once you have added the Power BI dataset data source, you can create a dataset with that data source. A <strong class="screentext">Query Designer</strong> window is available for constructing <a id="calibre_link-906" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>queries against the dataset.</p>
    <figure class="mediaobject"><img src="images/000128.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.72: Query Designer</p>
    <p class="book-title--packt">Power BI Report Builder includes a number of visual elements available in the <strong class="screentext">Insert</strong> menu, including:</p>
    <ul class="calibre9">
      <li class="bullet"><strong class="screentext">Table</strong></li>
      <li class="bullet"><strong class="screentext">Matrix</strong></li>
      <li class="bullet"><strong class="screentext">List</strong></li>
      <li class="bullet"><strong class="screentext">Column Chart</strong></li>
      <li class="bullet"><strong class="screentext">Line Chart</strong></li>
      <li class="bullet"><strong class="screentext">Pie Chart</strong></li>
      <li class="bullet"><strong class="screentext">Bar Chart</strong></li>
      <li class="bullet"><strong class="screentext">Area Chart</strong></li>
      <li class="bullet"><strong class="screentext">Gauge</strong></li>
      <li class="bullet"><strong class="screentext">MAP</strong></li>
      <li class="bullet"><strong class="screentext">ESRI Shapefile</strong></li>
      <li class="bullet"><strong class="screentext">Data Bar</strong></li>
      <li class="bullet"><strong class="screentext">Sparkline</strong></li>
      <li class="bullet"><strong class="screentext">Indicator</strong></li>
    </ul>
    <p class="book-title--packt">Also available <a id="calibre_link-805" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>are elements such as <strong class="screentext">Text Box</strong>, <strong class="screentext">Image</strong>, <strong class="screentext">Line</strong>, and <strong class="screentext">Rectangle</strong>. Reports can also include <strong class="screentext">Subreports</strong>, <strong class="screentext">Headers</strong>, and <strong class="screentext">Footers</strong>.</p>
    <p class="book-title--packt">Calculated fields can be created using numerous functions and operators; the following two formulas create calculated fields for <strong class="screentext">TaxAndFreight</strong> and <strong class="screentext">Year</strong>, respectively:</p>
    <pre class="programlisting"><code class="hljs">=Fields!TaxAmt.Value+Fields!Freight.Value
=Year(Fields!OrderDate.Value)
</code></pre>
    <figure class="mediaobject"><img src="images/000140.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 4.73: Dataset Properties</p>
    <p class="book-title--packt">You can format cells by clicking on the cell in the grid and then using the ribbon of the <strong class="screentext">Home</strong> tab to format information that appears in the column and row. For example, row headers can be put in bold and monetary fields set to <strong class="screentext">Currency</strong>.</p>
    <figure class="mediaobject"><img src="images/000153.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 74: Paginated report</p>
    <h2 id="calibre_link-1612" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power BI Report Builder: <a href="http://bit.ly/3rLCg3I" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3rLCg3I</span></a></li>
      <li class="bullet">Sample <a id="calibre_link-708" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI paginated reports: <a href="http://bit.ly/2PonXVE" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2PonXVE</span></a></li>
      <li class="bullet">What are paginated reports in Power BI Premium?: <a href="http://bit.ly/31F4tOS" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/31F4tOS</span></a></li>
    </ul>
    <h1 id="calibre_link-1225" class="title">Conclusion</h1>
    <p class="book-title--packt">Power BI reports serve as the foundation for dashboards, data exploration, and content collaboration and distribution in Power BI. Power BI Desktop provides data visualization features and options in abundance, enabling the construction of highly targeted and user-friendly reports across devices. In this chapter, we developed and described the most fundamental report visualizations and design concepts. Additionally, guidance was provided to enhance and control the user experience when interacting with Power BI reports and consuming them on Windows and mobile devices.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-5">
<div id="calibre_link-1613" class="calibre2">
<div id="calibre_link-1614" class="calibre3"><div id="calibre_link-1615" class="calibre4">
    <h1 class="heading">5</h1>
    <h1 id="calibre_link-1226" class="title">Working in the Service</h1>
    <blockquote class="packt_quote pcalibre6">"A dashboard is really a content aggregator. It lets you bring together lots of different data sources in one place so you can have a 360 degree view of your business on one dashboard."<p class="cite">- Adam Wilson, group program manager for the Power BI service</p></blockquote>
    
    <p class="book-title--packt">Power BI dashboards are collections of tiles created in the Power BI service, representing the visuals from one or many Power BI reports and, optionally, other sources, such as<a id="calibre_link-1031" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Excel and SQL Server Reporting Services (SSRS). Dashboards <a id="calibre_link-566" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>are best utilized to centralize essential key performance indicators (KPIs), measures, and trends in a visual- and mobile-optimized layout. Additionally, dashboards can provide an entryway to other dashboards or reports and are further enhanced with URL links, streaming data, images, web content, and interactivity. </p>
    <p class="book-title--packt">In this chapter, Power BI dashboards are constructed to provide intuitive, at-a-glance monitoring of critical measures and high-impact business activities. The unique features of dashboards, such as Q&amp;A natural language queries, data alerts, and the integration of other report types&mdash;such as Excel and SSRS&mdash;are also included. Finally, the creation of additional content objects, such as streaming datasets and dataflows, is also included.</p>
    <p class="book-title--packt">In this chapter, we will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Building a Dashboard</li>
      <li class="bullet">Preparing for Q&amp;A</li>
      <li class="bullet">Adding Alerts and Subscriptions</li>
      <li class="bullet">Deploying Content from Excel and SSRS</li>
      <li class="bullet">Streaming Datasets</li>
      <li class="bullet">Authoring Dataflows</li>
    </ul>
    <h1 id="calibre_link-1227" class="title">Technical Requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop and a Power BI service account.</li>
      <li class="bullet">SQL Server with the <code class="code-in-text--packt">AdventureWorksDW2019</code> database installed. This database and instructions for installing it are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a>.</li>
      <li class="bullet">Files for this chapter and can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a>.</li>
    </ul>
    <h1 id="calibre_link-1228" class="title">Building a Dashboard</h1>
    <p class="book-title--packt">With a robust dataset <a id="calibre_link-214" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and multiple reports created in Power BI Desktop, dashboards can be developed in the Power BI service to consolidate the most valuable KPIs, measures, and visualizations onto a single pane of glass. Additionally, dashboards provide an access point to the detailed reports supporting the tiles and are optimized for mobile access through the Power BI mobile application.</p>
    <p class="book-title--packt">Power BI dashboards are commonly used by executives and senior managers who desire an intuitive, consolidated view of relevant KPIs and visualizations. In many cases, these stakeholders will almost exclusively rely on dashboards rather than the more detailed and interactive reports underlying the dashboards. Such dashboards are often sourced from reports built against multiple datasets reflecting different business processes and functional areas such as Accounting and Supply Chain. Enterprise dashboards typically utilize card and KPI visuals to focus on strategic objectives and maximize canvas space. Given the scale and breadth of data sources for a modern enterprise, a significant level of coordination is required to ensure that all datasets supporting the dashboard represent an appropriate level of data quality and governance.</p>
    <p class="book-title--packt">The report design planning process described in <em class="italic">Chapter 4</em>, <em class="italic">Authoring Power BI Reports</em>, is directly applicable to dashboards as well. It is important to confirm that the existing data model (or models) support the required business questions and metrics exposed in a dashboard.</p>
    <p class="book-title--packt">In this recipe, a sales dashboard is created for the North American sales management team. Four reports have been built against the same Power BI dataset (data model) and the visuals from these reports are pinned as tiles to the sales dashboard.</p>
    <figure class="mediaobject"><img src="images/000166.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 5.1: North America sales dashboard structure: 4 reports and 1 dataset</p>
    <h2 id="calibre_link-1616" class="calibre8">Getting Ready</h2>
    <p class="book-title--packt">To prepare for <a id="calibre_link-215" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12">Log in to the Power BI service.</li>
      <li class="calibre12">Click on <strong class="screentext">Workspaces</strong> in the left navigation pane and select <strong class="screentext">Create a workspace</strong> at the bottom of the fly-out. If you cannot create a workspace, check with your Power BI administrator, as they may have disabled this option.<figure class="mediaobject"><img src="images/000179.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.2: Create a workspace</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">Create a workspace</strong> dialog, enter a <strong class="screentext">Workspace name</strong> and click <strong class="screentext">Save</strong>.</li>
      <li class="calibre12">In the center area, click <strong class="screentext">Add content</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Get Data</strong> dialog, click the <strong class="screentext">Get</strong> button for <strong class="screentext">Files</strong>.<figure class="mediaobject"><img src="images/000192.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.3: Get Data, Files</p>
      </li>
      <li class="calibre12">Choose <strong class="screentext">Local File</strong>.</li>
      <li class="calibre12">Select the <code class="code-in-text--packt">CH5_R1_SalesAndFinanceDataset.pbix</code> file and click <strong class="screentext">Open</strong>.</li>
      <li class="calibre12">Open the <code class="code-in-text--packt">CH5_R1_RegionMonthlyReport.pbix</code> file in Power BI Desktop.</li>
      <li class="calibre12">Sign in to the Power BI service if necessary, and in the <strong class="screentext">Unable to connect</strong> dialog, choose <strong class="screentext">Edit</strong>. If you receive an error, contact your administrator to allow a connection to live datasets.</li>
      <li class="calibre12">On the <strong class="screentext">Select a dataset to create a report</strong> page, choose the <strong class="screentext">CH5_R1_SalesAndFinanceDataset</strong>, and then click the <strong class="screentext">Create</strong> button.</li>
      <li class="calibre12"><strong class="screentext">Save</strong> and <strong class="screentext">Publish</strong> the report to the service in the <strong class="screentext">Workspace</strong> created in <em class="italic">step 3</em>.</li>
      <li class="calibre12">Repeat <em class="italic">steps 8</em>, <em class="italic">9</em>, <em class="italic">10</em>, and <em class="italic">11</em> for <code class="code-in-text--packt">CH5_R1_CountryMonthlyReport.pbix</code>, and <code class="code-in-text--packt">CH5_R1_MarginAnalysisReport.pbix</code>.</li>
    </ol>
    <p class="book-title--packt">If you are<a id="calibre_link-216" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> unable to create a <strong class="screentext">Workspace</strong> in the Power BI service, you can use <strong class="screentext">My workspace</strong> instead. After completing these steps, the reports all have a live connection back to the dataset, <code class="code-in-text--packt">CH5_R1_SalesAndFinanceDataset</code>.</p>
    <h2 id="calibre_link-1617" class="calibre8">How to Build a Dashboard</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the Power BI service, select the workspace created in the <em class="italic">Getting started</em> section of this recipe.</li>
      <li class="calibre12">In the central area, click <strong class="screentext">New</strong> and then choose <strong class="screentext">Dashboard</strong>.<figure class="mediaobject"><img src="images/000204.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.4: Create a new dashboard</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">Create dashboard</strong> dialog, enter <strong class="screentext">North American Sales</strong> for <strong class="screentext">Dashboard name</strong> and then click <strong class="screentext">Create</strong>.</li>
      <li class="calibre12">A blank dashboard is created; click on the workspace in the left navigation pane and note that the <strong class="screentext">North American Sales</strong> dashboard is shown in the list.</li>
      <li class="calibre12">In the service, open the <strong class="screentext">CH5_R1_RegionMonthlyReport</strong> report and navigate to the <strong class="screentext">North America</strong> page.</li>
      <li class="calibre12">Hover your <a id="calibre_link-217" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>mouse over the <strong class="screentext">Monthly Internet Sales</strong> KPI visualization and click the pin visual icon.<figure class="mediaobject"><img src="images/000215.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.5: Pin visual</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">Pin to dashboard</strong> dialog, choose <strong class="screentext">Existing dashboard</strong>, select <strong class="screentext">North American Sales</strong>, and then click the <strong class="screentext">Pin</strong> button.<figure class="mediaobject"><img src="images/000227.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.6: Pin to dashboard</p>
      </li>
      <li class="calibre12">Pin the <strong class="screentext">Monthly Internet Margin %</strong> KPI visualization to the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">Open <a id="calibre_link-1618" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">CH5_R1_MarginAnalysisReport</strong> report in the service.</li>
      <li class="calibre12">In the <strong class="screentext">Sales Group</strong> slicer, choose <strong class="screentext">North America</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Calendar Month</strong> slicer, choose <strong class="screentext">2013-Dec</strong>, <strong class="screentext">2013-Nov</strong>, <strong class="screentext">2013-Oct</strong>, <strong class="screentext">2013-Sep</strong>, <strong class="screentext">2013-Aug</strong>, and <strong class="screentext">2013-Jul</strong>.</li>
      <li class="calibre12">Pin the <strong class="screentext">Net Sales vs. Last Year</strong> clustered column chart visualization to the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">Open the <strong class="screentext">CH5_R1_CustomerActivityReport</strong> report in the service.</li>
      <li class="calibre12">In the <strong class="screentext">Sales Group</strong> slicer, choose <strong class="screentext">North America</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Calendar Month</strong> slicer, choose <strong class="screentext">2013-Dec</strong>, <strong class="screentext">2013-Nov</strong>, <strong class="screentext">2013-Oct</strong>, <strong class="screentext">2013-Sep</strong>, <strong class="screentext">2013-Aug</strong>, and <strong class="screentext">2013-Jul</strong>.</li>
      <li class="calibre12">Pin the <strong class="screentext">Monthly Customers</strong> KPI visualization to the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">Pin the <strong class="screentext">YTD Net Sales vs. Last Year</strong> gauge visualization to the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">Pin the <strong class="screentext">Customer Count by Region</strong> stacked column chart visualization to the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">Pin the <strong class="screentext">YTD Net Sales by Region</strong> clustered bar chart visualization to the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">Open the <strong class="screentext">CH5_R1_CountryMonthlyReport</strong> report in the service.</li>
      <li class="calibre12">Navigate to the <strong class="screentext">United States</strong> report page.</li>
      <li class="calibre12">Pin the filled map visualization to the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">Navigate to the <strong class="screentext">Canada</strong> report page.</li>
      <li class="calibre12">Pin the Filled map visualization to the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">Open the <strong class="screentext">North American Sales</strong> dashboard in the service.</li>
      <li class="calibre12">Move and resize the dashboard tiles such that the most important visuals are in the top-left corner.</li>
      <li class="calibre12">On the <strong class="screentext">Filled </strong>map for the <strong class="screentext">United States</strong>, hover over the tile and select the ellipsis (<strong class="screentext">â¦</strong>) from the upper-right corner.</li>
      <li class="calibre12">Choose <strong class="screentext">Edit details</strong>.</li>
      <li class="calibre12">Edit <a id="calibre_link-218" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Title</strong> to be <strong class="screentext">Internet Net Sales by State</strong>, remove the <strong class="screentext">Subtitle</strong> text, and click <strong class="screentext">Apply</strong>.</li>
      <li class="calibre12">Repeat <em class="italic">steps 27</em> to <em class="italic">29</em> for the Canada map using <strong class="screentext">Internet Net Sales by Province</strong> as the <strong class="screentext">Title</strong>.<figure class="mediaobject"><img src="images/000238.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.7: North American Sales dashboard</p>
        <div class="pcalibre4 pcalibre5 note">
          <p class="book-title--packt">The dashboard provides an overview of the measures most important to the North America sales team. You can access any of the four underlying reports by clicking on a dashboard tile.</p>
          <p class="book-title--packt">Note that resizing and moving dashboard tiles can be tricky at first. Hovering over a dashboard tile with your cursor displays a single resizing handle in the bottom-right corner of the tile. Click on this resizing handle to resize the tile. Tiles resize to preconfigured tile sizes displayed by the gray box displayed around the tile while resizing. When moving a tile, click and hold on the tile to move the tile around on the dashboard. Other tiles will automatically move depending upon where you place the tile. Release the mouse button to place the tile.</p>
        </div>
      </li>
      <li class="calibre12">Just <a id="calibre_link-219" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>above the main dashboard area, select <strong class="screentext">Edit</strong> and then <strong class="screentext">Add a tile</strong>.<figure class="mediaobject"><img src="images/000251.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.8: Dashboard Edit menu</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">Add a tile</strong> panel, choose <strong class="screentext">Image</strong>, then click <strong class="screentext">Next</strong>.</li>
      <li class="calibre12">In <strong class="screentext">URL</strong>, place the following link: <a href="https://bit.ly/3mhzBxv" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3mhzBxv</span></a>.</li>
      <li class="calibre12">Check the <strong class="screentext">Set custom link</strong> checkbox.</li>
      <li class="calibre12">Set <strong class="screentext">Link type</strong> to <strong class="screentext">External link</strong> and <strong class="screentext">URL</strong> to <a href="http://www.adventure-works.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://www.adventure-works.com</span></a>.<figure class="mediaobject"><img src="images/000262.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.9: Image tile settings</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Apply</strong> button.</li>
      <li class="calibre12">Add another tile, this time a <strong class="screentext">Text </strong>box.</li>
      <li class="calibre12">Add text to the <strong class="screentext">Content</strong> area; notice that you can use the <strong class="screentext">Insert link</strong> icon to add active links.<figure class="mediaobject"><img src="images/000273.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.10: Text box tile settings</p>
      </li>
      <li class="calibre12">Click<a id="calibre_link-220" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Apply</strong> button.</li>
      <li class="calibre12">From the <strong class="screentext">Edit</strong> menu of the report, choose <strong class="screentext">Mobile view</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Unpinned tiles</strong> pane, pin the new tiles to the <strong class="screentext">Phone view</strong>.</li>
      <li class="calibre12">Drag and drop tiles to reposition or resize them using the sizing handle at the lower right.<figure class="mediaobject"><img src="images/000286.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.11: Dashboard Mobile view</p>
      </li>
      <li class="calibre12">When finished, at the upper right, select the dropdown for <strong class="screentext">Phone view</strong> and switch to <strong class="screentext">Web view</strong>.</li>
    </ol>
    <h2 id="calibre_link-1619" class="calibre8">How it works</h2>
    <p class="book-title--packt">It is important to understand that dashboard tiles maintain the filter context at the time the report visual is pinned. This is often a source of confusion for users and designers alike, as depending upon the design, a tile may appear to not update. For example, in the recipe, the last six months of 2013 were selected in the slicer before pinning the <strong class="screentext">Net Sales vs. Last Year </strong>tile. Assuming that December 2013 is "today," when the data comes in for January 2014, this <strong class="screentext">Net Sales vs. Last Year</strong> tile would not reflect data for January 2014. The tile would have to be unpinned and re-pinned with the new month included. To avoid situations like this, use <strong class="screentext">Relative Date</strong> slicers/filters or base filtering on a flag field column that returns 1 if data is within a chosen range and 0 otherwise. This can be <a id="calibre_link-221" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>done in DAX or M; a DAX example is as follows:</p>
    <pre class="programlisting"><code class="hljs">6MonthFlag Column = 
    VAR __Today = TODAY()
    VAR __EOM6Months = EOMONTH(__Today,-6)
    VAR __MinDate = DATE(YEAR(__EOM6Months),MONTH(__EOM6Months),1)
RETURN
    IF('Dates'[Date] &gt;= __MinDate &amp;&amp; 'Dates'[Date] &lt;= __Today,1,0)
</code></pre>
    <p class="book-title--packt">As demonstrated, dashboard tiles do not have to come from reports and can be added manually to include Image, Video, Text box, Web content, and Streaming data. In addition, a single dashboard can have tiles that come from reports that do not share the same dataset. Thus, if each of the four recipes in this model used different datasets, the exact same dashboard could still be created, as long as the reports all existed within the same workspace. In large enterprise organizations with many dashboards and reports, dashboards are sometimes used purely as a navigation device. By adding tiles of images or text, and using the ability to set custom links, a dashboard could be configured simply to link to other organizational dashboards.</p>
    <h2 id="calibre_link-1620" class="calibre8">There's more</h2>
    <p class="book-title--packt">By default, the tiles of a dashboard are independent of each other, and cannot be filtered or interacted with, such as when cross-filtering between visualizations. Additionally, modifications to reports after visuals have been pinned to dashboards, such as filter and layout changes, are not automatically reflected in the dashboards. In many scenarios, the users consuming a dashboard want to retain the interactive filtering experience of Power BI reports from within their dashboard, and so it can be helpful to automatically synchronize reports with dashboards. Luckily, Power BI supports the pinning of entire report pages to a dashboard. To see how this works, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the report <strong class="screentext">CH5_R1_RegionMonthlyReport</strong> in the service.</li>
      <li class="calibre12">From the menu bar of the report, click the ellipsis (<strong class="screentext">â¦</strong>) and choose <strong class="screentext">Pin to a dashboard</strong>.<figure class="mediaobject"><img src="images/000298.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.12: Pin to a dashboard</p>
      </li>
      <li class="calibre12">After selecting <strong class="screentext">Pin to a dashboard</strong>, choose <strong class="screentext">Existing dashboard</strong>, select the <strong class="screentext">North American Sales</strong> dashboard, and click the <strong class="screentext">Pin live</strong> button.</li>
      <li class="calibre12">Navigate to the <strong class="screentext">North American Sales</strong> dashboard, scroll down, and note that the report is now pinned as a tile.</li>
    </ol>
    <p class="book-title--packt">The user of the <a id="calibre_link-222" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>dashboard can interact with the region and date slicers and other visuals on the live page. Given the size of the report page, it is generally not a good idea to pin a live report page to the <strong class="screentext">Mobile view</strong>. The ellipsis at the top right of the live page tile includes the option <strong class="screentext">Go to report</strong> link to access all pages of the live page report. Modifications to the underlying report will be reflected on the pinned live page. The other visuals link to their report pages.</p>
    <h2 id="calibre_link-1621" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Intro to <a id="calibre_link-223" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>dashboards for Power BI designers: <a href="http://bit.ly/31KvIrv" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/31KvIrv</span></a></li>
      <li class="bullet">Tips for <a id="calibre_link-755" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>designing a great Power BI dashboard: <a href="http://bit.ly/2PspxG3" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2PspxG3</span></a></li>
      <li class="bullet">Add images, videos, and more to your dashboard: <a href="https://bit.ly/31QypHP" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/31QypHP</span></a></li>
    </ul>
    <h1 id="calibre_link-1229" class="title">Preparing for Q&amp;A</h1>
    <p class="book-title--packt">Q&amp;A can be <a id="calibre_link-875" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a powerful method of enabling users to explore datasets, enabling them to directly submit their own questions in both the Power BI service and through the Power BI mobile application. The tables and measures of each dataset, represented by a tile on the dashboard, are available to answer Q&amp;A questions.</p>
    <p class="book-title--packt">This recipe provides data model design and metadata tips to prepare a dataset for Q&amp;A. Additionally, synonyms are added to a Power BI Desktop data model to improve the accuracy of natural language queries.</p>
    <h2 id="calibre_link-1622" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe:</p>
    <ul class="calibre9">
      <li class="bullet">Complete the first recipe in this chapter, <em class="italic">Building a Dashboard</em>.</li>
    </ul>
    <h2 id="calibre_link-1623" class="calibre8">How to Prepare for Q&amp;A</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open<a id="calibre_link-876" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">At the upper left of the dashboard, click <strong class="screentext">Ask a question about your data</strong>.<figure class="mediaobject"><img src="images/000310.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.13: Power BI Q&amp;A</p>
      </li>
      <li class="calibre12">Type the following: <code class="code-in-text--packt">wholesaler net sales by country</code>.</li>
      <li class="calibre12">Notice that the word <strong class="screentext">wholesaler</strong> is double-underlined in red, <strong class="screentext">net sales</strong> is underlined in blue, and <strong class="screentext">country</strong> is underlined with a dashed red line.<figure class="mediaobject"><img src="images/000322.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.14: Showing results for net sales by reseller country</p>
      </li>
      <li class="calibre12">Hover over one of the map bubbles displayed and notice that the tooltip reads <strong class="screentext">Total Net Sales</strong>, and <em class="italic">not</em> <strong class="screentext">Reseller Net Sales</strong>.</li>
      <li class="calibre12">Click the thumbs-down icon in the lower-right corner of the screen.</li>
      <li class="calibre12">Open the file <code class="code-in-text--packt">CH5_R1_SalesAndFinanceDataset.pbix</code>.</li>
      <li class="calibre12">Change to the <strong class="screentext">Model</strong> view.</li>
      <li class="calibre12">Click <strong class="screentext">Q&amp;A setup</strong> in the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">In the <strong class="screentext">Q&amp;A setup</strong> dialog, click the <strong class="screentext">Review questions</strong> tab and notice that the question asked is present in the list. Note that you may have to wait a few minutes, using the refresh icon for the question to display.<figure class="mediaobject"><img src="images/000333.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.15: Review questions</p>
      </li>
      <li class="calibre12">Click the pencil icon under the <strong class="screentext">Fix needed</strong> column. Note that if the question does not<a id="calibre_link-877" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> appear after a few minutes, simply proceed to the <strong class="screentext">Teach Q&amp;A</strong> tab, enter the question <strong class="screentext">wholesaler net sales by country</strong>, click the <strong class="screentext">Submit</strong> button, and proceed to <em class="italic">Step 13</em>.</li>
      <li class="calibre12">The <strong class="screentext">Teach Q&amp;A</strong> tab is opened with the question displayed.</li>
      <li class="calibre12">The word "wholesaler" is flagged between two handles; in <strong class="screentext">Define the terms Q&amp;A didn't understand</strong>, type <strong class="screentext">reseller</strong> in the input field (see <em class="italic">Figure 5.16</em>).<figure class="mediaobject"><img src="images/000345.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.16: Adding synonym for reseller</p>
      </li>
      <li class="calibre12">Click <strong class="screentext">Save</strong>, but notice that the map visual is still not correct.</li>
      <li class="calibre12">Drag the right handle (the red stick and circle) to include the entire phrase <strong class="screentext">wholesaler net sales</strong> and click <strong class="screentext">Submit</strong>.<figure class="mediaobject"><img src="images/000356.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.17: Adding term for wholesaler net sales</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">Define the terms Q&amp;A didn't understand</strong> dialog box, type <strong class="screentext">reseller net sales</strong> in the input field and notice that the map updates; the correct information is now displayed in the tooltip.</li>
      <li class="calibre12">Click the <strong class="screentext">Save</strong> button.</li>
      <li class="calibre12">Click the <strong class="screentext">Manage terms</strong> tab and notice that <strong class="screentext">wholesaler</strong> and <strong class="screentext">wholesaler net sale</strong> are now defined as terms with the correct definitions.</li>
      <li class="calibre12">Click on the <strong class="screentext">Field synonyms</strong> tab, expand the <strong class="screentext">Resellers</strong> table and note that the <strong class="screentext">wholesaler</strong> synonym <a id="calibre_link-878" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>has been added for the <strong class="screentext">Resellers</strong> table.<figure class="mediaobject"><img src="images/000367.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.18: Table synonym</p>
      </li>
      <li class="calibre12">Expand the <strong class="screentext">Reseller Sales</strong> table, scroll down, and see that the <strong class="screentext">wholesaler net sale</strong> synonym has been added to the <strong class="screentext">Reseller Net Sales</strong> measure.<figure class="mediaobject"><img src="images/000378.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.19: Measure synonym</p>
      </li>
      <li class="calibre12">Close the <strong class="screentext">Q&amp;A setup</strong> dialog using the close button in the upper-right corner.</li>
    </ol>
    <h2 id="calibre_link-1624" class="calibre8">How it works</h2>
    <p class="book-title--packt">Power BI Q&amp;A supports Import mode and live connections to Azure Analysis Services, SQL Server Analysis Services (with a gateway), and Power BI datasets. RLS is supported for those data <a id="calibre_link-1625" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>sources. Additionally, Q&amp;A supports DirectQuery to SQL DirectQuery sources, such as Azure SQL Database, Azure Synapse Analytics, and SQL Server 2019. Q&amp;A is not supported for composite data models or Reporting Services.</p>
    <p class="book-title--packt">Synonyms are a crucial part of making sure that business users find the Q&amp;A experience easy and intuitive&mdash;as well as getting the right answers to their questions. Synonyms allow a semantic layer to be added to the data model that uses business terminology instead of purely just the names of tables, columns, and measures within the model. Tables, columns, and measures can be included or excluded from Q&amp;A and can have synonyms defined.</p>
    <p class="book-title--packt">Some general<a id="calibre_link-881" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> tips for setting up a Q&amp;A include the following:</p>
    <ul class="calibre9">
      <li class="bullet">Revise any columns with incorrect data types, such as dates or numbers that are stored as text data types.</li>
      <li class="bullet">Set the default summarization for dimension columns to <strong class="screentext">Do not summarize</strong>.</li>
      <li class="bullet">Associate geographical columns, such as states and zip codes, with a related data category.</li>
      <li class="bullet">Split columns containing multiple values into distinct columns.</li>
      <li class="bullet">Normalize tables such that entities within the tables are moved to their own distinct table; for example, columns of a vendor in a products table can be moved to a vendor table.</li>
      <li class="bullet">Q&amp;A queries only work with the active relationships of a model. Consider dedicated role-playing dimensions with active relationships. Alternatively, consider de-normalizing an inactive relationship dimension into a fact table.</li>
      <li class="bullet">Define the top or most common natural language questions and test for accuracy in Power BI.</li>
      <li class="bullet">Identify the gaps between the names of data model entities and the names used in natural language queries.</li>
      <li class="bullet">Focus on entities with longer and less intuitive names that are not used casually by the users.</li>
      <li class="bullet">Avoid reusing the same synonym across multiple entities, as this can lead to incorrect query results.</li>
      <li class="bullet">Ensure that<a id="calibre_link-1626" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the primary synonym for each entity of the model is unique.</li>
    </ul>
    <h2 id="calibre_link-1627" class="calibre8">There's more</h2>
    <p class="book-title--packt">Q&amp;A may not be<a id="calibre_link-879" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> appropriate for certain dashboards and datasets. For example, the Q&amp;A search bar <strong class="screentext">Ask a question about your data</strong> may be a distraction to users who only want to view the KPIs and other information as presented. Additionally, if the dataset requires a gateway, such as an on-premises SSAS server or a DirectQuery Power BI Desktop model to an on-premises source, Q&amp;A may be avoided, given the additional (and potentially inefficient) queries and performance considerations.</p>
    <p class="book-title--packt">To enable or disable Q&amp;A, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the Power BI service, access the app workspace containing the dashboard.</li>
      <li class="calibre12">Use the three vertical dots and click <strong class="screentext">Settings</strong>.<figure class="mediaobject"><img src="images/000388.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.20: Dashboard settings</p>
      </li>
      <li class="calibre12">Check or uncheck the box for <strong class="screentext">Show the Q&amp;A</strong> search box on this dashboard.<figure class="mediaobject"><img src="images/000400.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 5.21: Show the Q&amp;A search box on this dashboard</p>
    <p class="book-title--packt">The entire semantic layer definition that drives Q&amp;A can be exported, modified, and imported via Power BI Desktop using the <strong class="screentext">Linguistic schema</strong> option in the ribbon of the <strong class="screentext">Home</strong> tab while in <strong class="screentext">Model view</strong>. The exported file is a YAML file. YAML (YAML Ain't Markup Language) is <a id="calibre_link-880" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a human-readable text file used for data serialization. The portion of the YAML file after adding the wholesaler net margin synonym looks like the following:</p>
    <pre class="programlisting"><code class="hljs">  <span>reseller_sale.reseller_net_sales:</span>
    <span>Definition:</span>
      <span>Binding:</span> {<span>Table:</span> <span>Reseller</span> <span>Sales</span>, <span>Measure:</span> <span>Reseller</span> <span>Net</span> <span>Sales</span>}
    <span>State:</span> <span>Generated</span>
    <span>Terms:</span>
    <span>-</span> <span>reseller net sales:</span> {<span>State:</span> <span>Generated</span>}
    <span>-</span> <span>wholesaler net sale:</span> {<span>LastModified:</span> <span>'2021-04-05T16:58:30.2996117Z'</span>}
    <span>-</span> <span>sales:</span> {<span>State:</span> <span>Generated</span>, <span>Weight:</span> <span>0.97</span>}
    <span>-</span> <span>net sales:</span> {<span>State:</span> <span>Generated</span>, <span>Weight:</span> <span>0.97</span>}
    <span>-</span> <span>sale:</span> {<span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.97</span>}
    <span>-</span> <span>net sale:</span> {<span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.97</span>}
    <span>-</span> <span>reseller net sale:</span> {<span>Type:</span> <span>Noun</span>, <span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.739</span>}
    <span>-</span> <span>wholesaler net auction:</span> {<span>Type:</span> <span>Noun</span>, <span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.492</span>}
    <span>-</span> <span>net auction:</span> {<span>Type:</span> <span>Noun</span>, <span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.485</span>}
    <span>-</span> <span>wholesaler net transaction:</span> {<span>Type:</span> <span>Noun</span>, <span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.482</span>}
    <span>-</span> <span>auction:</span> {<span>Type:</span> <span>Noun</span>, <span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.476</span>}
    <span>-</span> <span>net transaction:</span> {<span>Type:</span> <span>Noun</span>, <span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.475</span>}
    <span>-</span> <span>wholesaler net deal:</span> {<span>Type:</span> <span>Noun</span>, <span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.468</span>}
    <span>-</span> <span>wholesaler net trade:</span> {<span>Type:</span> <span>Noun</span>, <span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.468</span>}
    <span>-</span> <span>wholesaler net vending:</span> {<span>Type:</span> <span>Noun</span>, <span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.468</span>}
    <span>-</span> <span>wholesaler net retailing:</span> {<span>Type:</span> <span>Noun</span>, <span>State:</span> <span>Suggested</span>, <span>Weight:</span> <span>0.468</span>}
</code></pre>
    <h2 id="calibre_link-1628" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Use Power BI Q&amp;A to <a id="calibre_link-799" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>explore and create visuals: <a href="http://bit.ly/2QYa7JN" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2QYa7JN</span></a></li>
      <li class="bullet">Best practices to optimize Q&amp;A: <a href="http://bit.ly/3cSddYp" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3cSddYp</span></a></li>
      <li class="bullet">Limitations <a id="calibre_link-798" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of Power BI Q&amp;A: <a href="http://bit.ly/2PtCrDL" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2PtCrDL</span></a></li>
    </ul>
    <h1 id="calibre_link-1230" class="title">Adding Alerts and Subscriptions</h1>
    <p class="book-title--packt">Alerts can be<a id="calibre_link-43" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> configured on the tiles of dashboards to provide a notification that a specific condition has been met. Alert rules and options can be managed in the Power BI service, and notifications can be limited to the notification center in Power BI or shared via email. Data-driven alerts enhance the value of Power BI dashboards, as they immediately bring attention to significant events or outcomes as the dataset supporting the dashboard tile is refreshed. Power BI dashboards and reports also support subscriptions. Subscriptions send images and links of refreshed reports and dashboards directly to user inboxes according to the defined schedule. Additionally, paginated report subscriptions can be configured to attach report data to subscription emails in common file formats such as Excel and PDF.</p>
    <p class="book-title--packt">This recipe demonstrates how to create and configure alerts and subscriptions, as well as how to use this functionality to unlock even more powerful functionality through the use of Power Automate.</p>
    <h2 id="calibre_link-1629" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe:</p>
    <ul class="calibre9">
      <li class="bullet">Complete the first recipe in this chapter, <em class="italic">Building a Dashboard</em>.</li>
    </ul>
    <h2 id="calibre_link-1630" class="calibre8">How to Add Alerts and Subscriptions</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the <strong class="screentext">North American Sales</strong> dashboard in the Power BI service.</li>
      <li class="calibre12">Hover over the <strong class="screentext">Monthly Customers</strong> KPI tile, click the ellipsis (â¦) in the upper-right corner, and select <strong class="screentext">Manage alerts</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Manage alerts</strong> pane, click <strong class="screentext">Add alert rule</strong>.</li>
      <li class="calibre12">Edit <strong class="screentext">Alert title</strong>, <strong class="screentext">Condition</strong>, and <strong class="screentext">Threshold</strong> and ensure that the <strong class="screentext">Send me email, too</strong> checkbox <a id="calibre_link-44" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is selected.<figure class="mediaobject"><img src="images/000413.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.22: Alert creation</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Save and close</strong> button to save the alert.</li>
      <li class="calibre12">Create another alert on the same KPI visual named <strong class="screentext">Monthly Customers Above 1100</strong>, with the appropriate <strong class="screentext">Condition</strong> and <strong class="screentext">Threshold</strong> set.</li>
      <li class="calibre12">In the ribbon for the dashboard, choose <strong class="screentext">Subscribe</strong>.<figure class="mediaobject"><img src="images/000425.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.23: Dashboard ribbon</p>
      </li>
      <li class="calibre12">Click<a id="calibre_link-45" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Add new subscription</strong> button.</li>
      <li class="calibre12">Edit the subscription settings.<figure class="mediaobject"><img src="images/000435.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.24: Subscription creation</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Save and close</strong> button.</li>
      <li class="calibre12">Click <strong class="screentext">Subscribe</strong> in the ribbon again.</li>
      <li class="calibre12">This time, expand the subscription just created.</li>
      <li class="calibre12">Click <strong class="screentext">Run Now</strong> to test the subscription (see <em class="italic">Figure 5.24</em>).</li>
      <li class="calibre12">Within minutes, you should receive an email from Microsoft Power BI, with a subject line of the<a id="calibre_link-46" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> name of your subscription, and an email body similar to that shown in <em class="italic">Figure 5.25</em>.<figure class="mediaobject"><img src="images/000446.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.25: Subscription message body</p>
      </li>
      <li class="calibre12">In the Power BI service, click the gear icon in the upper-right corner and choose <strong class="screentext">Settings</strong>.</li>
      <li class="calibre12">Click<a id="calibre_link-1631" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Alerts</strong> tab and note that you will have alerts appear.<figure class="mediaobject"><img src="images/000457.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.26: Alert management</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Subscriptions</strong> tab and note that your subscription has also appeared.<figure class="mediaobject"><img src="images/000468.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 5.27: Subscription management</p>
    <h2 id="calibre_link-1632" class="calibre8">How it works</h2>
    <p class="book-title--packt">Alerts can only be set on dashboard tiles that surface a single numeric metric, like Card visuals, KPI visuals, and Gauge visuals. Alerts can be set on multiple different dashboard tiles, and multiple alerts can be configured for the same dashboard tile, with each alert having a separate condition and/or threshold&mdash;such as a maximum and minimum accepted value. Power BI evaluates the alert rule when the dataset supporting the dashboard is refreshed. If the alert is triggered, an icon and message will appear in the notification center in the Power BI service (a bell icon in the upper-right corner) containing a link to the dashboard tile configured for the alert. In addition, if the email option is selected, an email will also be sent regarding the alert. Data alerts can also be set and viewed in the Power BI mobile apps&mdash;Power BI mobile also provides access to notifications. </p>
    <p class="book-title--packt">Subscriptions can be set on either dashboards or reports. When setting up a subscription for a report, you must choose the <strong class="screentext">Report</strong> page for the subscription. Subscriptions run at the appointed time, generating a PNG image file that is attached to an email message. Subscription frequency can be set to <strong class="screentext">Hourly</strong>, <strong class="screentext">Daily</strong>, <strong class="screentext">Weekly</strong>, or <strong class="screentext">Monthly</strong>. <strong class="screentext">Hourly</strong> and <strong class="screentext">Weekly</strong> subscriptions allow the choosing of individual days of the week. A single subscription can support multiple email addresses, allowing Power BI admins to<a id="calibre_link-47" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> configure subscriptions for other users.</p>
    <h2 id="calibre_link-1633" class="calibre8">There's more</h2>
    <p class="book-title--packt">Alerts in the Power BI service are limited to the sending of emails only to the creator of that alert. However, Power Automate can be used to notify others via email, or even trigger complex workflows. To see how this works, carry out the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the Power BI service, click the gear icon in the upper-right corner and choose <strong class="screentext">Settings</strong>.</li>
      <li class="calibre12">Choose the <strong class="screentext">Alerts</strong> tab and click <strong class="screentext">Edit</strong> for the <strong class="screentext">Monthly Customers Above 1100</strong> alert.</li>
      <li class="calibre12">In the <strong class="screentext">Manage alerts</strong> pane at the bottom, click <strong class="screentext">Use Microsoft Power Automate to trigger additional actions</strong>.</li>
      <li class="calibre12">A new tab is opened for Power Automate for a template called <strong class="screentext">Trigger a flow with a Power BI data-driven alert</strong>.</li>
      <li class="calibre12">Click the <strong class="screentext">Try it now</strong> button.</li>
      <li class="calibre12">If necessary, sign in to your work account.<figure class="mediaobject"><img src="images/000479.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.28: Trigger a flow with a Power BI data-driven alert</p>
      </li>
      <li class="calibre12">Click<a id="calibre_link-48" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Continue</strong> button.</li>
      <li class="calibre12">From the <strong class="screentext">Alert Id</strong> dropdown, choose the specific Power BI data alert to trigger the flow, and then click the <strong class="screentext">New Step</strong> button.</li>
      <li class="calibre12">Find the <strong class="screentext">Mail</strong> action and select it.</li>
      <li class="calibre12">Configure the email notification using <strong class="screentext">Dynamic content</strong> and click the <strong class="screentext">Save</strong> button.<figure class="mediaobject"><img src="images/000490.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.29: Configure custom email notification for alert</p>
      </li>
      <li class="calibre12">Select <strong class="screentext">Save</strong> to<a id="calibre_link-1634" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> save, and <strong class="screentext">Test</strong> to test the flow. Select the <strong class="screentext">Manually </strong>option.</li>
      <li class="calibre12">Verify that the flow appears when selecting the <strong class="screentext">My flows</strong> tab in the left navigation pane.</li>
    </ol>
    <p class="book-title--packt">Given the value of alerts to stakeholders and the low effort required in creating and managing alerts and notifications in Power BI and Power Automate, dedicated alert dashboards can be developed to reduce the amount of analysis and monitoring required.</p>
    <h2 id="calibre_link-1635" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Set data alerts on the Power BI service dashboards: <a href="http://bit.ly/2R4OebL" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2R4OebL</span></a></li>
      <li class="bullet">Subscribe yourself to reports and dashboards: <a href="http://bit.ly/3fJphwU" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3fJphwU</span></a></li>
      <li class="bullet">Subscribe others to your reports and dashboards: <a href="http://bit.ly/3wynW2a" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3wynW2a</span></a></li>
    </ul>
    <h1 id="calibre_link-1231" class="title">Deploying Content from Excel and SSRS</h1>
    <p class="book-title--packt">Dashboards <a id="calibre_link-443" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>in Power <a id="calibre_link-1048" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>BI can consolidate much more than just Power BI report visuals. Microsoft Excel objects&mdash;such as pivot tables, charts, and workbook ranges&mdash;and SSRS report items can also be pinned as dashboard tiles. This integration with Power BI allows teams to utilize existing reports and skills, and to leverage the unique capabilities of these tools as part of overall BI solutions.</p>
    <p class="book-title--packt">In this recipe, a pivot table and pivot chart from an Excel workbook are integrated into an existing Power BI dashboard. Additionally, an SSRS report item is also pinned to this dashboard. For more advanced integration examples, see <em class="italic">Chapter 13</em>, <em class="italic">Integrating Power BI with Other Applications</em>.</p>
    <h2 id="calibre_link-1636" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Complete the first recipe in this chapter, <em class="italic">Building a Dashboard</em>.</li>
      <li class="calibre12">Install<a id="calibre_link-1637" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Analyze in<a id="calibre_link-1638" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Excel from the Power BI service. See <em class="italic">Chapter 1</em>, <em class="italic">Configuring Power BI Tools</em>, for details on this process.</li>
      <li class="calibre12">Configure the <strong class="screentext">Report Server</strong> for Power BI by opening <strong class="screentext">Reporting Server Configuration Manager</strong>, clicking on the Power BI <strong class="screentext">Integration</strong> tab, and selecting <strong class="screentext">Register with Power BI</strong>.</li>
    </ol>
    <h2 id="calibre_link-1639" class="calibre8">How to Deploy Excel and SSRS Content</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the report <strong class="screentext">CH5_R1_CountryMonthlyReport</strong> in the service.</li>
      <li class="calibre12">In the <strong class="screentext">Report</strong> ribbon, select <strong class="screentext">Export</strong> and then <strong class="screentext">Analyze in Excel</strong>.</li>
      <li class="calibre12">Open the <code class="code-in-text--packt">CH5_R1_SalesAndFinanceDataset.xlsx</code> file from your <strong class="screentext">Downloads</strong> folder.</li>
      <li class="calibre12">In the <strong class="screentext">Protected View</strong> warning box, click <strong class="screentext">Enable Editing</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Security Warning</strong> box, click <strong class="screentext">Enable Content</strong>.</li>
      <li class="calibre12">Select a cell in the <strong class="screentext">PivotTable1</strong> area.</li>
      <li class="calibre12">In the <strong class="screentext">PivotTable Fields</strong> pane, find the <strong class="screentext">Internet Sales</strong> group with a summation icon in front of it and place <strong class="screentext">Internet Net Sales</strong> in the <strong class="screentext">Values</strong> area.</li>
      <li class="calibre12">Scroll down to find the <strong class="screentext">Dates</strong> group with the table icon in front of it and drag and drop the <strong class="screentext">Year Month</strong> field into the <strong class="screentext">Rows</strong> area.<figure class="mediaobject"><img src="images/000000.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.30: Pivot table configuration</p>
      </li>
      <li class="calibre12">Select <strong class="screentext">Insert Slicer</strong> from <a id="calibre_link-444" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the ribbon <a id="calibre_link-1049" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of the <strong class="screentext">Analyze</strong> tab.</li>
      <li class="calibre12">In the <strong class="screentext">Insert Slicers</strong> dialog, select <strong class="screentext">Country</strong> from the <strong class="screentext">Customers</strong> table and then click <strong class="screentext">OK</strong>.</li>
      <li class="calibre12">Select a cell in the pivot table and then choose <strong class="screentext">PivotChart</strong> from the ribbon of the <strong class="screentext">Analyze</strong> tab.</li>
      <li class="calibre12">In the <strong class="screentext">Insert Chart</strong> dialog, choose <strong class="screentext">Column</strong>, then <strong class="screentext">Clustered Column</strong>, and click <strong class="screentext">OK</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">United States</strong> in the slicer.</li>
      <li class="calibre12">Save the Excel file to your OneDrive for Business directory as <code class="code-in-text--packt">CH5_R4_Workbook</code> and close Excel.</li>
      <li class="calibre12">In the Power BI service, open the workspace with the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">In the lower-left corner, choose <strong class="screentext">Get data</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Get Data</strong> dialog, select the <strong class="screentext">Get</strong> button in the <strong class="screentext">Files</strong> section under <strong class="screentext">Create new content</strong>.</li>
      <li class="calibre12">Choose <strong class="screentext">OneDrive &ndash; Business</strong>.</li>
      <li class="calibre12">Select the Excel file and then click the <strong class="screentext">Connect</strong> button.</li>
      <li class="calibre12">Under <strong class="screentext">Connect, manage, and view Excel in Power BI</strong>, click the <strong class="screentext">Connect</strong> button.</li>
      <li class="calibre12">The Excel file name now appears in the <strong class="screentext">Workbooks </strong>area of the workspace.</li>
      <li class="calibre12">Select <strong class="screentext">CH5_R4_Workbook</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">PivotChart</strong>.</li>
      <li class="calibre12">In<a id="calibre_link-445" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the upper-right <a id="calibre_link-1050" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>corner, select the pin icon.</li>
      <li class="calibre12">Pin the dashboard to the <strong class="screentext">North American Sales</strong> dashboard.<figure class="mediaobject"><img src="images/000011.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.31: Pin Excel PivotChart to dashboard</p>
      </li>
      <li class="calibre12">Navigate to the <strong class="screentext">North American Sales</strong> dashboard to view the pinned <strong class="screentext">PivotChart</strong> tile at the bottom of the dashboard.</li>
    </ol>
    <h2 id="calibre_link-1640" class="calibre8">How it works</h2>
    <p class="book-title--packt">This recipe demonstrates how to publish the workbook from Excel to Power BI and then pin items from the workbook report in the Power BI service. Using this method, once published, the workbook cannot not be refreshed. This means that after pinning items directly from the Excel workbook to the dashboard, the connection to the dataset hosted in the Power BI service must be periodically refreshed, with the tile being removed and re-pinned.</p>
    <p class="book-title--packt">To avoid this manual and local refresh process, Excel report visuals can be built on top of an Excel data model; this Excel workbook can be published to the Power BI service. Published workbooks, containing data models, can be configured for a scheduled refresh in the Power BI service, and their dependent reports will be updated to reflect these refreshes.</p>
    <p class="book-title--packt">Recently, Microsoft added the ability for connected PivotTable refresh in Excel for the web. This means that PivotTables connected to Power BI inside Excel for the web can now be refreshed. A connected PivotTable can be created either via the service by choosing the <strong class="screentext">Analyze in Excel</strong> option for a report or in Excel by choosing the <strong class="screentext">From Power BI</strong> option<a id="calibre_link-446" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> when <a id="calibre_link-1051" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>inserting a PivotTable.</p>
    <h2 id="calibre_link-1641" class="calibre8">There's more</h2>
    <p class="book-title--packt">It is also possible to pin SSRS report elements to Power BI dashboards. To see how this works, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create or identify the SSRS report to support the dashboard.</li>
      <li class="calibre12">Publish this report to the SSRS report server, or open this report on the report server.</li>
      <li class="calibre12">From the report server browser window, click the Power BI icon and sign in with the appropriate Power BI account.</li>
      <li class="calibre12">Click on the SSRS report item to pin:<figure class="mediaobject"><img src="images/000023.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.32: Pin to Power BI from SSRS 2016</p>
      </li>
      <li class="calibre12">From the <strong class="screentext">Pin to Power BI Dashboard</strong> dialog, choose the workspace and dashboard to pin the item to.</li>
    </ol>
    <p class="book-title--packt">The update frequency creates an SSRS subscription to keep the tile updated in Power BI. You can also pin charts, gauge panels, maps, and images from SSRS reports to Power BI dashboards, provided these items are within the report body (and not the page header or footer). You <a id="calibre_link-1642" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>cannot currently pin tables, matrices, or list<a id="calibre_link-1643" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> report items from SSRS reports.</p>
    <p class="book-title--packt">SSRS and Excel are now much more deeply integrated in Power BI than the first edition of this book. In the case of SSRS, almost all of the same granular, 'pixel perfect' report design features are supported with paginated reports for Power BI premium customers. Likewise, Excel reports built with external data connections to Power BI datasets can also be published to Power BI and included in the same Power BI apps alongside paginated and Power BI reports.</p>
    <h2 id="calibre_link-1644" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Pin a tile to a Power BI dashboard from Excel: <a href="http://bit.ly/2PI6RC1" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2PI6RC1</span></a></li>
      <li class="bullet">Power BI Report Server Integration (Configuration Manager): <a href="http://bit.ly/3sTGGqA" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3sTGGqA</span></a></li>
      <li class="bullet">Pin paginated report items to Power BI dashboards: <a href="http://bit.ly/3rVQfE7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/3rVQfE7</span></a></li>
      <li class="bullet">Connected PivotTable refresh in Excel for the web is now 100% available to Office tenants: <a href="https://bit.ly/3yM3kmS" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3yM3kmS</span></a></li>
    </ul>
    <h1 id="calibre_link-1232" class="title">Streaming Datasets</h1>
    <p class="book-title--packt">Streaming <a id="calibre_link-280" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>datasets allow Power BI dashboards to display real-time data. Real-time data sources are generally Internet of Things (IoT) devices, but can also include such things as social media applications and stock prices.</p>
    <p class="book-title--packt">This recipe demonstrates how to use real-time data in a Power BI dashboard.</p>
    <h2 id="calibre_link-1645" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe:</p>
    <ul class="calibre9">
      <li class="bullet">Complete the first recipe in this chapter, <em class="italic">Building a Dashboard</em>.</li>
    </ul>
    <h2 id="calibre_link-1646" class="calibre8">How to Stream Datasets</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Navigate to the workspace where <strong class="screentext">North American Sales</strong> is located in the service.</li>
      <li class="calibre12">Under the workspace name, select <strong class="screentext">New</strong>, and then <strong class="screentext">Streaming dataset</strong>.<figure class="mediaobject"><img src="images/000035.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.33: Create a new Streaming dataset</p>
      </li>
      <li class="calibre12">In <a id="calibre_link-281" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">New streaming dataset</strong> pane, choose <strong class="screentext">PUBNUB</strong> and click <strong class="screentext">Next</strong>.</li>
      <li class="calibre12">Name the dataset <strong class="screentext">Streaming Sensor Data</strong>.</li>
      <li class="calibre12">Use the following <code class="code-in-text--packt">Sub-key: sub-c-5f1b7c8e-fbee-11e3-aa40-02ee2ddab7fe</code>.</li>
      <li class="calibre12">Use the following <strong class="screentext">Channel: pubnub-sensor-network</strong>.</li>
      <li class="calibre12">Click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">The next page shows the schema of the dataset; click the <strong class="screentext">Create</strong> button.</li>
      <li class="calibre12">The <strong class="screentext">Streaming Sensor Data</strong> dataset appears in the workspace.</li>
      <li class="calibre12">Navigate to the <strong class="screentext">North American Sales</strong> dashboard.</li>
      <li class="calibre12">In the dashboard ribbon, choose <strong class="screentext">Edit</strong> and then <strong class="screentext">Add a tile</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Add a tile</strong> pane, choose <strong class="screentext">Custom Streaming Data</strong> from the <strong class="screentext">REAL-TIME DATA</strong> area.</li>
      <li class="calibre12">Click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Under <strong class="screentext">YOUR DATASETS</strong>, choose <strong class="screentext">Streaming Sensor Data</strong>, and click <strong class="screentext">Next</strong>.</li>
      <li class="calibre12">For <strong class="screentext">Visualization type</strong>, choose <strong class="screentext">Line chart</strong>.</li>
      <li class="calibre12">For the <strong class="screentext">Axis</strong>, use <strong class="screentext">timestamp</strong>, and for <strong class="screentext">Values</strong> use <strong class="screentext">ambient_temperature</strong>.</li>
      <li class="calibre12">Click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Enter the <strong class="screentext">Title</strong> name as <strong class="screentext">Temperature</strong> for the tile and click the <strong class="screentext">Apply</strong> button.</li>
      <li class="calibre12">Scroll down in the dashboard to find the <strong class="screentext">Temperature</strong> tile.</li>
    </ol>
    <h2 id="calibre_link-1647" class="calibre8">How it works</h2>
    <p class="book-title--packt">There are actually three types of streaming datasets in Power BI:</p>
    <ul class="calibre9">
      <li class="bullet">Push</li>
      <li class="bullet">Streaming</li>
      <li class="bullet">PubNub</li>
    </ul>
    <p class="book-title--packt">Push datasets have an external program that pushes data into Power BI; the data is stored within Power BI as a dataset. Push datasets store the information permanently in Power BI, which<a id="calibre_link-282" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> can then be used to create reports. With push datasets, visuals are built via reports and then pinned to dashboards. Push datasets are limited to 1 request per second, 16 MB per request, and 1 million rows per hour. </p>
    <p class="book-title--packt">Streaming datasets push data to Power BI, but do not store data within a Power BI dataset. Therefore, streaming datasets cannot be used in reports&mdash;only dashboards. Streaming datasets are limited to 5 requests per second and 15 KB per request but have no limits on the number of rows processed per hour.</p>
    <p class="book-title--packt">PubNub datasets also do not store data in Power BI, and therefore can only be used on dashboards. There are no limits regarding the requests sent per second, or the amount of data sent per request, because the Power BI web client uses the PubNub SDK to read existing PubNub data streams, instead of the information being pushed to Power BI.</p>
    <p class="book-title--packt">Push and streaming datasets can be created using the Power BI REST API, the <strong class="screentext">API</strong> option in the service when creating a new streaming dataset via Azure Stream Analytics. </p>
    <figure class="mediaobject"><img src="images/000047.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 5.34: New streaming dataset options</p>
    <p class="book-title--packt">When creating a streaming dataset using the <strong class="screentext">API</strong> option in the service, the configuration screen includes a toggle for <strong class="screentext">Historic data analysis</strong>. This toggle is <strong class="screentext">Off</strong> by default, and will create a streaming dataset&mdash;toggling <strong class="screentext">Historic data analysis</strong> to <strong class="screentext">On</strong> creates a push dataset. Once the push/streaming dataset is created, the Push Datasets functions of the Power BI REST API can be used to push data into the dataset.</p>
    <p class="book-title--packt">The Azure Stream option in the Power BI service is not fully implemented at the time of writing, but when implemented will provide an interface for integrating Azure Stream Analytics data into Power BI. Currently, you must activate the Power BI integration from Azure Stream Analytics. Power BI is an output option for Azure Stream Analytics data. Setting Power <a id="calibre_link-283" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>BI as an output from Azure Stream Analytics creates a Power BI dataset that can take advantage of both push and streaming. By default, this dataset stores 200,000 rows of data, and data is expired via first-in-first-out (FIFO).</p>
    <h2 id="calibre_link-1648" class="calibre8">There's more</h2>
    <p class="book-title--packt">Another option when it comes to real-time or near-real-time data is to use <strong class="screentext">Automatic page refresh</strong>. Automatic page refresh is used on report pages to set a refresh interval for visuals that is only active when the report is being viewed&mdash;the option is not available for Import data sources. Automatic page refresh is configured in Power BI Desktop or the Power BI service in the <strong class="screentext">Format</strong> options for the page. The <strong class="screentext">Refresh</strong> type can be configured to either a fixed interval or based upon a change detection configuration. Change detection support varies by storage mode, source, and whether you are using dedicated (Premium) or shared capacity. Shared capacities do not support change detection for any storage mode or source. The minimum refresh fixed interval also varies by storage mode, source, and type of capacity. For dedicated capacity, the minimum refresh fixed interval is one second, except for Azure Analysis Services, where it is 30 minutes. For shared capacity, the minimum refresh fixed interval is 30 minutes for all storage modes and sources.</p>
    <h2 id="calibre_link-1649" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Real-time streaming in Power BI: <a href="https://bit.ly/39NhYRg" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/39NhYRg</span></a></li>
      <li class="bullet">Power BI REST API Push Datasets: <a href="https://bit.ly/3dDVW4u" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3dDVW4u</span></a></li>
      <li class="bullet">Azure Stream Analytics: <a href="https://azure.microsoft.com/en-us/services/stream-analytics/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://azure.microsoft.com/en-us/services/stream-analytics/</span></a></li>
      <li class="bullet">Automatic page refresh in Power BI Desktop: <a href="https://bit.ly/3utXO6q" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3utXO6q</span></a></li>
    </ul>
    <h1 id="calibre_link-1233" class="title">Authoring Dataflows</h1>
    <p class="book-title--packt">Dataflows are <a id="calibre_link-236" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>reusable, scalable self-service ETL (extract-transform-load) artifacts created exclusively in the Power BI cloud service. Dataflows utilize the same Power Query (M) language for data access and transformation that has existed within Power BI Desktop but can be shared across datasets and, with Power BI premium capacity, can support large, resource-intensive workloads. </p>
    <p class="book-title--packt">This recipe demonstrates how to create a dataflow within the Power BI service, and how that dataflow can then be leveraged within Power BI Desktop.</p>
    <h2 id="calibre_link-1650" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Download the <code class="code-in-text--packt">CH5_R7_AuthoringDataflows.xlsx</code> file from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a>.</li>
      <li class="calibre12">Save the <code class="code-in-text--packt">CH5_R7_AuthoringDataflows.xlsx</code> file to your OneDrive for Business directory.</li>
    </ol>
    <h2 id="calibre_link-1651" class="calibre8">How to Author Dataflows</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a workspace in the Power BI service.</li>
      <li class="calibre12">Under the workspace name, select <strong class="screentext">New</strong> and then <strong class="screentext">Dataflow</strong>.</li>
      <li class="calibre12">Choose <strong class="screentext">Add new tables</strong> under the <strong class="screentext">Define new tables</strong> area.<figure class="mediaobject"><img src="images/000059.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.35: Define new tables</p>
      </li>
      <li class="calibre12">From the All categories tab, choose Excel under Data sources.<figure class="mediaobject"><img src="images/000071.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.36: Data sources</p>
      </li>
      <li class="calibre12">For <strong class="screentext">Connection settings</strong>, click <a id="calibre_link-237" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Browse OneDrive</strong> button, select the <code class="code-in-text--packt">CH5_R7_AuthoringDataflows.xlsx</code> file, and click <strong class="screentext">Open</strong>.</li>
      <li class="calibre12">Click the <strong class="screentext">Next</strong> button in the lower-right corner.</li>
      <li class="calibre12">Select <strong class="screentext">DimProduct</strong>, <strong class="screentext">DimProductCategory</strong>, and <strong class="screentext">DimProductSubcategory</strong>.<figure class="mediaobject"><img src="images/000083.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.37: Choose data</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Transform Data</strong> button in the lower-right corner.</li>
      <li class="calibre12">You are now in the <strong class="screentext">Power Query &ndash; Edit queries</strong> interface, which works in the same way as the Power Query interface in Desktop.<figure class="mediaobject"><img src="images/000096.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.38: Power Query in the Power BI service</p>
      </li>
      <li class="calibre12">Select <a id="calibre_link-238" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">DimProductSubcategory</strong> query in the <strong class="screentext">Queries</strong> pane.</li>
      <li class="calibre12">Ensure that the <strong class="screentext">ProductSubcategoryKey</strong> and <strong class="screentext">ProductCategoryKey</strong> columns are of the type <strong class="screentext">Whole number</strong> (<strong class="screentext">1234</strong> icon), and if not then right-click the column header, choose <strong class="screentext">Change type</strong>, and then <strong class="screentext">Whole number</strong>.</li>
      <li class="calibre12">Right-click the <strong class="screentext">EnglishProductSubcategoryName</strong> column header, choose <strong class="screentext">Rename</strong>, and rename the column to <strong class="screentext">Product Subcatgory</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">DimProductCategory</strong> query in the <strong class="screentext">Queries</strong> pane.</li>
      <li class="calibre12">Ensure that the <strong class="screentext">ProductCategoryKey</strong> column is of type <strong class="screentext">Whole number</strong> (<strong class="screentext">1234</strong> icon), and if not then right-click the column header and choose <strong class="screentext">Change type</strong>, then <strong class="screentext">Whole number</strong>.</li>
      <li class="calibre12">Rename the <strong class="screentext">EnglishProductCategoryName</strong> column to <strong class="screentext">Product Category</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">DimProduct</strong> query in the <strong class="screentext">Queries</strong> pane.</li>
      <li class="calibre12">Ensure that the <strong class="screentext">ProductSubcategoryKey</strong> column is of type <strong class="screentext">Whole number</strong> (<strong class="screentext">1234</strong> icon), and if not then right-click the column header, choose <strong class="screentext">Change type</strong>, then <strong class="screentext">Whole number</strong>.</li>
      <li class="calibre12">Rename the <strong class="screentext">EnglishProductName</strong> column to <strong class="screentext">Product Name</strong>.</li>
      <li class="calibre12">Click <strong class="screentext">Merge queries</strong> in the ribbon of the <strong class="screentext">Home</strong> tab.<figure class="mediaobject"><img src="images/000109.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.39: Merge dialog</p>
      </li>
      <li class="calibre12">Select <strong class="screentext">DimProductSubcategory</strong> as <a id="calibre_link-239" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Right table for merge</strong>, select the two <strong class="screentext">ProductSubcategoryKey</strong> columns, and click <strong class="screentext">OK</strong> to accept the default <strong class="screentext">Left outer Join kind</strong>.</li>
      <li class="calibre12">Click the column expansion icon in the <strong class="screentext">DimProductSubcategory</strong> column header, deselect all of the columns, select the <strong class="screentext">Product Subcategory</strong> and <strong class="screentext">ProductCategoryKey</strong> columns, and uncheck the <strong class="screentext">Use original column name as prefix</strong> checkbox; click <strong class="screentext">OK</strong>.<figure class="mediaobject"><img src="images/000120.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.40: Expand column</p>
      </li>
      <li class="calibre12">Click <strong class="screentext">Merge queries</strong> in <a id="calibre_link-240" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Select <strong class="screentext">DimProductCategory</strong> as the <strong class="screentext">Right table for merge</strong>, select the two <strong class="screentext">ProductCategoryKey</strong> columns and click <strong class="screentext">OK</strong> to accept the default <strong class="screentext">Left outer Join kind</strong>.</li>
      <li class="calibre12">Click the column expansion icon in the <strong class="screentext">DimProductCategory</strong> column header, deselect all of the columns, select the <strong class="screentext">Product Category</strong> column, uncheck the <strong class="screentext">Use original column name as prefix</strong> checkbox, and click <strong class="screentext">OK</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">ProductCategoryKey</strong> column and while holding down the <strong class="screentext">Ctrl</strong> key, select the <strong class="screentext">ProductSubcategoryKey</strong> column.</li>
      <li class="calibre12">Right-click the <strong class="screentext">ProductSubcategoryKey</strong> column header and choose <strong class="screentext">Remove columns</strong>.</li>
      <li class="calibre12">Right-click the <strong class="screentext">DimProductCategory</strong> query in the <strong class="screentext">Queries</strong> pane and deselect <strong class="screentext">Enable load</strong>.</li>
      <li class="calibre12">Disable load on the <strong class="screentext">DimProductSubcategory</strong> query as well.</li>
      <li class="calibre12">In the lower-right corner, click the <strong class="screentext">Save &amp; Close</strong> button.</li>
      <li class="calibre12"><strong class="screentext">Name</strong> the dataflow <strong class="screentext">Products</strong> and click the <strong class="screentext">Save</strong> button.<figure class="mediaobject"><img src="images/000132.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.41: Save your dataflow</p>
      </li>
      <li class="calibre12">Click back on the workspace and note that the <strong class="screentext">Products</strong> dataflow has appeared.<figure class="mediaobject"><img src="images/000145.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 5.42: Products dataflow</p>
      </li>
      <li class="calibre12">Hover over the <strong class="screentext">Products</strong> dataflow and click the <strong class="screentext">Refresh now</strong> icon.</li>
    </ol>
    <h2 id="calibre_link-1652" class="calibre8">How it works</h2>
    <p class="book-title--packt">Dataflows allow <a id="calibre_link-241" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power Query queries to be built in the Power BI service. Furthermore, unlike Power Query queries built in the Power BI Desktop, dataflows are reusable across multiple datasets (models). Since dataflows and Power Query queries built in the Power BI Desktop use the same underlying M code technology, it is actually possible to take queries built in the Power BI Desktop and easily migrate them to dataflows using the <strong class="screentext">Advanced Editor</strong> capability to copy and paste the code between the desktop and a dataflow, or using the <strong class="screentext">Import Model</strong> feature when creating a dataflow.</p>
    <p class="book-title--packt">Dataflows ingest data from sources into Common Data Model-compliant (Dataverse) folders stored in Azure Data Lake Storage Gen2. Dataflows also allow you to expose data in your own Azure Data Lake Gen2 storage to other Azure services. Once created, a dataflow must be refreshed at least once to initialize the data within the Azure Data Lake Gen2 storage. Dataflows support similar settings to datasets, in that you can configure scheduled refreshes and utilize gateways when refreshing data.</p>
    <p class="book-title--packt">Dedicated capacities, such as Premium, support additional dataflow functionality, such as the following:</p>
    <ul class="calibre9">
      <li class="bullet">Enhanced compute engine, enabling dataflows to leverage <code class="code-in-text--packt">DirectQuery</code></li>
      <li class="bullet">Refresh linked <a id="calibre_link-1653" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>tables from other dataflows</li>
      <li class="bullet"><strong class="screentext">Automated Machine Learning</strong> (<strong class="screentext">AutoML</strong>) and <a id="calibre_link-99" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Cognitive Services</li>
    </ul>
    <h2 id="calibre_link-1654" class="calibre8">There's more</h2>
    <p class="book-title--packt">Once created, dataflows <a id="calibre_link-243" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>can be used in Power BI Desktop as data sources. To see how this works, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a new Power BI Desktop file.</li>
      <li class="calibre12">Select <strong class="screentext">Get data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab and choose <strong class="screentext">Power BI dataflows</strong>.</li>
      <li class="calibre12">Expand the workspace where the <strong class="screentext">Products</strong> dataflow was created.</li>
      <li class="calibre12">Expand the <strong class="screentext">Products</strong> dataflow.</li>
      <li class="calibre12">Choose the <code class="code-in-text--packt">DimProduct</code> table and then click the <strong class="screentext">Load</strong> button.</li>
    </ol>
    <p class="book-title--packt">The <code class="code-in-text--packt">DimProduct</code> table has now been added to the dataset.</p>
    <h2 id="calibre_link-1655" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Introduction <a id="calibre_link-242" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to dataflows and self-service data prep: <a href="https://bit.ly/3uCjNZf" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3uCjNZf</span></a></li>
      <li class="bullet">Creating a dataflow: <a href="https://bit.ly/2RiiGPV" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2RiiGPV</span></a></li>
      <li class="bullet">Configure and consume a dataflow: <a href="https://bit.ly/2RhlVHm" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2RhlVHm</span></a></li>
      <li class="bullet">Dataflows best practices: <a href="https://bit.ly/3cZIIQr" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3cZIIQr</span></a></li>
      <li class="bullet">Dataflows limitations and considerations: <a href="https://bit.ly/3t2UChM" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3t2UChM</span></a></li>
      <li class="bullet">Premium features of dataflows: <a href="https://bit.ly/3fZXLLA" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3fZXLLA</span></a></li>
      <li class="bullet">Build a Machine Learning model in Power BI: <a href="https://bit.ly/3d1XGp7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3d1XGp7</span></a></li>
      <li class="bullet">Use Machine Learning&mdash;Cognitive Services with dataflows: <a href="https://bit.ly/3fT3nYk" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3fT3nYk</span></a></li>
    </ul>
    <h1 id="calibre_link-1234" class="title">Conclusion</h1>
    <p class="book-title--packt">The Power BI service provides the capability to create and share additional BI objects, such as dashboards, apps, streaming datasets, and dataflows; these components can be enriched and enhanced with alerts, subscriptions, images, and web content. In this chapter, Power BI dashboards were constructed to provide simple, at-a-glance monitoring of critical measures and high-impact business activities. The unique features of dashboards, such as Q&amp;A natural language queries, data alerts, and the integration of other report types&mdash;such as Excel and SSRS&mdash;was also included. Finally, the creation and use of streaming datasets and dataflows was also covered.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-6">
<div id="calibre_link-1656" class="calibre2">
<div id="calibre_link-1657" class="calibre3"><div id="calibre_link-1658" class="calibre4">
    <h1 class="heading">6</h1>
    <h1 id="calibre_link-1235" class="title">Getting Serious with Date Intelligence</h1>
    <p class="book-title--packt">Date intelligence<a id="calibre_link-312" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> refers to a broad set of data modeling patterns and functions that enable analysis across time periods. In this chapter and throughout this book, we use date intelligence to refer to this broad set of data modeling patterns and to distinguish the concept from DAX time intelligence functions. This is done for two reasons. First, to be more technically precise, date intelligence deals with dates (days, months, years), not time (hours, minutes, seconds). Second, DAX time intelligence functions are only useful if dealing with a standard (Gregorian) calendar, but many businesses use a financial calendar that is different than a standard calendar year. Date intelligence, the broad concept, is applicable to both the standard (Gregorian) calendar as well as custom financial calendars.</p>
    <p class="book-title--packt">Fundamental measures, such as reseller net sales, as created in <em class="italic">Chapter 3</em>, <em class="italic">Building a Power BI Data Model</em>, are supplemented with date intelligence measures to calculate year-to-date, prior period, and many other custom time period calculations. These measures are then used in combination to support growth and variance measures and are often utilized as <strong class="screentext">Key Performance Indicators</strong> (<strong class="screentext">KPIs</strong>) in Power BI dashboards, given their ability to convey additional context and insight. When implemented properly, date intelligence dramatically expands the analytical power of a data model and simplifies report and dashboard development.</p>
    <p class="book-title--packt">This chapter contains recipes for preparing a data model to support robust date intelligence and authoring custom date intelligence measures. We will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Building a Date Dimension Table</li>
      <li class="bullet">Prepping the Date Dimension via the Query Editor</li>
      <li class="bullet">Authoring Date Intelligence Measures</li>
      <li class="bullet">Developing Advanced Date Intelligence Measures</li>
      <li class="bullet">Simplifying Date Intelligence with DAX and Calculated Tables</li>
      <li class="bullet">Leveraging Calculation Groups</li>
    </ul>
    <h1 id="calibre_link-1236" class="title">Technical Requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop</li>
      <li class="bullet">Tabular Editor</li>
      <li class="bullet">SQL Server with the AdventureWorksDW2019 database installed. This database and instructions for installing it are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a></li>
      <li class="bullet">Files for this chapter can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a></li>
    </ul>
    <h1 id="calibre_link-1237" class="title">Building a Date Dimension Table</h1>
    <p class="book-title--packt">A date dimension<a id="calibre_link-303" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is needed by almost all data models and particularly those that require date intelligence calculations (e.g. Year-to-Date, Year-over-Year) and company-specific calendars. Building a robust date table in the source system provides significant long-term value across BI projects and tools. A complete date table accounts for all the required grains or hierarchy levels of both the standard (Gregorian) calendar and any fiscal calendar specific to the organization. Additionally, surrogate key columns aligned to each grain are included to drive the sort order of report attributes and to enable date intelligence expressions.</p>
    <p class="book-title--packt">This recipe includes a design phase to identify the required date dimension columns and a process for adding a date intelligence surrogate key column to a dimension.</p>
    <h2 id="calibre_link-1659" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">Full date tables are available from various sources:</p>
    <ul class="calibre9">
      <li class="bullet"><strong class="screentext">The Kimball </strong><strong class="screentext"><a id="calibre_link-1105" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">Group downloadable Excel file</strong>: <a href="http://bit.ly/2rOchxt" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2rOchxt</span></a></li>
      <li class="bullet"><strong class="screentext">A</strong><strong class="screentext"><a id="calibre_link-1108" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext"> T-SQL approach</strong>: <a href="http://bit.ly/2s6tuPT" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2s6tuPT</span></a></li>
      <li class="bullet"><strong class="screentext">A Power </strong><strong class="screentext"><a id="calibre_link-840" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">Query calendar</strong>: <a href="https://bit.ly/3uxcf9Z" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3uxcf9Z</span></a></li>
      <li class="bullet"><strong class="screentext">A</strong><strong class="screentext"><a id="calibre_link-336" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext"> DAX 445 Custom Financial Calendar</strong>: <a href="https://bit.ly/39SOVeZ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/39SOVeZ</span></a></li>
    </ul>
    <p class="book-title--packt">A date table containing only the <code class="code-in-text--packt">DateKey</code>, <code class="code-in-text--packt">Date</code>, <code class="code-in-text--packt">Calendar</code> <code class="code-in-text--packt">Year</code>, and <code class="code-in-text--packt">Calendar Month</code> <code class="code-in-text--packt">Number</code> columns for the years 2010 to 2030 can be downloaded from the GitHub repository for this book. Download CH6_DateTable.xlsx from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a></p>
    <p class="book-title--packt">Date tables should contain a single row for every calendar date (no gaps). Given the small size (a 20-year span is approximately 7,600 rows inclusive of the last year), include all necessary history and three or more future years.</p>
    <h2 id="calibre_link-1660" class="calibre8">How to Build a Dimension Table</h2>
    <p class="book-title--packt">To implement this recipe, carry <a id="calibre_link-308" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>out the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12">Identify and document the required columns of the date dimension and identify any gaps with the existing table.<p class="packt_figref">Like other dimension tables, teams can often incrementally improve their date dimension table over time with additional logic. For example, if the great majority of analysis revolves around a fiscal calendar and at a certain granularity, then these columns can be targeted first. Mature date tables inclusive of standard and financial calendars, sequential surrogate columns, and logical or dynamic columns&mdash;such as <code class="code-in-text--packt">Fiscal Period Status</code>&mdash;are often quite wide, with over 40 columns. Required date dimension columns include the following:</p>
        <ul class="calibre11">
          <li class="calibre12">The <code class="code-in-text--packt">Prior Year Date</code> and <code class="code-in-text--packt">Prior Period Date</code> columns for both standard and financial calendars</li>
          <li class="calibre12">Natural hierarchy attributes for all levels, such as <code class="code-in-text--packt">2013</code>, <code class="code-in-text--packt">2013-Q3</code>, <code class="code-in-text--packt">2013-Sep</code>, <code class="code-in-text--packt">2013-Wk39</code>, and <code class="code-in-text--packt">9/25/2013</code></li>
        </ul>
        <p class="packt_figref">The natural hierarchy (one parent for each child value) allows users to easily navigate Power BI report visuals via drill-down and next-level commands. Without natural hierarchies, the context of the parent value is lost when drilling into the given parent. For example, drilling into the year 2017 would display each month's name, but the year associated with this month would only be visible in the tooltips by hovering over the chart. With natural hierarchies, this context is not lost as a <code class="code-in-text--packt">Calendar Yr-Mo</code> column might contain values such as <code class="code-in-text--packt">2017-Aug</code>.</p>
        <p class="packt_figref">Power BI provides a method of working around unnatural hierarchies in report visuals via the <strong class="screentext">Expand all down one level in the hierarchy</strong> drilling feature. However, this can lead to dense axis labels when multiple levels of a hierarchy are used. Given date intelligence requirements as well as the needs of other visualizations, it is recommended to build your date table to support natural hierarchies. When building natural hierarchies, consider building the following support columns:</p>
        <ul class="calibre11">
          <li class="calibre12">An integer column that corresponds to the chronological order of each string column, such as <code class="code-in-text--packt">Weekday</code>. For example, a <code class="code-in-text--packt">Weekday Number</code> column, with values of 1 through 7, will set the <code class="code-in-text--packt">Sort By</code> property of <code class="code-in-text--packt">Weekday</code>.</li>
          <li class="calibre12">Multiple "X in Y" columns, such as <code class="code-in-text--packt">Day in Year</code>, <code class="code-in-text--packt">Day in Month</code>, <code class="code-in-text--packt">Week in Month</code>, and <code class="code-in-text--packt">Week in Year</code>, stored as integers.</li>
          <li class="calibre12">Indicator columns, such as <code class="code-in-text--packt">Weekday Indicator</code>, <code class="code-in-text--packt">Holiday Indicator</code>, and <code class="code-in-text--packt">Working Day Indicator</code>. The values for these columns should be report-friendly, such as <code class="code-in-text--packt">Holiday</code> and <code class="code-in-text--packt">Non-Holiday</code>.</li>
          <li class="calibre12">Starting and ending date columns for the different grains supported, such as <code class="code-in-text--packt">Week Ending Date</code> and <code class="code-in-text--packt">Period Ending Date</code>.</li>
        </ul>
      </li>
      <li class="calibre12">Look to integrate <a id="calibre_link-309" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>other calendars, such as a periods or fiscal calendar, into the same date table in the source database. Distinct views can be created to support role-playing dimensions. See the <em class="italic">There's moreâ¦</em> section.</li>
      <li class="calibre12">Identify common date manipulations taking place in the existing reports, or by business users in Excel or Power BI, and consider adding a date dimension column to eliminate or simplify this work.</li>
      <li class="calibre12">Ensure that date columns (for example, <code class="code-in-text--packt">Prior Year Date</code>) and number columns (such as <code class="code-in-text--packt">Calendar Year</code>) are stored as date and integer data types, respectively, as this allows arithmetic and DAX functions, such as <code class="code-in-text--packt">MAX</code> and <code class="code-in-text--packt">MIN</code>, to operate without any type conversion.<p class="packt_figref">If the date dimension table is updated daily as part of a data warehouse <strong class="screentext">Extract-Transform-Load</strong> (<strong class="screentext">ETL</strong>) process, columns identifying the current and prior periods such as <code class="code-in-text--packt">IsCurrentFiscalPeriod</code> and <code class="code-in-text--packt">IsPrior60Days</code> are also common.</p>
      </li>
      <li class="calibre12">Consider adding two columns to the date table stored in the relational database, a natural hierarchy string (<code class="code-in-text--packt">2009-Jan</code>), and an integer column, such as <code class="code-in-text--packt">Calendar Year Month Number</code> (<code class="code-in-text--packt">200901</code>).</li>
      <li class="calibre12">Create a table with three columns, <code class="code-in-text--packt">Calendar Year</code>, <code class="code-in-text--packt">Calendar Month Number</code>, and an <code class="code-in-text--packt">identity</code> column with an increment value of 1, <code class="code-in-text--packt">Calendar Yr Mo Index</code>:
        <pre class="programlisting"><code class="hljs">Create Table dbo.TempTblYearMo
( [Calendar Year] int not null
, [Calendar Month Number] tinyint not null
, [Calendar Yr Mo Index] smallint <span><strong class="screentext">identity(1,1)</strong></span> not null)
</code></pre>
      </li>
      <li class="calibre12">Execute an <code class="code-in-text--packt">INSERT INTO</code> SQL statement to load this table.</li>
      <li class="calibre12"><code class="code-in-text--packt">SELECT</code>, <code class="code-in-text--packt">GROUP</code>, and <code class="code-in-text--packt">ORDER BY </code>the <code class="code-in-text--packt">Calendar Year</code> and <code class="code-in-text--packt">Calendar Month Number</code> columns from the existing date table.<p class="packt_figref">The <code class="code-in-text--packt">ORDER BY</code> clause of the <code class="code-in-text--packt">SELECT</code> statement should order by <code class="code-in-text--packt">Calendar Year</code> and then by <code class="code-in-text--packt">Calendar Month Number</code>. The temporary table's index column (<code class="code-in-text--packt">Calendar Yr Mo Index</code>) is now populated in sequential order by month across years, as per <em class="italic">Figure 6.1</em>.</p>
        <figure class="mediaobject"><img src="images/000158.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 6.1: TempTblYearMo table loaded from the INSERT INTO statement</p>
      </li>
      <li class="calibre12">Execute an <code class="code-in-text--packt">UPDATE</code> statement<a id="calibre_link-310" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> that populates the <code class="code-in-text--packt">Calendar Year Month Number</code> column with the identity value:
        <pre class="programlisting"><code class="hljs">UPDATE DBO.DimFinDateTestTbl
SET [Calendar Year Month Number] = T.[Calendar Yr Mo Index]
FROM 
DBO.DimFinDateTestTbl as D INNER JOIN dbo.TempTblYearMo as T
ON D.[Calendar Year] = T.[Calendar Year] AND D.[Calendar Month Number] = T.[Calendar Month Number]
</code></pre>
        <p class="packt_figref">The following query in <em class="italic">Figure 6.2</em> displays the sequentially increasing <code class="code-in-text--packt">Calendar Year Month Number</code> column on the <code class="code-in-text--packt">date</code> table.</p>
        <figure class="mediaobject"><img src="images/000170.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 6.2: Date table with the Calendar Year Month Number column updated</p>
      </li>
      <li class="calibre12">Repeat this process for other natural hierarchy columns, such as <code class="code-in-text--packt">Year-Qtr</code> and <code class="code-in-text--packt">Year-Wk</code>, and drop the temporary tables.</li>
      <li class="calibre12">When loaded to the model, the surrogate columns should be hidden from <code class="code-in-text--packt">Report View</code> and used as the <code class="code-in-text--packt">Sort By</code> column.</li>
      <li class="calibre12">Implement hierarchies in the <code class="code-in-text--packt">Fields</code> list as per the <em class="italic">Creating Hierarchies and Groups</em> recipe, shared in <em class="italic">Chapter 3</em>, <em class="italic">Building a Power BI Data Model</em>.</li>
    </ol>
    <p class="book-title--packt">SQL window functions can <a id="calibre_link-1661" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>be helpful in creating certain "X in Y" date dimension columns. For example, the following <code class="code-in-text--packt">DENSE_RANK</code> function returns the calendar week number of the given calendar month:</p>
    <pre class="programlisting"><code class="hljs">OVER(PARTITION BY D.[CALENDAR YEAR MONTH NUMBER] ORDER BY D.[Calendar Week Number in Year])
</code></pre>
    <p class="book-title--packt">For DirectQuery data models in which the SQL queries defining the tables of the model are executed at runtime, it is best to move as much data transformation logic back to the source system. Complex SQL queries, DAX calculated columns, and M query expression logic can all lead to inefficient query plans, and so negatively impact the performance of DirectQuery solutions.</p>
    <h2 id="calibre_link-1662" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">Date intelligence measures reference the surrogate key columns to easily define specific time period filter conditions, such as in <code class="code-in-text--packt">Internet Net Sales (Trailing 3 Periods)</code>:</p>
    <pre class="programlisting"><code class="hljs">Internet Net Sales (Trailing 3 Periods) = 
    CALCULATE(
        [Internet Net Sales],
        FILTER(
            ALL('Date'),
            'Date'[Calendar Year Month Number] &gt;= 
                MAX('Date'[Calendar Year Month Number])-2
            &amp;&amp; 
            'Date'[Calendar Year Month Number] &lt;= 
                MAX('Date'[Calendar Year Month Number])
        )
    )
</code></pre>
    <p class="book-title--packt">The <code class="code-in-text--packt">Internet Net Sales</code> (<code class="code-in-text--packt">Trailing 3 Periods</code>) can be used in visuals as shown in <em class="italic">Figure 6.3</em>.</p>
    <figure class="mediaobject"><img src="images/000182.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 6.3: Trailing 3 Periods measure includes Calendar Year Month Number values 99 through 101 for 2017-May</p>
    <p class="book-title--packt">If the <code class="code-in-text--packt">Calendar Year Month Number</code> column was not sequential, it would not be possible to refer to months across years without complex logic, such as the trailing three-month average of <code class="code-in-text--packt">2017-Jan</code>. Note that in this example, May 2017 is the current month and so was included, but often only the completed (or previous) months are included in these calculations</p>
    <p class="book-title--packt">The SQL view used by the <a id="calibre_link-311" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>data model should dynamically filter the required dates, such as the trailing three years:</p>
    <pre class="programlisting"><code class="hljs">FROM DBO.DimFinDate as D 
WHERE 
D.[Date] BETWEEN DATEADD(YEAR,-3,CAST(CURRENT_TIMESTAMP AS date)) AND CAST(CURRENT_TIMESTAMP as date)
</code></pre>
    <p class="book-title--packt">In this example, only the current system date and three prior calendar years are loaded to the data model.</p>
    <h2 id="calibre_link-1663" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">An alternative to "secondary relationships" (inactive relationships) via the <code class="code-in-text--packt">USERELATIONSHIP</code> function described in <em class="italic">Chapter 3</em>, <em class="italic">Building a Power BI Data Model,</em> is to have multiple date dimension tables in the data model, each with a single, active relationship based on a different date column of the fact table. For example, a model would have <code class="code-in-text--packt">Order Date</code>, <code class="code-in-text--packt">Ship Date</code>, and <code class="code-in-text--packt">Delivery Date</code> dimension tables. This approach, called <strong class="screentext">role-playing tables</strong>, reduces <a id="calibre_link-988" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the volume of custom measures that must be developed and maintained in the model. If choosing this approach, create separate views against the source date dimension table, corresponding to each role-playing table. Apply column aliases in each view associating the attribute to the date (for example, <code class="code-in-text--packt">Ship Date Year</code> or <code class="code-in-text--packt">Ship Date Month</code>).</p>
    <p class="book-title--packt">If the source fact table only contains a surrogate key, commonly in the <code class="code-in-text--packt">YYYYMMDD</code> format, the source views utilized by the data model can include the following conversion logic:</p>
    <pre class="programlisting"><code class="hljs">CONVERT(date,(CAST(F.OrderDateKey AS nvarchar(8)))) as [Order Date-Convert]
</code></pre>
    <p class="book-title--packt">The <code class="code-in-text--packt">DATEFROMPARTS</code> function in SQL Server can be used for many other date conversion or logical needs.</p>
    <p class="book-title--packt">As a general practice we recommend developing a single date dimension table in a corporate data warehouse system such as Azure Synapse Analytics and leveraging this dimension across multiple datasets. In many cases, a Power BI dataset targeting a particular business process and team will require custom date filtering or grouping not supported by the existing date dimension table in the data warehouse. In these scenarios, the additional logic can be incorporated into a SQL view object specific to the dataset or, if the requirement is expected to be common across many datasets, the new logic or columns could be built into the data warehouse dimension table.</p>
    <h1 id="calibre_link-1238" class="title">Preparing the Date Dimension via the Query Editor</h1>
    <p class="book-title--packt">In some BI environments, it is <a id="calibre_link-304" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>not feasible to alter the source date <a id="calibre_link-909" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>table as per the previous recipe or even modify the SQL view used to load the date dimension table. In these situations, Power BI Desktop's Query Editor and M expressions can serve as an effective alternative to deliver the same columns necessary to drive robust date intelligence analysis.</p>
    <p class="book-title--packt">In this recipe, an example date dimension M query is shared that builds common date attributes as well as dynamic logical columns. Additionally, a process for adding sequential date intelligence columns via M expressions is also included.</p>
    <h2 id="calibre_link-1664" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe:</p>
    <ul class="calibre9">
      <li class="bullet">Download <code class="code-in-text--packt">CH6_DateTable.xlsx</code> from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a></li>
    </ul>
    <h2 id="calibre_link-1665" class="calibre8">How to Prepare the Date Dimension</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a new Power BI Desktop file.</li>
      <li class="calibre12">Open the <code class="code-in-text--packt">Power Query Editor</code> by clicking <code class="code-in-text--packt">Transform Data</code> from the ribbon of the <code class="code-in-text--packt">Home</code> tab.</li>
      <li class="calibre12">Create a query that imports the <code class="code-in-text--packt">Dates</code> sheet from <code class="code-in-text--packt">CH6_DateTable.xlsx</code>, and call this query <code class="code-in-text--packt">BaseDateTable</code>.</li>
      <li class="calibre12">Create an M query that references the <code class="code-in-text--packt">BaseDateTable</code> query, retrieves the last three years of dates, and computes 11 additional columns via M functions:
        <pre class="programlisting"><code class="hljs">let 
    Dates = BaseDateTable,
    CurrentDate = DateTime.Date(DateTime.LocalNow()),
    CurrentYear = Date.Year(DateTime.Date(DateTime.LocalNow())), 
    CurrentMonth = Date.Month(DateTime.Date(DateTime.LocalNow())), 
    FilteredDates = 
        Table.SelectRows(
            Dates, 
            each [Date] &gt;= 
            Date.AddYears(CurrentDate,-3) and [Date] &lt;= CurrentDate
        ),
    DateCol = Table.SelectColumns(FilteredDates,"Date"),
    YearCol = 
        Table.AddColumn(
            DateCol, "Year", each Date.Year([Date]), Int64.Type
        ),
    MonthNameCol = 
        Table.AddColumn(
            YearCol, "Month Name", each Date.MonthName([Date]), type text
        ),
    YearMonthCol = 
        Table.AddColumn(
            MonthNameCol, "Year-Mo", 
            each Text.From([Year]) &amp; "-" &amp; [Month Name], type text
        ),
    MonthNumberCol = 
        Table.AddColumn(
            YearMonthCol, "Month Number", each Date.Month([Date]), Int64.Type
        ),
    WeekdayNameCol = 
        Table.AddColumn(
            MonthNumberCol, "Weekday", each Date.DayOfWeekName([Date]), 
            type text
        ), 
    DayNumberOfWeekCol = 
        Table.AddColumn(
            WeekdayNameCol, "Weekday Number", 
            each Date.DayOfWeek([Date]), Int64.Type
        ), 
    YearStatusCol = 
        Table.AddColumn(DayNumberOfWeekCol, "Year Status", each 
            if Date.IsInCurrentYear([Date]) = true then "Current Year" 
            else if [Year] = CurrentYear - 1 then "Prior Year" 
            else "Other Year", type text
        ),
    MonthStatusCol = 
        Table.AddColumn(YearStatusCol, "Month Status", each
            if [Year Status] = "Current Year" and [Month Number] = CurrentMonth 
            then "Current Month" else 
            if [Year] = 
                    Date.Year(
                        Date.AddMonths(DateTime.Date(DateTime.LocalNow()),-1)
                    ) 
                and [Month Number] = 
                    Date.Month(
                        Date.AddMonths(DateTime.Date(DateTime.LocalNow()),-1)
                    ) 
            then "Prior Month" else "Other Month", type text
        ),
    DayInMonthCol = 
        Table.AddColumn(
            MonthStatusCol, "Day in Month", each Date.Day([Date]), Int64.Type
        ),
    WeekOfYearCol = 
        Table.AddColumn(
            DayInMonthCol, "Week of Year", each Date.WeekOfYear([Date]), 
            Int64.Type
        ),
    WeekOfMonthCol = 
        Table.AddColumn(
            WeekOfYearCol, "Week of Month", 
            each Date.WeekOfMonth([Date]), Int64.Type
        )
in 
    WeekOfMonthCol
</code></pre>
      </li>
      <li class="calibre12">Name this <a id="calibre_link-305" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query <code class="code-in-text--packt">DatesInterim</code>.</li>
      <li class="calibre12">Create a new <a id="calibre_link-910" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query called <code class="code-in-text--packt">Dates</code> that adds a surrogate sequential column to be used in date intelligence measures:
        <pre class="programlisting"><code class="hljs">let 
    Source = BaseDateTable, 
    YearMonthCols = 
        Table.Distinct(
            Table.SelectColumns(
                Source, {"Calendar Year","Calendar Month Number"}
            )
        ),
    YearMonthColSort = 
        Table.Sort(
            YearMonthCols,
            {
                {"Calendar Year", Order.Ascending}, 
                {"Calendar Month Number", Order.Ascending}
            }
        ),
    YearMonthColIndex = 
        Table.AddIndexColumn(YearMonthColSort, "YearMonthIndex",1,1),
    JoinedDateTable = 
        Table.NestedJoin(
            DatesInterim, {"Year", "Month Number"},
            YearMonthColIndex, {"Calendar Year","Calendar Month Number"}, 
            "Year-Mo Index", JoinKind.Inner
        ), 
    IndexColumnAdded = 
        Table.ExpandTableColumn(
            JoinedDateTable,
            "Year-Mo Index",{"YearMonthIndex"},{"Year Month Number"}
        )
in 
    IndexColumnAdded
</code></pre>
      </li>
      <li class="calibre12">Disable loading on <code class="code-in-text--packt">BaseDateTable</code> and <code class="code-in-text--packt">DatesInterim</code> by right-clicking the queries and deselecting <code class="code-in-text--packt">Enable load</code>. Only the <code class="code-in-text--packt">Dates</code> query needs to be loaded into the data model.</li>
    </ol>
    <h2 id="calibre_link-1666" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">For the <code class="code-in-text--packt">DatesInterim</code> query, the <code class="code-in-text--packt">CurrentDate</code>, <code class="code-in-text--packt">CurrentMonth</code>, and <code class="code-in-text--packt">CurrentYear</code> expressions can be stored as separate queries. The <code class="code-in-text--packt">DateTime.LocalNow</code> function is used in dynamic M date logic, similar<a id="calibre_link-325" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to the <code class="code-in-text--packt">CURRENT_TIMESTAMP</code> function used in SQL statements. A filter is applied via the <code class="code-in-text--packt">Table.SelectRows</code> function to only retrieve the last three years<a id="calibre_link-306" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> of dates, and conditional logic is used <a id="calibre_link-911" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to populate dynamic <code class="code-in-text--packt">Year Status</code> and <code class="code-in-text--packt">Month Status</code> columns (for example, <code class="code-in-text--packt">Current Year</code>). The rest of the expressions use functions of the <code class="code-in-text--packt">Date</code> object class or concatenate columns.</p>
    <p class="book-title--packt">Despite a minimal date table available in the source system (all that is required is a column containing dates), the M query generates a useful date dimension table for a model with many of the most common and important columns.</p>
    <p class="book-title--packt">For the final <code class="code-in-text--packt">Dates</code> query, two additional columns (<code class="code-in-text--packt">Calendar Year</code> and <code class="code-in-text--packt">Calendar Month Number</code>) are used, although we could have performed a self-joining query with the <code class="code-in-text--packt">Year</code> and <code class="code-in-text--packt">Month Number</code> columns in the <code class="code-in-text--packt">DatesInterim</code> query. For example, if we rename the <code class="code-in-text--packt">Dates</code> query to <code class="code-in-text--packt">DatesInterim2</code>, we can create the final <code class="code-in-text--packt">Dates</code> table that adds a sequential index for <code class="code-in-text--packt">Year Week Number</code> as well:</p>
    <pre class="programlisting"><code class="hljs">let
    Source = DatesInterim2,
    YearMonthWeekCols = 
        Table.Distinct(
            Table.SelectColumns(
                Source, {"Year", "Month Number", "Week of Year"}
            )
        ),
    YearMonthWeekColSort = 
        Table.Sort(
            YearMonthWeekCols,
            {
                {"Year", Order.Ascending},
                {"Month Number", Order.Ascending},
                {"Week of Year", Order.Ascending}
            }
        ),
    YearMonthWeekColIndex = 
        Table.AddIndexColumn(YearMonthWeekColSort, "YearMonthWeekIndex",1,1),
    JoinedDateTable = 
        Table.NestedJoin(
            DatesInterim2,{"Year", "Month Number", "Week of Year"},
            YearMonthWeekColIndex, {"Year", "Month Number", "Week of Year"},
            "Year-Mo-Wk Index", JoinKind.Inner
        ),
    IndexColumnAdded = 
        Table.ExpandTableColumn(
            JoinedDateTable,
            "Year-Mo-Wk Index", {"YearMonthWeekIndex"},{"Year Month Week Number"}
        )
in
    IndexColumnAdded
</code></pre>
    <p class="book-title--packt">The <code class="code-in-text--packt">Table.AddIndexColumn</code> function<a id="calibre_link-1074" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is applied to the sorted <code class="code-in-text--packt">DatesInterim2</code> table to create the sequential column, <code class="code-in-text--packt">YearMonthWeekColIndex</code>. The <code class="code-in-text--packt">DatesInterim2</code> query is then joined to <a id="calibre_link-307" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the table containing this new column. Finally, the<a id="calibre_link-912" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> joined table is expanded using the <code class="code-in-text--packt">Table.ExpandTablecolumn</code> function.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">Year-Mo</code> column (that is, <code class="code-in-text--packt">2016-Dec</code>) can now be sorted by the <code class="code-in-text--packt">Year Month Number</code> column in the data model and DAX measures can reference the <code class="code-in-text--packt">Year Month Number</code> column to apply date intelligence filter conditions, such as the trailing six months.</p>
    <h2 id="calibre_link-1667" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">The <code class="code-in-text--packt">Table.AddIndexColumn</code> function<a id="calibre_link-1668" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> used in this recipe is not currently supported in DirectQuery mode for SQL Server, and thus the full M query from the date dimension M query section of this recipe cannot be used in DirectQuery data models.</p>
    <p class="book-title--packt">Since the data access queries defining the dimension and fact tables in DirectQuery models are executed at runtime, these queries should be as simple as possible. For example, these queries should avoid joins, derived tables, subqueries, data type conversions, case statements, and so on. Simple, performant, or optimized queries are especially important for the queries used to access the largest tables of the model. To ensure sufficient performance in Power BI with DirectQuery models, large source tables of DirectQuery models should be optimized for read performance with features such as the columnstore index of SQL Server and table partitions.</p>
    <h2 id="calibre_link-1669" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><strong class="screentext">Power Query </strong><strong class="screentext"><a id="calibre_link-844" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">Date functions</strong>: <a href="https://bit.ly/3wSCMAz" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3wSCMAz</span></a></li>
      <li class="bullet"><strong class="screentext">Power Query </strong><strong class="screentext"><a id="calibre_link-850" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">Table functions</strong>: <a href="https://bit.ly/3wMxlmC" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3wMxlmC</span></a></li>
    </ul>
    <h1 id="calibre_link-1239" class="title">Authoring Date Intelligence Measures</h1>
    <p class="book-title--packt">With a complete date<a id="calibre_link-317" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> dimension table in place, date intelligence measures can be developed to support common requirements, such as <code class="code-in-text--packt">year-to-date</code>, <code class="code-in-text--packt">year-over-year</code>, and rolling history, as well as more complex, context-specific behaviors. </p>
    <p class="book-title--packt">The date intelligence patterns described in this recipe are applicable to both standard and non-standard financial calendars, as they leverage fundamental DAX functions and the sequential date intelligence columns created earlier in this chapter.</p>
    <p class="book-title--packt">This recipe includes examples of core <code class="code-in-text--packt">year-to-date</code> and prior year measures, as well as a more advanced dynamic prior period measure that adjusts to all grains of the date dimension.</p>
    <h2 id="calibre_link-1670" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Complete the <em class="italic">Preparing the Date Dimension via the Query Editor</em> recipe in this chapter, or have a date table with the same columns as in that recipe.</li>
      <li class="calibre12">Edit the initial part of the <code class="code-in-text--packt">DatesInterim</code> query to load all rows, and not just the first three years. The code snippet below represents the initial part of the query with the <code class="code-in-text--packt">FilteredDates</code> expression removed. The rest of the query is the same as the recipe. Note that the <code class="code-in-text--packt">DateCol</code> expression now refers to the <code class="code-in-text--packt">Dates</code> expression instead of the <code class="code-in-text--packt">FilteredDates</code> expression:
        <pre class="programlisting"><code class="hljs">    Dates = BaseDateTable,
    CurrentDate = DateTime.Date(DateTime.LocalNow()),
    CurrentYear = Date.Year(DateTime.Date(DateTime.LocalNow())), 
    CurrentMonth = Date.Month(DateTime.Date(DateTime.LocalNow())), 
    DateCol = Table.SelectColumns(Dates,"Date"),
</code></pre>
      </li>
      <li class="calibre12">Add two additional columns to the end of the DatesInterim query for Prior Year Date and Prior Month Date using the following code:
        <pre class="programlisting"><code class="hljs">PriorYearDate = 
        Table.AddColumn(
            WeekOfMonthCol, "Prior Year Date", each Date.AddYears([Date],-1)
        ),
    PriorMonthDate = 
        Table.AddColumn(
            PriorYearDate, "Prior Month Date", each Date.AddMonths([Date],-1)
        )
in 
    PriorMonthDate
</code></pre>
      </li>
      <li class="calibre12">Import the <code class="code-in-text--packt">FactInternetSales</code> table from the <code class="code-in-text--packt">AdventureWorksDW2019</code> database.</li>
      <li class="calibre12">Create a relationship between the <code class="code-in-text--packt">Date</code> column in the <code class="code-in-text--packt">Dates</code> table and the <code class="code-in-text--packt">OrderDate</code> column in the <code class="code-in-text--packt">FactInternetSales</code> table.</li>
      <li class="calibre12">Mark the <code class="code-in-text--packt">Dates</code> table as a date table using the <code class="code-in-text--packt">Date</code> column.</li>
    </ol>
    <p class="book-title--packt">Plan for a standard measure naming convention to identify the date intelligence logic, such as <code class="code-in-text--packt">Sales (PYTD)</code>. Symbol <a id="calibre_link-318" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>characters, such as currency (<code class="code-in-text--packt">$</code>) or percentage (<code class="code-in-text--packt">%</code>), can also help users browse the measures. Document the types of date intelligence measures to be implemented and for which measures of the model. Create a date intelligence measure matrix for documentation and to support communication with stakeholders.</p>
    <figure class="mediaobject"><img src="images/000196.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 6.4: Date intelligence measure matrix</p>
    <p class="book-title--packt">Conduct reviews and/or quality assurance testing with business users to validate the logic and walk through use cases when designing reports. Given the volume of new measures to be developed, it is best to receive business approval for one or two measures prior to applying the date intelligence logic to other measures.</p>
    <h2 id="calibre_link-1671" class="calibre8">How to Author Date Intelligence Measures</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a simple Internet Sales measure:
        <pre class="programlisting"><code class="hljs">Internet Sales = SUM('FactInternetSales'[SalesAmount])
</code></pre>
      </li>
      <li class="calibre12">Create <code class="code-in-text--packt">Year-to-Date (YTD)</code>, <code class="code-in-text--packt">Month-to-Date (MTD)</code>, and <code class="code-in-text--packt">Week-to-Date</code> (<code class="code-in-text--packt">WTD</code>) measures:
        <pre class="programlisting"><code class="hljs">Internet Sales (YTD) = 
    CALCULATE([Internet Sales],
        FILTER(ALL('Dates'),
             'Dates'[Year] = MAX('Dates'[Year]) &amp;&amp;
            'Dates'[Date] &lt;= MAX('Dates'[Date])))
Internet Sales (MTD) = 
    CALCULATE([Internet Sales],
        FILTER(ALL('Dates'),
            'Dates'[Year Month Number] = MAX('Dates'[Year Month Number]) &amp;&amp;
            'Dates'[Date] &lt;= MAX('Dates'[Date])))
Internet Sales (WTD) = 
    CALCULATE([Internet Sales],
        FILTER(ALL('Dates'),
            'Dates'[Year Week Number] = MAX('Dates'[Year Week Number]) &amp;&amp;
            'Dates'[Date] &lt;= MAX('Dates'[Date])))
</code></pre>
      </li>
      <li class="calibre12">Create<a id="calibre_link-319" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> <code class="code-in-text--packt">Prior Year (PY)</code>, <code class="code-in-text--packt">Prior Year to Date (PYTD)</code>, and <code class="code-in-text--packt">Prior Month to Date (PMTD)</code> measures:
        <pre class="programlisting"><code class="hljs">Internet Sales (PY) = 
    CALCULATE([Internet Sales],
        FILTER(ALL('Dates'), 
            'Dates'[Date] &gt;= MIN('Dates'[Prior Year Date]) &amp;&amp; 
            'Dates'[Date] &lt;= MAX('Dates'[Prior Year Date])))
Internet Sales (PYTD) = 
    CALCULATE([Internet Sales],
        FILTER(ALL('Dates'), 
            'Dates'[Year] = MAX('Dates'[Year]) - 1 &amp;&amp; 
            'Dates'[Date] &lt;= MAX('Dates'[Prior Year Date])))
Internet Sales (PMTD) = 
    CALCULATE([Internet Sales],
        FILTER(ALL('Dates'), 
            'Dates'[Year Month Number] = MAX('Dates'[Year Month Number]) - 1 &amp;&amp; 
            'Dates'[Date] &lt;= MAX('Dates'[Prior Month Date])))
</code></pre>
      </li>
      <li class="calibre12">Use the current year and prior year measures to create <code class="code-in-text--packt">Year-over-Year (YOY)</code> measures:
        <pre class="programlisting"><code class="hljs">Internet Sales (YOY YTD) = [Internet Sales (YTD)] - [Internet Sales (PYTD)]
Internet Sales (YOY YTD %) = DIVIDE([Internet Sales (YOY YTD)],[Internet Sales (PYTD)])
</code></pre>
      </li>
      <li class="calibre12">Build logic into<a id="calibre_link-320" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> date intelligence measures to account for alternative subtotal filter contexts, such as when a prior period measure is calculated in a yearly, quarterly, or weekly subtotal context:
        <pre class="programlisting"><code class="hljs">Internet Sales (Prior Period) = 
    VAR Periods = DISTINCTCOUNT('Dates'[Year Month Number]) 
RETURN SWITCH(TRUE, 
    HASONEVALUE('Dates'[Date]),
        CALCULATE([Internet Sales],
            FILTER(ALL('Dates'),'Dates'[Date] = MAX('Dates'[Date])-1)),
    HASONEVALUE('Dates'[Year Week Number]),
        CALCULATE([Internet Sales],
            FILTER(ALL('Dates'),
                'Dates'[Year Week Number] = MAX('Dates'[Year Week Number])-1)),
    CALCULATE([Internet Sales],
        FILTER(ALL('Dates'),
            'Dates'[Year Month Number] &gt;= 
                MIN('Dates'[Year Month Number]) - Periods &amp;&amp;
            'Dates'[Year Month Number] &lt;= 
                MAX('Dates'[Year Month Number]) - Periods )))
</code></pre>
      </li>
      <li class="calibre12">Create a <code class="code-in-text--packt">Matrix</code> visualization that uses the <code class="code-in-text--packt">Year</code> column from the <code class="code-in-text--packt">Dates</code> table for columns and the <code class="code-in-text--packt">Internet Sales (YTD)</code> and <code class="code-in-text--packt">Internet Sales (PYTD)</code> as values</li>
    </ol>
    <h2 id="calibre_link-1672" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">When designing date intelligence measures, it is important to understand that the definition of "current" and "prior" are defined by the context of the visualization in which the measures operate. The <code class="code-in-text--packt">FILTER</code> function iterates<a id="calibre_link-485" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> each row (a date) to determine which rows are passed to<a id="calibre_link-116" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <code class="code-in-text--packt">CALCULATE</code> function. The <code class="code-in-text--packt">ALL</code> function<a id="calibre_link-49" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> removes all existing date table filters, thereby allowing filter conditions in the measure to access all rows of the date table.</p>
    <p class="book-title--packt">For the "current" date period measures, each measure expression sets an "equal to" condition on the column representing the intended granularity; this column respects the filter context of the report query via <code class="code-in-text--packt">MAX</code>. If the source query to the date table is filtered to only retrieve dates equal to or less than the current date, these measures will default to the current year, month (or period), and week when added to reports.</p>
    <p class="book-title--packt">Note that the <code class="code-in-text--packt">Year</code> <code class="code-in-text--packt">Month Number</code> and <code class="code-in-text--packt">Year Week Number</code> columns should be sequentially increasing integers.</p>
    <p class="book-title--packt">For the "prior" date period measures, applying both the <code class="code-in-text--packt">MIN</code> and <code class="code-in-text--packt">MAX</code> filter conditions against the prior date columns selects the corresponding date ranges. Subtracting a value (1 in this example) from the <code class="code-in-text--packt">MAX</code> of the column shifts the selected time period backward.</p>
    <p class="book-title--packt">Growth or variance <a id="calibre_link-321" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>measures that calculate the difference between the current time period value of a measure and a prior time period such as <code class="code-in-text--packt">Year-over-Year</code> <code class="code-in-text--packt">(YOY)</code> growth can be created with new measures that subtract the previous time period measure from the current period measure. Additional growth or variance measures expressed in percentages can use the <code class="code-in-text--packt">DIVIDE</code> function for computing this difference as a percentage of the previous time period value.</p>
    <p class="book-title--packt">Prior period date columns allow the prior time period measures to apply simple filter expressions relative to the active date filter context down to the individual date granularity. In the absence of these columns and for period- or month-level date tables, measure filter conditions can be written as follows:</p>
    <pre class="programlisting"><code class="hljs">Prior Year (PY) = 'Dates'[Year Month Number] = MAX('Dates'[Year Month Number]) - 12)
Prior Month (PM) = 'Dates'[Year Month Number] = MAX('Dates'[Year Month Number]) - 1)
</code></pre>
    <p class="book-title--packt">For the dynamic prior period measure, <code class="code-in-text--packt">Internet Sales (Prior Period)</code>, the DAX variable (<code class="code-in-text--packt">Periods</code>) computes the number of periods in the current filter context, such as 12 if a year is the subtotal, 3 if it is a quarter, or 1 for an individual period. Test conditions with <code class="code-in-text--packt">HASONEVALUE</code> check whether a single date or week is selected, and return the corresponding previous day or week, respectively. The remaining date grains (Year, Quarter, Period) are accounted for by the <code class="code-in-text--packt">Periods</code> variable; this value is subtracted from both the <code class="code-in-text--packt">MIN</code> and the <code class="code-in-text--packt">MAX</code> of the period number of the given context. This example underscores the importance of sequential date intelligence columns for accessing specific time frames across grains to apply custom filter conditions.</p>
    <h2 id="calibre_link-1673" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">DAX includes a full set of time intelligence functions, such as <code class="code-in-text--packt">DATESYTD</code> and <code class="code-in-text--packt">SAMEPERIODLASTYEAR,</code> which, given a standard (Gregorian) calendar, can compute the same values as the expressions in this recipe. Although these functions generally improve readability relative to the examples in this recipe, the use (and knowledge) of core <code class="code-in-text--packt">DAX</code> functions, such as <code class="code-in-text--packt">FILTER</code>, <code class="code-in-text--packt">MAX</code>, and <code class="code-in-text--packt">MIN</code>, is necessary when working with non-standard calendars&mdash;such as fiscal calendars and more complex scenarios. Considering that the vast majority of <code class="code-in-text--packt">DAX</code> time intelligence functions<a id="calibre_link-368" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are simply syntax sugar for the <code class="code-in-text--packt">FILTER</code> function and the simplifying assumptions regarding calendar dates, it is unwise to rely on <code class="code-in-text--packt">DAX</code> time intelligence functions to be of any meaningful use in many real-world scenarios.</p>
    <p class="book-title--packt">It is often surprising for many individuals new to business intelligence how differently organizations measure and conceptualize time; this can be particularly true regarding weeks. Here again, the DAX time intelligence functions are useless, as there are no included week functions. When dealing with weeks, different organizations start weeks on different days within a week. Thus, when assigning week numbers at either a yearly or monthly grain, it is important to bear this in mind. </p>
    <p class="book-title--packt">Furthermore, organizations will also treat partial weeks differently as well. For example, in the final <code class="code-in-text--packt">Dates</code> table, there is a single entry for <code class="code-in-text--packt">Year Week Number</code> of <code class="code-in-text--packt">54</code>. This is because the year 2010 ends with a partial 53<sup class="superscript--packt">rd</sup> week. A single day of this week, Saturday, January 1<sup class="superscript--packt">st</sup>, 2011, falls outside of 2010. Organizations will treat these partial weeks differently, either including that single day as part of the week starting in 2010, as its own week, or as part of the first full week of 2011.</p>
    <h2 id="calibre_link-1674" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><strong class="screentext">DAX FILTER</strong><strong class="screentext"><a id="calibre_link-347" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext"> function</strong>: <a href="https://bit.ly/2Q1S45q" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2Q1S45q</span></a></li>
      <li class="bullet"><strong class="screentext">DAX HASONEVALUE </strong><strong class="screentext"><a id="calibre_link-350" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">function</strong>: <a href="https://bit.ly/3wXSEBE" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3wXSEBE</span></a></li>
      <li class="bullet"><strong class="screentext">DAX time intelligence </strong><strong class="screentext"><a id="calibre_link-369" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">functions</strong>: <a href="https://bit.ly/3mKWtWp" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3mKWtWp</span></a></li>
      <li class="bullet"><strong class="screentext">To **bleep** with Time Intelligence</strong>: <a href="https://bit.ly/3gaUHN6" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3gaUHN6</span></a></li>
    </ul>
    <h1 id="calibre_link-1240" class="title">Developing Advanced Date Intelligence Measures</h1>
    <p class="book-title--packt">Date intelligence measures are <a id="calibre_link-30" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>often at the center of the most visible Power BI reports and dashboards, as well as more complex business analyses. Therefore, given the unique requirements of each organization and BI project, it is important to understand how to go beyond the standard patterns described in the previous recipe to efficiently embed custom logic. Additionally, the ability to answer the business question "When did X occur (or not occur)?" is a powerful supplement to data models that can be supported via DAX measure logic.</p>
    <p class="book-title--packt">In this recipe, an example is provided of a measure that identifies the dates in which sales were not recorded for a specific region and product category. In addition, a custom prior year-to-date measure is described with default (no filter) behavior and the exclusion of incomplete periods from the current year.</p>
    <h2 id="calibre_link-1675" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this<a id="calibre_link-1676" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Complete the <em class="italic">Preparing the Date Dimension via the Query Editor</em> recipe from this chapter.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <code class="code-in-text--packt">Data Sources</code> and <code class="code-in-text--packt">disable loading</code>.</li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">AdWorksDW</code> and choose <code class="code-in-text--packt">Reference</code>.</li>
      <li class="calibre12">Select the <code class="code-in-text--packt">FactInternetSales</code> table and name this query <code class="code-in-text--packt">Internet Sales</code>.</li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">5</em> and <em class="italic">6</em> for the <code class="code-in-text--packt">DimSalesTerritory</code> table and name this query <code class="code-in-text--packt">Sales Territories</code>.</li>
      <li class="calibre12">Create a <code class="code-in-text--packt">Products</code> query based upon the <code class="code-in-text--packt">DimProduct</code>, <code class="code-in-text--packt">DimProductCategory</code>, and <code class="code-in-text--packt">DimProductSubcategory</code> tables using the following code.
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName"}, {"Product Category"}
        )
in
   Category
</code></pre>
      </li>
      <li class="calibre12">Separate the fact query, <code class="code-in-text--packt">Internet Sales</code>, into a <code class="code-in-text--packt">Facts</code> query group.</li>
      <li class="calibre12">Separate the dimension queries, <code class="code-in-text--packt">Dates</code>, <code class="code-in-text--packt">Sales Territories</code>, and <code class="code-in-text--packt">Products</code>, into a <code class="code-in-text--packt">Dimensions</code> query group.</li>
      <li class="calibre12">Create a <code class="code-in-text--packt">Blank</code> <code class="code-in-text--packt">Query</code> called <code class="code-in-text--packt">Calculations</code> in the <code class="code-in-text--packt">Other Queries</code> group.</li>
      <li class="calibre12">Select <code class="code-in-text--packt">Close &amp; Apply</code> in the ribbon of the <code class="code-in-text--packt">Home</code> tab to load the tables to the data model.</li>
      <li class="calibre12">Create a relationship using the <code class="code-in-text--packt">Date</code> column from the <code class="code-in-text--packt">Dates</code> table and the <code class="code-in-text--packt">OrderDate</code> column of the <code class="code-in-text--packt">Internet Sales</code> table.</li>
      <li class="calibre12">Create a relationship between the <code class="code-in-text--packt">Internet Sales</code> table and the <code class="code-in-text--packt">Products</code> and <code class="code-in-text--packt">Sales Territories</code> tables using the <code class="code-in-text--packt">ProductKey</code> column and <code class="code-in-text--packt">SalesTerritoryKey</code> column, respectively.</li>
      <li class="calibre12">Set the <code class="code-in-text--packt">Sort By</code> column<a id="calibre_link-31" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> for the <code class="code-in-text--packt">Year-Mo</code> column in <code class="code-in-text--packt">Dates</code> to be the <code class="code-in-text--packt">Year</code> <code class="code-in-text--packt">Month</code> <code class="code-in-text--packt">Number</code> column.</li>
    </ol>
    <h2 id="calibre_link-1677" class="calibre8">How to Develop Advanced Date Intelligence Measures</h2>
    <p class="book-title--packt">To implement this recipe, carry out the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a measure that counts the rows (days) that do not have corresponding fact table rows, given the following conditions:
        <pre class="programlisting"><code class="hljs">Days Without Northwest Bike Sales = 
    COUNTROWS(
        FILTER('Dates', 
            ISEMPTY(CALCULATETABLE('Internet Sales',
                FILTER(CROSSJOIN(ALL('Sales Territories'),ALL('Products')),
                    'Sales Territories'[SalesTerritoryRegion] = "Northwest" &amp;&amp; 
                        'Products'[Product Category] = "Bikes")))))
</code></pre>
      </li>
      <li class="calibre12">Create Power BI report visualization to analyze the measure. The result of doing this is shown in <em class="italic">Figure 6.5</em>.<figure class="mediaobject"><img src="images/000207.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 6.5: 22 days in 2013 in which the Northwest region did not generate any bike sales</p>
    <h2 id="calibre_link-1678" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">In this example, a new<a id="calibre_link-32" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> measure must count the days in which the Northwest sales region did not have any online sales for the <code class="code-in-text--packt">Bikes</code> product category. Any existing filters on the <code class="code-in-text--packt">Product</code> and <code class="code-in-text--packt">Sales Territory</code> tables are removed via <code class="code-in-text--packt">CROSSJOIN</code> of the <code class="code-in-text--packt">ALL</code> clauses. The <code class="code-in-text--packt">Internet Sales</code> fact table is then filtered for the <code class="code-in-text--packt">Northwest</code> region and the <code class="code-in-text--packt">Bikes</code> category, and <code class="code-in-text--packt">ISEMPTY</code> is applied for each date in the filter context. Only the dates with no rows are returned by <code class="code-in-text--packt">FILTER</code> to be counted.</p>
    <p class="book-title--packt">The use of <code class="code-in-text--packt">CROSSJOIN</code> is necessary to remove filters on columns from separate tables of the model. A single <code class="code-in-text--packt">ALL</code> function can be used to remove one or more columns from the filter context of a single table, such as <code class="code-in-text--packt">ALL('Product'[Product Color],'Product'[Product Class])</code>.</p>
    <h2 id="calibre_link-1679" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Prior period date intelligence measures<a id="calibre_link-851" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> can become quite complex. For example, consider the scenario where for a Prior Year-to-Date measure at the monthly grain, the business requirements are to filter the prior year by only the completed periods of the current year (only compare completed against completed). The goal is to calculate the Prior Year-to-Date value (completed periods only) automatically without any date columns in the report, and return a blank if the current period, which is incomplete, is selected in report visuals. To implement this measure, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <code class="code-in-text--packt">Calculations</code> table, create the following measures:
        <pre class="programlisting"><code class="hljs">Today = DATE(2013,6,28)
Current Year = LOOKUPVALUE('Dates'[Year],'Dates'[Date],[Today])
Current Period = LOOKUPVALUE('Dates'[Year Month Number],'Dates'[Date], [Today])
Last Complete Period = [Current Period] - 1
Last Complete Month = LOOKUPVALUE('Dates'[Month Number],'Dates'[Year Month Number],[Last Complete Period])
Internet Sales = SUM('FactInternetSales'[SalesAmount])
</code></pre>
      </li>
      <li class="calibre12">Hide the <code class="code-in-text--packt">Calculations</code> column in the <code class="code-in-text--packt">Calculations</code> table from the <code class="code-in-text--packt">Report View</code></li>
      <li class="calibre12">Create <a id="calibre_link-1680" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a measure in the <code class="code-in-text--packt">Calculations</code> table with multiple pairs of conditions and results to account for the filter contexts and requirements:
        <pre class="programlisting"><code class="hljs">Sales (PYTD-Custom) = 
SWITCH(TRUE(),
    NOT(ISCROSSFILTERED('Dates')),
        CALCULATE([Internet Sales],
            FILTER(ALL('Dates'),
                'Dates'[Year] = [Current Year]-1 &amp;&amp; 
                'Dates'[Month Number] &lt;= [Last Complete Month])),
    HASONEVALUE('Dates'[Year Month Number]) &amp;&amp; 
        MAX('Dates'[Year Month Number]) &gt; [Last Complete Period],BLANK(),
    HASONEVALUE('Dates'[Year Month Number]) &amp;&amp; 
        MAX('Dates'[Year Month Number]) &lt;= [Last Complete Period],
        CALCULATE([Internet Sales],
            FILTER(ALL('Dates'),'Dates'[Year] = MAX('Dates'[Year])-1 &amp;&amp; 
            'Dates'[Year Month Number] &lt;= MAX('Dates'[Year Month Number])-12)),
    MAX('Dates'[Year]) = [Current Year],
        CALCULATE([Internet Sales],
        FILTER(ALL('Dates'),'Dates'[Year] = [Current Year]-1 &amp;&amp; 
        'Dates'[Month Number] &lt;= [Last Complete Month])),
    CALCULATE([Internet Sales],
        FILTER(ALL('Dates'),
        'Dates'[Year] = MAX('Dates'[Year])-1 &amp;&amp; 
        'Dates'[Year Month Number] &lt;= MAX('Dates'[Year Month Number])-12)))
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">Since we are dealing with historical information in the Adventure Works database, the <code class="code-in-text--packt">Today</code> measure is set to a specific date. In a production scenario, the <code class="code-in-text--packt">Today</code> measure would be something like <code class="code-in-text--packt">Today = TODAY()</code> or, if you are filtering your date table in your query to only be through the current day, <code class="code-in-text--packt">Today = MAX('Dates'[Date])</code>. The rest of the measures are derived from the <code class="code-in-text--packt">Today</code> measure and use simple <code class="code-in-text--packt">LOOKUPVALUE</code> expressions.</p>
    <p class="book-title--packt">By passing <code class="code-in-text--packt">TRUE</code> as the expression parameter to <code class="code-in-text--packt">SWITCH</code>, the first <code class="code-in-text--packt">&lt;value&gt;</code> condition (such as no filters applied) that evaluates to <code class="code-in-text--packt">True</code> will result in the corresponding result expression.</p>
    <p class="book-title--packt">The first <a id="calibre_link-852" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>condition <code class="code-in-text--packt">NOT(ISCROSSFILTERED)</code> handles whether any date filter has been applied from any date column. The second condition tests for individual periods that are not yet complete, and returns a <code class="code-in-text--packt">BLANK</code>. The third condition accounts for individual periods prior to or equal to the last complete period. The fourth condition is specific to the subtotal of the current year (<code class="code-in-text--packt">= [Current Year]</code>); this rule excludes the incomplete period. All other filter contexts are accounted for in the final expression&mdash;a standard Prior Year-to-Date calculation at the period grain.</p>
    <figure class="mediaobject"><img src="images/000169.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 6.6: Custom PYTD measure computes the correct value without any filter (card visual) and across date hierarchy levels</p>
    <p class="book-title--packt">Note that a blank (no value) is returned for the current period (<code class="code-in-text--packt">2013-Jun</code>) as per the requirements.</p>
    <p class="book-title--packt">Remember that the data models created in Power BI can be consumed in self-service scenarios, such as with Excel pivot tables, and business users will want or expect the new measures to "just work" across filter conditions. However, in the rapid, agile delivery of Power BI, only the most important or core filter contexts can be implemented in the first iterations.</p>
    <h2 id="calibre_link-1681" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><code class="code-in-text--packt">DAX LOOKUPVALUE</code> <a id="calibre_link-353" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>function: <a href="https://bit.ly/3gdjZKl%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3gdjZKl</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">DAX CROSSJOIN </code><code class="code-in-text--packt"><a id="calibre_link-339" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></code>function: <a href="https://bit.ly/2Ryr3qx" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2Ryr3qx</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">DAX HASONEVALUE</code> <a id="calibre_link-351" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>function: <a href="https://bit.ly/3wXSEBE" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3wXSEBE</span></a></li>
    </ul>
    <h1 id="calibre_link-1241" class="title">Simplifying Date Intelligence with DAX and Calculated Tables</h1>
    <p class="book-title--packt">In addition to the <a id="calibre_link-315" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>M query transformations<a id="calibre_link-313" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> described earlier in this <a id="calibre_link-114" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>chapter, DAX table functions can also be used in Power BI Import mode models to enhance and simplify date intelligence. DAX queries can access existing tables in the data model, and the tables evaluated during refresh can be used in relationships and measure calculations like all other tables. Similar to calculated columns, calculated tables should be rarely used&mdash;given the transformation capabilities of M, SQL, and ETL tools&mdash;but can be valuable supplements to models for small tables, such as role-playing date dimensions and bridge tables.</p>
    <p class="book-title--packt">This recipe provides an example of using DAX calculated tables to support role-playing date dimensions. Additionally, a single row table is created via DAX to simplify common date intelligence measures.</p>
    <h2 id="calibre_link-1682" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <code class="code-in-text--packt">Data Sources</code> and disable loading.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <code class="code-in-text--packt">Reference</code>.</li>
      <li class="calibre12">Select the <code class="code-in-text--packt">FactInternetSales</code> table and name this query <code class="code-in-text--packt">Internet Sales</code>.</li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">5</em> and <em class="italic">6</em> for the <code class="code-in-text--packt">DimDate</code> table and name this query <code class="code-in-text--packt">Order Dates</code>.</li>
      <li class="calibre12">Separate the fact query, <code class="code-in-text--packt">Internet Sales</code>, into a <code class="code-in-text--packt">Facts query</code> group.</li>
      <li class="calibre12">Separate the dimension query, <code class="code-in-text--packt">Order</code> <code class="code-in-text--packt">Dates</code>, into a <code class="code-in-text--packt">Dimensions</code> query group.</li>
      <li class="calibre12">Create a <code class="code-in-text--packt">Blank</code> <code class="code-in-text--packt">Query</code> called <code class="code-in-text--packt">Calculations</code> in the <code class="code-in-text--packt">Other Queries</code> group.</li>
      <li class="calibre12">Choose <code class="code-in-text--packt">Close &amp; Apply</code> in the ribbon of the <code class="code-in-text--packt">Home</code> tab to load the tables to the data model.</li>
      <li class="calibre12">Create a relationship using the <code class="code-in-text--packt">FullDateAlternateKey</code> column from the <code class="code-in-text--packt">Order Dates</code> table and <a id="calibre_link-115" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <code class="code-in-text--packt">OrderDate</code> column of the Internet Sales table.</li>
    </ol>
    <h2 id="calibre_link-1683" class="calibre8">How to Simplify Date Intelligence</h2>
    <p class="book-title--packt">To <a id="calibre_link-316" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">From <code class="code-in-text--packt">Report View</code>, click<a id="calibre_link-314" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> on <code class="code-in-text--packt">New Table</code> in the ribbon of the <code class="code-in-text--packt">Modeling</code> tab</li>
      <li class="calibre12">In the formula bar, assign a name to the date dimension table, such as <code class="code-in-text--packt">Shipment Dates</code>, and use the <code class="code-in-text--packt">SELECTCOLUMNS</code> function to retrieve date columns from the existing date dimension table:
        <pre class="programlisting"><code class="hljs">Shipment Dates = 
    SELECTCOLUMNS('OrderDates', 
        "Shipment Date", 'OrderDates'[FullDateAlternateKey], 
        "Shipment Year", 'OrderDates'[CalendarYear], 
        "Shipment Month", 'OrderDates'[EnglishMonthName], 
        "Last Refreshed", NOW()
    )
</code></pre>
      </li>
      <li class="calibre12">As per the example, apply column aliases (<code class="code-in-text--packt">Shipment...</code>) to avoid confusion with other date tables in the model</li>
      <li class="calibre12">Create a relationship between the <code class="code-in-text--packt">Shipment Date</code> column in the <code class="code-in-text--packt">Shipment Dates</code> table and the <code class="code-in-text--packt">ShipDate</code> table in the <code class="code-in-text--packt">Internet Sales</code> table</li>
      <li class="calibre12">Rename the <code class="code-in-text--packt">FullDateAlternateKey</code> column in the <code class="code-in-text--packt">Order Dates</code> table to <code class="code-in-text--packt">Order Date</code></li>
    </ol>
    <h2 id="calibre_link-1684" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">The model now has two<a id="calibre_link-1685" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> date dimension tables with active relationships to the fact table, order date, and shipment date in this example. Generally, when<a id="calibre_link-1686" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> role-playing date dimensions<a id="calibre_link-1687" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are used, aliases are applied to all tables and columns, thus requiring the date table and its columns to be renamed as <code class="code-in-text--packt">Order Dates</code>. However, if the new role-playing date tables will be rarely used, then aliases may only be necessary for these new role-playing date tables.</p>
    <h2 id="calibre_link-1688" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">One option to further simplify date intelligence measures<a id="calibre_link-322" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is to embed a calculated table in a model that generates values frequently used as filter conditions:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a <code class="code-in-text--packt">Today</code> measure in the <code class="code-in-text--packt">Calculations</code> table:
        <pre class="programlisting"><code class="hljs">Today = DATE(2013,6,28)
</code></pre>
      </li>
      <li class="calibre12">Hide the <code class="code-in-text--packt">Calculations</code> column in <code class="code-in-text--packt">Report View</code> and note that the <code class="code-in-text--packt">Calculations</code> table's icon changes from a table to a calculator. This measure table will remain above other non-measure-only tables in the <code class="code-in-text--packt">Fields</code> list.</li>
      <li class="calibre12">While in <code class="code-in-text--packt">Report View</code>, select <code class="code-in-text--packt">New Table</code> from the ribbon of the <code class="code-in-text--packt">Modeling</code> tab and enter the following DAX query:
        <pre class="programlisting"><code class="hljs">Date Parameters = 
    VAR __Today = [Today] 
    VAR __CurrentFiscalYear = 
        LOOKUPVALUE('OrderDates'[FiscalYear], 'OrderDates'[Order Date],__Today)
    VAR __CurrentFiscalQuarter = 
        LOOKUPVALUE('OrderDates'[FiscalQuarter], 
            'OrderDates'[Order Date],__Today)
RETURN
    ROW(
        "Last Refreshed", NOW(),
        "Today", __Today,
        "30 Days Prior", __Today - 30,
        "90 Days Prior",__Today - 90,
        "Current Fiscal Year", __CurrentFiscalYear, 
        "Prior Fiscal Year", __CurrentFiscalYear-1,
        "Current Fiscal Quarter", __CurrentFiscalQuarter
    )
</code></pre>
      </li>
      <li class="calibre12">Hide the parameters table from the <code class="code-in-text--packt">Report</code> view.<figure class="mediaobject"><img src="images/000219.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 6.7: Sample of the single row table (Date Parameters) created via the DAX calculated table query</p>
      </li>
      <li class="calibre12">Create date<a id="calibre_link-323" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> intelligence measures that leverage the values stored in the calculated table:
        <pre class="programlisting"><code class="hljs">Internet Sales = SUM('Internet Sales'[SalesAmount])
Last 90 Days Sales = 
    CALCULATE([Internet Sales],
        'OrderDates'[Order Date] &gt;= DISTINCT('Date Parameters'[90 Days Prior])
        &amp;&amp; 
        'OrderDates'[Order Date] &lt;= DISTINCT('Date Parameters'[Today]))
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">Since we are dealing with historical information in the Adventure Works database, the <code class="code-in-text--packt">Today</code> measure is set to a specific date. In a production scenario, the <code class="code-in-text--packt">Today</code> measure would be something like <code class="code-in-text--packt">Today = TODAY()</code> or, if you are filtering your date table in your query to only be through the current day, <code class="code-in-text--packt">Today = MAX('Dates'[Date])</code>.</p>
    <p class="book-title--packt">An underscore or other leading character can be used in front of variable names to ensure that a variable's name does not conflict with reserved words, and also to distinguish variables and DAX added columns from actual columns and tables in the data model.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">DISTINCT</code> function retrieves the single value from the table for comparison with the corresponding date dimension column in the filter condition of <code class="code-in-text--packt">CALCULATE</code>. One may be tempted to use the <code class="code-in-text--packt">MAX</code> or <code class="code-in-text--packt">MIN</code> functions here in place of <code class="code-in-text--packt">DISTINCT</code>, but this will generate an error that the <code class="code-in-text--packt">MAX</code> or <code class="code-in-text--packt">MIN</code> function has been used in a True/False expression that is used as a table filter expression.</p>
    <h2 id="calibre_link-1689" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><code class="code-in-text--packt">DAX SELECTCOLUMNS</code> <a id="calibre_link-364" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>function: <a href="https://bit.ly/2OSw4JA" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2OSw4JA</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">DAX LOOKUPVALUE</code> <a id="calibre_link-354" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>function: <a href="https://bit.ly/3gdjZKl" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3gdjZKl</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">DAX ROW</code> <a id="calibre_link-363" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>function: <a href="https://bit.ly/3dobQ3R" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3dobQ3R</span></a></li>
    </ul>
    <h1 id="calibre_link-1242" class="title">Leveraging Calculation Groups</h1>
    <p class="book-title--packt">When working with date<a id="calibre_link-117" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> intelligence, it is common to have many quasi-redundant measures that calculate various different metrics for YTD, MTD, PY, PYTD, PMTD, and other common date intelligence intervals. For example, business users may be interested in a year-to-date, year-over-year, and year-over-year percentage calculation for the gross sales, net sales, and other measures. Normally, this would require nine DAX measures to calculate these measures at each of those date intelligence intervals.</p>
    <p class="book-title--packt">Calculation groups can greatly assist in reducing the number of measures required by allowing a DAX expression to be reused for any measure. In the example given, this means that three DAX expressions could serve the needs of the nine DAX expressions required without the use of calculation groups.</p>
    <p class="book-title--packt">This recipe demonstrates the use of calculation groups in the context of date intelligence in order to eliminate redundant DAX expressions.</p>
    <h2 id="calibre_link-1690" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open Power BI Desktop.</li>
      <li class="calibre12">Create an Import mode data source query called <code class="code-in-text--packt">AdWorksDW</code>. This query should be similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Isolate this query in a query group called <code class="code-in-text--packt">Data Sources</code> and disable loading.</li>
      <li class="calibre12">Right-click <code class="code-in-text--packt">AdWorksDW</code> and choose <code class="code-in-text--packt">Reference</code>.</li>
      <li class="calibre12">Select the <code class="code-in-text--packt">FactInternetSales</code> table and name this query <code class="code-in-text--packt">Internet Sales</code>.</li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">4</em> and <em class="italic">5</em> for the <code class="code-in-text--packt">DimDate</code> table and name this query <code class="code-in-text--packt">Order Dates</code>.</li>
      <li class="calibre12">Separate the fact query, <code class="code-in-text--packt">Internet Sales</code>, into a <code class="code-in-text--packt">Facts</code> query group.</li>
      <li class="calibre12">Separate the dimension query, <code class="code-in-text--packt">Order</code> <code class="code-in-text--packt">Dates</code>, into a <code class="code-in-text--packt">Dimensions</code> query group.</li>
      <li class="calibre12">Create a <code class="code-in-text--packt">Blank</code> <code class="code-in-text--packt">Query</code> called <code class="code-in-text--packt">Calculations</code> in the <code class="code-in-text--packt">Other Queries</code> group.</li>
      <li class="calibre12">Select <code class="code-in-text--packt">Close &amp; Apply</code> in the ribbon of the <code class="code-in-text--packt">Home</code> tab to load the tables to the data model.</li>
      <li class="calibre12">Create a relationship using the <code class="code-in-text--packt">FullDateAlternateKey</code> column from the <code class="code-in-text--packt">Order Dates</code> table and the <code class="code-in-text--packt">OrderDate</code> column of the Internet Sales table.</li>
      <li class="calibre12">Rename the <code class="code-in-text--packt">FullDateAlternateKey</code> column to <code class="code-in-text--packt">Date</code>.</li>
      <li class="calibre12">Mark the <code class="code-in-text--packt">Order Dates</code> table as a date table using <code class="code-in-text--packt">Date</code> as the <code class="code-in-text--packt">Date</code> column.</li>
      <li class="calibre12">In the <code class="code-in-text--packt">Calculations</code> table, create some simple measures:
        <pre class="programlisting"><code class="hljs">Internet Sales = SUM('Internet Sales'[SalesAmount])
Orders = COUNTROWS('Internet Sales')
</code></pre>
      </li>
      <li class="calibre12">Hide the <code class="code-in-text--packt">Calculations</code> column<a id="calibre_link-118" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in the <code class="code-in-text--packt">Calculations</code> table.</li>
      <li class="calibre12">Set the <code class="code-in-text--packt">Sort by</code> column for the <code class="code-in-text--packt">EnglishMonthName</code> column to the <code class="code-in-text--packt">MonthNumberOfYear</code> column.</li>
    </ol>
    <h2 id="calibre_link-1691" class="calibre8">How to Leverage Calculation Groups</h2>
    <p class="book-title--packt">To implement this recipe, carry out the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Select <code class="code-in-text--packt">Tabular Editor</code> from the ribbon of the <code class="code-in-text--packt">External Tools</code> tab</li>
      <li class="calibre12">In <code class="code-in-text--packt">Tabular Editor</code>, select <code class="code-in-text--packt">Model</code> and then <code class="code-in-text--packt">New Calculation Group</code></li>
      <li class="calibre12">Name the new calculation group <code class="code-in-text--packt">Date Intelligence Group</code></li>
      <li class="calibre12">Expand <code class="code-in-text--packt">Date Intelligence Group</code>, right-click <code class="code-in-text--packt">Calculation Items</code>, and choose <code class="code-in-text--packt">New Calculation</code> <code class="code-in-text--packt">Item</code></li>
      <li class="calibre12">Create a <code class="code-in-text--packt">Current</code> calculation item with the formula <code class="code-in-text--packt">SELECTEDMEASURE()</code>
        <figure class="mediaobject"><img src="images/000230.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 6.8: Creation of the Current calculation item</p>
      </li>
      <li class="calibre12">Repeat <em class="italic">steps</em> <em class="italic">4</em> and <em class="italic">5</em> to <a id="calibre_link-119" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>create the following calculation items:<p class="packt_figref">For YTD:</p>
        <pre class="programlisting"><code class="hljs">CALCULATE(SELECTEDMEASURE(),
    FILTER(ALL('Order Dates'),
         'Order Dates'[CalendarYear] = MAX('Order Dates'[CalendarYear]) &amp;&amp;
        'Order Dates'[Date] &lt;= MAX('Order Dates'[Date])))
For MTD:
CALCULATE(SELECTEDMEASURE(),
    FILTER(ALL('Order Dates'),
        'Order Dates'[CalendarYear] = MAX('Order Dates'[CalendarYear]) &amp;&amp;
        'Order Dates'[MonthNumberOfYear] = MAX('Order Dates'[MonthNumberOfYear])
 &amp;&amp; 'Order Dates'[Date] &lt;= MAX('Order Dates'[Date])))
For QTD:
CALCULATE(SELECTEDMEASURE(),
    FILTER(ALL('Order Dates'),
        'Order Dates'[CalendarYear] = MAX('Order Dates'[CalendarYear]) &amp;&amp;
        'Order Dates'[CalendarQuarter] = MAX('Order Dates'[CalendarQuarter]) &amp;&amp;
        'Order Dates'[Date] &lt;= MAX('Order Dates'[Date])))
For PY:
VAR __MaxDate = MAX('Order Dates'[Date])
VAR __MinDate = MIN('Order Dates'[Date])
RETURN
    CALCULATE(SELECTEDMEASURE(),
        FILTER(ALL('Order Dates'),
            'Order Dates'[Date] &gt;= 
                DATE(YEAR(__MinDate)-1,MONTH(__MinDate),DAY(__MinDate)) &amp;&amp;
            'Order Dates'[Date] &lt;= 
                DATE(YEAR(__MaxDate)-1,MONTH(__MaxDate),DAY(__MaxDate))))
For PY YTD:
VAR __MaxDate = MAX('Order Dates'[Date])
RETURN
    CALCULATE(SELECTEDMEASURE(),
        FILTER(ALL('Order Dates'),
            'Order Dates'[CalendarYear] = 
                MAX('Order Dates'[CalendarYear])-1 &amp;&amp;
            'Order Dates'[Date] &lt;= 
                DATE(
                    YEAR(__MaxDate)-1,  
                    MONTH(__MaxDate),
                    DAY(__MaxDate))))
For YOY:
SELECTEDMEASURE() 
    - CALCULATE(SELECTEDMEASURE(),'Date Intelligence Group'[Name] = "PY")
For YOY %:
DIVIDE(
    CALCULATE(SELECTEDMEASURE(),'Date Intelligence Group'[Name] ="YOY"),
    CALCULATE(SELECTEDMEASURE(),'Date Intelligence Group'[Name] ="PY"))
</code></pre>
      </li>
      <li class="calibre12">For the <code class="code-in-text--packt">YOY %</code> calculation <a id="calibre_link-120" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>item, set the <code class="code-in-text--packt">Format String Expression</code> to <code class="code-in-text--packt">0.00%; -0.00%;0.00%</code></li>
      <li class="calibre12">In <code class="code-in-text--packt">Tabular Editor</code>, select <code class="code-in-text--packt">File</code> and then <code class="code-in-text--packt">Save</code></li>
      <li class="calibre12">In Power BI Desktop, click <code class="code-in-text--packt">Refresh now</code> in the warning box regarding refreshing calculation groups<figure class="mediaobject"><img src="images/000242.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 6.9: Manually refreshing calculation groups</p>
      </li>
      <li class="calibre12">Create a <code class="code-in-text--packt">Matrix</code> visualization with the <code class="code-in-text--packt">CalendarYear</code> and <code class="code-in-text--packt">EnglishMonthName</code> columns from the <code class="code-in-text--packt">Order Dates</code> table as <code class="code-in-text--packt">Rows</code>, the <code class="code-in-text--packt">Internet Sales</code> measure as <code class="code-in-text--packt">Values</code>, and the <code class="code-in-text--packt">Name</code> column from the <code class="code-in-text--packt">Date Intelligence Group</code> as <code class="code-in-text--packt">Columns</code></li>
      <li class="calibre12">Add the <code class="code-in-text--packt">Orders</code> measure to the <code class="code-in-text--packt">Matrix</code> visualization as <code class="code-in-text--packt">Values</code></li>
    </ol>
    <h2 id="calibre_link-1692" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">Currently, Power BI Desktop does not provide a method for creating and editing calculation groups, so this must be done in Visual Studio or Tabular Editor.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">SELECTEDMEASURE</code> function takes the current measure in context and replaces the values returned by the measure with the calculations from the calculation group. The format of the value returned (Currency, Whole Number, Decimal) corresponds with the format of the selected measure, unless overridden by a specified <code class="code-in-text--packt">Format String Expression</code>. For numeric values, the <code class="code-in-text--packt">Format String Expression</code> should always include three format specifications separated by semi-colons for positive, negative, and zero values.</p>
    <p class="book-title--packt">The order of the <a id="calibre_link-121" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>calculation items returned will be alphabetical when the <code class="code-in-text--packt">Ordinal</code> property is set to <code class="code-in-text--packt">-1</code> for all calculation items. This order can be overridden by specifying <code class="code-in-text--packt">Ordinal</code> numbers from <code class="code-in-text--packt">0</code> and higher. Lower <code class="code-in-text--packt">Ordinal</code> numbers display first.</p>
    <h2 id="calibre_link-1693" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">The same results can be achieved using DAX time intelligence functions with the caveat that DAX time intelligence functions assume a standard (Gregorian) calendar, and thus should be avoided when dealing with fiscal calendars and more complex scenarios. To see how this works, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In <code class="code-in-text--packt">Tabular Editor</code>, select <code class="code-in-text--packt">Model</code> and then <code class="code-in-text--packt">New Calculation Group</code></li>
      <li class="calibre12">Name the new calculation group <code class="code-in-text--packt">Time Intelligence Group</code></li>
      <li class="calibre12">Create the following calculation items:<ul class="calibre11">
          <li class="calibre12"><strong class="screentext">Current</strong>: <code class="code-in-text--packt">SELECTEDMEASURE()</code></li>
          <li class="calibre12"><strong class="screentext">YTD</strong>: <code class="code-in-text--packt">CALCULATE(SELECTEDMEASURE(), DATESYTD('Order Dates'[Date]))</code></li>
          <li class="calibre12"><strong class="screentext">MTD</strong>: <code class="code-in-text--packt">CALCULATE(SELECTEDMEASURE(), DATESMTD('Order Dates'[Date]))</code></li>
          <li class="calibre12"><strong class="screentext">QTD</strong>: <code class="code-in-text--packt">CALCULATE(SELECTEDMEASURE(), DATESQTD('Order Dates'[Date]))</code></li>
          <li class="calibre12"><strong class="screentext">PY</strong>: <code class="code-in-text--packt">CALCULATE(SELECTEDMEASURE(), SAMEPERIODLASTYEAR('Order Dates'[Date]))</code></li>
          <li class="calibre12"><strong class="screentext">PY YTD</strong>: <code class="code-in-text--packt">CALCULATE(SELECTEDMEASURE(),SAMEPERIODLASTYEAR('Order Dates'[Date]),'Time Intelligence Group'[Name]= "YTD")</code></li>
          <li class="calibre12"><strong class="screentext">YOY</strong>: <code class="code-in-text--packt">SELECTEDMEASURE()-CALCULATE(SELECTEDMEASURE(),'Time Intelligence Group'[Name] = "PY")</code></li>
          <li class="calibre12"><strong class="screentext">YOY %</strong>: <code class="code-in-text--packt">DIVIDE(CALCULATE(SELECTEDMEASURE(),'Time Intelligence Group'[Name] ="YOY"),CALCULATE(SELECTEDMEASURE(),'Time Intelligence Group'[Name] ="PY"))</code></li>
        </ul>
      </li>
      <li class="calibre12">Duplicate <code class="code-in-text--packt">Page 1</code></li>
      <li class="calibre12">Select the matrix visualization on <code class="code-in-text--packt">Duplicate of Page 1</code> and replace the columns with the <code class="code-in-text--packt">Name</code> column from the <code class="code-in-text--packt">Time Intelligence Group</code></li>
    </ol>
    <p class="book-title--packt">The numbers in both matrices are identical.</p>
    <h2 id="calibre_link-1694" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Calculation groups in <a id="calibre_link-122" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Analysis Services tabular models: <a href="https://bit.ly/3tlJRYd" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3tlJRYd</span></a></li>
      <li class="bullet"><code class="code-in-text--packt">DAX SELECTEDMEASURE</code> <a id="calibre_link-365" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>function: <a href="https://bit.ly/3sv5XWN" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3sv5XWN</span></a></li>
    </ul>
    <h1 id="calibre_link-1243" class="title">Conclusion</h1>
    <p class="book-title--packt">This chapter provided recipes for preparing a data model to support robust date intelligence and for authoring custom date intelligence measures. Date intelligence provides a broad set of data modeling patterns and functions that enable analysis across time periods. The measures created for date intelligence can be used in combination with one another to support growth and variance measures and are often utilized as KPIs in Power BI dashboards. When properly implemented, date intelligence dramatically expands the analytical power of a data model and simplifies report and dashboard development.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-7">
<div id="calibre_link-1695" class="calibre2">
<div id="calibre_link-1696" class="calibre3"><div id="calibre_link-1697" class="calibre4">
    <h1 class="heading">7</h1>
    <h1 id="calibre_link-1244" class="title">Parameterizing Power BI Solutions</h1>
    <p class="book-title--packt">With the foundation of a Power BI deployment in place, components of the data retrieval and report design processes&mdash;as well as the user experience&mdash;can be parameterized to deliver greater flexibility for both technology services and users. For example, query parameters can isolate and restrict data sources to support changing source systems, templates can enable parameterized report development against pre-defined metadata, and M and DAX functions can deliver custom integration and analytical capabilities.</p>
    <p class="book-title--packt">The recipes in this chapter cover both standard parameterization features and techniques in Power BI, as well as more advanced custom implementations. Examples of parameterizing data sources, queries, user-defined functions, and reports further express the power of the M language and its integration with other Power BI Desktop features. Additional examples, such as URL-based parameter filters, a dedicated forecasting or what-if? tool, and user selection parameter tables, utilize both the transformation and analytical features of Power BI to empower users with greater control over the analysis and visualization of Power BI data models.</p>
    <p class="book-title--packt">In this chapter, we will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Filtering reports dynamically</li>
      <li class="bullet">Leveraging query parameters</li>
      <li class="bullet">Working with templates</li>
      <li class="bullet">Converting static queries to dynamic functions</li>
      <li class="bullet">Capturing user selections with parameter tables</li>
      <li class="bullet">Forecasting with what-if analysis</li>
    </ul>
    <h1 id="calibre_link-1245" class="title">Technical requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop</li>
      <li class="bullet">SQL Server with the <code class="code-in-text--packt">AdventureWorksDW2019</code> database installed. This database and the instructions for installing it are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a></li>
      <li class="bullet">Files for this chapter can be downloaded from the following GitHub repository: <a href="https://github.com/gdeckler/PowerBICookbook2ndEdition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/gdeckler/PowerBICookbook2ndEdition</span></a></li>
    </ul>
    <h1 id="calibre_link-1246" class="title">Filtering reports dynamically</h1>
    <p class="book-title--packt">In addition to<a id="calibre_link-963" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the report filter options in Power BI Desktop covered in <em class="italic">Chapter 4</em>, <em class="italic">Authoring Power BI Reports</em>, filters can also be applied to published Power BI reports via the URL string. Rather than multiple, dedicated reports and report pages with distinct filter conditions, URL links with unique query strings can leverage a single published report in the Power BI service. Additionally, URL links can be embedded within a dataset such that a published report can expose links to other reports with a pre-defined filter condition.</p>
    <p class="book-title--packt">In this recipe, two URL strings are created to demonstrate single and multiple filter parameter syntax. The second example creates a URL string for each row of the <code class="code-in-text--packt">Product</code> dimension table via an M query and exposes this dynamic link in a report visual.</p>
    <h2 id="calibre_link-1698" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12">Download <code class="code-in-text--packt">CH7_R1.pbix</code> from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a></li>
      <li class="calibre12">Open <code class="code-in-text--packt">CH7_R1.pbix</code> in Power BI Desktop.</li>
      <li class="calibre12">Edit the <code class="code-in-text--packt">AdWorksDW</code> query and change the <code class="code-in-text--packt">Source</code> line to point to your SQL server with the <code class="code-in-text--packt">AdventureWorksDW2019</code> database installed.</li>
      <li class="calibre12">Publish the report to the Power BI service.</li>
    </ol>
    <h2 id="calibre_link-1699" class="calibre8">How to filter reports dynamically</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the report in the Power BI service.</li>
      <li class="calibre12">Replace the query string in the URL with the following and press <span>Enter</span>:
        <pre class="programlisting"><code class="hljs">?filter=Products/ProductCategory eq 'Bikes'
</code></pre>
      </li>
      <li class="calibre12">To apply multiple URL filter parameters, separate the column filters with an <code class="code-in-text--packt">and</code> operator, as in the following example:
        <pre class="programlisting"><code class="hljs">?filter=Products/ProductCategory eq 'Bikes' and Dates/CalendarYear eq 2013
</code></pre>
      </li>
      <li class="calibre12">Copy the report URL, without including the query string (the portion after and including the <code class="code-in-text--packt">?)</code>.</li>
      <li class="calibre12">Open <code class="code-in-text--packt">CH7_R1.pbix</code> in Power BI Desktop</li>
      <li class="calibre12">Edit <a id="calibre_link-964" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Products</strong> query in Power Query Editor.</li>
      <li class="calibre12">Add a column called <strong class="screentext">Product</strong> <strong class="screentext">URL</strong> to the <strong class="screentext">Products</strong> table by using <strong class="screentext">Custom Column</strong> in the ribbon of the <strong class="screentext">Add Column</strong> tab, with a format similar to the following:
        <pre class="programlisting"><code class="hljs">"https://app.powerbi.com/groups/[...]/reports/[...]/[...]?filter=Products/ProductName eq '" &amp; [ProductName] &amp; "'"
</code></pre>
        <div class="pcalibre4 pcalibre5 note">
          <p class="book-title--packt">Note that <strong class="screentext">[â¦]</strong> will be replaced with your unique IDs.</p>
        </div>
      </li>
      <li class="calibre12">Close and apply the query changes to apply them to the model.</li>
      <li class="calibre12">Change the <strong class="screentext">Data category</strong> for the <strong class="screentext">Product</strong> <strong class="screentext">URL</strong> column in the <strong class="screentext">Products</strong> table to <strong class="screentext">Web URL</strong>.</li>
      <li class="calibre12">Add a second page to the report.</li>
      <li class="calibre12">Create a <strong class="screentext">Table</strong> visualization with the <strong class="screentext">ProductName</strong> column from the <strong class="screentext">Products</strong> table, the <strong class="screentext">Total Net Sales</strong> measure from the <strong class="screentext">Calculations</strong> table, and the <strong class="screentext">Product</strong> <strong class="screentext">URL</strong> column from the <strong class="screentext">Products</strong> table.</li>
      <li class="calibre12">With the <strong class="screentext">Table</strong> visualization selected, use the <strong class="screentext">Format</strong> pane, expand the <strong class="screentext">Values</strong> section, and toggle the <strong class="screentext">URL icon</strong> to <strong class="screentext">On</strong>.</li>
      <li class="calibre12">Save and publish the report.</li>
      <li class="calibre12">Open the report in the Power BI service, navigate to <strong class="screentext">Page 2</strong>, and click on one of the URL icons for a product.</li>
    </ol>
    <h2 id="calibre_link-1700" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">URL filters can be applied to any column in the data model that is of a text or numeric data type. The column does not have to be visible in the <code class="code-in-text--packt">Fields</code> list or used in one of the <code class="code-in-text--packt">Filtering</code> field wells in the <code class="code-in-text--packt">Report</code> view to be used in a URL filter.</p>
    <p class="book-title--packt">The syntax is <code class="code-in-text--packt">&lt;Report URL&gt;?filter=Table/Column eq 'value'</code>. The table and field names (without spaces) are case sensitive, and the <code class="code-in-text--packt">'value'</code> must be enclosed in single quotes for text values. Do not use single quotes for numeric values, however.</p>
    <p class="book-title--packt">Table and column names used in URL filters must not contain spaces. In the event that you want to have a friendly name for report users for columns, you can duplicate a friendly name column, remove the spaces from the duplicate column name, and then hide the duplicate column name from the report view. In this way, you can have a column for use in reports and a duplicate column that can be used as URL filters. When using duplicate columns, given the additional resources required of the new column(s), try to limit the columns to those with few distinct values. Additionally, a single hidden column with no<a id="calibre_link-965" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> spaces can be created based on the concatenation of multiple columns to simplify the URL strings.</p>
    <h2 id="calibre_link-1701" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">A report visual from a custom URL with a query string can be pinned to a dashboard, and the dashboard tile will reflect the filter condition following refreshes. However, by default, selecting the pinned dashboard tile will navigate to the unfiltered source report. The custom URL can be associated with a dashboard tile to control the dashboard navigation, as demonstrated in <em class="italic">Figure 7.1</em>:</p>
    <figure class="mediaobject"><img src="images/000254.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 7.1: Custom URL link for a Power BI dashboard tile</p>
    <h2 id="calibre_link-1702" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Filter a<a id="calibre_link-978" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> report using query string parameters in the URL: <a href="https://bit.ly/3swEJPF%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3swEJPF</span></a></li>
      <li class="bullet">Guy in a Cube &ndash; Filter a report with a URL query string parameter: <a href="http://bit.ly/2s5hXSW%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2s5hXSW</span></a></li>
    </ul>
    <h1 id="calibre_link-1247" class="title">Leveraging query parameters</h1>
    <p class="book-title--packt">Parameters<a id="calibre_link-921" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are a primary component in building flexible, manageable query retrieval processes, as well as enabling simple filter selections. Hardcoded values in queries can be replaced with parameters, and a single parameter can be leveraged by multiple queries, thereby reducing development time and maintenance. Parameters are required to configure incremental data refresh policies on datasets and are commonly used to limit the volume of data loaded to a local instance of Power BI Desktop relative to the published Power BI dataset.</p>
    <p class="book-title--packt">Parameters can also be useful during development in order to filter fact tables or large dimension tables to only a subset of data. Very large Power BI files can become slow and difficult to work with and thus the dataset author can add a filter via a parameter so that only a subset of rows are loaded locally. The dataset author can then simply revise the parameter such that all rows are loaded. This can be done just prior to publishing or after publishing via APIs and scripts that revise the parameter values in the Power BI service.</p>
    <p class="book-title--packt">In this recipe, a parameter is used to filter a fact table query for a specified number of days relative to the current date. An additional, more advanced example is shared to apply parameters to a fact table query on both a dimension column as well as a date range.</p>
    <h2 id="calibre_link-1703" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable the load on the <code class="code-in-text--packt">AdWorksDW</code> query and place it in a <code class="code-in-text--packt">Data Sources</code> query group.</li>
    </ol>
    <h2 id="calibre_link-1704" class="calibre8">How to leverage query parameters</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a blank query called <code class="code-in-text--packt">CurrentDate</code> and disable the loading of the query by right-clicking the query and then deselecting <strong class="screentext">Enable load</strong>:
        <pre class="programlisting"><code class="hljs">let
    Source = #date(2014,1,28)
in
    Source
</code></pre>
      </li>
      <li class="calibre12">From the <strong class="screentext">Home</strong> tab of <strong class="screentext">Power Query Editor</strong>, click on the <strong class="screentext">Manage Parameters</strong> dropdown<a id="calibre_link-922" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and select <strong class="screentext">New Parameter</strong>:<figure class="mediaobject"><img src="images/000265.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 7.2: New parameter created for filtering fact table queries</p>
      </li>
      <li class="calibre12">Give the query the name <strong class="screentext">Days Prior to Current Date</strong>, a data type of <strong class="screentext">Decimal Number</strong>, and, for this example, enter a list of suggested values. Values outside this suggested list can also be applied to the parameter when necessary.</li>
      <li class="calibre12">Based on the <strong class="screentext">List of values</strong>, enter a <strong class="screentext">Default Value</strong> and <strong class="screentext">Current Value</strong>.</li>
      <li class="calibre12">Create a new blank query called <code class="code-in-text--packt">StartDate</code> that computes a date value based on the <strong class="screentext">CurrentDate</strong> query and the new parameter, and then disable the load:
        <pre class="programlisting"><code class="hljs">let 
    Source = Date.AddDays(CurrentDate,- #"Days Prior to Current Date")
in 
    Source
</code></pre>
        <p class="packt_figref">In this<a id="calibre_link-923" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> example, a date 365 days prior to the current date is returned based on the default parameter value.</p>
      </li>
      <li class="calibre12">Create an <strong class="screentext">Internet Sales</strong> query based on the following M code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_FactInternetSales = 
        Source{[Schema="dbo",Item="FactInternetSales"]}[Data],
    ChangeType = Table.TransformColumnTypes(
        dbo_FactInternetSales,{{"OrderDate", type date}}),
    RowFilter = Table.SelectRows(
        ChangeType, 
        each [OrderDate] &gt;= StartDate and [OrderDate] &lt;= CurrentDate)
in 
    SalesTerritoryJoin
</code></pre>
      </li>
      <li class="calibre12">Click on <strong class="screentext">Close &amp; Apply</strong> from the <strong class="screentext">Home</strong> tab of Query Editor.</li>
      <li class="calibre12">Optionally, build a report or query against the refreshed fact table to validate the filter.</li>
      <li class="calibre12">From the <strong class="screentext">Home</strong> tab of the <strong class="screentext">Report</strong> view, click on the <strong class="screentext">Transform data</strong> dropdown in the ribbon and select <strong class="screentext">Edit Parameters</strong>:<figure class="mediaobject"><img src="images/000276.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 7.3: Editing parameters from the Report view</p>
      </li>
      <li class="calibre12">Either select a suggested value from the drop-down menu or enter a number in the input box and click on <strong class="screentext">OK</strong>.</li>
      <li class="calibre12">Click on <strong class="screentext">Apply Changes</strong> from the warning dialog. <code class="code-in-text--packt">StartDate</code> and the fact table queries<a id="calibre_link-924" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> impacted by the parameter change will both be refreshed.</li>
    </ol>
    <h2 id="calibre_link-1705" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">In a production scenario, the <code class="code-in-text--packt">CurrentDate</code> query would not be hardcoded to a date and would be something similar to the following:</p>
    <pre class="programlisting"><code class="hljs">let
    Source = DateTime.Date(DateTime.LocalNow())
in
    Source
</code></pre>
    <p class="book-title--packt">The <code class="code-in-text--packt">StartDate</code> query uses the parameter to calculate a date prior to the <code class="code-in-text--packt">CurrentDate</code> by a number of days selected from the list of values. Parameters can be referenced within queries, just like referencing other queries or steps in a query, in which the same rules also apply. When parameters include spaces in their names, referencing the parameter must be preceded by a hashtag, #, and double quotes, and suffixed by double quotes <code class="code-in-text--packt">(#"Days Prior to Current Date"</code>). Parameters that do not include spaces in their names can be referenced directly without the prefix or suffix.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">Internet Sales</code> query uses the <code class="code-in-text--packt">Table.SelectRows</code> function in the <code class="code-in-text--packt">RowFilter</code> step to filter the <code class="code-in-text--packt">FactInternetSales</code> table using the <code class="code-in-text--packt">OrderDate</code> column to be greater than or equal to <code class="code-in-text--packt">StartDate</code> (a date value). It is important that the data type of the <code class="code-in-text--packt">OrderDate</code> column and the data type of the <code class="code-in-text--packt">StartDate</code> query match one another. For example, <code class="code-in-text--packt">Date</code> data types cannot be compared to <code class="code-in-text--packt">DateTime</code> data types.</p>
    <p class="book-title--packt">Currently, parameters cannot be created or edited in the Power BI service. The parameter values configured when published will be used for each refresh.</p>
    <p class="book-title--packt">When considering your own scenarios, identify candidates for query parameters, such as hardcoded date filters and dimension attributes with few distinct values (for example, department groups). Identify scenarios in which certain business users or teams require edit rights to a dataset (that is, source queries, model relationships, and measures), but only need a small, highly filtered model for self-service development.</p>
    <h2 id="calibre_link-1706" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Queries can be affected by multiple parameters. In addition, parameters can also use queries for<a id="calibre_link-1707" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> their <code class="code-in-text--packt">Suggested Values</code>. To see how to use multiple parameters in a query, as well as how to use a query to provide <code class="code-in-text--packt">Suggested Values</code> for a parameter, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In <strong class="screentext">Power Query Editor</strong>, create a query called <strong class="screentext">SalesTerritoryGroupsList</strong> that returns the distinct <strong class="screentext">Sales Territory Groups</strong> from the <strong class="screentext">DimSalesTerritory</strong> table and disable loading of the query:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimSalesTerritory"]}[Data],
    RemoveColumns = Table.SelectColumns(Navigation,{"SalesTerritoryGroup"}),
    FilterNA = Table.SelectRows(RemoveColumns, each ([SalesTerritoryGroup] &lt;&gt; "NA")),
    RemoveDups = Table.Distinct(FilterNA),
    List = Table.ToList(RemoveDups)
in
    List
</code></pre>
      </li>
      <li class="calibre12">Click on <strong class="screentext">New Parameter</strong> from the <strong class="screentext">Manage Parameters</strong> dropdown in the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a parameter called <strong class="screentext">Territory Group</strong> with a <strong class="screentext">Text</strong> data type that uses the <strong class="screentext">SalesTerritoryGroupsList</strong> query for <strong class="screentext">Suggested Values</strong>:<figure class="mediaobject"><img src="images/000289.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 7.4: Territory Group parameter</p>
      </li>
      <li class="calibre12">Create a <strong class="screentext">SalesTerritoryKeys</strong> query that selects the unique key values associated with this dimension using the value set by the <strong class="screentext">Territory Group</strong> parameter<a id="calibre_link-925" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and disable the load:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimSalesTerritory"]}[Data],
    ParamFilter = Table.SelectRows(Navigation, each [SalesTerritoryGroup] = #"Territory Group"),
    KeyColumn = Table.Distinct(Table.SelectColumns(ParamFilter,{"SalesTerritoryKey"}))
in
    KeyColumn
</code></pre>
      </li>
      <li class="calibre12">Within the <strong class="screentext">Internet Sales</strong> table query, create an inner join expression step against the new <strong class="screentext">SalesTerritoryKeys</strong> query:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_FactInternetSalesReason = Source{[Schema="dbo",Item="FactInternetSales"]}[Data],
    ChangeType = Table.TransformColumnTypes(dbo_FactInternetSalesReason,{{"OrderDate", type date}}),
    RowFilter = Table.SelectRows(ChangeType, each [OrderDate] &gt;= StartDate and [OrderDate] &lt;= CurrentDate),
    SalesTerritoryJoin = Table.Join(RowFilter,"SalesTerritoryKey",SalesTerritoryKeys,"SalesTerritoryKey",JoinKind.Inner)
in 
    SalesTerritoryJoin
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">The <code class="code-in-text--packt">Internet Sales</code> table is now filtered by both the <code class="code-in-text--packt">Days Prior to Current Date</code> parameter and the <code class="code-in-text--packt">Territory Group</code> parameter. Instead of a static list of values, <code class="code-in-text--packt">Territory Group</code> derives <code class="code-in-text--packt">Suggested Values</code> from another query in the model &ndash; the <code class="code-in-text--packt">SalesTerritoryGroupsList</code> query. For queries to be used as <code class="code-in-text--packt">Suggested Values</code> in a parameter, the query must return a <code class="code-in-text--packt">List</code> data type, and not a table. The <code class="code-in-text--packt">Table.ToList</code> function is used within the <code class="code-in-text--packt">SalesTerritoryGroupsList</code> query to transform the single-column table into a list.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">SalesTerritoryKeys</code> query <a id="calibre_link-926" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>returns a single column table with the distinct <code class="code-in-text--packt">SalesTerritoryKey</code> values that correspond to the value chosen for the <code class="code-in-text--packt">Territory Group</code> parameter. This table is used in a <code class="code-in-text--packt">Table.Join</code> expression within the <code class="code-in-text--packt">Internet Sales</code> query to filter the <code class="code-in-text--packt">Internet Sales</code> table to only include the sales territories chosen using the <code class="code-in-text--packt">Territory Group</code> parameter.</p>
    <h2 id="calibre_link-1708" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Using <a id="calibre_link-927" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>parameters: <a href="https://bit.ly/37rXLP6" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/37rXLP6</span></a></li>
      <li class="bullet">Edit parameter settings in the Power BI service: <a href="https://bit.ly/3iuC1sn" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3iuC1sn</span></a></li>
    </ul>
    <h1 id="calibre_link-1248" class="title">Working with templates</h1>
    <p class="book-title--packt">Power BI<a id="calibre_link-1100" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> templates can be created from Power BI Desktop files as a means of providing users and other report authors with access to pre-defined metadata, such as M queries, DAX measures, model relationships, and report visualizations. As the template files do not contain actual data, they are very lightweight and, for import mode models, data is only retrieved when the template is opened. Additionally, if query parameters have been configured, a user interface is provided for entering parameter values, and these parameters can be integrated with the source queries and other components of the dataset.</p>
    <p class="book-title--packt">In this recipe, a parameter and supporting query are added to a Power BI Desktop file to support the distribution of a Power BI template.</p>
    <h2 id="calibre_link-1709" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Download <code class="code-in-text--packt">CH7_R3_Start.pbix</code> from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a>.</li>
      <li class="calibre12">Edit the <code class="code-in-text--packt">AdWorksDW</code> query to point to your copy of the <code class="code-in-text--packt">AdventureWorksDW2019</code> database.</li>
    </ol>
    <h2 id="calibre_link-1710" class="calibre8">How to work with templates</h2>
    <p class="book-title--packt">In this example, the goal is to provide a Power BI template that only retrieves data for a single customer <a id="calibre_link-1101" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>country. To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open <code class="code-in-text--packt">CH7_R3_Start.pbix</code> in Power BI Desktop.</li>
      <li class="calibre12">Choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Queries</strong> pane, right-click an empty area and choose <strong class="screentext">New Group</strong> to create a new query group called <strong class="screentext">Parameters</strong>.</li>
      <li class="calibre12">Right-click <strong class="screentext">Other Queries</strong> and create a <code class="code-in-text--packt">List</code> query called <strong class="screentext">CustomerCountries</strong> to retrieve the <strong class="screentext">Country</strong> names from the <strong class="screentext">Customers</strong> query:
        <pre class="programlisting"><code class="hljs">let
    Source = Customers,
    SelectColumn = Table.SelectColumns(Source,{"Country"}),
    Distinct = Table.Distinct(SelectColumn),
    List = Table.ToList(Distinct)
in
    List
</code></pre>
      </li>
      <li class="calibre12">Disable the load for the <strong class="screentext">CustomerCountries</strong> query.</li>
      <li class="calibre12">Right-click the <strong class="screentext">Parameters</strong> query group and choose <strong class="screentext">New Parameter</strong>.</li>
      <li class="calibre12">Create a parameter called <strong class="screentext">Customer Country</strong> with <strong class="screentext">Text </strong>as the type, <strong class="screentext">Suggested Values</strong> for the <strong class="screentext">CustomerCountries</strong> query, and <strong class="screentext">United States</strong> as the current value.</li>
      <li class="calibre12">In the <strong class="screentext">Other Queries</strong> group, create a query called <strong class="screentext">CustomerKeys</strong> that references the <strong class="screentext">Customer Country</strong> parameter, and disable the load on this query:
        <pre class="programlisting"><code class="hljs">let 
    CountryParamFilter = Table.SelectRows(Customers, each [Country] = #"Customer Country"),
    CustomerKeys = Table.SelectColumns(CountryParamFilter,
{"CustomerKey"})
in 
    CustomerKeys
</code></pre>
      </li>
      <li class="calibre12">Modify the <strong class="screentext">Internet Sales</strong> fact table query to respect the parameter selection:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_FactInternetSales = Source{[Schema="dbo",Item="FactInternetSales"]}[Data],
    ChangeType = 
        Table.TransformColumnTypes(dbo_FactInternetSales,
            {
                {"OrderDate", type date}, 
                {"DueDate", type date}, 
                {"ShipDate", type date}
            }
        ),
    CustomerJoin = 
        Table.Join(ChangeType, 
        "CustomerKey",CustomerKeys,"CustomerKey",JoinKind.Inner
    )
in
    CustomerJoin
</code></pre>
      </li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from <a id="calibre_link-1102" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the ribbon of the <strong class="screentext">Home</strong> tab and then save the PBIX file.</li>
      <li class="calibre12">From the <strong class="screentext">File</strong> menu of the <strong class="screentext">Report</strong> view, select <strong class="screentext">Export </strong>and then<strong class="screentext"> Power BI template</strong>.</li>
      <li class="calibre12">Optionally, give the template a description describing the parameter logic.</li>
      <li class="calibre12">Choose a folder path for the template (<code class="code-in-text--packt">.pbit</code>).</li>
      <li class="calibre12">Open the template file; the parameters dialog is opened, as shown in <em class="italic">Figure 7.5</em>:<figure class="mediaobject"><img src="images/000301.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 7.5: Parameter dialog when opening the Power BI template (.PBIT)</p>
      </li>
      <li class="calibre12">Choose <strong class="screentext">Australia</strong> from the list and then select the <strong class="screentext">Load</strong> button.</li>
      <li class="calibre12">Save the file as a<a id="calibre_link-787" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> new <strong class="screentext">Power BI Desktop</strong> (<strong class="screentext">PBIX</strong>) file.</li>
    </ol>
    <h2 id="calibre_link-1711" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">When opening a Power BI template, if there are any parameters defined, the parameters dialog will open, allowing the user to specify the parameter values. In the recipe, the <code class="code-in-text--packt">Customer Country</code> parameter is defined. This parameter uses <code class="code-in-text--packt">Suggested Values</code>, which come from the <code class="code-in-text--packt">CustomerCountries</code> query; this is a <code class="code-in-text--packt">List</code> query in that it returns a <code class="code-in-text--packt">List</code> object instead of a <code class="code-in-text--packt">Table</code> object. Only queries that return lists can be used as <code class="code-in-text--packt">Suggested Values</code> for parameters.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">CustomerKeys</code> query<a id="calibre_link-1103" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> uses the chosen <code class="code-in-text--packt">Customer Country</code> parameter <a id="calibre_link-208" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>value to return a single-column table of <code class="code-in-text--packt">CustomerKey</code> values from the <code class="code-in-text--packt">Customers</code> query. Since the <code class="code-in-text--packt">CustomerKey</code> column is the surrogate key used in the customer-to-sales relationship, it is not necessary to apply any transformations to remove duplicates, as each value is already unique. The <code class="code-in-text--packt">CustomerKeys</code> query is then used within the <code class="code-in-text--packt">CustomerJoin</code> expression in the <code class="code-in-text--packt">Internet Sales</code> query to return only the sales for the specified <code class="code-in-text--packt">CustomerKeys</code>, which belong to the chosen <code class="code-in-text--packt">Customer Country</code>.</p>
    <p class="book-title--packt">Distributing templates can introduce version control and manageability issues. Therefore, prior to designing parameters and creating templates, confirm whether the report authoring capabilities of Power BI Desktop against a published dataset in Power BI are insufficient. If insufficient, identify the modifications that users need to implement, such as additional data sources or query transformations, and consider whether these changes can be implemented in the existing dataset. Identify the scope and goals of the templates, such as the years of data and specific dimensions required. Parameters will be designed based on these requirements to retrieve the minimum amount of data needed.</p>
    <h2 id="calibre_link-1712" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">In some <a id="calibre_link-558" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>cases, such as, perhaps, an <strong class="screentext">Independent Software Vendor</strong> (<strong class="screentext">ISV</strong>), report templates can be created that utilize a standard data schema, such as the vendor's database that supports their third-party application. In these cases, the ISV can create a standard Power BI report template, complete with visuals, and distribute this template to its customers. In such circumstances, the database connection information can be parameterized, since each customer has their own local copy of the database. To see how this can work, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open <code class="code-in-text--packt">CH7_R3_Start.pbix</code> in Power BI Desktop.</li>
      <li class="calibre12">Choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open <strong class="screentext">Power Query Editor</strong>.</li>
      <li class="calibre12">Right-click the <strong class="screentext">Parameters</strong> query group and choose <strong class="screentext">New Parameter</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Manage Parameters</strong> dialog, create a parameter called <strong class="screentext">SQL Server Instance</strong> with <strong class="screentext">Text</strong> as the type and a <strong class="screentext">Current Value </strong>of the SQL Server instance that hosts your <code class="code-in-text--packt">AdventureWorksDW2019</code> database (in other words, <code class="code-in-text--packt">localhost\MSSQLSERVERDEV</code>).</li>
      <li class="calibre12">While still in the <strong class="screentext">Manage Parameters</strong> dialog, select <strong class="screentext">New</strong> and create a parameter <a id="calibre_link-1713" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>called <strong class="screentext">SQL</strong> <strong class="screentext">Database</strong> with <strong class="screentext">Text</strong> as the type, and a <strong class="screentext">Current Value</strong> of the<a id="calibre_link-1023" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> database name of the <code class="code-in-text--packt">AdventureWorksDW2019</code> database.</li>
      <li class="calibre12">Click the <strong class="screentext">OK</strong> button to exit the <strong class="screentext">Manage Parameters</strong> dialog.</li>
      <li class="calibre12">Edit the <code class="code-in-text--packt">AdWorksDW</code> query to use the new parameters:
        <pre class="programlisting"><code class="hljs">let
    SQLInstance = 
        if #"SQL Server Instance" = null 
            then "localhost\MSSQLSERVERDEV" else #"SQL Server Instance",
    SQLDatabase = 
        if #"SQL Database" = null 
            then "AdventureWorksDW2019" else #"SQL Database",
    Source = Sql.Database(SQLInstance, SQLDatabase)
in 
    Source
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">In this case, the modified <code class="code-in-text--packt">AdWorksDW</code> query demonstrates how to account for parameters that may not be required. The query uses <code class="code-in-text--packt">if</code> statements to determine whether the parameter value is <code class="code-in-text--packt">null</code> and, if so, uses a default value for the <code class="code-in-text--packt">SQLInstance</code> and <code class="code-in-text--packt">SQLDatabase</code> expressions. If saved as a template, these parameters for the <code class="code-in-text--packt">SQL Server Instance</code> and <code class="code-in-text--packt">SQL Database</code> would be presented to the user upon opening the PBIT file. This would allow the user to connect to their own local copy of the database to retrieve the data used in the report. The user can then save the file as a PBIX.</p>
    <h2 id="calibre_link-1714" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Using <a id="calibre_link-1104" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>templates in Power BI Desktop: <a href="https://bit.ly/3gpXtxX" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3gpXtxX</span></a></li>
    </ul>
    <h1 id="calibre_link-1249" class="title">Converting static queries to dynamic functions</h1>
    <p class="book-title--packt">In addition <a id="calibre_link-1053" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to the standard library of functions<a id="calibre_link-404" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> available to M queries, user-defined functions can be created to encapsulate the logic of queries for dynamic application against parameter inputs. Like SQL-stored procedures, M functions can be created with or without input parameters, which can be required or optional. Additionally, as functions are values in the M language, just like table and list values, they can be invoked on demand and in multiple areas within a given Power BI data model.</p>
    <p class="book-title--packt">In this recipe, a function is created to support the integration of a list of employee IDs maintained outside the data warehouse environment. The function accepts the employee ID values as parameter inputs and retrieves related column values.</p>
    <h2 id="calibre_link-1715" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Download <code class="code-in-text--packt">Employees.xlsx</code> from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a>.</li>
      <li class="calibre12">Open a <strong class="screentext">Power BI Desktop</strong> file locally and access <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable the load on the <code class="code-in-text--packt">AdWorksDW</code> query and place it in a <code class="code-in-text--packt">Data Sources query</code> group.</li>
      <li class="calibre12">Create an <code class="code-in-text--packt">Employees</code> query that references the <code class="code-in-text--packt">AdWorksDW</code> query and imports the <code class="code-in-text--packt">DimEmployee</code> table:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimEmployee = Source{[Schema="dbo",Item="DimEmployee"]}[Data],
    FullName = 
        Table.CombineColumns(
            dbo_DimEmployee,
            {"FirstName", "LastName"},
            Combiner.CombineTextByDelimiter(" ", QuoteStyle.None),
            "EmployeeName"
        )
in
    FullName
</code></pre>
      </li>
      <li class="calibre12">Place the <code class="code-in-text--packt">Employees</code> query into a query group called <code class="code-in-text--packt">Dimensions</code> and disable the load.</li>
    </ol>
    <h2 id="calibre_link-1716" class="calibre8">How to convert static queries</h2>
    <p class="book-title--packt">To <a id="calibre_link-1054" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>implement this recipe, perform the<a id="calibre_link-405" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create an M query called <code class="code-in-text--packt">EmployeeKeysAdHoc</code> in the <strong class="screentext">Other Queries</strong> group that retrieves the employee IDs from the Excel workbook:
        <pre class="programlisting"><code class="hljs">let
    Source = Excel.Workbook(File.Contents("C:\Employees.xlsx"), null, true),
    Employees_Sheet = Source{[Item="Employees",Kind="Sheet"]}[Data],
    Headers = Table.PromoteHeaders(Employees_Sheet, [PromoteAllScalars=true]),
    TypeConversion = 
        Table.TransformColumnTypes(
            Headers,{{"EmployeeAlternateKey", type text}}
        ),
    RemoveNullsAndDups = 
        Table.Distinct(
            Table.SelectRows(TypeConversion, each [EmployeeAlternateKey]&lt;&gt;null)
        )
in
    RemoveNullsAndDups
</code></pre>
      </li>
      <li class="calibre12">Disable the load on the <strong class="screentext">EmployeeKeysAdHoc</strong> query.</li>
      <li class="calibre12">Create a function that retrieves the required employee column values for a given <code class="code-in-text--packt">Employee ID</code> input parameter from the <strong class="screentext">Employees</strong> query by creating a <strong class="screentext">Blank Query</strong>, using the following code:
        <pre class="programlisting"><code class="hljs">(EmployeeID as text) =&gt;
    let 
        EmployeeDimFilter = 
            Table.SelectRows(
                Employees, 
                each [EmployeeNationalIDAlternateKey] = EmployeeID and 
                [EndDate] = null),
        EmployeeColumnSelection = Table.SelectColumns(
             EmployeeDimFilter, 
             {"EmployeeName", "DepartmentName", "EmailAddress"})
in 
    EmployeeColumnSelection
</code></pre>
      </li>
      <li class="calibre12">Name<a id="calibre_link-406" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this <a id="calibre_link-1055" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>function <strong class="screentext">EmployeeDetailFunction</strong> and place it in a <strong class="screentext">Functions</strong> query group. A formula (<code class="code-in-text--packt">fx</code>) icon in the Query Editor will identify the value as a function.</li>
      <li class="calibre12">Create a new blank query in the <strong class="screentext">Other Queries</strong> group that references the <strong class="screentext">EmployeeKeysAdHoc</strong> query; name this new query <strong class="screentext">EmployeeIDLookup</strong>.</li>
      <li class="calibre12">Add an expression that invokes the <strong class="screentext">EmployeeDetailFunction</strong> function in a <code class="code-in-text--packt">Table.AddColumn</code> function, and then expand the column to expose the three columns returned from the <strong class="screentext">EmployeeDetailFunction</strong> function using the <code class="code-in-text--packt">Table.ExpandTableColumn</code> function:
        <pre class="programlisting"><code class="hljs">let
    Source = EmployeeKeysAdHoc,
    CallFunction = 
        Table.AddColumn(
            Source, 
            "FunctionTbl", each EmployeeDetailFunction([EmployeeAlternateKey])
        ),
    Expand = 
        Table.ExpandTableColumn(
            CallFunction, 
            "FunctionTbl", 
            {"EmployeeName", "DepartmentName", "EmailAddress"}, 
            {"EmployeeName", "DepartmentName", "EmailAddress"}
        )
in
    Expand
</code></pre>
      </li>
      <li class="calibre12">Click on <strong class="screentext">Close &amp; Apply</strong> in the ribbon of the <strong class="screentext">Home</strong> tab and save your work.</li>
    </ol>
    <h2 id="calibre_link-1717" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">In this example, a business team maintains a list of employee IDs in an Excel workbook and wants the ability to access several columns from the employee dimension table in the data model related to these IDs. In the <code class="code-in-text--packt">EmployeeKeysAdHoc</code> query, three M transformation functions are applied to protect the integration process: a data type conversion to text, the removal of any null values, and the removal of any duplicates. Data cleansing operations are always recommended when importing from files and unstructured data sources.</p>
    <p class="book-title--packt">In the <code class="code-in-text--packt">EmployeeDetailFunction</code> function, the <code class="code-in-text--packt">EmployeeID</code> parameter is first defined as a required <a id="calibre_link-407" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>text-type<a id="calibre_link-1056" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> input parameter. The parameter is then used in the <code class="code-in-text--packt">EmployeeDimFilter</code> expression as part of a <code class="code-in-text--packt">Table.SelectRows</code> filtering function. Given that the <code class="code-in-text--packt">Employees</code> table has type 2 slowly changing dimension logic applied, with multiple rows possible per employee, it is necessary to filter for the current employee row according to the <code class="code-in-text--packt">EmployeeDimFilter</code> variable expression (<code class="code-in-text--packt">[End Date = null]</code>). Setting this filter condition ensures that only the current or "active" row (no end date) for the employee is returned.</p>
    <p class="book-title--packt">Slowly changing dimension logic that inserts and/or updates rows for core dimensions as the entities in these dimensions change is an essential feature of data warehouses. The entities represented by such dimensions can be things like products or employees. Power BI dataset designers must be aware of this logic as represented in dimension columns, such as surrogate keys and alternate or business keys, and develop M and DAX expressions accordingly.</p>
    <p class="book-title--packt">With the filters applied, a simple <code class="code-in-text--packt">Table.SelectColumns</code> expression is used to retrieve the three required columns. A <code class="code-in-text--packt">Table</code> value is returned for each row, and each table contains columns for the given employee ID from the Excel workbook. As per the M expression code, the <code class="code-in-text--packt">EmployeeDetailFunction</code> function accepts the values from the <code class="code-in-text--packt">EmployeeNationalIDAlternateKey</code> column as its parameter inputs.</p>
    <p class="book-title--packt">Changes to the list of employee keys in the Excel workbook will be reflected in the Power BI report with each refresh. Additional columns and logic can be added to the function and, as the function is only metadata, it can be used in other data transformation scenarios&mdash;in this model or in other models&mdash;with access to the <code class="code-in-text--packt">Employees</code> table.</p>
    <p class="book-title--packt">The function in this recipe (Excel-based list), as well as functions applied against relational database sources that support query folding, still requires local resources of the M engine. This is demonstrated in <em class="italic">Figure 7.6</em>:</p>
    <figure class="mediaobject"><img src="images/000313.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 7.6: No query folding for an invoked M function</p>
    <p class="book-title--packt">Given local <a id="calibre_link-1057" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>resource usage and the iterative <a id="calibre_link-408" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>nature of functions, try to limit or avoid the use of functions against many rows, as well as functions with complex, multi-step logic. In this recipe, for example, the list of employees was very small and the function only selected a few columns from a small dimension table. Since join functions (<code class="code-in-text--packt">Table.Join, Table.NestedJoin</code>) and filter expressions are folded back to relational database sources, query authors should design query processes to achieve the same results as functions, but without row-by-row iterations and, hence, the local or gateway resource usage.</p>
    <h2 id="calibre_link-1718" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">The Excel file connection information can be parameterized. To see how this works, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In Power Query Editor, choose <strong class="screentext">Manage Parameters</strong> and then <strong class="screentext">New Parameter</strong> in the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a parameter called <strong class="screentext">ExcelFolder</strong> as <strong class="screentext">Text</strong> and set <strong class="screentext">Current Value</strong> to the folder path where the <code class="code-in-text--packt">Employees.xlsx</code> file is located, with no trailing backslash, \, in the path.</li>
      <li class="calibre12">Create a second parameter called <strong class="screentext">ExcelFile</strong> as <strong class="screentext">Text</strong> and set <strong class="screentext">Current Value</strong> to <code class="code-in-text--packt">Employees.xlsx</code>.</li>
      <li class="calibre12">Move the <strong class="screentext">ExcelFolder</strong> and <strong class="screentext">ExcelFile</strong> parameters to a <strong class="screentext">Parameters</strong> query group.</li>
      <li class="calibre12">Create a new <strong class="screentext">Blank Query</strong> in the <strong class="screentext">Other Queries</strong> group called <strong class="screentext">ExcelFilePath</strong> and disable the load:
        <pre class="programlisting"><code class="hljs">let 
    ExcelPath = ExcelFolder &amp; "\" &amp; ExcelFile
in 
    ExcelPath
</code></pre>
      </li>
      <li class="calibre12">Edit the <code class="code-in-text--packt">Source</code> line of the <code class="code-in-text--packt">EmployeeKeysAdHoc</code> query to use the <code class="code-in-text--packt">ExcelFilePath</code> query:
        <pre class="programlisting"><code class="hljs">Source = Excel.Workbook(File.Contents(ExcelFilePath), null, true),
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">The path and filename <a id="calibre_link-409" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of<a id="calibre_link-1058" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the Excel file are now controlled by the <code class="code-in-text--packt">ExcelFolder</code> and <code class="code-in-text--packt">ExcelFile</code> parameters.</p>
    <h2 id="calibre_link-1719" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Writing <a id="calibre_link-210" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Custom Functions in Power Query M: <a href="https://bit.ly/3xnPuYc" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3xnPuYc</span></a></li>
    </ul>
    <h1 id="calibre_link-1250" class="title">Capturing user selections with parameter tables</h1>
    <p class="book-title--packt">An alternative<a id="calibre_link-1114" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> method for providing <a id="calibre_link-709" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>parameter functionality to users of Power BI reports is via dedicated parameter tables. In this approach, the parameter values of a table are either computed during the dataset refresh process or are loaded as a one-time manual operation. DAX measures reference this parameter table and other tables and expressions of the model to enrich the self-service analysis experience and support Power BI report development. This approach is best suited for parameters that change infrequently since hard-coded parameter tables within Power BI means that the dataset owner must make such changes. If parameters need to change frequently, it may be better to have a database table or external file for the parameter table that is easier to edit and change.</p>
    <p class="book-title--packt">The example in this recipe involves providing simple visibility to four alternative scenarios to the baseline annual sales plan&mdash;10 and 20 percent above and below the baseline plan. An inline set of scenario values are embedded in the data model, and DAX measures are used to capture filter context&mdash;such as business user selections&mdash;and compute the corresponding scenario logic.</p>
    <h2 id="calibre_link-1720" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create<a id="calibre_link-710" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> a<a id="calibre_link-1115" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable the load on the <code class="code-in-text--packt">AdWorksDW</code> query and place it in a <code class="code-in-text--packt">Data Sources</code> query group</li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">AdWorksDW</code> query and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Create a <code class="code-in-text--packt">Products</code> query using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName"}, {"Product Category"}
        )
in
   Category
</code></pre>
      </li>
      <li class="calibre12">Create a <code class="code-in-text--packt">CategoryPlan</code> query <a id="calibre_link-1721" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>with the<a id="calibre_link-1722" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following code:
        <pre class="programlisting"><code class="hljs">let
    Source = Products,
    Sales = 
        Table.ExpandTableColumn(
            Source, "FactInternetSales", 
            {"SalesAmount", "OrderDate"}, {"SalesAmount", "OrderDate"}
        ),
    RemoveNulls = Table.SelectRows(Sales, each [SalesAmount] &lt;&gt; null),
    Year = 
        Table.AddColumn(
            RemoveNulls, "Calendar Year", each Date.Year([OrderDate])
        ),
    Month = 
        Table.AddColumn(
            Year, "Calendar Month", each Date.MonthName([OrderDate])
        ),
    MonthNum = 
        Table.AddColumn(
            Month, "Month Number", each Date.Month([OrderDate])
        ),
    Group = 
        Table.Group(MonthNum, {"Calendar Year", "Calendar Month", "Product Category", "Month Number"}, {{"SalesAmount", each List.Sum([SalesAmount]), type nullable number}}),
    Index = Table.AddIndexColumn(Group, "Index", 1, 1, Int64.Type),
    Plan = 
        Table.AddColumn(
            Index, "Plan Amt", 
            each if Number.IsEven([Index]) 
                then 1/Number.RandomBetween(5,10) * [SalesAmount] + [SalesAmount] 
                else (-1 * 1/Number.RandomBetween(5,10) * [SalesAmount]) + [SalesAmount]
        ),
    YearMonthSort = 
        Table.AddColumn(
            Plan, "YearMonthSort", each [Calendar Year] * 100 + [Month Number]
        ),
    YearMonth = 
        Table.CombineColumns(
            Table.TransformColumnTypes(
                YearMonthSort, {{"Calendar Year", type text}}, "en-US"
            ),
            {"Calendar Year", "Calendar Month"},
            Combiner.CombineTextByDelimiter("-", QuoteStyle.None),"Year-Month"),
    Currency = Table.TransformColumnTypes(YearMonth,{{"Plan Amt", Currency.Type}})
in
    Currency
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">CategoryPlan</strong> query to a query group called <strong class="screentext">Facts</strong>, and the <strong class="screentext">Products</strong> query to<a id="calibre_link-711" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> a<a id="calibre_link-1116" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> query group called <strong class="screentext">Dimensions</strong>.</li>
      <li class="calibre12">Disable the load for the <strong class="screentext">Products</strong> query.</li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Set the <strong class="screentext">Sort By</strong> column for the <strong class="screentext">Year-Month</strong> column in the <code class="code-in-text--packt">CategoryPlan</code> table to the <code class="code-in-text--packt">YearMonthSort</code> column.</li>
      <li class="calibre12">Save your work.</li>
    </ol>
    <h2 id="calibre_link-1723" class="calibre8">How to capture user selections</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In Power BI Desktop, while in the <strong class="screentext">Report</strong> view, click on <strong class="screentext">New Table</strong> in the ribbon of the <strong class="screentext">Modeling</strong> tab.</li>
      <li class="calibre12">Use the DAX <code class="code-in-text--packt">DATATABLE</code> function to create a calculated table with the scenario name, scenario value, and a sort key:
        <pre class="programlisting"><code class="hljs">Plan Scenarios = 
    DATATABLE(
        "Plan Scenario", STRING, 
        "Var to Plan", DOUBLE, 
        "Scenario Sort", INTEGER,
        {
            {"Plan",1,3},{"10% Above Plan",1.1,2},
            {"20% Above Plan",1.2,1}, 
            {"10% Below Plan",.9,4}, 
            {"20% Below Plan",.8,5}
        }
    )
</code></pre>
      </li>
      <li class="calibre12">Select the new table (<strong class="screentext">Plan Scenarios</strong>) in the <strong class="screentext">Data</strong> view, and set the <strong class="screentext">Plan Scenario</strong> column to sort by the <strong class="screentext">Scenario Sort</strong> column using the <strong class="screentext">Sort by column</strong> feature in the <strong class="screentext">Column tools</strong> tab of the ribbon.</li>
      <li class="calibre12">Right-click on the <strong class="screentext">Scenario Sort</strong> and <strong class="screentext">Var to Plan</strong> columns and select <strong class="screentext">Hide in Report View</strong>.</li>
      <li class="calibre12">Return to the <strong class="screentext">Report</strong> view<a id="calibre_link-712" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and<a id="calibre_link-1117" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> create a measure that retrieves the filter context of the <strong class="screentext">Plan Scenario</strong> column:
        <pre class="programlisting"><code class="hljs">Sales Plan Scenario Filter Branch = 
    SWITCH(TRUE(),
        NOT(ISFILTERED('Plan Scenarios'[Plan Scenario])),
            "No Selection",
        NOT(HASONEFILTER('Plan Scenarios'[Plan Scenario])),
            "Multiple Selections",
        "Single Selection"
    )
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Plan Amount</strong> measure:
        <pre class="programlisting"><code class="hljs">Plan Amount = SUM('SubCatPlan'[Plan Amt])
</code></pre>
      </li>
      <li class="calibre12">Create an <strong class="screentext">Internet Sales Plan Scenario</strong> measure that dynamically calculates a budget/plan amount based on the filter context (slicers, visuals):
        <pre class="programlisting"><code class="hljs">Internet Sales Plan Scenario = 
    VAR FilterContext = [Sales Plan Scenario Filter Branch]
RETURN
    SWITCH(TRUE(),
        FilterContext = "Single Selection",
            MIN('Plan Scenarios'[Var to Plan]) * [Plan Amount],
        FilterContext = "No Selection",
            [Plan Amount], 
        FilterContext = "Multiple Selections",BLANK()
    )
</code></pre>
      </li>
      <li class="calibre12">Apply a currency format to the <strong class="screentext">Plan Amount</strong> and <strong class="screentext">Internet Sales Plan Scenario</strong> measures.</li>
      <li class="calibre12">Create visualizations to display the different plan scenarios; an example is shown in <em class="italic">Figure 7.7</em>:<figure class="mediaobject"><img src="images/000325.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 7.7: Visualizations of plan scenarios</p>
    <h2 id="calibre_link-1724" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">When<a id="calibre_link-713" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> using <a id="calibre_link-1118" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the DAX <code class="code-in-text--packt">DATATABLE</code> function in the <code class="code-in-text--packt">Plan Scenarios</code> table, the column names and types are declared, and each row is enclosed in curly braces&mdash;<code class="code-in-text--packt">List</code> values in M queries. Ideally, the new scenario table can be persisted within a data warehouse and the Power BI solution can be resilient to changes in scenario names and values. </p>
    <p class="book-title--packt">As per other recipes, using DAX to create tables or columns should generally be thought of as a secondary and temporary option, such as in proof-of-concept scenarios, or in narrow, static use cases, such as a Power BI model owned and maintained by a business team. </p>
    <p class="book-title--packt">The intermediate measure, <code class="code-in-text--packt">Sales Plan Scenario Filter Branch</code>, simplifies the parameter selection measure by computing one of the three possible filter contexts: <code class="code-in-text--packt">No Selection</code>, <code class="code-in-text--packt">Single Selection</code>, or <code class="code-in-text--packt">Multiple Selections</code>. This measure can be hidden from the report view's <code class="code-in-text--packt">Fields</code> list.</p>
    <p class="book-title--packt">The scenario measure, <code class="code-in-text--packt">Internet Sales Plan Scenario</code>, passes the intermediate measure into the <code class="code-in-text--packt">FilterContext</code> variable and leverages the existing <code class="code-in-text--packt">Plan Amount</code> measure. If a single scenario selection has been made, such as on a slicer visual, then only a single value will be active in the <code class="code-in-text--packt">Plan Scenarios</code> table, and this will be retrieved via the <code class="code-in-text--packt">MIN</code> function. Generally, defaulting to a standard or base value if no selections have been made, and returning a blank if multiple selections are made, is appropriate for minimizing complexity and user confusion.</p>
    <p class="book-title--packt">A standard slicer is the most straightforward method of exposing the parameter values in reports, and <a id="calibre_link-714" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the<a id="calibre_link-1119" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> descending order of scenario values (based on the <code class="code-in-text--packt">Sort By </code>column) makes the slicer intuitive for users. As per the matrix visual, the <code class="code-in-text--packt">Plan Scenario</code> column can also be used within report visuals. Additionally, any dimension table with a relationship to the plan/budget fact table, such as a <code class="code-in-text--packt">Products</code> table, can be used in report visualizations with the new scenario measure as well. The slicer can be used to control chosen plan scenarios, or visual-level filters can be applied to only display one or a few of the five scenario values.</p>
    <p class="book-title--packt">Disconnected parameter tables are one of the more powerful and easily implemented patterns in Power BI, with many published examples available, such as enabling the user to filter reports for their own TOP criteria (in other words, Top 5, 10, 15, 20) through slicers. A more dynamic and analytical approach involves computing parameter values via M queries with each refresh, such as the standard deviation, median, and average of prices, and then using these query results in DAX measures.</p>
    <h2 id="calibre_link-1725" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Parameter tables can also be used to dynamically filter Power Query queries when using DirectQuery sources. This means that users can dynamically filter the information coming back from a DirectQuery query using report slicers. This functionality may still be in preview at the time this book is published, but more information regarding this functionality is provided in the <em class="italic">See also</em> section of this recipe.</p>
    <h2 id="calibre_link-1726" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Dynamic <a id="calibre_link-421" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>M query parameters in Power BI Desktop (preview): <a href="https://bit.ly/2QYrvhq" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2QYrvhq</span></a></li>
    </ul>
    <h1 id="calibre_link-1251" class="title">Forecasting with what-if analysis</h1>
    <p class="book-title--packt">Power BI can be <a id="calibre_link-1152" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>used to directly support the creation of <a id="calibre_link-498" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>forecasts, budgets, and other planned values of future business measures and events. The relationships and logic of these datasets, which are commonly implemented in Excel formulas and maintained by business teams, can be efficiently replicated within a dedicated Power BI Desktop file. Isolating the what-if input variables from the forecast creation, storage, and visualization in Power BI enables users to more easily create, analyze, and collaborate on business forecasts.</p>
    <p class="book-title--packt">In this recipe, a Power Desktop model is used to ingest forecast-variable inputs from Excel, and process these variables with a dynamic transformation process to generate a forecast table available for visualization. This design enables business teams to rapidly iterate on forecasts, and ultimately supports an official or approved forecast or plan that could be integrated with other data models.</p>
    <h2 id="calibre_link-1727" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Download <code class="code-in-text--packt">Forecast.xlsx</code> from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a>.</li>
      <li class="calibre12">Open a <strong class="screentext">Power BI Desktop</strong> file locally and access <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a query named <code class="code-in-text--packt">AdWorksDW</code>, similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable the load on the <code class="code-in-text--packt">AdWorksDW</code> query and place it in a <code class="code-in-text--packt">Data Sources</code> query group.</li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">AdWorksDW</code> query and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Rename the query <code class="code-in-text--packt">Internet Sales</code>, choose the <code class="code-in-text--packt">FactInternetSales</code> table, and change the <code class="code-in-text--packt">OrderDate</code> column to be of the <code class="code-in-text--packt">Date</code> data type:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_FactInternetSales = Source{[Schema="dbo",Item="FactInternetSales"]}[Data],
    DateType = Table.TransformColumnTypes(
        dbo_FactInternetSales,{{"OrderDate", type date}})
in
    DateType
</code></pre>
      </li>
      <li class="calibre12">Repeat <em class="italic">steps 5</em> and <em class="italic">6</em>, creating a <code class="code-in-text--packt">Sales Territories</code> query that points to the <code class="code-in-text--packt">DimSalesTerritory</code> table, and a <code class="code-in-text--packt">Dates</code> query that points to the <code class="code-in-text--packt">DimDates</code> table.</li>
      <li class="calibre12">Add <code class="code-in-text--packt">YearMonth</code> and <code class="code-in-text--packt">YearMonthSort</code> columns <a id="calibre_link-1153" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to <a id="calibre_link-499" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <code class="code-in-text--packt">Dates</code> table:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimDate = Source{[Schema="dbo",Item="DimDate"]}[Data],
    YearMonth = Table.AddColumn(
        dbo_DimDate, "YearMonth", 
        each Text.From([CalendarYear]) &amp; "-" &amp; Text.Start([EnglishMonthName],3)
    ),
    YearMonthSort = Table.AddColumn(
        YearMonth, "YearMonthSort", each [CalendarYear]*100+[MonthNumberOfYear])
in
    YearMonthSort
</code></pre>
      </li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Model</strong> view and create a relationship between the <code class="code-in-text--packt">SalesTerritoryKey</code> columns in the <code class="code-in-text--packt">Internet Sales</code> and <code class="code-in-text--packt">Sales Territories</code> tables.</li>
      <li class="calibre12">Create a relationship between the <code class="code-in-text--packt">DateKey</code> column in the <code class="code-in-text--packt">Dates</code> table and the <code class="code-in-text--packt">OrderDateKey</code> column in the <code class="code-in-text--packt">Internet Sales</code> table.</li>
      <li class="calibre12">Set <code class="code-in-text--packt">Sort by column</code> for the <code class="code-in-text--packt">YearMonth</code> column in the <code class="code-in-text--packt">Dates</code> table to the <code class="code-in-text--packt">YearMonthSort</code> column.</li>
    </ol>
    <h2 id="calibre_link-1728" class="calibre8">How to forecast with what-if analysis</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In <strong class="screentext">Report </strong>View, choose <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a query in the <code class="code-in-text--packt">Data Sources</code> query group called <strong class="screentext">ForecastFile</strong> that points to the <code class="code-in-text--packt">Forecast.xlsx</code> file<a id="calibre_link-1729" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and <a id="calibre_link-1730" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>disable the load:
        <pre class="programlisting"><code class="hljs">let
    Source = Excel.Workbook(File.Contents("C:\Forecast.xlsx"), null, true)
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Right-click the <strong class="screentext">ForecastFile</strong> query and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Rename the query <code class="code-in-text--packt">ForecastYear</code> and use the following code:
        <pre class="programlisting"><code class="hljs">() =&gt;
    let
        Source = ForecastFile,
        FY = Source{[Item="ForecastYear",Kind="DefinedName"]}[Data],
        Rename = Table.RenameColumns(FY,{{"Column2", "ForecastYear"}}),
        SelectColumn = Table.SelectColumns(Rename,{"ForecastYear"}),
        Record = Table.Max(SelectColumn,{"ForecastYear"}),
        Year = Record.Field(Record,"ForecastYear")
    in
        Year
</code></pre>
      </li>
      <li class="calibre12">Move the <code class="code-in-text--packt">ForecastYear</code> function to a query group called <code class="code-in-text--packt">Forecast</code>.</li>
      <li class="calibre12">In the <code class="code-in-text--packt">Forecast</code> query group, create a query called <code class="code-in-text--packt">ForecastTotalGrowth</code> and disable the load:
        <pre class="programlisting"><code class="hljs">let
    Source = ForecastFile,
    Forecast = Source{
        [Item="TotalSalesGrowthBaseForecast",Kind="DefinedName"]}[Data],
    Promote = Table.PromoteHeaders(Forecast, [PromoteAllScalars=true]),
    Unpivot = Table.UnpivotOtherColumns(
        Promote, {"Value"}, "Attribute", "Value.1"),
    RemoveColumn = Table.RemoveColumns(Unpivot,{"Value"}),
    Rename = Table.RenameColumns(
        RemoveColumn,{{"Attribute", "Month"}, {"Value.1", "Sales Growth"}}),
    ChangeToPercent = Table.TransformColumnTypes(
        Rename,{{"Sales Growth", Percentage.Type}})
in
    ChangeToPercent
</code></pre>
      </li>
      <li class="calibre12">In the <code class="code-in-text--packt">Forecast</code> query group, create a query called <code class="code-in-text--packt">ForecastAllocation</code> and disable <a id="calibre_link-1154" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <a id="calibre_link-500" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>load:
        <pre class="programlisting"><code class="hljs">let
    Source = ForecastFile,
    Allocation = Source{[Item="SalesGroupAllocation",Kind="DefinedName"]}[Data],
    Promote = Table.PromoteHeaders(Allocation, [PromoteAllScalars=true]),
    Unpivot = Table.UnpivotOtherColumns(
        Promote, {"Group"}, "Attribute", "Value"),
    Rename = Table.RenameColumns(Unpivot,
        {
            {"Group", "Sales Territory"}, {"Attribute", "Month"}, 
            {"Value", "Allocation"}
        }),
    ChangeToPercent = Table.TransformColumnTypes(
        Rename,{{"Allocation", Percentage.Type}})
in
    ChangeToPercent
</code></pre>
      </li>
      <li class="calibre12">In the <code class="code-in-text--packt">Forecast</code> query group, create a function called <code class="code-in-text--packt">CurrentDate</code>:
        <pre class="programlisting"><code class="hljs">() as date =&gt;
    let
        Current = Date.FromText("6/28/2013")
    in
        Current
</code></pre>
      </li>
      <li class="calibre12">In the <code class="code-in-text--packt">Forecast</code> query group, create a query called <code class="code-in-text--packt">PriorYearMonthlySales</code> and disable the load:
        <pre class="programlisting"><code class="hljs">let 
    CurrentYear = Date.Year(CurrentDate()),
    CurrentMonth = Date.Month(CurrentDate()),
    WorkingMonth = 
        if Date.DaysInMonth = Date.Day(CurrentDate()) 
            then CurrentMonth - 1 else CurrentMonth,
    PYJoin = Table.Join(
        #"Internet Sales","OrderDate",
        Dates,"FullDateAlternateKey",JoinKind.Inner),
    PYFilter = Table.SelectRows(PYJoin, each [CalendarYear] = CurrentYear-1 and 
        [MonthNumberOfYear] &gt;= WorkingMonth),
    PYGroup = Table.Group(
        PYFilter,{"CalendarYear", "MonthNumberOfYear", "EnglishMonthName"},
        {"Sales", each List.Sum([SalesAmount]), Currency.Type}),
    RemoveColumns = Table.RemoveColumns(PYGroup,{"MonthNumberOfYear"}),
    Month = Table.TransformColumns(
        RemoveColumns, 
        {{"EnglishMonthName", each Text.Start(_, 3), type text}}),
    Rename = Table.RenameColumns(Month,{{"EnglishMonthName", "Month"}})
in
    Rename
</code></pre>
      </li>
      <li class="calibre12">In the <code class="code-in-text--packt">Forecast</code> query <a id="calibre_link-1155" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>group, create a query<a id="calibre_link-501" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> called <code class="code-in-text--packt">CurrentYearMonthlySales</code> and disable the load:
        <pre class="programlisting"><code class="hljs">let 
    CurrentYear = Date.Year(CurrentDate()),
    CurrentMonth = Date.Month(CurrentDate()),
    WorkingMonth = 
        if Date.DaysInMonth = Date.Day(CurrentDate()) 
            then CurrentMonth else CurrentMonth - 1,
    PYJoin = Table.Join(
        #"Internet Sales","OrderDate",
        Dates,"FullDateAlternateKey",JoinKind.Inner),
    PYFilter = Table.SelectRows(PYJoin, each [CalendarYear] = CurrentYear and 
        [MonthNumberOfYear] &lt;= WorkingMonth),
    PYGroup = Table.Group(
        PYFilter,{"CalendarYear", "MonthNumberOfYear", "EnglishMonthName"},
        {"Sales", each List.Sum([SalesAmount]), Currency.Type}),
    RemoveColumns = Table.RemoveColumns(PYGroup,{"MonthNumberOfYear"}),
    Month = Table.TransformColumns(
        RemoveColumns, 
        {{"EnglishMonthName", each Text.Start(_, 3), type text}}),
    Rename = Table.RenameColumns(Month,{{"EnglishMonthName", "Month"}})
in
    Rename
</code></pre>
      </li>
      <li class="calibre12">In the <code class="code-in-text--packt">Forecast</code> query<a id="calibre_link-1156" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> group, create a query<a id="calibre_link-502" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> called <code class="code-in-text--packt">SalesForecastBase</code> and disable the load:
        <pre class="programlisting"><code class="hljs">let
    History = Table.Combine({CurrentYearMonthlySales,PriorYearMonthlySales}),
    JoinForecast = Table.NestedJoin(
        History, "Month", ForecastTotalGrowth,"Month", 
        "Fcst Column", JoinKind.Inner),
    ForecastColumns = Table.ExpandTableColumn(
        JoinForecast, "Fcst Column", {"Sales Growth"}, {"Sales Growth"}),
    MonthlyForecast = Table.AddColumn(
        ForecastColumns, 
        "Forecast Sales", each ([Sales Growth]+1) * [Sales], Currency.Type),
    AddForecastYear = Table.AddColumn(
        MonthlyForecast,"Forecast Year",each ForecastYear()),
    RemoveColumns = Table.RemoveColumns(
        AddForecastYear,{"CalendarYear", "Sales", "Sales Growth"})
in
    RemoveColumns
</code></pre>
      </li>
      <li class="calibre12">In the <code class="code-in-text--packt">Forecast</code> query group, create a query called <code class="code-in-text--packt">Sales Forecast</code>:
        <pre class="programlisting"><code class="hljs">let
    Source = Table.NestedJoin(
        ForecastAllocation, "Month", 
        SalesForecastBase, "Month", "AllocationTable", JoinKind.LeftOuter),
    ExpandAllocation = Table.ExpandTableColumn(
        Source, "AllocationTable", {"Forecast Sales", "Forecast Year"}, 
        {"Forecast Sales Total", "Forecast Year"}),
    AddAllocationForecast = Table.AddColumn(
        ExpandAllocation, "Forecast Sales",
        each [Allocation] * [Forecast Sales Total], Currency.Type),
    RemoveColumns = Table.RemoveColumns(
        AddAllocationForecast,{"Allocation", "Forecast Sales Total"}),
    YearMonth = Table.CombineColumns(
        Table.TransformColumnTypes(RemoveColumns, 
        {{"Forecast Year", type text}}, "en-US"),
        {"Forecast Year", "Month"},
        Combiner.CombineTextByDelimiter("-", QuoteStyle.None),"YearMonth")
in
    YearMonth
</code></pre>
      </li>
      <li class="calibre12">In the <code class="code-in-text--packt">Other Queries</code> query <a id="calibre_link-1157" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>group, create a query <a id="calibre_link-503" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>called <code class="code-in-text--packt">ForecastDateBridge</code>:
        <pre class="programlisting"><code class="hljs">let
    Dates = Table.Distinct(
        Table.SelectColumns(
            Table.SelectRows(Dates, 
                each [FullDateAlternateKey] &lt;= CurrentDate()),
            {"YearMonth"})),
    Forecast = Table.Distinct(
        Table.SelectColumns(#"Sales Forecast", {"YearMonth"})),
    YearMonths = Table.Combine({Dates, Forecast})
in
    YearMonths
</code></pre>
      </li>
      <li class="calibre12">In the <code class="code-in-text--packt">Other Queries</code> query group, create a query called <code class="code-in-text--packt">ForecastTerritoryBridge</code>:
        <pre class="programlisting"><code class="hljs">let
    Territories = Table.Distinct(
        Table.SelectColumns(#"Sales Territories","SalesTerritoryGroup"))
in
    Territories
</code></pre>
      </li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab and save your work.</li>
      <li class="calibre12">Create a relationship between the <code class="code-in-text--packt">YearMonth</code> columns of the <code class="code-in-text--packt">Dates</code> table and the <code class="code-in-text--packt">ForecastDateBridge</code> table, and set <strong class="screentext">Cross filter direction</strong> to <strong class="screentext">Both</strong>.</li>
      <li class="calibre12">Create a relationship between the <code class="code-in-text--packt">YearMonth</code> columns of the <code class="code-in-text--packt">ForecastDateBridge</code> table and the <code class="code-in-text--packt">Sales Forecast</code> table.</li>
      <li class="calibre12">Hide the <code class="code-in-text--packt">ForecastDateBridge</code> table from the <strong class="screentext">Report</strong> view.</li>
      <li class="calibre12">Create a relationship between the <code class="code-in-text--packt">SalesTerritoryGroup</code> columns of the <code class="code-in-text--packt">Sales Territory</code> table and the <code class="code-in-text--packt">ForecastTerritoryBridge</code> table, and set <strong class="screentext">Cross filter direction</strong> to <strong class="screentext">Both</strong>.</li>
      <li class="calibre12">Create a relationship between the <code class="code-in-text--packt">SalesTerritoryGroup</code> column in the <code class="code-in-text--packt">ForecastTerritoryBridge</code> table and the <code class="code-in-text--packt">Sales Territory</code> column in the <code class="code-in-text--packt">Sales Forecast</code> table.</li>
      <li class="calibre12">Hide the <code class="code-in-text--packt">ForecastTerritoryBridge</code> table from the <strong class="screentext">Report</strong> view. The final data model<a id="calibre_link-504" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is<a id="calibre_link-1158" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> displayed in <em class="italic">Figure 7.8</em>:<figure class="mediaobject"><img src="images/000336.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 7.8: Final model for forecasting</p>
      </li>
      <li class="calibre12">Create a <code class="code-in-text--packt">Today</code> measure:
        <pre class="programlisting"><code class="hljs">Today = DATE(2013,6,28)
</code></pre>
      </li>
      <li class="calibre12">Create a <code class="code-in-text--packt">Total Sales Amount</code> measure:
        <pre class="programlisting"><code class="hljs">Total Sales Amount = 
    SWITCH(TRUE(),
        ISBLANK(COUNTROWS('Sales Forecast')),
            IF(
                MAX('Dates'[FullDateAlternateKey])&lt;[Today],
                SUM('Internet Sales'[SalesAmount]),
                BLANK()
            ),
        SUM('Sales Forecast'[Forecast Sales])
    )
</code></pre>
      </li>
      <li class="calibre12">Create a Line chart visualization using the <code class="code-in-text--packt">YearMonth</code> column from the <code class="code-in-text--packt">Dates</code> table as <code class="code-in-text--packt">Axis</code>, and the <code class="code-in-text--packt">Total Sales Amount</code> measure as <code class="code-in-text--packt">Values</code>.</li>
      <li class="calibre12">Add a Slicer <a id="calibre_link-1159" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>visualization using the <code class="code-in-text--packt">SalesTerritoryGroup</code> column<a id="calibre_link-505" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> from the <code class="code-in-text--packt">Sales Territories</code> table, as shown in <em class="italic">Figure 7.9</em>:<figure class="mediaobject"><img src="images/000348.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 7.9: Historical and forecasted sales</p>
    <h2 id="calibre_link-1731" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">The <code class="code-in-text--packt">ForecastYear</code>, <code class="code-in-text--packt">ForecastTotalGrowth</code>, and <code class="code-in-text--packt">ForecastAllocation</code> queries use the named ranges in the <code class="code-in-text--packt">Forecast.xlsx</code> file to import the required forecast information. The <code class="code-in-text--packt">ForecastYear</code> query is a function with no input parameters that returns the single numeric value for the forecast year. The <code class="code-in-text--packt">ForecastTotalGrowth</code> and <code class="code-in-text--packt">ForecastAllocation</code> queries use the <code class="code-in-text--packt">Table.UnpivotOtherColumns</code> function to unpivot the month columns in the data to return 12 rows and 36 rows, respectively. In the <code class="code-in-text--packt">ForecastTotalGrowth</code> query, each row represents a month in the forecast year and the forecasted growth percentage year-on-year. In the <code class="code-in-text--packt">ForecastAllocation</code> query, each row represents the expected allocation of the forecasted growth by <code class="code-in-text--packt">Sales Territory</code> and <code class="code-in-text--packt">Month</code>.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">CurrentDate</code> query specifies a date for the current date by using a function with no input parameters. The function is specified to return a <code class="code-in-text--packt">Date</code> data type. In this recipe, the value for <code class="code-in-text--packt">CurrentDate</code> is hardcoded to June 28, 2013. In a production scenario something like the <code class="code-in-text--packt">Date.LocalNow</code> function would be used instead.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">PriorYearMonthlySales</code>, <code class="code-in-text--packt">CurrentYearMonthlySales</code>, and <code class="code-in-text--packt">SalesForecastBase</code> queries work together<a id="calibre_link-1160" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to create a base forecast for the report. Both<a id="calibre_link-506" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <code class="code-in-text--packt">PriorYearMonthlySales</code> and <code class="code-in-text--packt">CurrentYearMonthlySales</code> queries retrieve aggregated values from the <code class="code-in-text--packt">Internet Sales</code> query by <code class="code-in-text--packt">Month</code>. The <code class="code-in-text--packt">Table.SelectRows</code> filter function is used in the <code class="code-in-text--packt">PriorYearMonthlySales</code> and <code class="code-in-text--packt">CurrentYearMonthlySales</code> queries to ensure that the combination of the two queries is always equal to the full 12 months. For example, in June 2013, only January through May are retrieved by the <code class="code-in-text--packt">CurrentYearMonthlySales</code> query, with the remaining months retrieved by the <code class="code-in-text--packt">PriorYearMonthlySales</code> query.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">SalesForecastBase</code> query combines the <code class="code-in-text--packt">PriorYearMonthlySales</code> and <code class="code-in-text--packt">CurrentYearMonthlySales</code> queries using the <code class="code-in-text--packt">Table.Combine</code> function into the <code class="code-in-text--packt">History</code> expression. The combined table is then joined to the <code class="code-in-text--packt">ForecastTotalGrowth</code> query to add the forecasted <code class="code-in-text--packt">Sales Growth</code> column. The base forecast, the <code class="code-in-text--packt">Forecast Sales</code> column, is created by multiplying the <code class="code-in-text--packt">Sales</code> column from <code class="code-in-text--packt">Internet Sales</code> by 1 + the <code class="code-in-text--packt">Sales Growth</code> percentage. Finally, the <code class="code-in-text--packt">Forecast Year</code> column is added by calling the <code class="code-in-text--packt">ForecastYear</code> function from a <code class="code-in-text--packt">Table.AddColumn</code> expression and unnecessary columns are removed.</p>
    <p class="book-title--packt">The final <code class="code-in-text--packt">Sales Forecast</code> query joins the <code class="code-in-text--packt">ForecastAllocation</code> query to the <code class="code-in-text--packt">SalesForecastBase</code> query in order to attribute the sales growth of the specified allocation by <code class="code-in-text--packt">Sales Territory</code>. A <code class="code-in-text--packt">Left.Outer</code> join is used to ensure that all rows from the <code class="code-in-text--packt">ForecastAllocation</code> query are present in the resulting table, with the <code class="code-in-text--packt">AllocationTable</code> column holding the columns from the <code class="code-in-text--packt">SalesForecastBase</code> query. Once the columns from the <code class="code-in-text--packt">SalesForecastBase</code> table are expanded, the <code class="code-in-text--packt">Forecast Sales</code> column can be created by multiplying the <code class="code-in-text--packt">Forecast Sales Total</code> column by the <code class="code-in-text--packt">Allocation</code> column. Finally, unnecessary columns are removed, and a <code class="code-in-text--packt">YearMonth</code> column is created to ensure that the <code class="code-in-text--packt">Sales Forecast</code> table can be related to the <code class="code-in-text--packt">Dates</code> table in the model.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">ForecastDateBridge</code> and <code class="code-in-text--packt">ForecastTerritoriesBridge</code> tables each contain unique values for <code class="code-in-text--packt">YearMonth</code> and <code class="code-in-text--packt">SalesTerritoryGroup</code>, respectively. These tables are used in the model to bridge the different granularities between the <code class="code-in-text--packt">Dates</code> table, the <code class="code-in-text--packt">Sales Territories</code> table, and the <code class="code-in-text--packt">Sales Forecast</code> table.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">Total Sales Amount</code> measure determines whether the measure is executing in a current or future <code class="code-in-text--packt">YearMonth</code>, and calculates the value by either summing the <code class="code-in-text--packt">SalesAmount</code> column from the <code class="code-in-text--packt">Internet Sales</code> table for current <code class="code-in-text--packt">YearMonth</code> values, or by summing<a id="calibre_link-1161" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <code class="code-in-text--packt">Forecast Sales</code> column from the <code class="code-in-text--packt">Sales Forecast</code> table<a id="calibre_link-507" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> for future <code class="code-in-text--packt">YearMonth</code> values.</p>
    <h2 id="calibre_link-1732" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">The forecasting can be modified to include a what-if parameter that can be chosen by the user to visualize beating the forecast by specified percentages. To demonstrate how this works, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Report</strong> view, choose <strong class="screentext">New parameter</strong> from the ribbon of the <strong class="screentext">Modeling</strong> tab.</li>
      <li class="calibre12">Name the parameter <code class="code-in-text--packt">Beat Forecast By</code>, choose <code class="code-in-text--packt">Decimal number</code> for the data type, set <strong class="screentext">Minimum</strong> to <code class="code-in-text--packt">0.1</code>, <strong class="screentext">Maximum</strong> to <code class="code-in-text--packt">0.4</code>, and <strong class="screentext">Increment</strong> to <code class="code-in-text--packt">0.1</code>:<figure class="mediaobject"><img src="images/000359.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 7.10: What-if parameter</p>
      </li>
      <li class="calibre12">Modify the <code class="code-in-text--packt">Total Sales Amount</code> measure as follows:
        <pre class="programlisting"><code class="hljs">Total Sales Amount = 
    VAR __BeatForecastValue = [Beat Forecast By Value]
    VAR __ForecastIncrease = 
        IF(ISBLANK(__BeatForecastValue),1,1+__BeatForecastValue)
RETURN
    SWITCH(TRUE(),
        ISBLANK(COUNTROWS('Sales Forecast')),
            IF(
                MAX('Dates'[FullDateAlternateKey])&lt;[Today],
                SUM('Internet Sales'[SalesAmount]),
                BLANK()
            ),
        SUM('Sales Forecast'[Forecast Sales]) * __ForecastIncrease
    )
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">Users can now <a id="calibre_link-1162" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>use the <code class="code-in-text--packt">Beat Forecast By</code> slicer to control what-if scenarios, regarding<a id="calibre_link-508" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> exceeding the sales forecast by the specified percentages.</p>
    <h2 id="calibre_link-1733" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Use what-if <a id="calibre_link-1163" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>parameters to visualize variables: <a href="https://bit.ly/2QsmNZu" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2QsmNZu</span></a></li>
    </ul>
    <h1 id="calibre_link-1252" class="title">Conclusion</h1>
    <p class="book-title--packt">The recipes in this chapter covered both standard parameterization features and techniques in Power BI as well as more advanced custom implementations. Examples of parameterizing data sources, queries, user-defined functions, and reports demonstrated the power of the M language and its integration with other Power BI Desktop features. Additional examples, such as URL-based parameter filters, a dedicated forecasting or what-if? tool, and user selection parameter tables, utilized both the transformation and analytical features of Power BI to empower users with greater control over the analysis and visualization of Power BI data models.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-8">
<div id="calibre_link-1734" class="calibre2">
<div id="calibre_link-1735" class="calibre3"><div id="calibre_link-1736" class="calibre4">
    <h1 class="heading">8</h1>
    <h1 id="calibre_link-1253" class="title">Implementing Dynamic User-Based Visibility in&nbsp;Power BI</h1>
    <p class="book-title--packt">Data security, wherein users or groups of users are prevented from viewing a portion of a dataset, is often a top requirement in Power BI deployments. Security implementations can range in complexity from mapping a few security groups to their associated row-level security roles based on a single dimension value such as department or region to dynamic, user-based security involving dedicated user permissions tables and dynamic DAX functions. Given the variety of use cases and the importance of this feature to securely share a dataset across stakeholders, it is important to understand the process and techniques available for developing, testing, and operationalizing data security roles.</p>
    <p class="book-title--packt">In addition to <strong class="screentext">row-level security</strong> (<strong class="screentext">RLS</strong>) roles, dynamic, user-based filter context techniques can also be used to simplify and personalize the user experience. For example, the filter conditions built into reports, as well as the interactive filter selections from end users, can be dynamically updated and displayed in intuitive visuals to aid comprehension. In more advanced scenarios, DAX measures themselves can be filtered based on information about the user interacting with the content to deliver a personalized experience. This chapter contains detailed examples of building and deploying dynamic, user-based security for both Import and DirectQuery datasets, as well as examples of dynamic filter context functionality to enhance the user experience.</p>
    <p class="book-title--packt">In this chapter, we will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Capturing Current User Context</li>
      <li class="bullet">Defining RLS Roles and Filter Expressions</li>
      <li class="bullet">Designing Dynamic Security Models</li>
      <li class="bullet">Building Dynamic Security for DirectQuery</li>
      <li class="bullet">Displaying the Current Filter Context</li>
      <li class="bullet">Avoiding Manual User Clicks</li>
    </ul>
    <h1 id="calibre_link-1254" class="title">Technical Requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop.</li>
      <li class="bullet">SQL Server with the <code class="code-in-text--packt">AdventureWorksDW2019</code> database installed. This database and the instructions for installing it are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a>.</li>
      <li class="bullet">Files for this chapter and can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a>.</li>
    </ul>
    <h1 id="calibre_link-1255" class="title">Capturing Current User Context</h1>
    <p class="book-title--packt">The foundation of dynamic user security and visibility in Power BI is the ability to extract the <strong class="screentext">user principal name</strong> (<strong class="screentext">UPN</strong>) or login credential of the business<a id="calibre_link-1113" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> user connected to content<a id="calibre_link-201" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in the Power BI service. The <code class="code-in-text--packt">USERPRINCIPALNAME</code> DAX function retrieves this text value and thus enables filter expressions to be applied to the tables of a model in security roles. In addition to RLS roles, which override and impact all DAX measures of a dataset, the UPN or "current user" text value can be used by DAX measures to retrieve the UPN prefix and suffix, or filter other measures.</p>
    <p class="book-title--packt">In this recipe, DAX measures are added to a data model to dynamically retrieve the UPN as well as the UPN's prefix and suffix. Additional detail on authentication in Power BI and the <code class="code-in-text--packt">USERNAME</code> function, an alternative dynamic DAX function that also retrieves the UPN in the Power BI service, is also covered.</p>
    <h2 id="calibre_link-1737" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12">Open a new file in Power BI Desktop and sign in</li>
      <li class="calibre12">Click <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">In the Power Query Editor, create a new <strong class="screentext">Blank</strong> query called <strong class="screentext">Dynamic User Measures</strong></li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Switch to <strong class="screentext">Data</strong> view and hide the <strong class="screentext">Dynamic User Measures</strong> column in the <strong class="screentext">Dynamic User Measures</strong> table</li>
    </ol>
    <h2 id="calibre_link-1738" class="calibre8">How to Capture User Context</h2>
    <p class="book-title--packt">To implement<a id="calibre_link-202" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Data</strong> view, create three DAX measures in the <strong class="screentext">Dynamic User Measures</strong> table:
        <pre class="programlisting"><code class="hljs">User Principal Name = USERPRINCIPALNAME()
UPN Prefix = LEFT([User Principal Name], SEARCH("@",[User Principal Name]) - 1)
UPN Suffix = 
    RIGHT(
        [User Principal Name], 
        LEN([User Principal Name]) - LEN([UPN Prefix]) - 1)
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Table</strong> visualization and add the three measures to the table as <strong class="screentext">Values</strong>
        <figure class="mediaobject"><img src="images/000370.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.1: UPN measures</p>
      </li>
      <li class="calibre12">Publish the report to the Power BI service</li>
      <li class="calibre12">Add a separate user to the workspace or share the report with another user</li>
      <li class="calibre12">Request this user to log in to the workspace to view the report or log on with the alternate user's credentials<figure class="mediaobject"><img src="images/000381.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 8.2: The function returns the UPN of the different logged-in user</p>
    <h2 id="calibre_link-1739" class="calibre8">How it works ...</h2>
    <p class="book-title--packt">It is not technically necessary<a id="calibre_link-1740" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to create these measures in a data model in order to implement dynamic security or visibility, but this approach simplifies development since measure expressions can be reused and hidden from users.</p>
    <p class="book-title--packt">Power BI uses <strong class="screentext">Azure Active Directory</strong> (<strong class="screentext">AAD</strong>) to authenticate users<a id="calibre_link-101" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> who log in to the Power BI service, and the Power BI login credentials (such as <code class="code-in-text--packt">BrettP@FrontlineAnalytics.onmicrosoft.com</code>) are used as the effective username whenever a user attempts to access resources that require authentication. The <code class="code-in-text--packt">USERPRINCIPALNAME</code> DAX function returns the email address used to log in to Power BI. For organizations that use work email addresses for Power BI logins, this effective username maps to a UPN in the local active directory. </p>
    <p class="book-title--packt">In Power BI service-to-on-premises scenarios, such as with SSAS cubes on-premises, the effective username (login credentials) from the Power BI service is mapped to a UPN in the local active directory and resolved to the associated Windows domain account.</p>
    <p class="book-title--packt">If security roles have not been configured on the dataset, the member of the workspace, (JenLawrence for example) will see her UPN via either read or edit rights in the workspace. If security roles have been configured for the dataset, the member will either require edit rights in the workspace or can be added to one of the security roles defined for the dataset, and granted read access to the workspace. Security roles are applied to read-only members of app workspaces. Alternatively, the app workspace admin or workspace members with edit rights can test the security of users who are mapped to a security role but are not members of the workspace.</p>
    <h2 id="calibre_link-1741" class="calibre8">There's more ...</h2>
    <p class="book-title--packt">The <code class="code-in-text--packt">USERNAME</code> DAX function<a id="calibre_link-1112" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> returns the user's domain login in the format <code class="code-in-text--packt">domain\user</code> locally, but returns the user principal name (the user's login credential) in the Power BI service. Therefore, security role filter expressions, user permissions tables, and any other dynamic user functionality added to Power BI datasets should align with the UPN email address format provided by <code class="code-in-text--packt">USERPRINCIPALNAME</code>.</p>
    <p class="book-title--packt">In locally shared data models, DAX text functions can be used to extract the domain and username from <code class="code-in-text--packt">USERNAME</code>, like with <code class="code-in-text--packt">USERPRINCIPALNAME</code> in this recipe's example:</p>
    <pre class="programlisting"><code class="hljs">User Name = USERNAME()
User Name Domain = LEFT([User Name], SEARCH("\", [User Name]) - 1)
User Name Login = 
    RIGHT([User Name], LEN([User Name]) - LEN([User Name Domain]) - 1)
</code></pre>
    <figure class="mediaobject"><img src="images/000392.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 8.3: The USERNAME function used locally and outside of the Power BI service</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">USERNAME</code> function<a id="calibre_link-1742" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is commonly used in dynamic security implementations with SSAS tabular models. <code class="code-in-text--packt">USERPRINCIPALNAME</code> was introduced to simplify user identity, as it returns the UPN (email address format) locally and in the Power BI service. A rare exception to this is when a PC is not joined to a domain. In this unlikely scenario, <code class="code-in-text--packt">USERPRINCIPALNAME</code> returns the domain and username in (<code class="code-in-text--packt">domain\user</code>) format, just like <code class="code-in-text--packt">USERNAME</code>.</p>
    <p class="book-title--packt">There is also a <code class="code-in-text--packt">USEROBJECTID</code> DAX function that returns the current user's object ID from AAD when used in the context of the Power BI service or Azure Analysis Services. When used with SQL Server Analysis Services on-premises, the user's <strong class="screentext">Security Identifier</strong> (<strong class="screentext">SID</strong>) is returned.</p>
    <h2 id="calibre_link-1743" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power BI security<a id="calibre_link-819" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> documentation and whitepaper: <a href="http://bit.ly/22NHzRS" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/22NHzRS</span></a></li>
      <li class="bullet">DAX<a id="calibre_link-372" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> <code class="code-in-text--packt">USERPRINCIPALNAME</code> function: <a href="https://bit.ly/3dMDhVc" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3dMDhVc</span></a></li>
      <li class="bullet">DAX<a id="calibre_link-370" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> <code class="code-in-text--packt">USERNAME</code> function: <a href="https://bit.ly/2RRFuWT" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2RRFuWT</span></a></li>
      <li class="bullet">DAX<a id="calibre_link-371" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> <code class="code-in-text--packt">USEROBJECTID</code> function: <a href="https://bit.ly/3aCEXPo" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3aCEXPo</span></a></li>
    </ul>
    <h1 id="calibre_link-1256" class="title">Defining RLS Roles and Filter Expressions</h1>
    <p class="book-title--packt">Data security should always<a id="calibre_link-980" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> be top of mind and BI teams and developers<a id="calibre_link-477" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> should strive to ensure that users are never granted greater access or permission than is necessary to perform a legitimate business function.</p>
    <p class="book-title--packt">In the context of Power BI projects, the question "Who should be able to see what?" should be well defined and documented before any reports are published or read access to the dataset is granted. Additionally, there should be a well-defined process for creating and managing the security groups used in security implementations.</p>
    <p class="book-title--packt">The data security<a id="calibre_link-1744" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> of Power BI models comprises security roles defined within the model, with each<a id="calibre_link-1745" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> role containing a unique set of one or more DAX filter expressions. Roles and their associated filter expressions are created in Power BI Desktop, and users or groups are mapped to security roles in the Power BI service. A single DAX filter expression can be applied to each table of a model within a given security role, with users having the option of being mapped to multiple security roles. The filter expressions applied to tables within a security role also filter other tables in the model via relationships defined in the model, like the filters applied to Power BI reports, and are applied to all queries submitted by the security role member.</p>
    <p class="book-title--packt">This recipe contains an end-to-end example of configuring, deploying, and validating RLS roles, applicable to both Import and DirectQuery data models. Additional guidance on a consolidated security role table that improves the manageability of changing security requirements is also included.</p>
    <h2 id="calibre_link-1746" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <strong class="screentext">AdWorksDW</strong> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <strong class="screentext">AdWorksDW</strong> query and place it into a <strong class="screentext">Data Sources </strong>query group</li>
      <li class="calibre12">Right-click the <strong class="screentext">AdWorksDW</strong> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Internet Sales</strong> and choose the <strong class="screentext">FactInternetSales</strong> table</li>
      <li class="calibre12">Repeat steps <em class="italic">4</em> and <em class="italic">5</em>, creating a <strong class="screentext">Resellers</strong> query that points to the <strong class="screentext">DimResellers</strong> table, a <strong class="screentext">Reseller Sales</strong> query that points to the <strong class="screentext">FactResellerSales</strong> query, a <strong class="screentext">Sales Territories</strong> query that points to the <strong class="screentext">DimSalesTerritory</strong> table, and a <strong class="screentext">Dates</strong> query that points to the <strong class="screentext">DimDate</strong> table</li>
      <li class="calibre12">Create a <strong class="screentext">Customers</strong> query<a id="calibre_link-981" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> using the following<a id="calibre_link-478" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimCustomer = Source{[Schema="dbo",Item="DimCustomer"]}[Data],
    DimGeography = Table.ExpandRecordColumn(
        dbo_DimCustomer, "DimGeography", 
        {"DimSalesTerritory"}, {"DimSalesTerritory"}),
    SalesTerritory = Table.ExpandRecordColumn(
        DimGeography, "DimSalesTerritory", 
        {"SalesTerritoryGroup"}, {"SalesTerritoryGroup"})
in
    SalesTerritory
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName"}, {"Product Category"}
        )
in
   Category
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Reseller Sales</strong> queries to a <strong class="screentext">Facts</strong> query group and the <strong class="screentext">Sales Territories</strong>, <strong class="screentext">Dates</strong>, <strong class="screentext">Customers</strong>, <strong class="screentext">Resellers</strong>, and <strong class="screentext">Products</strong> queries to a <strong class="screentext">Dimensions</strong> query group</li>
      <li class="calibre12">In the <strong class="screentext">Other Queries</strong> group, create a <strong class="screentext">Blank</strong> query called <strong class="screentext">Calculations</strong></li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Switch to the <strong class="screentext">Model</strong> view and create a relationship between the <strong class="screentext">SalesTerritoryKey</strong> columns in the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Sales Territories</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">SalesTerritoryKey</strong> columns in the <strong class="screentext">Reseller Sales</strong> and <strong class="screentext">Sales Territories</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">ProductKey</strong> columns in the <strong class="screentext">Reseller Sales</strong> and <strong class="screentext">Products</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">ProductKey</strong> columns in the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Products</strong> tables</li>
      <li class="calibre12">Create a relationship<a id="calibre_link-982" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> between the <strong class="screentext">DateKey</strong> column in the <strong class="screentext">Dates</strong> table<a id="calibre_link-479" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and the <strong class="screentext">OrderDateKey</strong> column in the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">DateKey</strong> column in the <strong class="screentext">Dates</strong> table and the <strong class="screentext">OrderDateKey</strong> column in the <strong class="screentext">Reseller Sales</strong> table</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">CustomerKey</strong> columns in the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Customers</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">ResellerKey</strong> columns in the <strong class="screentext">Reseller Sales</strong> and <strong class="screentext">Resellers</strong> tables</li>
      <li class="calibre12">Save your work</li>
    </ol>
    <p class="book-title--packt">Define and document the security role requirements to be implemented, and the members or groups of these roles. Use the bus matrix diagrams (<em class="italic">Figure 3.1</em> and <em class="italic">Figure 3.2</em>) described in <em class="italic">Chapter 3</em>, <em class="italic">Building a Power BI Data Model</em>, to help communicate what data is currently stored in the model. Validate that role security is indeed required (not report or model filters), given the risk or sensitivity of the data.</p>
    <p class="book-title--packt">Do not confuse security role filters with the various other forms of filters in Power BI, such as report-, page-, and visual-level filters, as well as filter logic in DAX measures. RLS role filters are applied to all queries of security role members, effectively producing a virtual subset of the data model for the given role at query time. Given the performance implications of compounding security role filters with report query filters, all user experience and analytical filters should be implemented outside of the security role filters. Security filters should be exclusively used for securing sensitive data.</p>
    <figure class="mediaobject"><img src="images/000404.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 8.4: Model for RLS roles and filter expressions</p>
    <h2 id="calibre_link-1747" class="calibre8">How to Define RLS Roles and Filter Expressions</h2>
    <p class="book-title--packt">To implement<a id="calibre_link-983" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe, use the<a id="calibre_link-480" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Report</strong> view, create the following measures in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Customers Row Count = COUNTROWS('Customers')
Internet Sales Row Count = COUNTROWS('Internet Sales')
Products Row Count = COUNTROWS('Products')
Reseller Sales Row Count = COUNTROWS('Reseller Sales')
Resellers Row Count = COUNTROWS('Resellers')
Sales Territories Row Count = COUNTROWS('Sales Territories')
Dates Row Count = COUNTROWS('Dates')
</code></pre>
      </li>
      <li class="calibre12">Create a simple Table visualization<a id="calibre_link-984" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> using the measures created in the previous<a id="calibre_link-481" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> step. An example is shown in <em class="italic">Figure 8.5</em>.<figure class="mediaobject"><img src="images/000416.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.5: Row count measures in a table visual of the Power BI data model</p>
      </li>
      <li class="calibre12">Hide the <strong class="screentext">Calculations</strong> column in the <strong class="screentext">Calculations</strong> table.</li>
      <li class="calibre12">Click <strong class="screentext">Manage roles</strong> in the ribbon of the <strong class="screentext">Modeling</strong> tab.</li>
      <li class="calibre12">Click the <strong class="screentext">Create</strong> button and name the new role <strong class="screentext">United States Online Bike Sales</strong>.</li>
      <li class="calibre12">Create the following four table filter DAX expressions on the <strong class="screentext">Customers</strong>, <strong class="screentext">Products</strong>, <strong class="screentext">Resellers</strong>, and <strong class="screentext">Sales Territories</strong> tables, respectively:
        <pre class="programlisting"><code class="hljs">[SalesTerritoryGroup] = "North America"
[Product Category] = "Bikes"
FALSE()
[SalesTerritoryCountry] = "United States"
</code></pre>
        <figure class="mediaobject"><img src="images/000427.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.6: Role security definitions for United States Online Bike Sales</p>
      </li>
      <li class="calibre12">Click <strong class="screentext">Create</strong> and name the new role <strong class="screentext">Europe Reseller Mountain and Touring</strong>.</li>
      <li class="calibre12">Create the following three table filter DAX expressions on the <strong class="screentext">Customers</strong>, <strong class="screentext">Resellers</strong>, and <strong class="screentext">Sales Territories</strong> tables, respectively:
        <pre class="programlisting"><code class="hljs">FALSE()
[ProductLine] IN {"Mountain","Touring"}
[SalesTerritoryGroup] = "Europe"
</code></pre>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Save</strong> button.</li>
      <li class="calibre12">Click <strong class="screentext">View as</strong> in the ribbon<a id="calibre_link-985" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> of the <strong class="screentext">Modeling</strong> tab, choose the <strong class="screentext">United States Online Bike Sales</strong> role, click<a id="calibre_link-482" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">OK</strong> button, and note that the row counts in the Table visualization change, with the <strong class="screentext">Reseller Sales Row Count</strong> and <strong class="screentext">Reseller Row Count</strong> measures being blank.<figure class="mediaobject"><img src="images/000438.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.7: Viewing the row count measures as a member of the United States Online Bike Sales role</p>
      </li>
      <li class="calibre12">Click <strong class="screentext">View as</strong> in the ribbon of the <strong class="screentext">Modeling</strong> tab, choose the <strong class="screentext">Europe Reseller Mountain and Touring</strong> role and uncheck the <strong class="screentext">United States Online Bike Sales</strong> role, click the <strong class="screentext">OK</strong> button, and note that the row counts in the Table visualization change with the <strong class="screentext">Internet Sales Row Count</strong> and <strong class="screentext">Customers Row Count</strong> measures being blank.<figure class="mediaobject"><img src="images/000449.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.8: Viewing the row count measures as a member of the Europe Reseller Mountain and Touring role</p>
      </li>
      <li class="calibre12">Save the file, click <strong class="screentext">Publish</strong> in the ribbon of the <strong class="screentext">Home</strong> tab, and deploy to the Power BI service.</li>
      <li class="calibre12">Log in to the Power BI service and navigate to the workspace of the published report.</li>
      <li class="calibre12">Click the vertical ellipsis next to the dataset and select <strong class="screentext">Security</strong>.<figure class="mediaobject"><img src="images/000460.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.9: Opening the security settings for a published Power BI dataset in an app workspace</p>
      </li>
      <li class="calibre12">Members for each role<a id="calibre_link-986" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> can be added by entering the email addresses of the<a id="calibre_link-483" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> users and clicking the <strong class="screentext">Add</strong> button.<figure class="mediaobject"><img src="images/000471.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 8.10: Row-Level Security dialog</p>
    <h2 id="calibre_link-1748" class="calibre8">How it works</h2>
    <p class="book-title--packt">The filter<a id="calibre_link-990" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> expressions in<strong class="screentext"> RLS</strong> roles are always enforced and override any filtering logic in connected reports or DAX measures. BI developers responsible for a model with RLS roles defined should be able to communicate how the RLS logic impacts common reports and measures to report authors and other stakeholders.</p>
    <p class="book-title--packt">Filters applied in security roles traverse relationships just like filters in Power BI reports and filters applied in DAX measures. For example, a security filter on a product dimension table will flow from the <strong class="screentext">Products</strong> table (the one side of a relationship) to the many side (<strong class="screentext">Internet Sales</strong>), but will stop there, and neither will they flow to other tables related to<strong class="screentext"> Internet Sales</strong> unless bidirectional relationships have been enabled between <strong class="screentext">Internet Sales</strong> and these other dimension tables. Note that when viewing by either role or no roles, the <strong class="screentext">Dates Row Count</strong> measure remains the same, because there is no direct filter applied&mdash;nor are any of the DAX filter expressions propagated to the <strong class="screentext">Dates</strong> table through relationships.</p>
    <p class="book-title--packt">The data model<a id="calibre_link-1749" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> contains both internet sales and reseller sales, but each role should be restricted<a id="calibre_link-1750" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to their specific business process (fact table). Additionally, the <strong class="screentext">United States Online</strong> <strong class="screentext">Bike Sales</strong> role should be able to view North America customer details (Canada and United States), but only sales for United States customers purchasing products in the bike category. The <strong class="screentext">Sales Territories</strong> filter ensures that members will only see sales data associated with United States customers. The <strong class="screentext">Customers</strong> table filter allows the security members the option to view Canada and United States customers. The <code class="code-in-text--packt">FALSE</code> function is used to filter every row of the <strong class="screentext">Reselle</strong><strong class="screentext">rs </strong>table, which also filters the related <strong class="screentext">Reseller Sales</strong> table.</p>
    <p class="book-title--packt">The two reseller table measures return a blank value, given the <code class="code-in-text--packt">FALSE</code> security filter. The <strong class="screentext">Internet Sales</strong> table is filtered by the <strong class="screentext">Products</strong> filter (Bikes) and the <strong class="screentext">Sales Territories</strong> filter (United States). The <strong class="screentext">Internet Sales </strong>table is also filtered by the <strong class="screentext">Customers</strong> filter, but the <strong class="screentext">Sales</strong> <strong class="screentext">Territories</strong> filter is more restrictive.</p>
    <p class="book-title--packt">Even for experienced Power BI developers and for relatively simple requirements, it can be helpful to apply a single security filter at a time and to observe the impact on row counts. A standard testing report page with row counts, and possibly fact table measures, can help expedite the process.</p>
    <p class="book-title--packt">For the <strong class="screentext">European Reseller Mountain</strong> <strong class="screentext">and Touring</strong> role, the <strong class="screentext">Resellers</strong> filter makes only rows with a <strong class="screentext">ProductLine</strong> of <strong class="screentext">Mountain</strong> or <strong class="screentext">Touring</strong> visible. The <code class="code-in-text--packt">IN</code> DAX operator is a more intuitive and sustainable expression than the <code class="code-in-text--packt">||</code> symbol used as a logical <code class="code-in-text--packt">OR</code> operator in older versions of the language. The <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Customers</strong> tables are blank due to the <code class="code-in-text--packt">FALSE</code> expression for the <strong class="screentext">Customers</strong> table. <strong class="screentext">Customers</strong> has a one-to-many, single-direction relationship with<strong class="screentext"> Internet Sales</strong>. Therefore, filters on the <strong class="screentext">Customers</strong> table impact <strong class="screentext">Internet Sales</strong>, but not other tables.</p>
    <p class="book-title--packt">The <strong class="screentext">Sales Territories</strong> table has three rows remaining (France, Germany, and United Kingdom) due to the Europe filter. The <strong class="screentext">Reseller Sales</strong> fact table is impacted by both the <strong class="screentext">Sales Territories </strong>filter and the <strong class="screentext">Reseller ProductLine</strong> filter (<strong class="screentext">Mountain</strong> or <strong class="screentext">Touring</strong>). The filters from the <strong class="screentext">Resellers</strong> and <strong class="screentext">Sales Territories</strong> tables flow to the <strong class="screentext">Reseller Sales</strong> table, but stop there and do not impact other tables.</p>
    <p class="book-title--packt">In gathering security<a id="calibre_link-884" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> requirements, and again in a testing or <strong class="screentext">quality assurance</strong> (<strong class="screentext">QA</strong>) phase, communicate<a id="calibre_link-987" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> which tables are not impacted by the security filters<a id="calibre_link-484" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to stakeholders. Users may falsely believe that a <strong class="screentext">Products</strong> table security filter will also filter another dimension table, such as a <strong class="screentext">Stores</strong> dimension, since only certain products are sold in certain stores. However, if the <strong class="screentext">Stores</strong> table is queried directly and there is not a bidirectional relationship between <strong class="screentext">Stores</strong> and a <strong class="screentext">Sales</strong> fact table, all the stores would be accessible. Only when a sales measure is used in a visual would stores with blank values (given the <strong class="screentext">Products</strong> filter) be discarded by default, and even then, a user could access these stores via <strong class="screentext">Show items with no data setting</strong>. To secure these tables and avoid bidirectional cross-filtering for these relationships, additional table-specific security filters may be needed.</p>
    <h2 id="calibre_link-1751" class="calibre8">There's more</h2>
    <p class="book-title--packt">Security role definitions are specific to a given Power BI model (dataset). The management overhead and risk of maintaining common security roles and business definitions across multiple Power BI models, in addition to excess resource usage, should motivate IT/BI teams to consider consolidating these models to a single Power BI premium dataset or optionally an Analysis Services model. The management overhead and risk of maintaining common security roles and business definitions across multiple Power BI models can motivate IT/BI teams to consolidate<a id="calibre_link-1025" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> data models when feasible, and to consider a <strong class="screentext">SQL</strong> <strong class="screentext">Server Analysis Services</strong> (<strong class="screentext">SSAS</strong>) or <strong class="screentext">Azure Analysis Services</strong> model as a more efficient and secure long-term solution.</p>
    <p class="book-title--packt">As more roles and role filter requirements are required of a data model, a central security role table can be built into a data warehouse with the names of distinct roles associated with the values of the columns to be secured. Queries against this table can be used by Import or DirectQuery data models to implement these roles via relationships.</p>
    <h2 id="calibre_link-1752" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Row-level<a id="calibre_link-994" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> security (RLS) with Power BI: <a href="https://bit.ly/3nhx3zW" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3nhx3zW</span></a></li>
      <li class="bullet">Row-level security (RLS) guidance<a id="calibre_link-993" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in Power BI Desktop: <a href="https://bit.ly/3tUH3kY" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3tUH3kY</span></a></li>
    </ul>
    <h1 id="calibre_link-1257" class="title">Designing Dynamic Security Models</h1>
    <p class="book-title--packt">Dynamic security models in Power BI filter tables are based on the relationship of the logged-in user to a column or columns<a id="calibre_link-436" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> stored in the data model. The <code class="code-in-text--packt">USERPRINCIPALNAME</code> DAX function returns the user's UPN, as per the first recipe of this chapter, and a filter expression of a security role accepts this value as a parameter. Like all filters in Power BI data models, the filters applied in security roles also filter other tables via one-to-many and bidirectional relationships. Security roles can also blend dynamic, user-based filters with standard security filters to further restrict the visibility of members mapped to these roles.</p>
    <p class="book-title--packt">This recipe implements dynamic security on an <strong class="screentext">Employees </strong>dimension table. The result is that logged-in users (employees) can only view their own data and the data of those who report to them directly or indirectly via other managers.</p>
    <h2 id="calibre_link-1753" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <strong class="screentext">AdWorksDW</strong> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <strong class="screentext">AdWorksDW</strong> query, and place it into a <strong class="screentext">Data Sources </strong>query group</li>
      <li class="calibre12">Right-click the <strong class="screentext">AdWorksDW</strong> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Employees</strong>, choose the <strong class="screentext">DimEmployee</strong> table, and move it to the <strong class="screentext">Other Queries</strong> query group</li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Switch to the <strong class="screentext">Data</strong> view and create the following calculated columns:
        <pre class="programlisting"><code class="hljs">Employee Name = SWITCH(TRUE(),
    ISBLANK([MiddleName]),[FirstName] &amp; " " &amp; [LastName],
    [FirstName] &amp; " " &amp; LEFT([MiddleName],1) &amp; ". " &amp; [LastName])
Manager Name = LOOKUPVALUE(
    Employees[Employee Name],[EmployeeKey],[ParentEmployeeKey])
ManagementPath = PATH(Employees[EmployeeKey],Employees[ParentEmployeeKey])
ManagementPathLength = PATHLENGTH([ManagementPath])
</code></pre>
      </li>
      <li class="calibre12">Set the <strong class="screentext">EmployeeKey</strong> and <strong class="screentext">ParentEmployeeKey</strong> columns default <strong class="screentext">Summarization</strong> <strong class="screentext">setting</strong> to <strong class="screentext">Don't summarize</strong></li>
      <li class="calibre12">Save your work</li>
    </ol>
    <p class="book-title--packt">Establish the technical feasibility<a id="calibre_link-437" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> of dynamic security early in a Power BI deployment, such as through the existence and quality of employee-manager hierarchy sources, and the role security implications/options of Import versus DirectQuery models. As per the other recipes in this chapter, simple tables and relationships can be used as an alternative to relatively complex DAX expressions such as <code class="code-in-text--packt">PATHCONTAINS</code>. Additionally, for DirectQuery models, consider the option to leverage the existing security model of the source database rather than defining new RLS roles.</p>
    <h2 id="calibre_link-1754" class="calibre8">How to Build Dynamic Security Models</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Report</strong> view, create a simple Table visualization using the <strong class="screentext">Employee Name</strong>, <strong class="screentext">Manager Name</strong>, <strong class="screentext">EmployeeKey</strong>, <strong class="screentext">ParentEmployeeKey</strong>, <strong class="screentext">EmailAddress</strong>, <strong class="screentext">ManagementPath</strong>, and <strong class="screentext">ManagementPathLength</strong> columns, as shown in <em class="italic">Figure 8.11</em>
        <figure class="mediaobject"><img src="images/000482.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.11: Table visual of the Employees table columns</p>
      </li>
      <li class="calibre12">Create the following DAX measures:
        <pre class="programlisting"><code class="hljs">Current User Principal Name = "ascott0@adventure-works.com"
Current User EmployeeKey = LOOKUPVALUE(Employees[EmployeeKey],
    Employees[EmailAddress],[Current User Principal Name])
Current User Name = LOOKUPVALUE(Employees[Employee Name],
    Employees[EmailAddress],[Current User Principal Name])
Current User Manager = LOOKUPVALUE(Employees[Manager Name],
    Employees[EmployeeKey],[Current User EmployeeKey])
Current User Org Level = CALCULATE(MAX(Employees[ManagementPathLength]),
    FILTER(ALL(Employees),Employees[EmployeeKey] = [Current User EmployeeKey]))
Employee Row Count = COUNTROWS('Employees')
</code></pre>
      </li>
      <li class="calibre12">Select <strong class="screentext">Manage roles</strong> in the ribbon of the <strong class="screentext">Modeling</strong> tab</li>
      <li class="calibre12">Click <strong class="screentext">Create</strong> and name<a id="calibre_link-438" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the role <strong class="screentext">Current User</strong>, with a table filter DAX expression on the <strong class="screentext">Employees</strong> table of the following:
        <pre class="programlisting"><code class="hljs">PATHCONTAINS(Employees[ManagementPath],[Current User EmployeeKey])
</code></pre>
        <figure class="mediaobject"><img src="images/000493.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.12: Dynamic filter expression applied to Employees table for security role Current User</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Save</strong> button</li>
      <li class="calibre12">Create a <strong class="screentext">Multi-card</strong> visualization using the <strong class="screentext">Current User Name</strong>, <strong class="screentext">Current User</strong> <strong class="screentext">Manager</strong>, <strong class="screentext">Current User Org Level</strong>, and <strong class="screentext">Employee Row Count </strong>measures as <strong class="screentext">Fields</strong></li>
      <li class="calibre12">Select <strong class="screentext">View as</strong> in the ribbon of the <strong class="screentext">Modeling</strong> tab and choose the <strong class="screentext">Current User</strong> role<figure class="mediaobject"><img src="images/000003.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.13: Viewing the report as A. Scott Wright</p>
      </li>
      <li class="calibre12">Edit the <strong class="screentext">Current User Principal </strong>Name<a id="calibre_link-1755" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> measure to be <em class="italic">peter0@adventure-works.com</em>
        <figure class="mediaobject"><img src="images/000013.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 8.14: Viewing the report as Peter J. Krebs</p>
    <h2 id="calibre_link-1756" class="calibre8">How it works</h2>
    <p class="book-title--packt">In a production environment, the <strong class="screentext">Current User Principal Name</strong> measure would not be hardcoded to an email address, but would rather take the form of the following formula:</p>
    <pre class="programlisting"><code class="hljs">Current User Principal Name = USERPRINCIPALNAME()
</code></pre>
    <p class="book-title--packt">The DAX functions used in this recipe are specific to a parent-child hierarchy that exists in the <strong class="screentext">DimEmployee</strong> source table. The <strong class="screentext">DimEmployee</strong> table contains an email address column that would correspond to the value returned by the DAX <code class="code-in-text--packt">USERPRINCIPALNAME</code> function when logged into the Power BI service. Additionally, this recipe is exclusive to Import mode datasets, as parent-child DAX functions are not currently supported in DirectQuery mode models for either calculated columns or security filter expressions.</p>
    <p class="book-title--packt">The <strong class="screentext">Employees </strong>table has 296 rows, but a logged-in user should only see her data and the data of those that report to her directly or indirectly. For example, a vice president should still have visibility to a manager<a id="calibre_link-439" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> even if the manager reports to a senior manager who reports to the vice president. The senior manager, however, should not be able to view the vice president's data or the data of a different senior manager. Visibility is limited to the current user's data and the data of those employees who report to them directly or indirectly via other managers.</p>
    <p class="book-title--packt">The <strong class="screentext">EmployeeKey</strong> value is the last item in the <strong class="screentext">ManagementPath</strong> column via the <code class="code-in-text--packt">PATH</code> function. The <strong class="screentext">Current User EmployeeKey</strong> measure, which uses the <strong class="screentext">Current User Principal </strong>Name to retrieve the <strong class="screentext">EmployeeKey</strong> value, is passed as the item parameter to the <code class="code-in-text--packt">PATHCONTAINS</code> function in the RLS filter expression. The calculated column created in <em class="italic">step 1</em>, <strong class="screentext">ManagementPath</strong>, provides the string of values for each <strong class="screentext">Employees</strong> row to be evaluated against.</p>
    <h2 id="calibre_link-1757" class="calibre8">There's more</h2>
    <p class="book-title--packt">RLS expressions can significantly degrade query performance, as these filters will be applied in addition to other filters and expressions from Power BI reports when members of security roles access this content. As a general rule, try to use relationships between tables with low cardinality to implement dynamic security, as per the following recipe in this chapter. Utility or information functions, such as <code class="code-in-text--packt">LOOKUPVALUE</code>, <code class="code-in-text--packt">CONTAINS</code>, and <code class="code-in-text--packt">PATHCONTAINS</code>, can meet complex security rules in Import mode models but can be very expensive from a performance standpoint when applied against larger-dimension tables&mdash;such as customer or product tables containing more than one million rows.</p>
    <h2 id="calibre_link-1758" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Row-level security (RLS) with Power BI: <a href="https://bit.ly/3nhx3zW" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3nhx3zW</span></a></li>
      <li class="bullet">Row-level security (RLS) guidance in Power BI Desktop: <a href="https://bit.ly/3tUH3kY%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3tUH3kY</span></a></li>
    </ul>
    <h1 id="calibre_link-1258" class="title">Building Dynamic Security for DirectQuery</h1>
    <p class="book-title--packt">Dynamic row-level security<a id="calibre_link-433" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> roles can be implemented in DirectQuery<a id="calibre_link-388" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> models via relationships, and with specifically bidirectional cross-filtering between user security tables and the dimension tables to be secured. DAX information functions, commonly used in the role security expressions of Import mode models, such as <code class="code-in-text--packt">CONTAINS</code> and <code class="code-in-text--packt">LOOKUPVALUE</code>, are not supported in DirectQuery mode models, thus requiring a relationship-based security design. Although limited to this single approach, dynamic security can be quickly developed for DirectQuery models and maintained easily, without the need for complex DAX security expressions.</p>
    <p class="book-title--packt">This recipe walks through the steps<a id="calibre_link-1759" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and settings necessary to support<a id="calibre_link-1760" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> dynamic security in a DirectQuery model.</p>
    <h2 id="calibre_link-1761" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a new query that accesses your copy of the <strong class="screentext">AdventureWorksDW2019</strong> database on your SQL Server, ensuring that the <strong class="screentext">Data Connectivity </strong>mode is set to <strong class="screentext">DirectQuery</strong></li>
      <li class="calibre12">Choose the <strong class="screentext">FactInternetSales</strong> table in the <strong class="screentext">Navigation</strong> dialog</li>
      <li class="calibre12">Rename the query <strong class="screentext">Internet Sales</strong></li>
      <li class="calibre12">Right-click the <strong class="screentext">Internet Sales</strong> query and choose <strong class="screentext">Duplicate</strong></li>
      <li class="calibre12">Change the <strong class="screentext">Navigation</strong> step to point to the <strong class="screentext">DimSalesTerritory</strong> table</li>
      <li class="calibre12">Rename the query <strong class="screentext">Sales Territories</strong></li>
      <li class="calibre12">Right-click the <strong class="screentext">Internet Sales</strong> query and choose <strong class="screentext">Duplicate</strong></li>
      <li class="calibre12">Change the <strong class="screentext">Navigation</strong> step to point to the <strong class="screentext">DimEmployee</strong> table</li>
      <li class="calibre12">Rename the query <strong class="screentext">Employees</strong></li>
      <li class="calibre12">Edit the <strong class="screentext">Employees</strong> query to be the following (replacing the <strong class="screentext">Source</strong> line with the instance of your SQL Server):
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019"),
    dbo_DimEmployee = Source{[Schema="dbo",Item="DimEmployee"]}[Data],
    ExpandSalesTerritory = Table.ExpandRecordColumn(
        dbo_DimEmployee, "DimSalesTerritory", 
        {"SalesTerritoryCountry"}, {"SalesTerritoryCountry"}),
    RemoveColumns = Table.SelectColumns(
        ExpandSalesTerritory,
        {"SalesTerritoryCountry", "EmployeeKey", 
        "EmployeeNationalIDAlternateKey", "EmailAddress"})
in
    RemoveColumns
</code></pre>
      </li>
      <li class="calibre12">Right-click the <strong class="screentext">Employees</strong> query and choose <strong class="screentext">Duplicate</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Countries</strong></li>
      <li class="calibre12">Edit the <strong class="screentext">Countries</strong> query to be the following (replacing the <strong class="screentext">Source</strong> line with the instance of your SQL Server):
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019"),
    dbo_DimEmployee = Source{[Schema="dbo",Item="DimEmployee"]}[Data],
    ExpandSalesTerritory = Table.ExpandRecordColumn(
        dbo_DimEmployee, "DimSalesTerritory", 
        {"SalesTerritoryCountry"}, {"SalesTerritoryCountry"}),
    RemoveColumns = Table.SelectColumns(
        ExpandSalesTerritory,{"SalesTerritoryCountry"}),
    RemoveDups = Table.Distinct(RemoveColumns)
in
    RemoveDups
</code></pre>
      </li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from the ribbon<a id="calibre_link-434" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Switch to <strong class="screentext">Model</strong> view and<a id="calibre_link-389" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> create a relationship between the <strong class="screentext">SalesTerritoryCountry</strong> columns of the <strong class="screentext">Sales Territories</strong> and <strong class="screentext">Countries</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">SalesTerritoryKey</strong> columns of the <strong class="screentext">Sales Territories</strong> and <strong class="screentext">Internet Sales</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">SalesTerritoryCountry</strong> columns of the <strong class="screentext">Countries</strong> and <strong class="screentext">Employees</strong> tables</li>
      <li class="calibre12">Save your work</li>
    </ol>
    <h2 id="calibre_link-1762" class="calibre8">How to Build Dynamic Security Models for DirectQuery</h2>
    <p class="book-title--packt">To implement this recipe, perform the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Model</strong> view, open the properties for the <strong class="screentext">Countries</strong> to <strong class="screentext">Employees</strong> relationship, and set the <strong class="screentext">Cross filter direction</strong> to <strong class="screentext">Both</strong></li>
      <li class="calibre12">Check the checkbox for both <strong class="screentext">Assume</strong><strong class="screentext"><a id="calibre_link-1763" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext"> referential integrity</strong> and <strong class="screentext">Apply security</strong><strong class="screentext"><a id="calibre_link-1764" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext"> filter</strong> in both directions and then click <strong class="screentext">OK</strong>
        <figure class="mediaobject"><img src="images/000027.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.15: Bidirectional relationship between the Countries and Employees tables</p>
      </li>
      <li class="calibre12">The model should now look the same as that shown in <em class="italic">Figure 8.16</em>
        <figure class="mediaobject"><img src="images/000039.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.16: Dynamic user security relationships</p>
      </li>
      <li class="calibre12">Create the following measure, <strong class="screentext">Current User Principal Name</strong>:
        <pre class="programlisting"><code class="hljs">Current User Principal Name = "david8@adventure-works.com"
</code></pre>
      </li>
      <li class="calibre12">Click <strong class="screentext">Manage roles</strong> in the ribbon of the <strong class="screentext">Modeling</strong> tab</li>
      <li class="calibre12">Click <strong class="screentext">Create</strong>, and name the role <strong class="screentext">Current User</strong>, with a table filter DAX expression on the <strong class="screentext">Employees</strong> table of the following code:
        <pre class="programlisting"><code class="hljs">[EmailAddress] = [Current User Principal Name]
</code></pre>
      </li>
      <li class="calibre12"><em class="italic">Figure 8.17</em> shows this DAX formula entered into Power BI Desktop's interface for creating RLS roles<figure class="mediaobject"><img src="images/000051.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.17: DAX table filter expression applied to the EmailAddress column of the Employees table</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Save</strong> button</li>
      <li class="calibre12">Create a Table visualization using the <strong class="screentext">EmailAddress</strong> and <strong class="screentext">SalesTerritoryCountry</strong> columns from the <strong class="screentext">Employees</strong> table</li>
      <li class="calibre12">Create a <strong class="screentext">Clustered column chart</strong> visualization using the <strong class="screentext">SalesTerritoryCountry</strong> column from the <strong class="screentext">Countries</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">SalesAmount</strong> column (sum) from the <strong class="screentext">Internet Sales</strong> table as <strong class="screentext">Values</strong></li>
      <li class="calibre12">Click <strong class="screentext">View as</strong> in the ribbon<a id="calibre_link-435" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> of the <strong class="screentext">Modeling</strong> tab, choose <strong class="screentext">Current User</strong>, and click the <strong class="screentext">OK</strong> button to see that only the <strong class="screentext">United States</strong> column<a id="calibre_link-390" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is shown in the clustered column chart</li>
      <li class="calibre12">Edit the <strong class="screentext">Current User Principal Name</strong> measure to be <code class="code-in-text--packt">lynn0@adventure-works.com</code> and observe that only <strong class="screentext">Australia</strong> is shown in the clustered column chart</li>
    </ol>
    <h2 id="calibre_link-1765" class="calibre8">How it works</h2>
    <p class="book-title--packt">In a production environment, the <strong class="screentext">Current User Principal Name</strong> measure would not be hardcoded to an email address, but would rather be of the following formula:</p>
    <pre class="programlisting"><code class="hljs">Current User Principal Name = USERPRINCIPALNAME()
</code></pre>
    <p class="book-title--packt">When a user mapped to the dynamic security role connects to the DirectQuery dataset, their UPN is computed via the <code class="code-in-text--packt">USERPRINCIPALNAME</code> function. This value filters the <strong class="screentext">Employees</strong> table to a single row, which then filters the <strong class="screentext">Countries</strong> table via the bidirectional, one-to-many relationship. The filtered countries, such as Australia and the United States, then filter the <strong class="screentext">Sales Territories</strong> dimension table. As a final step, the <strong class="screentext">Internet Sales</strong> fact table is filtered by the <strong class="screentext">Sales Territories</strong> table, and thus all <strong class="screentext">Internet Sales</strong> measures and aggregations reflect the given <strong class="screentext">SalesTerritoryCountry</strong> of the employee.</p>
    <p class="book-title--packt">Note that the <strong class="screentext">Countries</strong> table, which contains only the distinct country values, is necessary, since the <strong class="screentext">Sales Territories</strong> table contains<a id="calibre_link-1766" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> many regions for the same country, and all relationships must have a side that identifies each row of a table.</p>
    <p class="book-title--packt">Ensure that <strong class="screentext">Apply security filter in both directions</strong> is selected for the bidirectional (both) cross-filter relationship between the <strong class="screentext">Countries</strong> and <strong class="screentext">Employees</strong> tables. In addition, the <strong class="screentext">Assume referential integrity </strong>setting causes<a id="calibre_link-1767" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the DirectQuery data model to send inner join<a id="calibre_link-1768" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> SQL queries to the source database and this&mdash;of course&mdash;significantly improves performance with larger models.</p>
    <h2 id="calibre_link-1769" class="calibre8">There's more</h2>
    <p class="book-title--packt">The approach from this recipe can be implemented in the same way for an Import mode model, and can also be used with a consolidated security role table. For example, instead of an <strong class="screentext">Employees</strong> table containing UPNs (email addresses), a <strong class="screentext">Permissions</strong> table could be loaded to the model containing the names of each RLS role and the columns to secure. </p>
    <p class="book-title--packt">For each role, a simple security filter could be applied that references the name of the role. As in this recipe, <strong class="screentext">Bridge</strong> tables containing the unique values of the secured columns could be created, and security filters would flow across relationships from the <strong class="screentext">Permissions</strong> table to the <strong class="screentext">Dimension</strong> and <strong class="screentext">Fact</strong> tables via the <strong class="screentext">Bridge</strong> table(s).</p>
    <figure class="mediaobject"><img src="images/000063.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 8.18: RLS permissions table</p>
    <p class="book-title--packt">Given the performance advantage of relationship filtering (including bidirectional relationship filtering), as well as the avoidance of relatively complex DAX, there could be value for organizations to follow this approach to dynamic security for both Import and DirectQuery models.</p>
    <h2 id="calibre_link-1770" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Row-level security (RLS) with Power BI: <a href="https://bit.ly/3nhx3zW" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3nhx3zW</span></a></li>
      <li class="bullet">Row-level security (RLS) guidance in Power BI Desktop: <a href="https://bit.ly/3tUH3kY" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3tUH3kY</span></a></li>
    </ul>
    <h1 id="calibre_link-1259" class="title">Displaying the Current Filter Context</h1>
    <p class="book-title--packt">DAX measures can be created to dynamically display the current filter context to report users. These measures<a id="calibre_link-198" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> can detect filters, retrieve values, and apply conditional logic to the filters applied to both slicer visuals and report- and page-level filters. With the filter context as a visual aid, users consuming or interacting with Power BI reports can focus on the data visualizations to obtain insights more quickly and with greater confidence. In addition, such measures can be useful when designing RLS scenarios as a check that the correct information is being filtered by the RLS rules.</p>
    <p class="book-title--packt">In this recipe, DAX measures are created to detect and display the filter selections applied to a specific column, either on the report canvas itself or as a report- or page-level filter. An additional example displays the values of a column that are "remaining," given the filters applied to the column directly and indirectly via other filters.</p>
    <h2 id="calibre_link-1771" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <strong class="screentext">AdWorksDW</strong>, similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <strong class="screentext">AdWorksDW</strong> query and place it into a <strong class="screentext">Data Sources </strong>query group</li>
      <li class="calibre12">Right-click the <strong class="screentext">AdWorksDW</strong> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Sales Territories</strong>, choose the <strong class="screentext">DimSalesTerritory</strong> table, and move to the <strong class="screentext">Other Queries</strong> query group</li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName"}, {"Product Category"}
        )
in
   Category
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Sales Territories</strong> and <strong class="screentext">Products</strong> queries to the <strong class="screentext">Other Queries</strong> query group</li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Save your work</li>
    </ol>
    <h2 id="calibre_link-1772" class="calibre8">How to do it</h2>
    <p class="book-title--packt">To implement<a id="calibre_link-199" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe, perform the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a DAX measure for <strong class="screentext">Regions Selected</strong>:
        <pre class="programlisting"><code class="hljs">Regions Selected = 
    VAR Selected = 
        FILTERS('Sales Territories'[SalesTerritoryRegion])
    VAR String = "Regions Selected: " &amp; 
        CONCATENATEX(
            Selected,[SalesTerritoryRegion],", ",[SalesTerritoryRegion])
    VAR StringLength = LEN(String)
    VAR NumOf = COUNTROWS(Selected)
RETURN 
    SWITCH(TRUE(),
        NOT(ISFILTERED('Sales Territories'[SalesTerritoryRegion])),
            "No Regions Selected", 
        StringLength &lt; 45, String, 
        NumOf &amp; " Regions Selected" )
</code></pre>
      </li>
      <li class="calibre12">Create a DAX measure for <strong class="screentext">Categories Selected</strong>:
        <pre class="programlisting"><code class="hljs">Categories Selected = 
    VAR Selected = 
        FILTERS('Products'[Product Category])
    VAR String = "Categories Selected: " &amp; 
        CONCATENATEX(
            Selected,[Product Category],", ",[Product Category])
    VAR StringLength = LEN(String)
    VAR NumOf = COUNTROWS(Selected)
RETURN 
    SWITCH(TRUE(),
        NOT(ISFILTERED('Sales Territories'[SalesTerritoryRegion])),
            "No Categories Selected", 
        StringLength &lt; 45, String, 
        NumOf &amp; " Categories Selected" )
</code></pre>
      </li>
      <li class="calibre12">Add a <strong class="screentext">Card</strong> or <strong class="screentext">Multi-row card</strong> visualization<a id="calibre_link-1773" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> for each measure created</li>
      <li class="calibre12">Add slicer visualizations for the <strong class="screentext">SalesTerritoryRegion</strong> column in the <strong class="screentext">Sales Territories</strong> table and the <strong class="screentext">Product Category</strong> column in the <strong class="screentext">Products</strong> table<figure class="mediaobject"><img src="images/000075.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 8.19: Two Multi-row Card visuals displaying the filter context from two Slicer visuals</p>
    <h2 id="calibre_link-1774" class="calibre8">How it works</h2>
    <p class="book-title--packt">In both measures, four DAX variables and a <code class="code-in-text--packt">SWITCH</code> function are used to support three separate conditions. When no filters<a id="calibre_link-200" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are applied, the message <strong class="screentext">No Regions Selected</strong> or No Categories Selected is returned. When many regions/categories are selected, resulting in a long text string (over 45 characters in this example), a short message is returned advising of the number of regions/categories selected. Otherwise, an ordered, comma-separated list of the selected region/category values is returned.</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">FILTERS</code> function returns a table of the values that are directly applied as filters to a column. The third parameter to <code class="code-in-text--packt">CONCATENATEX</code> is optional, but drives the sort order of the text values returned, and thus is recommended to aid the user when accessing the report by placing the values returned in a logical sorting order versus unsorted. As per <em class="italic">Figure 8.19</em>, the values are sorted alphabetically.</p>
    <p class="book-title--packt">In this example, a separate measure was created for the <strong class="screentext">Product Category</strong> column in the <strong class="screentext">Products</strong> table, and both columns are being filtered by slicer visuals. The two measures displayed in the multi-row Card visuals will also reflect filters applied via report- and page-level filters. For example, if there were no selections on the <strong class="screentext">Product Category</strong> slicer, or if this slicer was removed completely, the categories-selected measure would still detect and display product category filters from page- and report-level filters. </p>
    <p class="book-title--packt">You should plan ahead when creating multiple similar measures. Name variables in such a way that DAX code can be reused between multiple measures, and ensure that the variables' names still make sense within the context of each measure's code.</p>
    <h2 id="calibre_link-1775" class="calibre8">There's more</h2>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a DAX measure<a id="calibre_link-941" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> that identifies the remaining <strong class="screentext">SalesTerritoryRegion</strong> values, given all other filters<a id="calibre_link-860" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are applied:
        <pre class="programlisting"><code class="hljs">Regions Remaining = 
    VAR Remaining = DISTINCT('Sales Territories'[SalesTerritoryRegion])
    VAR String = "Regions Remaining: " &amp; 
        CONCATENATEX(
            Remaining,[SalesTerritoryRegion],", ",[SalesTerritoryRegion])
    VAR StringLength = LEN(String)
    VAR NumOf = COUNTROWS(Remaining)
RETURN
    SWITCH(TRUE(), 
        NOT(ISCROSSFILTERED('Sales Territories')),
            "No Sales Territories Filters", 
        StringLength &lt; 55, String, 
        NumOf &amp; " Regions Remaining")
</code></pre>
      </li>
      <li class="calibre12">Create a DAX measure that identifies the remaining <strong class="screentext">Product Subcategories</strong> values, given all other filters are applied:
        <pre class="programlisting"><code class="hljs">Subcategories Remaining = 
    VAR Remaining = DISTINCT('Products'[Product Subcategory])
    VAR String = "Subcategories Remaining: " &amp; 
        CONCATENATEX(
            Remaining,[Product Subcategory],", ",[Product Subcategory])
    VAR StringLength = LEN(String)
    VAR NumOf = COUNTROWS(Remaining)
RETURN
    SWITCH(TRUE(), 
        NOT(ISCROSSFILTERED('Sales Territories')),
            "No Products Filters", 
        StringLength &lt; 55, String, 
        NumOf &amp; " Subcategories Remaining")
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">The <code class="code-in-text--packt">DISTINCT</code> function<a id="calibre_link-1776" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> replaces the <code class="code-in-text--packt">FILTERS</code> function used in the earlier example<a id="calibre_link-1777" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to return the unique values still active despite filters on other columns. The <code class="code-in-text--packt">ISCROSSFILTERED</code> function replaces the <code class="code-in-text--packt">ISFILTERED</code> function used in the earlier example to test if any column from the <strong class="screentext">Sales Territories</strong> dimension table is being used as a filter.</p>
    <p class="book-title--packt">Test the new measure by applying filters on columns that would reduce the available or remaining values, as shown in <em class="italic">Figure 8.20</em>.</p>
    <figure class="mediaobject"><img src="images/000087.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 8.20: Regions Remaining and Subcategories Remaining measures</p>
    <p class="book-title--packt">The <strong class="screentext">SalesTerritoryRegion</strong> and <strong class="screentext">Product Subcategory</strong> columns are impacted by filters applied to the <strong class="screentext">SalesTerritoryGroup</strong> and <strong class="screentext">Product Category</strong> columns, respectively. Given the number of characters<a id="calibre_link-942" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in the text string of 15 product subcategories, only the number remaining<a id="calibre_link-861" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is displayed.</p>
    <p class="book-title--packt">Note that these remaining expressions will return the same string values as the first example, when filters are applied directly on the given column. For example, if the <strong class="screentext">Northwest</strong> and <strong class="screentext">Northeast</strong> regions were selected on a sales territory region slicer, these would be the only two regions remaining. The techniques applied in these two examples can be blended or enriched further, such as by associating a numeric measure with each dimension value returned by the delimited string.</p>
    <h2 id="calibre_link-1778" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">DAX<a id="calibre_link-348" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> <code class="code-in-text--packt">FILTERS</code> function: <a href="https://bit.ly/3aAVTFB" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3aAVTFB</span></a></li>
      <li class="bullet">DAX<a id="calibre_link-338" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> <code class="code-in-text--packt">CONCATENATEX</code> function: <a href="https://bit.ly/3sVmvHQ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3sVmvHQ</span></a></li>
      <li class="bullet">DAX<a id="calibre_link-352" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> <code class="code-in-text--packt">ISCROSSFILTERED</code> function: <a href="https://bit.ly/3vo13gr" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3vo13gr</span></a></li>
    </ul>
    <h1 id="calibre_link-1260" class="title">Avoiding Manual User Clicks</h1>
    <p class="book-title--packt">A common scenario in BI projects<a id="calibre_link-579" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is the need to customize a core set of reports and dashboards to better align with the responsibilities and analytical needs of specific roles or users within a larger team or organizational function. A given business user should, ideally, have immediate and default visibility to relevant data without the need to interact with or modify content, such as applying filter selections. </p>
    <p class="book-title--packt">Power BI's extensive self-service capabilities are sometimes a solution&mdash;or part of it&mdash;to this need, and additional role-specific, IT-supported reports and dashboards are another realistic option.</p>
    <p class="book-title--packt">A third option, and the one that is the subject<a id="calibre_link-580" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> of this recipe, is to embed user-based dynamic filtering logic into DAX measures. With this approach, a single or small group of reports and dashboards can be leveraged across multiple levels of an organization, thus avoiding the need for new report development.</p>
    <h2 id="calibre_link-1779" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <strong class="screentext">AdWorksDW</strong>, similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <strong class="screentext">AdWorksDW</strong> query and place into a <strong class="screentext">Data Sources </strong>query group</li>
      <li class="calibre12">Right-click the <strong class="screentext">AdWorksDW</strong> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Internet Sales</strong> and choose the <strong class="screentext">FactInternetSales</strong> table</li>
      <li class="calibre12">Repeat steps <em class="italic">4</em> and <em class="italic">5</em> for a query named <strong class="screentext">Sales Territories</strong> that points to the <strong class="screentext">DimSalesTerritory</strong> table, and a query named <strong class="screentext">Customers</strong> that points to the <strong class="screentext">DimCustomers</strong> table</li>
      <li class="calibre12">Edit the <strong class="screentext">Customers</strong> query to expand the <strong class="screentext">DimGeography</strong> column:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimCustomer = Source{[Schema="dbo",Item="DimCustomer"]}[Data],
    ExpandGeography = Table.ExpandRecordColumn(
        dbo_DimCustomer, "DimGeography", 
        {"City", "StateProvinceName", "EnglishCountryRegionName", "PostalCode"}, 
        {"City", "StateProvinceName", "EnglishCountryRegionName", "PostalCode"})
in
    ExpandGeography
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> query to a query group called <strong class="screentext">Facts</strong>, and the <strong class="screentext">Sales Territories</strong> and <strong class="screentext">Customers</strong> queries<a id="calibre_link-581" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to a query group called <strong class="screentext">Dimensions</strong></li>
      <li class="calibre12">Create an <strong class="screentext">Enter Data</strong> query named <strong class="screentext">Sales User Roles</strong> in the <strong class="screentext">Dimensions</strong> query group with the following information:<table id="calibre_link-1780" class="no-table-style">
          <colgroup class="calibre15">
            <col class="calibre16"></col>
            <col class="calibre16"></col>
            <col class="calibre16"></col>
          </colgroup>
          <tbody class="calibre17">
            <tr class="no-table-style1">
              <td class="no-table-style2">
                <p class="table-column-heading--packt">EmailAddress</p>
              </td>
              <td class="no-table-style2">
                <p class="table-column-heading--packt">SalesTerritoryKey</p>
              </td>
              <td class="no-table-style2">
                <p class="table-column-heading--packt">UserRole</p>
              </td>
            </tr>
            <tr class="no-table-style3">
              <td class="no-table-style2">
                <p class="table-column-heading--packt"><code class="code-in-text--packt1">david8@adventure-works.com</code></p>
              </td>
              <td class="no-table-style2">
                <p class="table-column-heading--packt"><code class="code-in-text--packt1">2</code></p>
              </td>
              <td class="no-table-style2">
                <p class="table-column-heading--packt"><code class="code-in-text--packt1">Country</code></p>
              </td>
            </tr>
            <tr class="no-table-style1">
              <td class="no-table-style2">
                <p class="table-column-heading--packt"><code class="code-in-text--packt">linda3@adventure-works.com</code></p>
              </td>
              <td class="no-table-style2">
                <p class="table-column-heading--packt"><code class="code-in-text--packt">4</code></p>
              </td>
              <td class="no-table-style2">
                <p class="table-column-heading--packt"><code class="code-in-text--packt">Region</code></p>
              </td>
            </tr>
            <tr class="no-table-style3">
              <td class="no-table-style2">
                <p class="table-column-heading--packt"><code class="code-in-text--packt1">pamela0@adventure-works.com</code></p>
              </td>
              <td class="no-table-style2">
                <p class="table-column-heading--packt"><code class="code-in-text--packt1">6</code></p>
              </td>
              <td class="no-table-style2">
                <p class="table-column-heading--packt"><code class="code-in-text--packt1">Group</code></p>
              </td>
            </tr>
          </tbody>
        </table>
      </li>
      <li class="calibre12">In the <strong class="screentext">Other Queries</strong> group, create a <strong class="screentext">Blank</strong> query called <strong class="screentext">Calculations</strong></li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">SalesTerritoryKey</strong> columns of the <strong class="screentext">Sales Territories</strong> and <strong class="screentext">Internet Sales</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">SalesTerritoryKey</strong> columns of the <strong class="screentext">Sales Territories</strong> and <strong class="screentext">Sales User Roles</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">CustomerKey</strong> columns of the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Customers</strong> tables</li>
      <li class="calibre12">Set the <strong class="screentext">Data category</strong> for the <strong class="screentext">Postal Code</strong> column in the <strong class="screentext">Customers</strong> table to <strong class="screentext">Postal Code</strong></li>
      <li class="calibre12">Save your work</li>
    </ol>
    <p class="book-title--packt">The model should now look the same as that shown in <em class="italic">Figure 8.21</em>.</p>
    <figure class="mediaobject"><img src="images/000100.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 8.21: The model for this recipe</p>
    <h2 id="calibre_link-1781" class="calibre8">How to Avoid Manual User Clicks</h2>
    <p class="book-title--packt">To implement<a id="calibre_link-582" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create the following DAX measures in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">User Principal Name = "david8@adventure-works.com"
User Sales Territory Key = LOOKUPVALUE('Sales User Roles'[SalesTerritoryKey],
    'Sales User Roles'[EmailAddress],[User Principal Name])
User Sales Role = 
    VAR RoleLookup = LOOKUPVALUE('Sales User Roles'[UserRole],
        'Sales User Roles'[EmailAddress],[User Principal Name])
RETURN IF(ISBLANK(RoleLookup),"Role Not Found",RoleLookup)
User Sales Group = IF([User Sales Role] = "Role Not Found", 
    "Role Not Found", LOOKUPVALUE('Sales Territories'[SalesTerritoryGroup],
        'Sales Territories'[SalesTerritoryKey],[User Sales Territory Key]))
User Sales Country = IF([User Sales Role] = "Role Not Found", 
    "Role Not Found", LOOKUPVALUE('Sales Territories'[SalesTerritoryCountry],
    'Sales Territories'[SalesTerritoryKey],[User Sales Territory Key]))
User Sales Region = IF([User Sales Role] = "Role Not Found", 
    "Role Not Found", LOOKUPVALUE('Sales Territories'[SalesTerritoryRegion],
    'Sales Territories'[SalesTerritoryKey],[User Sales Territory Key]))
</code></pre>
      </li>
      <li class="calibre12">Create two DAX measures<a id="calibre_link-1782" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in the <strong class="screentext">Calculations</strong> table to detect the filter context of the <strong class="screentext">Sales Territories</strong> table, and to filter the <strong class="screentext">Internet Sales </strong>table as appropriate:
        <pre class="programlisting"><code class="hljs">Sales Territory Detection = IF(ISCROSSFILTERED('Sales Territories'),
    "Filters Applied", "No Filters")
Internet Sales Amount = SWITCH(TRUE(), 
    [Sales Territory Detection] = "Filters Applied" || 
        [User Sales Role] = "Role Not Found",SUM('Internet Sales'[SalesAmount]), 
        [User Sales Role] = "Group",
            CALCULATE(SUM('Internet Sales'[SalesAmount]),
            FILTER(ALL('Sales Territories'),
                'Sales Territories'[SalesTerritoryGroup] = [User Sales Group])), 
        [User Sales Role] = "Country",
            CALCULATE(SUM('Internet Sales'[SalesAmount]),
            FILTER(ALL('Sales Territories'),
                'Sales Territories'[SalesTerritoryCountry] = 
                    [User Sales Country])), 
        [User Sales Role] = "Region",
            CALCULATE(SUM('Internet Sales'[SalesAmount]),
            FILTER(ALL('Sales Territories'),
                'Sales Territories'[SalesTerritoryRegion] = 
                    [User Sales Region])) )
</code></pre>
      </li>
      <li class="calibre12">Create a standard report with the new measure and the <strong class="screentext">Sales Territory</strong> table to test or demonstrate the logic<figure class="mediaobject"><img src="images/000113.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 8.22: Default filter context for the user Pamela, a group role member for North America</p>
      </li>
      <li class="calibre12">Change the <strong class="screentext">User Principal Name</strong> measure to test the three different roles</li>
    </ol>
    <h2 id="calibre_link-1783" class="calibre8">How it works</h2>
    <p class="book-title--packt">In a production<a id="calibre_link-583" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> environment, the <strong class="screentext">User Principal Name</strong> measure would not be hardcoded to an email address, but would rather be of the following formula:</p>
    <pre class="programlisting"><code class="hljs">User Principal Name = USERPRINCIPALNAME()
</code></pre>
    <p class="book-title--packt">In addition, a production implementation would store the <strong class="screentext">Sales User Roles</strong> table in the SQL data warehouse instead of using an <strong class="screentext">Enter Data</strong> query.</p>
    <p class="book-title--packt">The measures in this recipe build on one another, culminating in the <strong class="screentext">Internet Sales Amount</strong> measure. The purpose of these measures is to provide a specific default filter context to apply to a measure (<strong class="screentext">Internet Sales Amount</strong>). A country role member, for example, should see data filtered by his or her country by default when opening the report. However, conditional logic can also allow for user filter selections to be applied, allowing for additional visibility as an option as well.</p>
    <p class="book-title--packt">The <strong class="screentext">Sales Territory Detection</strong> measure is fundamental to this approach. If no columns on the <strong class="screentext">Sales Territories</strong> table have been filtered, such as via slicers, then the sales measure should default to a specific filter context based on the user. If filter selections have been made on <strong class="screentext">Sales Territories</strong> columns, then these selections should be used by the measure.</p>
    <p class="book-title--packt">The <strong class="screentext">Internet Sales Amount</strong> measure defaults to summing the <strong class="screentext">SalesAmount</strong> column in the <strong class="screentext">Internet Sales</strong> table if the current user is not found in the <strong class="screentext">Sales User Roles</strong> table. If a role is identified for the user and no filters<a id="calibre_link-584" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> have been applied on the <strong class="screentext">Sales Territories</strong> table, a filter at the user's role level (<strong class="screentext">Group</strong>, <strong class="screentext">Country</strong>, or <strong class="screentext">Region</strong>) and the specific dimension member is applied.</p>
    <h2 id="calibre_link-1784" class="calibre8">There's more</h2>
    <p class="book-title--packt">The five DAX measures exposed in the top-left card visual of the sample reports are defined as follows:</p>
    <pre class="programlisting"><code class="hljs">User Role Status = "My Sales Role: " &amp; [User Sales Role]
Sales Group Status = "My Group: " &amp; [User Sales Group]
Sales Country Status = "My Country: " &amp; [User Sales Country]
Sales Region Status = "My Region: " &amp; [User Sales Region]
Filter Status = VAR Prefix = "Sales Territory Filter Status: "
RETURN IF([Sales Territory Detection] = "No Filters",
    Prefix &amp; "Role Based",Prefix &amp; "User Defined")
</code></pre>
    <h2 id="calibre_link-1785" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">DAX<a id="calibre_link-355" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> <code class="code-in-text--packt">LOOKUPVALUE</code> function: <a href="https://bit.ly/3gdjZKl" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3gdjZKl</span></a></li>
    </ul>
    <h1 id="calibre_link-1261" class="title">Conclusion</h1>
    <p class="book-title--packt">This chapter contains detailed examples of building and deploying dynamic, user-based security for both import and DirectQuery datasets as well as examples of dynamic filter context functionality to enhance the user experience. Data security where users or groups of users are prevented from viewing a portion of a dataset is often a top requirement in Power BI deployments and security implementations can range from simple to complex. Given the variety of use cases and the importance of this feature to securely share a dataset across stakeholders, it is important to understand the process and techniques available for developing, testing, and operationalizing data security roles.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-9">
<div id="calibre_link-1786" class="calibre2">
<div id="calibre_link-1787" class="calibre3"><div id="calibre_link-1788" class="calibre4">
    <h1 class="heading">9</h1>
    <h1 id="calibre_link-1262" class="title">Applying Advanced Analytics and Custom&nbsp;Visuals</h1>
    <p class="book-title--packt">Power BI Desktop's standard report authoring tools provide a robust foundation for the development of rich BI and analytical content. Custom visualizations developed by Microsoft and third parties further supplement these capabilities with their own unique features and can be integrated with standard visuals in Power BI reports and dashboards. Additionally, geospatial analysis features such as the ArcGIS maps visual for Power BI, custom dimension groupings, and animation and annotation options further aid in the extraction of meaning from data and also support sharing these insights with others.</p>
    <p class="book-title--packt">Power BI Desktop also includes advanced analytics features reflecting modern data science tools and algorithms, including clustering, forecasting, and support for custom R and Python scripts and visuals. For example, an analytics pane is available to enrich visuals with additional metrics, such as a trend line, and the Quick Insights feature empowers report authors to rapidly analyze specific questions and generate new visualizations.</p>
    <p class="book-title--packt">This chapter contains a broad mix of recipes highlighting many of the latest and most popular custom visualization and advanced analytics features of Power BI. This includes top custom visuals such as bullet charts, the ArcGIS maps visual for Power BI, and data storytelling via animation and annotation. Additionally, examples are provided on leveraging Power BI datasets and the DAX, R, and Python languages to embed custom statistical analyses and visualizations, respectively.</p>
    <p class="book-title--packt">In this chapter, we will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Incorporating Advanced Analytics</li>
      <li class="bullet">Enriching Content with Custom Visuals and Quick Insights</li>
      <li class="bullet">Creating Geospatial Mapping with ArcGIS Maps</li>
      <li class="bullet">Democratizing Artificial Intelligence</li>
      <li class="bullet">Building Animation and Storytelling</li>
      <li class="bullet">Embedding Statistical Analyses</li>
      <li class="bullet">Grouping and Binning</li>
      <li class="bullet">Detecting and Analyzing Clusters</li>
      <li class="bullet">Forecasting and Anomaly Detection</li>
      <li class="bullet">Using R and Python Visuals</li>
    </ul>
    <h1 id="calibre_link-1263" class="title">Technical Requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop</li>
      <li class="bullet">SQL Server with the <strong class="screentext">AdventureWorksDW2019</strong> database installed. This database and instructions for installing it are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a></li>
      <li class="bullet">Files for this chapter and can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a></li>
    </ul>
    <h1 id="calibre_link-1264" class="title">Incorporating Advanced Analytics</h1>
    <p class="book-title--packt">The standard<a id="calibre_link-27" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> line, scatter, column, and bar chart visualization types available in Power BI Desktop, which generally represent the majority of Power BI report content, given their advantages in visual comprehension, can be further enhanced via a dedicated analytics pane. Similar to visual-level filters, the Power BI analytics pane creates measures scoped to the specific visual, such as trend lines, constant lines, percentile lines, min, max, and average. This additional logic provides greater context to the visual and avoids the need to author complex or visual-specific DAX measures.</p>
    <blockquote class="packt_quote pcalibre6">"This pane is our home for all of our analytics features and you'll be able to use this to augment your charts with any kind of additional analytics that you need."<p class="cite">- Amanda Cofsky Rivera, Power BI Program Manager</p></blockquote>
    
    <p class="book-title--packt">This recipe includes two examples of leveraging the analytics pane in Power BI Desktop to raise the analytical value of chart visuals: one for a clustered column chart and another for a line chart. The predictive forecasting feature built into the analytics pane is described in the <em class="italic">Forecasting and Anomaly Detection</em> recipe later in this chapter.</p>
    <h2 id="calibre_link-1789" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12">Open a new file in Power BI Desktop</li>
      <li class="calibre12">Click <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">In the <strong class="screentext">Power Query Editor</strong>, create a new query called <code class="code-in-text--packt">Internet Sales</code> that imports the <strong class="screentext">FactInternetSales</strong> table in the <strong class="screentext">AdventureWorksDW2019</strong> database</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
    </ol>
    <h2 id="calibre_link-1790" class="calibre8">How to Incorporate Advanced Analytics</h2>
    <p class="book-title--packt">To implement <a id="calibre_link-28" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Report</strong> view, create a clustered column chart visualization using the <strong class="screentext">OrderDate</strong> column of the <strong class="screentext">Internet Sales</strong> table as the <strong class="screentext">Axis</strong> and the <strong class="screentext">average of the UnitPrice</strong> column as <strong class="screentext">Values</strong></li>
      <li class="calibre12">In the <strong class="screentext">Axis</strong> field well of the <strong class="screentext">Visualizations</strong> pane, select the dropdown under the <strong class="screentext">OrderDate</strong> column and switch from <strong class="screentext">Date Hierarchy</strong> to <strong class="screentext">OrderDate</strong>
        <figure class="mediaobject"><img src="images/000124.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.1: The automatic Date Hierarchy when a date column is added to a visual</p>
      </li>
      <li class="calibre12">Use the <strong class="screentext">Filters</strong> pane to only display values from <strong class="screentext">1/1/2013</strong> to <strong class="screentext">4/1/2013</strong></li>
      <li class="calibre12">In the <strong class="screentext">Visualizations</strong> pane, click on the <strong class="screentext">Analytics</strong> pane (the magnifying glass icon)</li>
      <li class="calibre12">Open the <strong class="screentext">Trend Line</strong> card, click <strong class="screentext">Add</strong>, and apply the <strong class="screentext">Color</strong> black, a <strong class="screentext">Dashed</strong> line <strong class="screentext">Style</strong>, and <strong class="screentext">Transparency</strong> of <strong class="screentext">0%</strong></li>
      <li class="calibre12">Add <strong class="screentext">Min</strong>, <strong class="screentext">Max</strong>, and <strong class="screentext">Median</strong> lines to the visual from the respective card in the <strong class="screentext">Analytics</strong> pane</li>
      <li class="calibre12">Set the names of these lines, <strong class="screentext">Min:</strong>, <strong class="screentext">Max:</strong>, and <strong class="screentext">Median:</strong>, respectively, along with the <strong class="screentext">Color</strong> black, <strong class="screentext">Transparency</strong> of <strong class="screentext">0%</strong>, and line <strong class="screentext">Style</strong> of <strong class="screentext">Solid</strong></li>
      <li class="calibre12">For each <strong class="screentext">Min</strong>, <strong class="screentext">Max</strong>, and <strong class="screentext">Median</strong> line, toggle <strong class="screentext">Data</strong> <strong class="screentext">label</strong> to <strong class="screentext">On</strong> and set <strong class="screentext">Text</strong> to <strong class="screentext">Name and value</strong></li>
      <li class="calibre12">Format the <a id="calibre_link-29" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>colors of the columns to contrast with the analytics lines<figure class="mediaobject"><img src="images/000136.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.2: Clustered column chart with 4 dynamic lines from the analytics pane: Trend, Min, Max, and Median</p>
    <h2 id="calibre_link-1791" class="calibre8">How it works...</h2>
    <p class="book-title--packt">In this example, since a date data type column was used as the axis, the trend line calls out the decline in the average daily unit prices in the first quarter of 2013. Given the volume of individual dates, the <strong class="screentext">Min</strong>, <strong class="screentext">Max</strong>, and <strong class="screentext">Median</strong> lines give the user quick takeaways, such as the median daily unit price for an entire quarter, and the option to further analyze sales activity on February 11, when daily unit prices reached a low (<strong class="screentext">Min</strong>) of $93 per unit.</p>
    <p class="book-title--packt">The selections applied in the <strong class="screentext">Analytics</strong> pane result in new expressions added to the DAX query of the visual. The analytics calculations are translated into the equivalent DAX expressions (i.e., <code class="code-in-text--packt">MINX</code>, <code class="code-in-text--packt">AVERAGEX</code>) and passed into the <code class="code-in-text--packt">GROUPBY</code> table function. Running a SQL Server Profiler trace against a Power BI Desktop file and viewing the full DAX query associated with a given visual (including all filters applied) is a great way to understand advanced DAX functions and filter context. In Windows Task Manager, you can identify the <strong class="screentext">Process ID</strong> (<strong class="screentext">PID</strong>) associated with Power BI Desktop's <code class="code-in-text--packt">msmdsrv.exe</code> process. Alternatively, you <a id="calibre_link-859" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>can use the <code class="code-in-text--packt">TASKLIST</code> command from Command Prompt; run <code class="code-in-text--packt">netstat</code> <code class="code-in-text--packt">-anop tcp</code>, find the local port (in the <strong class="screentext">local address</strong> column) associated with this process, and pass this value to SQL Server Profiler.</p>
    <figure class="mediaobject"><img src="images/000149.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 9.3: A SQL Server profile trace of a Power BI file using the Analytics pane for Min, Max, and Average</p>
    <h2 id="calibre_link-1792" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Line charts<a id="calibre_link-25" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> support even more analytics features than most other visuals, including forecasting and X-axis constant lines. To see line chart analytics in action, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a measure called <code class="code-in-text--packt">Margin % </code>using the following formula:
        <pre class="programlisting"><code class="hljs">Margin % = 
    VAR __Price = SUM('Internet Sales'[SalesAmount])
    VAR __Cost = SUM('Internet Sales'[TotalProductCost])
RETURN DIVIDE(__Price - __Cost,__Price,0)
</code></pre>
      </li>
      <li class="calibre12">In the <strong class="screentext">Report</strong> view, create a <strong class="screentext">Line chart</strong> visualization using <strong class="screentext">OrderDate</strong> (the column not the hierarchy) as the <strong class="screentext">Axis</strong> and <code class="code-in-text--packt">Margin %</code> as <strong class="screentext">Values</strong></li>
      <li class="calibre12">Use the <strong class="screentext">Filters</strong> pane to only display values from <code class="code-in-text--packt">1/1/2013</code> to <code class="code-in-text--packt">4/1/2013</code></li>
      <li class="calibre12">In the <strong class="screentext">Analytics</strong> pane, add a <strong class="screentext">Y-Axis Constant line</strong> named <strong class="screentext">Target:</strong> with a <strong class="screentext">Value</strong> of <code class="code-in-text--packt">0.4</code></li>
      <li class="calibre12">Add an <strong class="screentext">X-Axis Constant Line</strong> called <strong class="screentext">End of Quarter:</strong> for <code class="code-in-text--packt">3/31/2013</code></li>
      <li class="calibre12">Add a <strong class="screentext">Min</strong> line called <strong class="screentext">Min:</strong> and a <strong class="screentext">Max</strong> line called <strong class="screentext">Max:</strong>, with a <strong class="screentext">Color</strong> of black and a <strong class="screentext">Line style</strong> of <strong class="screentext">Solid</strong></li>
      <li class="calibre12">Add a <strong class="screentext">Percentile line</strong> called <strong class="screentext">75%</strong> <strong class="screentext">Percentile</strong> and set <strong class="screentext">Percentile</strong> to <strong class="screentext">75%</strong></li>
      <li class="calibre12">For all lines, toggle <strong class="screentext">Data label</strong> to <strong class="screentext">On</strong> and set <strong class="screentext">Text</strong> to <strong class="screentext">Name and value</strong></li>
      <li class="calibre12">Add a <strong class="screentext">Forecast</strong> of <strong class="screentext">1 Month(s)</strong> with a <strong class="screentext">Confidence interval</strong> of <strong class="screentext">75%</strong> and <strong class="screentext">Seasonality</strong> of <strong class="screentext">60 points</strong>
        <figure class="mediaobject"><img src="images/000162.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.4: Line chart with analytics lines and forecast</p>
    <p class="book-title--packt">In this example, 40 percent is considered a key profitability threshold, and thus a constant line<a id="calibre_link-26" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> helps to call out values below this level. Additionally, the percentile line set at 75 percent helps to identify the top quartile of values. The lines from the <strong class="screentext">Analytics</strong> pane (and their formatting) provide more analytical value to users without requiring additional DAX measures for the model or cluttering the visual.</p>
    <h2 id="calibre_link-1793" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power BI<a id="calibre_link-752" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Analytics pane documentation: <a href="http://bit.ly/2s2fA0P" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2s2fA0P</span></a></li>
      <li class="bullet">How to<a id="calibre_link-785" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> trace a Power BI Desktop file: <a href="http://bit.ly/2tYRLZg" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2tYRLZg</span></a></li>
    </ul>
    <h1 id="calibre_link-1265" class="title">Enriching Content with Custom Visuals and Quick Insights</h1>
    <p class="book-title--packt">Custom<a id="calibre_link-211" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> visuals for Power BI can be reviewed and <a id="calibre_link-934" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>downloaded from AppSource to provide additional features and options beyond those supported by the standard visuals of Power BI Desktop. Over 300 custom visuals are currently available in AppSource with many of these having been developed by Microsoft to address common needs, such as the bullet, histogram, and Gantt charts. Other custom visuals available in AppSource have been developed by third parties but validated for security by Microsoft, with these visuals having unique and powerful capabilities, such as flow map network visualization and the interactive visuals developed by ZoomCharts. In addition to custom visuals, <strong class="screentext">Quick Insights</strong> can be used in the Power BI service and in Power BI Desktop to apply advanced analytics algorithms against datasets to extract insights, such as trends or relationships, and rapidly generate new visualizations for use in reports and dashboards.</p>
    <p class="book-title--packt">Custom visuals should only be used when they deliver a highly valuable or required functionality that is not provided by standard visuals. This is because custom visuals are often much less performant than standard visuals and are less reliable. Moreover, custom visuals are more difficult to support as report authors are less familiar with the specific options associated with custom visuals relative to standard visuals.</p>
    <p class="book-title--packt">This recipe includes an example of accessing and utilizing the bullet chart custom visual in Power<a id="calibre_link-1794" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> BI <a id="calibre_link-1795" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Desktop and an example of the Quick Insights feature in the Power BI service.</p>
    <h2 id="calibre_link-1796" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a new file in Power BI Desktop</li>
      <li class="calibre12">Click <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">In the Power Query Editor, create a new query called <strong class="screentext">Internet Sales</strong> that imports the <strong class="screentext">FactInternetSales</strong> table in the <strong class="screentext">AdventureWorksDW2019</strong> database:</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab
        <pre class="programlisting"><code class="hljs">   Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019"),
    Navigation = Source{[Schema="dbo",Item="FactInternetSales"]}[Data],
    ExpandedDimSalesTerritory = Table.ExpandRecordColumn(
        Navigation, "DimSalesTerritory", 
        {"SalesTerritoryCountry"}, {"SalesTerritoryCountry"})
in
    ExpandedDimSalesTerritory
</code></pre>
      </li>
      <li class="calibre12">In the <strong class="screentext">Visualizations</strong> pane, click the ellipsis (<strong class="screentext">â¦</strong>) and choose <strong class="screentext">Get more visuals</strong>
        <figure class="mediaobject"><img src="images/000175.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.5: Import custom visuals from AppSource</p>
      </li>
      <li class="calibre12">Use <strong class="screentext">Search</strong> to find the certified (blue star/checkmark icon) <strong class="screentext">Bullet Chart</strong> visualization and click the <strong class="screentext">Add</strong> button<figure class="mediaobject"><img src="images/000188.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.6: Adding a custom visual from Power BI Desktop</p>
    <h2 id="calibre_link-1797" class="calibre8">How to Enrich Content with Custom Visuals and Quick Insights</h2>
    <p class="book-title--packt">To <a id="calibre_link-212" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>implement<a id="calibre_link-935" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create the following measures:
        <pre class="programlisting"><code class="hljs">Sales 2011 = SUMX(FILTER('Internet Sales',YEAR([OrderDate])=2011),[SalesAmount])
Sales 2012 = SUMX(FILTER('Internet Sales',YEAR([OrderDate])=2012),[SalesAmount])
Sales 2012 Improve = [Sales 2011] * .7
Sales 2012 Sat = [Sales 2011] * .8
Sales 2012 Good = [Sales 2011] * .9
Sales 2012 VG = [Sales 2011]
</code></pre>
      </li>
      <li class="calibre12">Select the Bullet Chart icon in the <code class="code-in-text--packt">Visualizations</code> pane to add it to the report canvas</li>
      <li class="calibre12">Configure the visual as follows:<ul class="calibre11">
          <li class="calibre12"><strong class="screentext">Category: SalesTerritoryCountry column</strong></li>
          <li class="calibre12"><strong class="screentext">Value: Sales 2012 measure</strong></li>
          <li class="calibre12"><strong class="screentext">Needs Improvement: Sales 2012 Improve measure</strong></li>
          <li class="calibre12"><strong class="screentext">Satisfactory: Sales 2012 Sat measure</strong></li>
          <li class="calibre12"><strong class="screentext">Good: Sales 2012 Good measure</strong></li>
          <li class="calibre12"><strong class="screentext">Very Good: Sales 2012 VG measure</strong></li>
        </ul>
        <figure class="mediaobject"><img src="images/000200.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.7: Bullet chart custom visual with data-driven ranges and threshold values</p>
      </li>
      <li class="calibre12">Publish <a id="calibre_link-213" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the<a id="calibre_link-936" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> report to the Power BI service</li>
      <li class="calibre12">Open the report in the Power BI service</li>
      <li class="calibre12">Pin the bullet chart visualization to a new dashboard</li>
      <li class="calibre12">Open the new dashboard</li>
      <li class="calibre12">In the upper right of the pinned tile, click the ellipsis (<strong class="screentext">â¦</strong>) and choose <strong class="screentext">View insights</strong></li>
      <li class="calibre12">The insights engine will produce insights visuals related to the data in the dashboard tile</li>
    </ol>
    <h2 id="calibre_link-1798" class="calibre8">How it works</h2>
    <p class="book-title--packt">In this example, six DAX measures, reflecting different values relative to the target measure (<strong class="screentext">Sales 2011</strong>), were used to drive the color thresholds and the minimum and maximum values of the bullets. Measures representing 70%, 80%, 90%, and 100% of the <strong class="screentext">Sales 2011</strong> measure were used to drive the color categories in the bullet chart. </p>
    <p class="book-title--packt">The bullet chart also supports manually entered target values and percentages of target values in the formatting pane. However, the data-driven approach with DAX measures is recommended, as this allows for the reuse of the calculations across other visuals, and makes it easy to adjust multiple reports when the target and threshold value logic changes.</p>
    <h2 id="calibre_link-1799" class="calibre8">There's more</h2>
    <p class="book-title--packt">The <strong class="screentext">Quick Insights</strong> feature <a id="calibre_link-937" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and analytics engine in the Power BI service is now available in Power BI Desktop. To see how this works, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a <code class="code-in-text--packt">Margin %</code> measure with the following code:
        <pre class="programlisting"><code class="hljs">Margin % = 
    VAR __Price = SUM('Internet Sales'[SalesAmount])
    VAR __Cost = SUM('Internet Sales'[TotalProductCost])
RETURN DIVIDE(__Price - __Cost,__Price,0)
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Line chart</strong> visualization with <strong class="screentext">Order Date</strong> (hierarchy, not the column) as the <strong class="screentext">Axis</strong> and the <code class="code-in-text--packt">Margin %</code> measure as the <strong class="screentext">Values</strong></li>
      <li class="calibre12">Right-click the data point in the chart for <strong class="screentext">2013</strong> and choose <strong class="screentext">Analyze</strong> and then <strong class="screentext">Explain the decrease</strong>
        <figure class="mediaobject"><img src="images/000211.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.8: The Analyze feature in Power BI Desktop</p>
    <p class="book-title--packt">The <strong class="screentext">Analyze</strong> option <a id="calibre_link-938" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>appears when right-clicking a specific data point, enabling additional visualizations to be generated specific to the selected item, such as a date on a line chart or a dimension value on a bar chart. The generated visuals can then be added to the Power BI Desktop file and edited just like all other visuals. The <strong class="screentext">Analyze</strong> option is the embodiment of the <strong class="screentext">Quick Insights</strong> feature and analytics engine within Power BI Desktop.</p>
    <p class="book-title--packt"><strong class="screentext">Quick Insights</strong> can also be executed against an entire dataset in the Power BI service. To run quick insights against a dataset, click the ellipsis for the given dataset and select <strong class="screentext">Get quick insights</strong>. The insights generated can be accessed from the same context menu via a <strong class="screentext">View Insights</strong> option. Each insight contains a Power BI visual, the title of the insight (algorithm) applied, such as outliers and correlation, and a short description. Visuals from <strong class="screentext">View Insights</strong> can also be pinned to new and existing dashboards.</p>
    <p class="book-title--packt"><strong class="screentext">Quick Insights</strong> applies sophisticated algorithms against datasets, including category outliers, correlation, change points in a time series, low variance, majority, seasonality in time series, and overall trends in time series. The insights engine is limited to a set duration of time to render its results.</p>
    <p class="book-title--packt"><strong class="screentext">Quick Insights</strong> visuals can be pinned to new and existing dashboards like other Power BI report and dashboard tiles. Additionally, Quick Insights can be executed against a visual that was previously generated by Quick Insights.</p>
    <p class="book-title--packt">The results from <strong class="screentext">Quick Insights</strong> can be improved by hiding or unhiding columns. <strong class="screentext">Quick Insights</strong> does not search hidden columns, so hiding (or removing) unnecessary columns can focus the<a id="calibre_link-1800" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> insights algorithms on only important columns. Likewise, any duplicate columns can be removed or hidden such that the time available for Quick Insights to run is used efficiently.</p>
    <h2 id="calibre_link-1801" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power<a id="calibre_link-754" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> BI custom visuals: <a href="https://bit.ly/3xY9GAk" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3xY9GAk</span></a></li>
      <li class="bullet">Certified Power BI visuals: <a href="https://bit.ly/2RETFPa" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2RETFPa</span></a></li>
      <li class="bullet">Generate data insights on your dataset automatically: <a href="https://bit.ly/33qJErt" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/33qJErt</span></a></li>
      <li class="bullet">Optimize<a id="calibre_link-274" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> your data for Power BI Quick Insights: <a href="https://bit.ly/3trWOPz" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3trWOPz</span></a></li>
    </ul>
    <h1 id="calibre_link-1266" class="title">Creating Geospatial Mapping with ArcGIS Maps</h1>
    <p class="book-title--packt">The ArcGIS <a id="calibre_link-515" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>mapping and spatial analytics<a id="calibre_link-86" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> software from ESRI, a market leader in <strong class="screentext">geographic information systems</strong> (<strong class="screentext">GISes</strong>), is <a id="calibre_link-514" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>built into Power BI Desktop to generate greater insights from the spatial component of data. Familiar report visualization field wells and the cross-filtering capabilities of Power BI can be combined with ArcGIS geospatial features and datasets, such as classification types, pins, and reference layers, to build custom, intelligent geographical visualizations into Power BI solutions.</p>
    <p class="book-title--packt">In this recipe, a custom geographical column is created to include multiple geographical attributes (i.e., <code class="code-in-text--packt">Street Address</code>, <code class="code-in-text--packt">City</code>, <code class="code-in-text--packt">and State</code>) to support accurate geocoding by the ArcGIS service. The ArcGIS visualization in Power BI Desktop is then used to plot customer addresses into a <strong class="screentext">Cluster</strong> theme map visualization with supporting <strong class="screentext">Pins</strong> and <strong class="screentext">Infographics</strong>.</p>
    <h2 id="calibre_link-1802" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the Power BI service, click on <strong class="screentext">Settings</strong> (the gear icon) in the top right and enable ArcGIS maps on the <strong class="screentext">General</strong> tab. This requires administrative access to the Power BI service.<figure class="mediaobject"><img src="images/000223.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.9: General settings dialog in Power BI service</p>
      </li>
      <li class="calibre12">Open<a id="calibre_link-87" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> a <a id="calibre_link-516" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>new file in Power BI Desktop.</li>
      <li class="calibre12">Click <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">In the Power Query Editor, create a new query called <strong class="screentext">Customers</strong> using the following code (editing the <strong class="screentext">Source</strong> line):
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019"),
    dbo_DimCustomer = Source{[Schema="dbo",Item="DimCustomer"]}[Data],
    ExpandGeography = Table.ExpandRecordColumn(dbo_DimCustomer, "DimGeography", 
        {"City", "StateProvinceCode", "EnglishCountryRegionName", "PostalCode", 
            "DimSalesTerritory"}, 
        {"City", "StateProvinceCode", "EnglishCountryRegionName", "PostalCode", 
            "DimSalesTerritory"}),
    ExpandSalesTerritory = Table.ExpandRecordColumn(ExpandGeography, 
        "DimSalesTerritory", {"SalesTerritoryRegion"}, {"SalesTerritoryRegion"}),
    DupCity = Table.DuplicateColumn(ExpandSalesTerritory, "City", "City1"),
    DupZip = Table.DuplicateColumn(DupCity, "PostalCode", "Zip"),    
    Address = Table.CombineColumns(DupZip,
        {"AddressLine1", "City1", "StateProvinceCode"},
        Combiner.CombineTextByDelimiter(", ", QuoteStyle.None),"Address"),
    FullAddress = Table.CombineColumns(Address,{"Address", "Zip"},
        Combiner.CombineTextByDelimiter(" ", QuoteStyle.None),"Full Address")
in
    FullAddress
</code></pre>
      </li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from<a id="calibre_link-517" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <a id="calibre_link-88" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">In Power BI Desktop, select the <strong class="screentext">City</strong> column in the <strong class="screentext">Customers</strong> table and assign a <strong class="screentext">Data category</strong> of <strong class="screentext">City</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">Full Address</strong> column in the <strong class="screentext">Customers</strong> table and assign a <strong class="screentext">Data category</strong> of <strong class="screentext">Address</strong>.</li>
    </ol>
    <h2 id="calibre_link-1803" class="calibre8">How to Create Geospatial Mapping with ArcGIS Maps</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Apply a page-level filter using the <strong class="screentext">SalesTerritoryRegion</strong> column in the <strong class="screentext">Customers</strong> table, and select <strong class="screentext">Southwest</strong> only</li>
      <li class="calibre12">In the <strong class="screentext">Visualizations</strong> pane, select the <strong class="screentext">ArgGIS Maps for Power BI</strong> visualization and then expand the visualization's size to the entire page</li>
      <li class="calibre12">From the <strong class="screentext">Customers</strong> table, add the <strong class="screentext">Full Address</strong> column for <strong class="screentext">Location</strong>, the <strong class="screentext">CustomerKey</strong> column for <strong class="screentext">Size</strong>, and the <strong class="screentext">YearlyIncome</strong> column for <strong class="screentext">Color</strong></li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, expand <strong class="screentext">Location type</strong> and choose <strong class="screentext">United States</strong>
        <figure class="mediaobject"><img src="images/000234.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.10: Setting the ArcGIS Location type</p>
      </li>
      <li class="calibre12">In the upper left of the ArcGIS map visualization, select <strong class="screentext">Expand map tools</strong></li>
      <li class="calibre12">Click the <strong class="screentext">Layer list</strong> icon and then the vertical ellipsis next to <strong class="screentext">Full Address</strong> and choose <strong class="screentext">Symbology</strong>
        <figure class="mediaobject"><img src="images/000247.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.11: Change the Symbology of the map layer</p>
      </li>
      <li class="calibre12">Scroll <a id="calibre_link-518" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>down <a id="calibre_link-89" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and choose <strong class="screentext">Clustering</strong></li>
      <li class="calibre12">In <strong class="screentext">Map tools</strong>, click <strong class="screentext">Analysis</strong> <strong class="screentext">tools</strong> (the wrench icon) and then <strong class="screentext">Reference layer</strong></li>
      <li class="calibre12">Click <strong class="screentext">Add</strong> under <strong class="screentext">2020 USA Per Capita Income</strong></li>
      <li class="calibre12">Close the <strong class="screentext">Reference layer</strong> dialog, click <strong class="screentext">Analysis tools</strong> again, and this time choose <strong class="screentext">Infographics</strong></li>
      <li class="calibre12">Add infographics for <strong class="screentext">Average household</strong> size and <strong class="screentext">Median Disposable Income by Age</strong></li>
      <li class="calibre12">In <strong class="screentext">Map tools</strong>, click on the <strong class="screentext">Search</strong> icon (the magnifying glass), type <code class="code-in-text--packt">sherman</code>, and choose <strong class="screentext">Sherman Oaks, CA, USA</strong> to add a pin on the map</li>
      <li class="calibre12">In <strong class="screentext">Map tools</strong>, click <strong class="screentext">Analysis tools</strong> (the wrench icon) and choose <strong class="screentext">Drive time</strong></li>
      <li class="calibre12">Select the pin, enter <code class="code-in-text--packt">10</code> for the <strong class="screentext">Distance</strong> for the radius, and select <strong class="screentext">OK</strong>
        <figure class="mediaobject"><img src="images/000258.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.12: Formatted cluster theme map with a pin, analytic layer, drive time radius, and two infographics</p>
    <p class="book-title--packt">The<a id="calibre_link-90" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> visual is<a id="calibre_link-519" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> fully interactive; the clusters and the infographic numbers all update dynamically as the zoom of the visual is changed and as different geographic areas are navigated to, such as San Francisco, CA. A common alternative to the clustering theme is the heat map, and the dark-gray canvas base map is an alternative base map that can help visualize bright colors.</p>
    <h2 id="calibre_link-1804" class="calibre8">How it works</h2>
    <p class="book-title--packt">Setting <strong class="screentext">Location type</strong> provides a geographic hint that significantly improves the accuracy of the plotted points returned by the ESRI service. Note that locations can also be represented as boundaries, such as states or postal codes. Almost all the advanced report development features provided by ArcGIS are exposed in the Power BI visualization.</p>
    <p class="book-title--packt">If <strong class="screentext">latitude</strong> and <strong class="screentext">longitude</strong> columns are already available for the dimension to be mapped, then these columns should be used in the ArcGIS visual instead of the <strong class="screentext">Location</strong> field well. Providing latitude and longitude source data significantly improves performance, as it eliminates the need for ESRI to compute these values.</p>
    <h2 id="calibre_link-1805" class="calibre8">There's more</h2>
    <p class="book-title--packt">A powerful analytical capability of ArcGIS for Power BI is its ability to set the classification algorithm. To see how this works, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Make a duplicate <a id="calibre_link-1806" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of <strong class="screentext">Page 1</strong> by right-clicking <strong class="screentext">Page 1</strong> and choosing <strong class="screentext">Duplicate page</strong></li>
      <li class="calibre12">In <strong class="screentext">Map tools</strong>, change<a id="calibre_link-1807" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Symbology</strong> of <strong class="screentext">Full Address</strong> to <strong class="screentext">Color</strong></li>
      <li class="calibre12">Scroll down to the <strong class="screentext">Classification type</strong> area and experiment with the various options<figure class="mediaobject"><img src="images/000269.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.13: ArcGIS classification options</p>
    <h2 id="calibre_link-1808" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">ArcGIS for<a id="calibre_link-85" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Power BI documentation: <a href="https://bit.ly/3vtMckC" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3vtMckC</span></a> </li>
    </ul>
    <h1 id="calibre_link-1267" class="title">Democratizing Artificial Intelligence</h1>
    <p class="book-title--packt">Recent additions<a id="calibre_link-92" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to Power BI's visualization library help democratize artificial intelligence by making machine learning intuitive and easy to use by end users. The <strong class="screentext">Key influencers</strong> and <strong class="screentext">Decomposition tree</strong> visualizations covered in this chapter, as well as other visuals like <strong class="screentext">Smart narrative</strong> and <strong class="screentext">Q&amp;A</strong>, leverage machine learning algorithms to analyze visualization data in real time to bring artificial intelligence insights to the masses. Machine learning is the process of analyzing data based purely on mathematical algorithms in order to identify patterns, key metrics, clusters, anomalies, and key categorizations.</p>
    <p class="book-title--packt">This recipe demonstrates how to configure and <a id="calibre_link-91" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>use the artificial intelligence capabilities of the <strong class="screentext">Key influencers</strong> and <strong class="screentext">Decomposition tree</strong> visualizations.</p>
    <h2 id="calibre_link-1809" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <code class="code-in-text--packt">AdWorksDW</code> query and place it into a <strong class="screentext">Data Sources</strong> query group</li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">AdWorksDW</code> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Internet Sales</strong> and choose the <strong class="screentext">FactInternetSales</strong> table</li>
      <li class="calibre12">Repeat <em class="italic">steps 4</em> and <em class="italic">5</em>, creating a <strong class="screentext">Dates</strong> query that points to the <strong class="screentext">DimDates</strong> table, and a <strong class="screentext">Sales Territories</strong> query that points to the <strong class="screentext">DimSalesTerritory</strong> table</li>
      <li class="calibre12">Create a <strong class="screentext">Customers</strong> query using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimCustomer = Source{[Schema="dbo",Item="DimCustomer"]}[Data],
    ExpandGeography = Table.ExpandRecordColumn(dbo_DimCustomer, "DimGeography", 
        {"City", "StateProvinceCode", "EnglishCountryRegionName", "PostalCode", 
            "DimSalesTerritory"}, 
        {"City", "StateProvinceCode", "EnglishCountryRegionName", "PostalCode", 
            "DimSalesTerritory"}),
    ExpandSalesTerritory = Table.ExpandRecordColumn(ExpandGeography, 
        "DimSalesTerritory", {"SalesTerritoryRegion"}, {"SalesTerritoryRegion"}),
    DupCity = Table.DuplicateColumn(ExpandSalesTerritory, "City", "City1"),
    DupZip = Table.DuplicateColumn(DupCity, "PostalCode", "Zip"),    
    Address = Table.CombineColumns(DupZip,
        {"AddressLine1", "City1", "StateProvinceCode"},
        Combiner.CombineTextByDelimiter(", ", QuoteStyle.None),"Address"),
    FullAddress = Table.CombineColumns(Address,{"Address", "Zip"},
        Combiner.CombineTextByDelimiter(" ", QuoteStyle.None),"Full Address")
in
    FullAddress
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query <a id="calibre_link-93" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName"}, {"Product Category"}
        )
in
   Category
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> query to a <strong class="screentext">Facts</strong> query group and the <strong class="screentext">Sales Territories</strong>, <strong class="screentext">Dates</strong>, <strong class="screentext">Customers</strong>, and <strong class="screentext">Products</strong> queries to a <strong class="screentext">Dimensions</strong> query group</li>
      <li class="calibre12">Choose <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Switch to the <strong class="screentext">Model</strong> view and create a relationship between the <strong class="screentext">SalesTerritoryKey</strong> columns in the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Sales Territories</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">ProductKey</strong> columns in the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Products</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">DateKey</strong> column in the <strong class="screentext">Dates</strong> table and the <strong class="screentext">OrderDateKey</strong> column in the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">CustomerKey</strong> columns in the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Customers</strong> tables</li>
      <li class="calibre12">Save your <a id="calibre_link-94" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>work</li>
    </ol>
    <h2 id="calibre_link-1810" class="calibre8">How to Democratize Artificial Intelligence</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Report</strong> view, create a <strong class="screentext">Key influencers</strong> visualization, placing the <strong class="screentext">SalesAmount</strong> column from the <strong class="screentext">Internet Sales</strong> table in the <strong class="screentext">Analyze</strong> field well, and the following columns in the <strong class="screentext">Explain by</strong> field well:<ul class="calibre11">
          <li class="calibre12">The <strong class="screentext">SalesTerritoryCountry</strong> column from the <strong class="screentext">Sales Territories</strong> table</li>
          <li class="calibre12">The <strong class="screentext">SalesTerritoryGroup</strong> column from the <strong class="screentext">Sales Territories</strong> table</li>
          <li class="calibre12">The <strong class="screentext">SalesTerritoryRegion</strong> column from the <strong class="screentext">Sales Territories</strong> table</li>
          <li class="calibre12">The <strong class="screentext">Product Category</strong> column from the <strong class="screentext">Products</strong> table</li>
          <li class="calibre12">The <strong class="screentext">Product Subcategory</strong> column from the <strong class="screentext">Products</strong> table</li>
          <li class="calibre12">The <strong class="screentext">City</strong> column from the <strong class="screentext">Customers</strong> table</li>
        </ul>
        <figure class="mediaobject"><img src="images/000281.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.14: Key influencers visualization</p>
      </li>
      <li class="calibre12">Click on the different <strong class="screentext">When</strong> items to view visuals related to the influencers</li>
      <li class="calibre12">Click on the <strong class="screentext">Top segments</strong> tab to view the different segments identified</li>
      <li class="calibre12">Click on a<a id="calibre_link-95" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> segment of interest to view additional information and visualizations<figure class="mediaobject"><img src="images/000294.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.15: Segment detail in the Key influencers visualization</p>
    <h2 id="calibre_link-1811" class="calibre8">How it works</h2>
    <p class="book-title--packt">The <strong class="screentext">Key influencers</strong> visual <a id="calibre_link-564" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>uses machine learning algorithms to analyze the data added to the visual and extract insights based upon these algorithms. Different visuals and insights are created depending on whether the metric has categorical or continuous key influencers. Using an unsummarized numeric field in the <strong class="screentext">Analyze</strong> field well allows <strong class="screentext">Analysis</strong> in the <strong class="screentext">Format</strong> pane to be changed to either <strong class="screentext">Categorical</strong> or <strong class="screentext">Continuous</strong>. Using a measure or an aggregated column forces a <strong class="screentext">Continuous</strong> analysis. Measures can be used as either the metric to be analyzed or as a key influencer (<strong class="screentext">Explain by</strong>).</p>
    <p class="book-title--packt">Counts can be activated in the <strong class="screentext">Analysis</strong> section of the <strong class="screentext">Format</strong> pane. Counts are useful for determining whether key influencers have a large impact but only represent a small portion of the total data. Enabling counts creates a ring around the key influencer circles that represents the percentage of data rows in which the key influencer appears. A ring around the entire circle means that 100% of the data contains the key influencer.</p>
    <p class="book-title--packt">The <strong class="screentext">Top segments</strong> tab analyzes the data in order to find clusters of similar data points. Again, machine learning clustering algorithms are used in order to find and extract these segments from the underlying data used in the visualization.</p>
    <p class="book-title--packt">The <strong class="screentext">Key influencers</strong> visualization has certain limitations, primarily related to the data sources supported and where the visual can be displayed. For example, the Key influencers visual does<a id="calibre_link-1812" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> not support DirectQuery or live connections to Azure Analysis Services or SQL Server Analysis Services. In addition, the Key influencers visualization is not supported when using <strong class="screentext">Publish to web</strong> or embedding in SharePoint Online.</p>
    <h2 id="calibre_link-1813" class="calibre8">There's more</h2>
    <p class="book-title--packt">Another recently<a id="calibre_link-379" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> added, advanced visualization is the <strong class="screentext">Decomposition tree</strong>. To understand how to configure and use the <strong class="screentext">Decomposition tree</strong> visualization, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Report</strong> view, create a <strong class="screentext">Key</strong> <strong class="screentext">influencers</strong> visualization by placing the <strong class="screentext">SalesAmount</strong> column from the <strong class="screentext">Internet Sales</strong> table in the <strong class="screentext">Analyze</strong> field well, and the following columns in the <strong class="screentext">Explain by</strong> field well:<ul class="calibre11">
          <li class="calibre12">The <strong class="screentext">SalesTerritoryCountry</strong> column from the <strong class="screentext">Sales Territories</strong> table</li>
          <li class="calibre12">The <strong class="screentext">Product Category</strong> column from the <strong class="screentext">Products</strong> table</li>
          <li class="calibre12">The <strong class="screentext">Product Subcategory</strong> column from the <strong class="screentext">Products</strong> table</li>
          <li class="calibre12">The <strong class="screentext">City</strong> column from the <strong class="screentext">Customers</strong> table</li>
          <li class="calibre12">The <strong class="screentext">CalendarYear</strong> column from the <strong class="screentext">Dates</strong> table</li>
        </ul>
      </li>
      <li class="calibre12">Click the <strong class="screentext">+</strong> icon at the end of the <strong class="screentext">SalesAmount</strong> bar and choose <strong class="screentext">High value</strong>
        <figure class="mediaobject"><img src="images/000306.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.16: Decomposition tree expansion</p>
      </li>
      <li class="calibre12">Repeat this procedure until the tree is fully expanded, as shown in <em class="italic">Figure 9.17</em>
        <figure class="mediaobject"><img src="images/000318.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.17: Fully expanded Decomposition tree visualization</p>
    <p class="book-title--packt">Selecting <strong class="screentext">High value</strong> or <strong class="screentext">Low value</strong> when expanding the decomposition tree leverages artificial intelligence<a id="calibre_link-96" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> machine learning algorithms to expand the tree, to return either the highest or lowest values of the measure being analyzed, respectively. The <strong class="screentext">Decomposition tree</strong> visualization is a powerful and flexible tool for end users to explore and analyze their data, as users can explore the <strong class="screentext">Explain by</strong> categories in any order, or allow the machine learning algorithms to guide their analysis.</p>
    <h2 id="calibre_link-1814" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Key influencers <a id="calibre_link-570" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>visualizations tutorial: <a href="https://bit.ly/3h414Cn" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3h414Cn</span></a> </li>
      <li class="bullet">Decomposition<a id="calibre_link-380" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> tree: <a href="https://bit.ly/2PC9ZiR" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2PC9ZiR</span></a></li>
    </ul>
    <h1 id="calibre_link-1268" class="title">Building Animation and Storytelling</h1>
    <p class="book-title--packt">Business <a id="calibre_link-66" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>teams <a id="calibre_link-1066" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and analysts are commonly responsible for sharing or "walking through" business results, trends, and the findings from their analyses with other stakeholders, such as senior management. To support the message delivery process most effectively, Power BI provides built-in animation capabilities for the standard scatter chart and ArcGIS map visualization types. Additionally, core and custom visuals, such as the pulse chart, further aid the storytelling process by embedding user-defined annotations into the visual and providing full playback control over the animation.</p>
    <blockquote class="packt_quote pcalibre6">"We're bringing storytelling into Power BI. We're making Power BI into the PowerPoint for data."<p class="cite"> &ndash; Amir Netz, Microsoft Technical Fellow</p></blockquote>
    
    <p class="book-title--packt">This recipe includes examples for preparing the standard <strong class="screentext">Scatter chart</strong> visualization for animation, leveraging the date animation feature of the <strong class="screentext">ArcGIS Maps for Power BI</strong> visual. Details on the <strong class="screentext">Bookmarks</strong> pane, as well as the<strong class="screentext"> </strong><strong class="screentext">Smart narrative</strong> and other storytelling custom visuals, are also included.</p>
    <h2 id="calibre_link-1815" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform</strong> <strong class="screentext">Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <code class="code-in-text--packt">AdWorksDW</code> query and place this query into a <strong class="screentext">Data Sources</strong> query group</li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">AdWorksDW</code> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Internet</strong> <strong class="screentext">Sales</strong> and choose the <strong class="screentext">FactInternetSales</strong> table</li>
      <li class="calibre12">Repeat <em class="italic">steps 4</em> and <em class="italic">5</em>, creating a <strong class="screentext">Dates</strong> query that points to the <strong class="screentext">DimDates</strong> table, and a <strong class="screentext">Sales Territories</strong> query that points to the <strong class="screentext">DimSalesTerritory</strong> table</li>
      <li class="calibre12">Create a <strong class="screentext">Customers</strong> query using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    dbo_DimCustomer = Source{[Schema="dbo",Item="DimCustomer"]}[Data],
    ExpandGeography = Table.ExpandRecordColumn(dbo_DimCustomer, "DimGeography", 
        {"City", "StateProvinceCode", "EnglishCountryRegionName", "PostalCode", 
            "DimSalesTerritory"}, 
        {"City", "StateProvinceCode", "EnglishCountryRegionName", "PostalCode", 
            "DimSalesTerritory"}),
    ExpandSalesTerritory = Table.ExpandRecordColumn(ExpandGeography, 
        "DimSalesTerritory", {"SalesTerritoryRegion"}, {"SalesTerritoryRegion"}),
    DupCity = Table.DuplicateColumn(ExpandSalesTerritory, "City", "City1"),
    DupZip = Table.DuplicateColumn(DupCity, "PostalCode", "Zip"),    
    Address = Table.CombineColumns(DupZip,
        {"AddressLine1", "City1", "StateProvinceCode"},
        Combiner.CombineTextByDelimiter(", ", QuoteStyle.None),"Address"),
    FullAddress = Table.CombineColumns(Address,{"Address", "Zip"},
        Combiner.CombineTextByDelimiter(" ", QuoteStyle.None),"Full Address")
in
    FullAddress
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query<a id="calibre_link-67" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> using <a id="calibre_link-1067" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName"}, {"Product Category"}
        )
in
   Category
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> query to a <strong class="screentext">Facts</strong> query group, and the <strong class="screentext">Sales</strong> <strong class="screentext">Territories</strong>, <strong class="screentext">Dates</strong>, <strong class="screentext">Customers</strong>, and <strong class="screentext">Products</strong> queries to a <strong class="screentext">Dimensions</strong> query group</li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">In Power<a id="calibre_link-68" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> BI Desktop, select the <strong class="screentext">City</strong> column in the <strong class="screentext">Customers</strong> table<a id="calibre_link-1068" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and assign a <strong class="screentext">Data category</strong> of <strong class="screentext">City</strong></li>
      <li class="calibre12">Select the <strong class="screentext">Full Address</strong> column in the <strong class="screentext">Customers</strong> table and assign a <strong class="screentext">Data category</strong> of <strong class="screentext">Address</strong></li>
      <li class="calibre12">Switch to the <strong class="screentext">Model</strong> view and create a relationship between the <strong class="screentext">SalesTerritoryKey</strong> columns in the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Sales Territories</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">ProductKey</strong> columns in the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Products</strong> tables</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">DateKey</strong> column in the <strong class="screentext">Dates</strong> table and the <strong class="screentext">OrderDateKey</strong> column in the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">CustomerKey</strong> columns in the <strong class="screentext">Internet Sales</strong> and <strong class="screentext">Customers</strong> tables</li>
      <li class="calibre12">Save your work</li>
    </ol>
    <h2 id="calibre_link-1816" class="calibre8">How to Build Animation and Storytelling</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Report</strong> view, apply a report- or page-level filter for the <strong class="screentext">SalesTerritoryGroup</strong> column in the <strong class="screentext">SalesTerritories</strong> table to the value <strong class="screentext">Europe</strong></li>
      <li class="calibre12">Create a <strong class="screentext">Scatter</strong> chart visualization using the <strong class="screentext">SalesTerritoryCountry</strong> column from the <strong class="screentext">SalesTerritories</strong> table for <strong class="screentext">Details</strong>, the <strong class="screentext">CustomerKey</strong> column (count) from the <strong class="screentext">Internet Sales</strong> table for the <strong class="screentext">X Axis</strong>, and the <strong class="screentext">SalesAmount</strong> (sum) for the <strong class="screentext">Y Axis</strong></li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, expand the <strong class="screentext">Shapes</strong> card, set the <strong class="screentext">Size</strong> to <strong class="screentext">100</strong>, and also toggle <strong class="screentext">Fill point</strong>, <strong class="screentext">Category labels</strong>, and <strong class="screentext">Color by category</strong> to <strong class="screentext">On</strong></li>
      <li class="calibre12">Create two new columns in the <strong class="screentext">Dates</strong> table using the following formulas:
        <pre class="programlisting"><code class="hljs">YearMonth = [CalendarYear] &amp; "-" &amp; LEFT([EnglishMonthName],3)
YearMonthSort = [CalendarYear]*100 + [MonthNumberOfYear]
</code></pre>
      </li>
      <li class="calibre12">Set <strong class="screentext">Sort by column</strong> for the <strong class="screentext">YearMonth</strong> column to the <strong class="screentext">YearMonthSort</strong> column</li>
      <li class="calibre12">Drag the <strong class="screentext">YearMonth</strong> column into the <strong class="screentext">Play Axis</strong> field well of the scatter chart visualization</li>
      <li class="calibre12">Click on one or more of the circles to display their paths and test the animation capabilities <a id="calibre_link-69" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>by clicking on the play button to the left of the time<a id="calibre_link-1069" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> axis<figure class="mediaobject"><img src="images/000330.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.18: Scatter chart animation and tracing</p>
      </li>
      <li class="calibre12">Add a new page and add an ArcGIS map visualization to the page</li>
      <li class="calibre12">Apply a page-level filter using the <strong class="screentext">SalesTerritoryRegion</strong> column in the <strong class="screentext">Customers</strong> table and select only <strong class="screentext">Southwest</strong></li>
      <li class="calibre12">From the <strong class="screentext">Customers</strong> table, add the <strong class="screentext">Full Address</strong> column for <strong class="screentext">Location</strong>, the <strong class="screentext">CustomerKey</strong> column for <strong class="screentext">Size</strong>, and the <strong class="screentext">YearlyIncome</strong> column for <strong class="screentext">Color</strong></li>
      <li class="calibre12">In the <strong class="screentext">Format</strong> pane, expand <strong class="screentext">Location</strong> <strong class="screentext">type</strong> and choose <strong class="screentext">United States</strong></li>
      <li class="calibre12">In the upper left of the ArcGIS map visualization, select <strong class="screentext">Expand map tools</strong></li>
      <li class="calibre12">Click the <strong class="screentext">Layer list</strong> icon and then the vertical ellipsis next to <strong class="screentext">Full Address</strong> and choose <strong class="screentext">Symbology</strong></li>
      <li class="calibre12">Scroll down and choose <strong class="screentext">Heat map</strong></li>
      <li class="calibre12">Add<a id="calibre_link-70" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">FullDateAlternateKey</strong> column from the <strong class="screentext">Dates</strong> table to <a id="calibre_link-1070" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Time</strong> field well<figure class="mediaobject"><img src="images/000341.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.19: ArcGIS map for the Power BI visual using the heat map theme and the timeline</p>
      </li>
      <li class="calibre12">Add a new page and use the <strong class="screentext">Filters</strong> pane to add a page filter using the <strong class="screentext">CalendarYears</strong> column from the <strong class="screentext">Dates</strong> table for the years <strong class="screentext">2011</strong>, <strong class="screentext">2012</strong>, and <strong class="screentext">2013</strong></li>
      <li class="calibre12">In the <strong class="screentext">Visualizations</strong> pane, click the ellipsis (â¦) and choose <strong class="screentext">Get more visuals</strong></li>
      <li class="calibre12">Search for, find, and add the <strong class="screentext">Play Axis (Dynamic Slicer)</strong> visualization</li>
      <li class="calibre12">Create a <strong class="screentext">Clustered</strong> column chart visualization with the <strong class="screentext">YearMonth</strong> column from the <strong class="screentext">Dates</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">SalesAmount</strong> column (sum) as the <strong class="screentext">Values</strong></li>
      <li class="calibre12">Create a <strong class="screentext">Clustered</strong> bar chart visualization with the <strong class="screentext">SalesTerritoryCountry</strong> column from the <strong class="screentext">Sales Territories</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">SalesAmount</strong> column (sum) as the <strong class="screentext">Values</strong></li>
      <li class="calibre12">Add the <strong class="screentext">Play Axis</strong> visualization and use the <strong class="screentext">YearMonth</strong> column from the <strong class="screentext">Dates</strong> table as the <strong class="screentext">Field</strong></li>
      <li class="calibre12">Click the play button on the <strong class="screentext">Play Axis</strong> visualization<figure class="mediaobject"><img src="images/000353.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.20: Play Axis custom visual filtering two charts and paused on June 2013</p>
    <h2 id="calibre_link-1817" class="calibre8">How it works</h2>
    <p class="book-title--packt">For the<strong class="screentext"> </strong><strong class="screentext">Scatter chart</strong>, an<a id="calibre_link-71" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> alternative method of displaying bubbles is <a id="calibre_link-1003" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>by using a <a id="calibre_link-1071" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>measure for the <strong class="screentext">Size</strong> field well, applying a measure/column for <strong class="screentext">Size</strong> on a scatter chart, with the size of the bubbles being used to visually emphasize a certain metric. However, similar to pie and donut charts, it is difficult to visually determine differences in bubble sizes. Additionally, even a small number of dimension items, such as product categories, can lead to a cluttered visualization when presented as a bubble chart.</p>
    <p class="book-title--packt">In the <strong class="screentext">Scatter chart</strong> example, multiple items can be selected or unselected by holding down the <em class="italic">Ctrl</em> key and clicking a bubble from a separate series. When selected, the scatter chart highlights the path of the given item (or items) up to the currently selected or filtered point on the <strong class="screentext">Play Axis</strong>. Playing and pausing the <strong class="screentext">Play Axis</strong> and selecting the dimension(s) of the scatter chart makes it easy for presenters to address a significant outlier or a point in time at which a relevant trend began.</p>
    <p class="book-title--packt">Microsoft has also created the <strong class="screentext">Enhanced Scatter</strong> custom visual, which supports a background image URL, such as a business location or diagram, and images for the individually plotted categories. However, this visual does not include a <strong class="screentext">Play Axis</strong> or any visual animation like the standard scatter chart used in this recipe. The <strong class="screentext">Enhanced Scatter</strong> visualization is available in AppSource.</p>
    <p class="book-title--packt">For the ArcGIS visualization, the column used for the <strong class="screentext">Time</strong> field well must be of the date or the date/time data type, such as an individual calendar date or a week ending date. Text and numeric data type columns, such as calendar year, are not supported. The timeline at the bottom of the visual can be used to play through each individual date value, or a custom time interval can be set by modifying the start and end points of the timeline. </p>
    <p class="book-title--packt">For instance, a date interval representing four weeks could be set at the beginning of the timeline, and clicking the play icon would sequentially display each interval. The forward and backward icons can be used to quickly navigate to different time periods or intervals.</p>
    <p class="book-title--packt">Finally, the Play Axis visualization adds animation capabilities to visualizations that have no native animation features. The Play Axis visualization works by taking advantage of the native cross-filtering and cross-highlighting capabilities of Power BI. The Play Axis visualization <a id="calibre_link-1072" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is<a id="calibre_link-72" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> best used in combination with column charts, bar charts, and other charts that allow for the <strong class="screentext">Highlight</strong> visual interaction.</p>
    <h2 id="calibre_link-1818" class="calibre8">There's more</h2>
    <p class="book-title--packt">Bookmarks enable <a id="calibre_link-111" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the saving of specific report states, including filter context and the visibility of specific items on the report canvas. This can be particularly useful with animated visuals in order to skip to the most interesting parts of the animation. The <strong class="screentext">Bookmarks</strong> pane can be accessed in the ribbon of the <strong class="screentext">View</strong> tab while in the <strong class="screentext">Report</strong> view. Use the <strong class="screentext">Add</strong> button to create bookmarks. Use the <strong class="screentext">View</strong> button to easily page through bookmarks like a slideshow.</p>
    <figure class="mediaobject"><img src="images/000364.png" alt="" class="calibre14" /> Figure 9.21: Bookmarks pane in Power BI Desktop</figure>
    <p class="book-title--packt">The <strong class="screentext">Selection</strong> pane, also available in the ribbon of the <strong class="screentext">View</strong> tab, can be used with bookmarks to set the visibility of visuals for a bookmark. Playing through bookmarks in Power BI reports resembles Microsoft PowerPoint presentations (in presentation mode) that leverage animation. Additionally, bookmarks can be linked with other objects in the report, such as images, making it possible to create an intuitive navigation experience across report pages.</p>
    <p class="book-title--packt">Microsoft is also adding narrative and storytelling visuals to Power BI. The <strong class="screentext">Smart narrative</strong> visual has been added to Power BI Desktop. To see how Smart narrative works, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a new page and add a <strong class="screentext">Clustered</strong> column chart visualization to the page using the <strong class="screentext">CalendarYear</strong> column from the <strong class="screentext">Dates</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">SalesAmount</strong> column from the <strong class="screentext">Internet Sales</strong> table as the <strong class="screentext">Values</strong></li>
      <li class="calibre12">Copy <a id="calibre_link-1819" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and<a id="calibre_link-1820" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> paste this visual</li>
      <li class="calibre12">With the copy <a id="calibre_link-112" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of the visual selected, click the <strong class="screentext">Smart narrative</strong> visual in the <strong class="screentext">Visualizations</strong> tab<figure class="mediaobject"><img src="images/000375.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.22: The same data presented as both a clustered column chart and Smart narrative visual</p>
    <p class="book-title--packt">The Smart narrative visualization analyzes the data and creates a natural language narrative of the data presented in the visualization. Additional custom visuals focused on integrating explanatory text or annotations with data from the data model include the Add Intelligent Narratives for BI visual, the Enlighten Data Story visual, and Timeline Storyteller.</p>
    <h2 id="calibre_link-1821" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Scatter, bubble, and dot plot charts in Power BI: <a href="https://bit.ly/3u38toZ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3u38toZ</span></a> </li>
      <li class="bullet">Use bookmarks in Power BI Desktop to share insights and build stories: <a href="https://bit.ly/2QK3ACS" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2QK3ACS</span></a></li>
      <li class="bullet">Smart narratives tutorial: <a href="https://bit.ly/3e57xuM" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3e57xuM</span></a> </li>
    </ul>
    <h1 id="calibre_link-1269" class="title">Embedding Statistical Analyses </h1>
    <p class="book-title--packt">Statistical <a id="calibre_link-1059" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>analysis beyond basic aggregations is typically implemented outside of business intelligence semantic models by data scientists and data science applications. When possible, however, it is much more efficient to leverage existing data models, Power BI skills, and the features used for other Power BI reports and dashboards&mdash;such as the <strong class="screentext">Analytics</strong> pane described earlier in this chapter.</p>
    <p class="book-title--packt">In this recipe, the data points supporting a linear regression model are created from an existing Power BI data model. This model is then analyzed and described via DAX measures, with values such as slope, Y-intercept, and the Z-score for residuals. Finally, a rich report page is constructed to visualize the strength and accuracy of the regression model and to detect outliers.</p>
    <h2 id="calibre_link-1822" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <strong class="screentext">AdWorksDW</strong> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <strong class="screentext">AdWorksDW</strong> query and place it into a <strong class="screentext">Data Sources</strong> query group</li>
      <li class="calibre12">Right-click the <strong class="screentext">AdWorksDW</strong> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Internet Sales</strong> and choose the <strong class="screentext">FactInternetSales</strong> table</li>
      <li class="calibre12">Repeat <em class="italic">steps 4</em> and <em class="italic">5</em>, creating a <strong class="screentext">Dates</strong> query that points to the <strong class="screentext">DimDates</strong> table</li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> query to a <strong class="screentext">Facts</strong> query group, and the <strong class="screentext">Dates</strong> query to a <strong class="screentext">Dimensions</strong> query group</li>
      <li class="calibre12">Choose <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Switch to the <strong class="screentext">Model</strong> view and create a relationship between the <strong class="screentext">DateKey</strong> column in the <strong class="screentext">Dates</strong> table and the <strong class="screentext">OrderDateKey</strong> column in the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Create two new columns in the <strong class="screentext">Dates</strong> table using the following formulas:
        <pre class="programlisting"><code class="hljs">YearMonth = [CalendarYear] &amp; "-" &amp; LEFT([EnglishMonthName],3)
YearMonthSort = [CalendarYear]*100 + [MonthNumberOfYear]
</code></pre>
      </li>
      <li class="calibre12">Set the <strong class="screentext">Sort by column</strong> for the <strong class="screentext">YearMonth</strong> column to the <strong class="screentext">YearMonthSort</strong> column</li>
      <li class="calibre12">Save <a id="calibre_link-1060" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>your work</li>
    </ol>
    <h2 id="calibre_link-1823" class="calibre8">How to Embed Statistical Analyses</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Report</strong> view, click <strong class="screentext">New table</strong> from the ribbon of the <strong class="screentext">Modeling</strong> tab and use the following code:
        <pre class="programlisting"><code class="hljs">MktSalesRegression = 
    FILTER(
        SUMMARIZECOLUMNS(
            'Dates'[YearMonth],
            'Dates'[YearMonthSort],
            CALCULATETABLE('Dates',
                'Dates'[FullDateAlternateKey] &gt;= DATE(2011,1,1) &amp;&amp;
                'Dates'[FullDateAlternateKey] &lt;= DATE(2013,12,31)),
            "Marketing Amount", 
                    VAR __MonthNum = MAX('Dates'[MonthNumberOfYear])
                    VAR __Value = SUM('Internet Sales'[SalesAmount])
                RETURN SWITCH(__MonthNum,
                    1,__Value*.8,
                    2,__Value*.8,
                    3,__Value*.8,
                    4,__Value*.8,
                    5,__Value*.8,
                    6,__Value*1,
                    7,__Value*.8,
                    8,__Value*.8,
                    9,__Value*.6,
                    10,__Value*.8,
                    11,__Value*.8,
                    12,__Value*.8),
            "Internet Sales", SUM('Internet Sales'[SalesAmount])
        ),
        NOT(ISBLANK([Internet Sales]) || ISBLANK([Marketing Amount]))
    )
</code></pre>
      </li>
      <li class="calibre12">Create measures for the correlation coefficient, slope, y-intercept, and coefficient <a id="calibre_link-1061" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of determination (R squared):
        <pre class="programlisting"><code class="hljs">MktSalesCorrelNum = SUMX(MktSalesRegression, 
    (   (MktSalesRegression[Marketing Amount] - 
            AVERAGE(MktSalesRegression[Marketing Amount]) ) * 
        ( MktSalesRegression[Internet Sales] - 
            AVERAGE(MktSalesRegression[Internet Sales]) )
    ) )
MktSalesCorrelDenomX = SUMX(MktSalesRegression,
    (   MktSalesRegression[Marketing Amount] - 
        AVERAGE(MktSalesRegression[Marketing Amount]) )^2 )
MktSalesCorrelDenomY = SUMX(MktSalesRegression,
    (   MktSalesRegression[Internet Sales] - 
        AVERAGE(MktSalesRegression[Internet Sales]) )^2 )
Mkt-Sales Correl = DIVIDE([MktSalesCorrelNum],
    SQRT([MktSalesCorrelDenomX]*[MktSalesCorrelDenomY]) )
Mkt-Sales R Squared = [Mkt-Sales Correl]^2
MktSalesSlope = DIVIDE([MktSalesCorrelNum],[MktSalesCorrelDenomX])
MktSales Intercept = AVERAGE(MktSalesRegression[Internet Sales]) - 
    ( [MktSalesSlope]*AVERAGE(MktSalesRegression[Marketing Amount]) )
</code></pre>
      </li>
      <li class="calibre12">Click <strong class="screentext">New table</strong> from the ribbon of the <strong class="screentext">Modeling</strong> tab and use the following code:
        <pre class="programlisting"><code class="hljs">Residuals = 
    VAR Intercept = [MktSales Intercept]
    VAR Slope = [MktSalesSlope]
RETURN
    ADDCOLUMNS(MktSalesRegression,"Y Intercept",Intercept,"Slope",Slope,
    "Predicted Internet Sales", ([Marketing Amount]*Slope) + Intercept,
    "Residual",[Internet Sales] - (([Marketing Amount]*Slope) + Intercept))
</code></pre>
      </li>
      <li class="calibre12">Create the<a id="calibre_link-1062" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following measures:
        <pre class="programlisting"><code class="hljs">Residuals Amount = SUM(Residuals[Residual])
Residuals Average = CALCULATE(AVERAGE(Residuals[Residual]),ALL(Residuals)) 
Residuals Sample Std Dev = CALCULATE(STDEV.S(Residuals[Residual]),ALL(Residuals)) 
Residuals Z Score = DIVIDE([Residuals Amount] - [Residuals Average],[Residuals Sample Std Dev])
Regression Line Message = "Regression Line: Y= " &amp; FORMAT([MktSalesSlope],"#,###") &amp; "X" &amp; "+" &amp; FORMAT([MktSales Intercept],"#,###") 
Last Month Internet Sales = 
    VAR __LastMonth = MAX('Residuals'[YearMonthSort])
RETURN
    LOOKUPVALUE('Residuals'[Internet Sales],[YearMonthSort],__LastMonth)
Last Month Predicted Internet Sales = 
    VAR __LastMonth = MAX('Residuals'[YearMonthSort])
RETURN
    LOOKUPVALUE('Residuals'[Predicted Internet Sales],[YearMonthSort],__LastMonth)
</code></pre>
      </li>
      <li class="calibre12">From the <strong class="screentext">Report</strong> view, create card visuals to display the <strong class="screentext">Last Month Internet Sales, Last Month Predicted Internet Sales, Mkt-Sales Correl, Mkt-Sales R Squared,</strong> and <strong class="screentext">Regression Line Message </strong>measures</li>
      <li class="calibre12">Create a scatter chart visualization using the <strong class="screentext">Marketing Amount</strong> column (sum) from the <strong class="screentext">MktSalesRegression</strong> table as the <strong class="screentext">X Axis</strong>, the <strong class="screentext">Internet Sales</strong> column (sum) from the <strong class="screentext">MktSalesRegression</strong> table as the <strong class="screentext">Y Axis</strong>, and the <strong class="screentext">YearMonth</strong> column from the <strong class="screentext">MktSalesRegression</strong> table as <strong class="screentext">Details</strong></li>
      <li class="calibre12">Add a <strong class="screentext">Trend</strong> line from the <strong class="screentext">Analytics</strong> pane</li>
      <li class="calibre12">Create a second scatter chart visualization using the <strong class="screentext">Predicted Internet Sales</strong> column (sum) from the <strong class="screentext">Residuals</strong> table as the <strong class="screentext">X Axis</strong>, the <strong class="screentext">Residuals Z Score</strong> column (sum) from the <strong class="screentext">Residuals</strong> table as the <strong class="screentext">Y Axis</strong>, and the <strong class="screentext">YearMonth</strong> column <a id="calibre_link-1063" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>from the <strong class="screentext">Residuals</strong> table as <strong class="screentext">Details</strong>
        <figure class="mediaobject"><img src="images/000386.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.23: Regression report page</p>
    <p class="book-title--packt">With this report design, the user can instantly perceive the strength of the relationship via the <strong class="screentext">Marketing Amount and Internet Sales by YearMonth</strong> scatter chart and the high values for the correlation and R squared cards shown in <em class="italic">Figure 9.23</em>. The <strong class="screentext">Predicted</strong> <strong class="screentext">Internet Sales and Residuals Z Score by YearMonth</strong> scatter chart helps to identify the months with relatively large variations.</p>
    <h2 id="calibre_link-1824" class="calibre8">How it works</h2>
    <p class="book-title--packt">In this example, we have obviously engineered a monthly marketing spend metric to have a high correlation with internet sales. Had we used the actual <strong class="screentext">Sales and Marketing</strong> expenditure numbers from the general ledger (<strong class="screentext">FactFinance</strong>) fact table, we would have found no correlation at all. </p>
    <p class="book-title--packt">Simple (single-variable) regression models are often insufficient to estimate Y values accurately, but many of the concepts and techniques used in this recipe are applicable to more complex, multiple linear regression models.</p>
    <p class="book-title--packt">The main correlation calculations deal with data in the <strong class="screentext">MktSalesRegression</strong> table. This table creates rows with corresponding data between the two metrics we wish to correlate. The <code class="code-in-text--packt">SUMMARIZECOLUMNS</code> function groups the table at the monthly grain, and the <code class="code-in-text--packt">FILTER</code> function removes any rows (months) that do not have both internet sales and <a id="calibre_link-1064" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>marketing values. It is crucial to the calculations that the data does not contain gaps in any one time series. The <code class="code-in-text--packt">CALCULATETABLE</code> function passes a filtered date table to <code class="code-in-text--packt">SUMMARIZECOLUMNS</code> in order to exclude certain months. The <strong class="screentext">Marketing Amount</strong> and <strong class="screentext">Internet Sales</strong> columns are the two measures we wish to find or not find a correlation between. Note that to attempt a correlation between different measures, only the <strong class="screentext">Marketing Amount</strong> and <strong class="screentext">Internet Sales</strong> expressions need to be changed&mdash;all other measures and DAX calculations can remain the same.</p>
    <p class="book-title--packt">A new SQL view could be developed in the source system to meet the regression table requirements and, as another alternative, M queries within the dataset could leverage the existing general ledger, internet sales, and date queries. However, small DAX tables such as this example (with 36 rows) are a good option for supporting custom or advanced analysis and functionality.</p>
    <p class="book-title--packt">The correlation coefficient is split into three separate intermediate measures (<strong class="screentext">MktSalesCorrelNum</strong>, <strong class="screentext">MktSalesCorrelDenomX</strong>, and <strong class="screentext">MktSalesCorrelDenomY</strong>) and these measures are referenced in the <strong class="screentext">Mkt-Sales Correl</strong> measure. With the correlation and its components defined in the model, the slope (<strong class="screentext">MktSalesSlope</strong>) measure can leverage the same numerator measure, <strong class="screentext">MktSalesCorrelNum</strong>, and the <strong class="screentext">MktSalesCorrelDenomX</strong> measure as well. Finally, we can compute the y-intercept for the regression, <strong class="screentext">MktSales</strong> <strong class="screentext">Intercept</strong>.</p>
    <p class="book-title--packt">We now have all of the components for the equation of our line, <em class="italic">y = mx + b</em>, where <em class="italic">m</em> is the slope and <em class="italic">b</em> is the y-intercept. This formula is what allows us to compute the <strong class="screentext">Predicted Internet Sales</strong> in our <strong class="screentext">Residuals</strong> table. The <strong class="screentext">Predicted Internet Sales</strong> column in the <strong class="screentext">Residuals</strong> table implements the equation of a line (<em class="italic">y = mx + b</em>) by referencing the <strong class="screentext">Marketing Amount</strong> column (<em class="italic">x</em>), the slope (<strong class="screentext">MktSalesSlope</strong>), and the y-intercept (<strong class="screentext">MktSales Intercept</strong>). Finally, the <strong class="screentext">Residual</strong> column is computed to subtract the predicted sales value from the observed (actual) value in the <strong class="screentext">Internet Sales</strong> column.</p>
    <p class="book-title--packt">A Z-score is computed for each residual data point (a month) to determine if the variation (or "miss") between the predicted and observed values is large relative to other data points. To support the visualization, a measure returns a text string containing the equation of the regression model's line. Additionally, two measures are created to display actual and predicted internet sales for the last month in the analysis.</p>
    <p class="book-title--packt">The two calculated tables in this recipe, <strong class="screentext">MktSalesRegression</strong> and <strong class="screentext">Residuals</strong>, do not have any relationships to other tables in the model. Refreshing the source tables (queries) of the<a id="calibre_link-1825" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> two DAX tables also refreshes the calculated tables.</p>
    <h2 id="calibre_link-1826" class="calibre8">There's more</h2>
    <p class="book-title--packt">The created DAX<a id="calibre_link-362" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> measures in this recipe correspond to the <code class="code-in-text--packt">CORREL</code>,<code class="code-in-text--packt"> SLOPE</code>,<code class="code-in-text--packt"> and INTERCEPT</code> functions in Microsoft Excel. The documentation for these Excel functions provides the following formulas: </p>
    <p class="book-title--packt">The formula for the <code class="code-in-text--packt">CORREL</code> function, for a sample (Pearson's Correlation Coefficient):</p>
    <figure class="mediaobject"><img src="images/000397.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">The standard formula for finding the slope of a line:</p>
    <figure class="mediaobject"><img src="images/000409.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">The standard formula for finding a y-intercept:</p>
    <figure class="mediaobject"><img src="images/000421.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Correlation coefficients can range from -1 to 1. A positive correlation between two metrics means that as one measure goes up or down, the other metric also goes up or down. There are also inverse correlations represented by negative numbers, where the two metrics are inversely correlated, meaning that when one metric goes up, the other metric goes down, and vice versa. Values close to 1 or -1 indicate that the two metrics have a strong correlation and directly affect one another. Values closer to 0 indicate that the two metrics are not related to one another.</p>
    <p class="book-title--packt">The R squared value, or the coefficient of determination, is simply the square of the correlation coefficient. R squared values fall between 0 and 1 since the square of a negative number is positive. An R squared value of 1 indicates that the movements of one metric are 100% explained by the movements in the comparison metric, while a value of 0 indicates that there is no relation between the two metrics. R squared values between .85 and 1 are considered "high," meaning that the two metrics are closely linked, while anything below .7 is considered weak or of relatively little influence. </p>
    <p class="book-title--packt">It is important to consider that time series data often exhibits seasonality, meaning that the numbers are<a id="calibre_link-1827" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> artificially higher or lower than they would otherwise be due to, for example, quarterly influences. Think retail sales and holidays in the fourth calendar quarter like Thanksgiving and Christmas. When data exhibits seasonality, it is critically important that the metric's values are de-seasonalized before performing the correlation. </p>
    <p class="book-title--packt">Another consideration is leading and lagging indicators. Leading indicators mean that the values in one time series are related to another, but there is an offset of some number of weeks or months. In other words, one metric may go up and correspond to the other metric going up, but there is a period of time or delay before the second metric reflects the movement of the first metric. </p>
    <p class="book-title--packt">Finding leading indicators can be extremely valuable in business, as they provide a predictive metric upon which a business can make decisions and act based upon expected future behavior. To find leading indicators, the values in the correlation analysis must be offset from one another by the appropriate number of time periods. This generally leads to the correlation calculations taking place at various time period offsets in order to determine if one indicator leads or lags another.</p>
    <h2 id="calibre_link-1828" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Slope and intercept equation descriptions: <a href="http://bit.ly/2tdzrgA" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2tdzrgA</span></a></li>
      <li class="bullet">De-Seasonalized Correlation Coefficient: <a href="https://bit.ly/2SeTSsp" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2SeTSsp</span></a></li>
    </ul>
    <h1 id="calibre_link-1270" class="title">Grouping and Binning</h1>
    <p class="book-title--packt">Grouping and<a id="calibre_link-526" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> binning in Power BI creates group columns that can then be utilized like other columns in the model to simplify report visualizations and self-service analysis, given their reduced granularity. Additionally, groups can be managed and edited in Power BI Desktop, providing a flexible option for dataset owners to respond quickly to changing requirements or preferences.</p>
    <p class="book-title--packt">This recipe provides examples for using grouping and binning functionality within Power BI Desktop.</p>
    <h2 id="calibre_link-1829" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <code class="code-in-text--packt">AdWorksDW</code> query and place it into a <strong class="screentext">Data Sources</strong> query group</li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">AdWorksDW</code> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Internet Sales</strong> and choose the <strong class="screentext">FactInternetSales</strong> table</li>
      <li class="calibre12">Repeat <em class="italic">steps 4</em> and <em class="italic">5</em>, creating a <strong class="screentext">Dates</strong> query that points to the <strong class="screentext">DimDates</strong> table, and a <strong class="screentext">Customers</strong> query that points to the <strong class="screentext">DimCustomer</strong> table</li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> query to a Facts query group and the <strong class="screentext">Dates</strong> and <strong class="screentext">Customers</strong> queries to a <strong class="screentext">Dimensions</strong> query group</li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Switch to the <strong class="screentext">Model</strong> view and create a relationship between the <strong class="screentext">DateKey</strong> column in the <strong class="screentext">Dates</strong> table and the <strong class="screentext">OrderDateKey</strong> column in the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">CustomerKey</strong> columns in the <strong class="screentext">Customers</strong> table and the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Save your work</li>
    </ol>
    <h2 id="calibre_link-1830" class="calibre8">How to Perform Grouping and Binning</h2>
    <p class="book-title--packt">To implement this recipe, carry out the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Right-click the <strong class="screentext">DateFirstPurchased</strong> column in the <strong class="screentext">Customers</strong> table and choose <strong class="screentext">New Group</strong></li>
      <li class="calibre12">Set the <strong class="screentext">Name</strong> to <strong class="screentext">Customer First Purchase Calendar Quarter</strong>, the <strong class="screentext">Bin size</strong> to <strong class="screentext">3</strong>, choose <strong class="screentext">Months</strong> from <a id="calibre_link-527" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the dropdown, and click <strong class="screentext">OK</strong>
        <figure class="mediaobject"><img src="images/000432.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.24: Groups dialog for the First Purchase Date column with a Bin size of 3 Months</p>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Matrix</strong> visual that analyzes the sales of these quarterly customer bins using the newly created <strong class="screentext">Customer First Purchase Calendar Quarter</strong> column in the <strong class="screentext">Customer</strong> table for <strong class="screentext">Rows</strong>, the <strong class="screentext">CalendarYear</strong> column from the <strong class="screentext">Dates</strong> table for <strong class="screentext">Columns</strong>, and the <strong class="screentext">SalesAmount</strong> column (sum) from the <strong class="screentext">Internet Sales</strong> table as <strong class="screentext">Values</strong></li>
      <li class="calibre12">Optionally, add conditional formatting to the <strong class="screentext">SalesAmount</strong> column in the <strong class="screentext">Values</strong> field well by clicking the down arrow to the right of the column name and selecting <strong class="screentext">Conditional formatting</strong> and then <strong class="screentext">Data bars</strong>
        <figure class="mediaobject"><img src="images/000443.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.25: Customer First Purchase Calendar Quarter grouping used in Matrix Visual</p>
    <h2 id="calibre_link-1831" class="calibre8">How it works</h2>
    <p class="book-title--packt">By grouping the <a id="calibre_link-528" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>customers into quarterly bins, the new grouping column (<strong class="screentext">Customer First Purchase Calendar Quarter</strong>) has only 14 unique values and can be used in report visualizations. In this analysis, it is clear that sales in 2017 are being driven by customers that first purchased in the first and second quarters of 2013 (January 2013, April 2013). Interestingly, customers that first purchased in 2011 were large buyers in 2015, but then generally disappeared in 2016, and returned in 2017.</p>
    <h2 id="calibre_link-1832" class="calibre8">There's more</h2>
    <p class="book-title--packt">In this example, the goal is to group (bin) customers based on the number of days since their last purchase. To see how this works, perform the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create the following measure to define <strong class="screentext">Today</strong>:
        <pre class="programlisting"><code class="hljs">Today = DATE(2014,1,28)
</code></pre>
      </li>
      <li class="calibre12">Create the following columns in the <strong class="screentext">Customers</strong> table:
        <pre class="programlisting"><code class="hljs">Last Order Date = CALCuLATE(MAX('Internet Sales'[OrderDate]))
Days Since Last Purchase = ([Today] - [Last Order Date]) * 1
</code></pre>
      </li>
      <li class="calibre12">Create a numerical grouping based on the <strong class="screentext">Days Since Last Purchase</strong> column to help analyze <a id="calibre_link-529" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this data<figure class="mediaobject"><img src="images/000454.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.26: Grouping created based on the Days Since Last Purchase column</p>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Clustered</strong> bar chart to display the information graphically using the newly created <strong class="screentext">Days Since Last Purchase (bins)</strong> column in the <strong class="screentext">Customers</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">SalesAmount</strong> column from the <strong class="screentext">Internet Sales</strong> table as <strong class="screentext">Values</strong>
        <figure class="mediaobject"><img src="images/000465.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.27: Clustered bar chart of internet sales by the 90 Days Since Last Purchase grouping</p>
    <p class="book-title--packt">The new grouping<a id="calibre_link-530" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> column (<strong class="screentext">90 Days Since Last Purchase</strong>) helps determine that $15.7 M of total historical internet sales is comprised of customers that have purchased within the past 180 days ($7.3 M for the 0 to 90 group and $8.4 M for the 90 to 180 group).</p>
    <p class="book-title--packt">As groupings are effectively calculated columns within the data model and are not visible to source systems, the logic of grouping columns should eventually be migrated to new columns in a source data warehouse. Groups can be very helpful for proof-of-concept scenarios and short-term solutions, but as per other recipes, data transformation processes should be limited in Power BI Desktop to keep the dataset as manageable and scalable as possible. If a data warehouse option is not available, M query transformations can be used, rather than DAX calculated columns.</p>
    <h2 id="calibre_link-1833" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Use grouping<a id="calibre_link-531" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and binning in Power BI Desktop: <a href="https://bit.ly/3xHnMpG" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3xHnMpG</span></a></li>
    </ul>
    <h1 id="calibre_link-1271" class="title">Detecting and Analyzing Clusters</h1>
    <p class="book-title--packt">Clustering is a<a id="calibre_link-134" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> data mining and machine learning technique used to group (cluster) the items of one dimension based on the values of one or more measures. Given the number of distinct dimension items, such as products or customers, and the number of measures describing those items, clustering is a powerful method of exploring data to discover relationships not easily detected with standard reporting and analysis techniques. Power BI Desktop provides built-in support for the creation of clusters and allows these clusters to be managed, revised, and used in Power BI reports like other columns in the data model.</p>
    <p class="book-title--packt">In this recipe, a customer cluster is created based on the sales amount, the count of orders, and the count of days since the last purchase. DAX measures are created to support this analysis, and a <strong class="screentext">Scatter Chart</strong> visual is created to further analyze the clusters.</p>
    <h2 id="calibre_link-1834" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <code class="code-in-text--packt">AdWorksDW</code> query and place it into a <strong class="screentext">Data Sources</strong> query group</li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">AdWorksDW</code> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Internet Sales</strong> and choose the <strong class="screentext">FactInternetSales</strong> table</li>
      <li class="calibre12">Repeat <em class="italic">steps 4</em> and <em class="italic">5</em>, creating a <strong class="screentext">Dates</strong> query that points to the <strong class="screentext">DimDates</strong> table, a <strong class="screentext">Customers</strong> query that points to the <strong class="screentext">DimCustomer</strong> table, and a <strong class="screentext">Sales Territories</strong> query that points to the <strong class="screentext">DimSalesTerritory</strong> table</li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName"}, {"Product Category"}
        )
in
   Category
</code></pre>
      </li>
      <li class="calibre12">Move<a id="calibre_link-135" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Internet Sales</strong> query to a <strong class="screentext">Facts</strong> query group, and the <strong class="screentext">Dates</strong>, <strong class="screentext">Customers</strong>, and <strong class="screentext">Products</strong> queries to a <strong class="screentext">Dimensions</strong> query group</li>
      <li class="calibre12">In the <strong class="screentext">Other Queries</strong> group, create a blank query called <strong class="screentext">Calculations</strong></li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Switch to the <strong class="screentext">Model</strong> view and create a relationship between the <strong class="screentext">DateKey</strong> column in the <strong class="screentext">Dates</strong> table, and the <strong class="screentext">OrderDateKey</strong> in the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">CustomerKey</strong> columns in the <strong class="screentext">Customers</strong> table and the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">ProductKey</strong> columns in the <strong class="screentext">Products</strong> table and the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">SalesTerritoryKey</strong> columns in the <strong class="screentext">Sales Territories</strong> table and the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Save your work</li>
    </ol>
    <h2 id="calibre_link-1835" class="calibre8">How to Detect and Analyze Clusters</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create the following measures in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Today = DATE(2014,1,28)
Internet Gross Sales = SUM('Internet Sales'[SalesAmount])
Internet Sales Discounts = SUM('Internet Sales'[DiscountAmount])
Internet Net Sales = [Internet Gross Sales] - [Internet Sales Discounts]
Internet Sales Orders = DISTINCTCOUNT('Internet Sales'[SalesOrderNumber])
Last Purchase Date = LASTNONBLANK('Dates'[FullDateAlternateKey],[Internet Net Sales])
Days Since Last Purchase = DATEDIFF([Last Purchase Date],[Today],DAY)
</code></pre>
      </li>
      <li class="calibre12">In the <strong class="screentext">Report</strong> view, create a <strong class="screentext">Table</strong> visualization using the <strong class="screentext">CustomerAlternateKey</strong> column from the <strong class="screentext">Customers</strong> table and the <strong class="screentext">Internet Net Sales</strong>, <strong class="screentext">Internet Sales Orders</strong>, and <strong class="screentext">Days Since Last Purchase </strong>measures</li>
      <li class="calibre12">Select the <strong class="screentext"><a id="calibre_link-136" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">table</strong> visualization, click the ellipsis (<strong class="screentext">â¦</strong>), and choose <strong class="screentext">Automatically find clusters</strong></li>
      <li class="calibre12">In the <strong class="screentext">Clusters</strong> dialog, <strong class="screentext">Name</strong> the cluster <strong class="screentext">Customers</strong> (<strong class="screentext">RFM</strong>), enter a <strong class="screentext">Description </strong>of<strong class="screentext"> Clusters for All CustomerAlternateKey, Internet Net Sales, Internet Sales Orders, Days Since Last Purchase</strong>, and then click <strong class="screentext">OK</strong>
        <figure class="mediaobject"><img src="images/000476.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.28: Clusters dialog</p>
      </li>
      <li class="calibre12">Create three additional measures in the <strong class="screentext">Calculations</strong> table to help describe the clusters created:
        <pre class="programlisting"><code class="hljs">Average Customer Sales = 
AVERAGEX(DISTINCT(Customers[CustomerAlternateKey]),[Internet Net Sales])
Average Customer Orders = 
AVERAGEX(DISTINCT(Customers[CustomerAlternateKey]),[Internet Sales Orders])
Average Days Since Last Purchase = 
AVERAGEX(DISTINCT(Customers[CustomerAlternateKey]),[Days Since Last Purchase])
</code></pre>
      </li>
      <li class="calibre12">Create a <a id="calibre_link-137" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>simple <strong class="screentext">Table</strong> visualization using the three measures created plus the <strong class="screentext">Customers</strong> (<strong class="screentext">RFM</strong>) column and <strong class="screentext">CustomerAlternateKey</strong> (count) from the <strong class="screentext">Customers </strong>table, as well as the <strong class="screentext">Internet Net Sales</strong> measure<figure class="mediaobject"><img src="images/000487.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.29: Average Customer Measures used with the Customers (RFM) clusters</p>
      </li>
      <li class="calibre12">On a new page, create a Scatter chart with the <strong class="screentext">Average Days Since Last Purchase</strong> measure as the <strong class="screentext">X Axis</strong>, the <strong class="screentext">Average Customer Sales</strong> measure as the <strong class="screentext">Y Axis</strong>, and the <strong class="screentext">Customers (RFM)</strong> column from the <strong class="screentext">Customers</strong> table as <strong class="screentext">Legend</strong>
        <figure class="mediaobject"><img src="images/000498.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.30: Clusters visualized in a scatter chart by Internet Net Sales and Days Since Last Purchase</p>
    <p class="book-title--packt">A potential use <a id="calibre_link-138" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>case or action based on these clusters is to focus marketing efforts on converting the <strong class="screentext">Cluster1</strong> customers, who have purchased recently, to higher-value <strong class="screentext">Cluster3</strong> customers. Also, <strong class="screentext">Cluster2</strong> customers may have already committed to a new bike supplier or, more optimistically, may have purchased a bike two to three years ago, and may not be aware of what bike-related accessories and clothing are available.</p>
    <h2 id="calibre_link-1836" class="calibre8">How it works</h2>
    <p class="book-title--packt">Feature engineering is a common practice in data science, in which new columns are added to a dataset to produce more accurate models. The new columns often contain built-in logic, and features (columns) are added, removed, and modified iteratively based on the models produced. Identify measures that add the most value to the algorithm by representing the dimensions in different ways. The three measures used to support the clustering in this example follow the RFM technique, identifying the recency, frequency, and monetary (value) of the customer's purchase history. Adding measures (feature engineering) that cover each component of RFM is useful for various marketing and customer attrition analyses.</p>
    <p class="book-title--packt">Following the RFM technique, the <strong class="screentext">Days Since Last Purchase</strong> measure identifies the recency, <strong class="screentext">Internet Sales Orders</strong> measures the frequency, and <strong class="screentext">Internet Net Sales</strong> measures the monetary value. The <strong class="screentext">Last Purchase Date</strong> measure is an intermediary measure created to support the <strong class="screentext">Days Since Last Purchase</strong> measure. <strong class="screentext">Days Since Last Purchase</strong> uses the <strong class="screentext">Last Purchase Date</strong> measure and a <strong class="screentext">Today</strong> measure as parameter inputs to the DATEDIFF function. In a production scenario, the <strong class="screentext">Today</strong> measure would use the TODAY function instead of a hard-coded DATE.</p>
    <p class="book-title--packt">Three clusters were created in this example. These clusters are represented by a column added to<a id="calibre_link-1837" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Customers</strong> table of the data model with the name provided in the <strong class="screentext">Clusters</strong> dialog, <strong class="screentext">Customers (RFM)</strong>. The cluster column is identified in the <strong class="screentext">Fields</strong> list with two overlapping square shapes, and an <strong class="screentext">Edit clusters</strong> option is available by either right-clicking the column or selecting the ellipsis next to the column.</p>
    <p class="book-title--packt">For the analysis measures, <strong class="screentext">Average Customer Sales</strong>, <strong class="screentext">Average Customer Orders</strong>, and <strong class="screentext">Average Days Since Last Purchase</strong>, the <strong class="screentext">AVERAGEX</strong> function is used to iterate over the unique customer keys provided by the <strong class="screentext">DISTINCT</strong> function to compute the customer-specific value (sales, orders, and days since purchase) and then return the average of the measures from each cluster.</p>
    <p class="book-title--packt">The Power BI clustering feature uses the K-Means algorithm to determine the optimal number of clusters to create. Currently, a cluster is limited to 15 measures and one dimension; an error message is returned if these limits are exceeded.</p>
    <h2 id="calibre_link-1838" class="calibre8">There's more</h2>
    <p class="book-title--packt">In addition to the standard Power BI clustering from this recipe, additional custom visuals for clustering are available in the AppStore, including <strong class="screentext">Clustering</strong> and <strong class="screentext">Clustering with Outliers</strong>. Both these custom visuals are built with the R statistical programming language.</p>
    <p class="book-title--packt">Like the table visual from the example, clusters can also be automatically created from a Scatter chart visual. These clusters are limited to two input measures (X and Y) but the clusters are automatically added to the <strong class="screentext">Details</strong> field. To see how this works, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">On a new page, create a Scatter chart visualization using the <strong class="screentext">Internet Net Sales</strong> measure as the <strong class="screentext">X Axis</strong>, the <strong class="screentext">Internet Sales Orders</strong> measure as the <strong class="screentext">Y Axis</strong>, and the <strong class="screentext">EnglishProductName</strong> column from the <strong class="screentext">Products</strong> table as <strong class="screentext">Details</strong></li>
      <li class="calibre12">Select the <a id="calibre_link-139" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>scatter chart visualization, click the ellipsis (<strong class="screentext">â¦</strong>), and choose <strong class="screentext">Automatically find clusters</strong>
        <figure class="mediaobject"><img src="images/000008.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.31: Clusters automatically added to the legend of a Scatter chart</p>
    <h2 id="calibre_link-1839" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Apply<a id="calibre_link-133" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> clustering techniques: <a href="https://bit.ly/3gVwKK3" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3gVwKK3</span></a></li>
    </ul>
    <h1 id="calibre_link-1272" class="title">Forecasting and Anomaly Detection</h1>
    <p class="book-title--packt">Standard <a id="calibre_link-492" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI <a id="calibre_link-73" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>report and dashboard visualizations are great tools to support descriptive and diagnostic analytics of historical or real-time data, but ultimately organizations need predictive and prescriptive analytics to help guide decisions involving future outcomes. Power BI Desktop provides a time series forecasting tool with built-in predictive modeling capabilities that enables report authors to quickly create custom forecasts, evaluate the accuracy of these forecasts, and build intuitive visualizations that blend actual or historical data with the forecast.</p>
    <p class="book-title--packt">This recipe contains two complete forecasting examples. The first example builds a monthly forecast for the next three months utilizing an automatic date hierarchy. The second example builds a weekly forecast of the next eight weeks and evaluates the forecast's accuracy when applied to recent data. Finally, an example of using anomaly detection is provided.</p>
    <h2 id="calibre_link-1840" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and ensure that the <strong class="screentext">Auto Date/Time</strong> setting in the <strong class="screentext">Current File Data Load</strong> options is enabled (through <strong class="screentext">File | Options and settings | Options</strong>)</li>
      <li class="calibre12">Access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create <a id="calibre_link-493" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a <a id="calibre_link-74" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <code class="code-in-text--packt">AdWorksDW</code> query and place it into a <strong class="screentext">Data Sources</strong> query group</li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">AdWorksDW</code> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Internet Sales</strong> and choose the <strong class="screentext">FactInternetSales</strong> table</li>
      <li class="calibre12">Repeat <em class="italic">steps </em><em class="italic">4</em> and <em class="italic">5</em>, creating a <strong class="screentext">Dates</strong> query that points to the <strong class="screentext">DimDates</strong> table</li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> query to a <strong class="screentext">Facts</strong> query group and the <strong class="screentext">Dates</strong> query to a <strong class="screentext">Dimensions</strong> query group</li>
      <li class="calibre12">In the <strong class="screentext">Other Queries</strong> group, create a blank query called <strong class="screentext">Calculations</strong></li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Switch to the <strong class="screentext">Model</strong> view and create a relationship between the <strong class="screentext">DateKey</strong> column in the <strong class="screentext">Dates</strong> table, and the <strong class="screentext">OrderDateKey</strong> column in the <strong class="screentext">Internet Sales</strong> table</li>
      <li class="calibre12">Save your work</li>
    </ol>
    <h2 id="calibre_link-1841" class="calibre8">How to Perform Forecasting and Anomaly Detection</h2>
    <p class="book-title--packt">To implement this recipe, carry out the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create the following measures in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Today = DATE(2014,1,28)
Internet Gross Sales = SUM('Internet Sales'[SalesAmount])
Internet Sales Discounts = SUM('Internet Sales'[DiscountAmount])
Internet Net Sales = [Internet Gross Sales] - [Internet Sales Discounts]
</code></pre>
      </li>
      <li class="calibre12">In the <strong class="screentext">Report</strong> view, create a Line chart visualization using <strong class="screentext">FullDateAlternateKey</strong> from the <strong class="screentext">Dates</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">Internet Net Sales</strong> measure as the <strong class="screentext">Values</strong></li>
      <li class="calibre12">With<a id="calibre_link-75" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <a id="calibre_link-494" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>visualization selected, click on the <strong class="screentext">Expand all down one level in the hierarchy</strong> button twice to navigate to the monthly grain<figure class="mediaobject"><img src="images/000020.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.32: Expand all down used to display the line chart visual by month</p>
      </li>
      <li class="calibre12">With the line chart selected, open the <strong class="screentext">Analytics</strong> pane, expand <strong class="screentext">Forecast</strong>, and click <strong class="screentext">Add</strong></li>
      <li class="calibre12">Enter <strong class="screentext">3</strong> for <strong class="screentext">Forecast</strong> length, <strong class="screentext">1</strong> for <strong class="screentext">Ignore last</strong>, and <strong class="screentext">12</strong> for <strong class="screentext">Seasonality</strong>
        <figure class="mediaobject"><img src="images/000032.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.33: Monthly forecast with three forecast points and excluding the most current month</p>
      </li>
      <li class="calibre12">Create<a id="calibre_link-76" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> new<a id="calibre_link-495" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> columns in the <strong class="screentext">Dates</strong> table with the following code:
        <pre class="programlisting"><code class="hljs">Sequential = 
    VAR __Date = 'Dates'[FullDateAlternateKey]
    VAR __Year = YEAR(__Date) 
    VAR __Calendar = ADDCOLUMNS(ALL('Dates'), 
            "__Year", YEAR('Dates'[FullDateAlternateKey]),
            "__WeekNum", WEEKNUM('Dates'[FullDateAlternateKey]))
    VAR __FirstYear = MINX(__Calendar,[__Year])
    VAR __WeekNum = MAXX(FILTER(__Calendar, 
        [FullDateAlternateKey] = __Date), [__WeekNum])
    VAR __MaxWeeks = GROUPBY(__Calendar, [__Year],
        "__MaxWeek", MAXX(CURRENTGROUP(), [__WeekNum]))
    VAR __Start = SUMX(FILTER(__MaxWeeks, [__Year]&lt;__Year), [__MaxWeek])
    VAR __Calendar1 = ADDCOLUMNS(__Calendar,
            "__MaxWeek", 
            MAXX(FILTER(__Calendar, [__Year] = 
                EARLIER([__Year])),[__WeekNum]))
    VAR __SubtractTable = GROUPBY(FILTER(__Calendar1,
            [__Year] &lt; __Year &amp;&amp; [__WeekNum] = [__MaxWeek]), [__Year],
            "__NumWeekDays", COUNTX(CURRENTGROUP(),[FullDateAlternateKey]))
    VAR __Subtract = COUNTROWS(FILTER(__SubtractTable, [__NumWeekDays]&lt;7))
    VAR __Sequential = IF(__Year=__FirstYear, 
        __WeekNum, 
        __Start + __WeekNum - __Subtract)
RETURN __Sequential
Week Ending Date = 
    VAR __CurrentWeek = [Sequential]
RETURN 
    MAXX(FILTER(ALL('Dates'),[Sequential] = __CurrentWeek),
        [FullDateAlternateKey])
IsCurrentWeek = 
    VAR __CurrentWeek = 
        LOOKUPVALUE('Dates'[Sequential],'Dates'[FullDateAlternateKey],[Today])
RETURN
    IF([Sequential] = __CurrentWeek,1,0)
</code></pre>
      </li>
      <li class="calibre12">In the <strong class="screentext">Report</strong> view, create another <strong class="screentext">Line chart</strong> visualization using <strong class="screentext">Week Ending Date</strong> (not the hierarchy) from the <strong class="screentext">Dates</strong> table as the <strong class="screentext">Axis</strong>, and the <strong class="screentext">Internet Net Sales</strong> measure as the <strong class="screentext">Values</strong></li>
      <li class="calibre12">With <a id="calibre_link-77" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <a id="calibre_link-496" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>visualization selected, use the <strong class="screentext">Filters</strong> pane and add the <strong class="screentext">IsCurrentWeek</strong> column to the filters for the visualization, and exclude values of <strong class="screentext">1</strong></li>
      <li class="calibre12">With the line chart selected, open the <strong class="screentext">Analytics</strong> pane, expand <strong class="screentext">Forecast</strong>, and click <strong class="screentext">Add</strong></li>
      <li class="calibre12">Enter <strong class="screentext">8</strong> for <strong class="screentext">Forecast</strong> length, <strong class="screentext">5</strong> for <strong class="screentext">Ignore last</strong>, and <strong class="screentext">52</strong> for <strong class="screentext">Seasonality</strong>
        <figure class="mediaobject"><img src="images/000044.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.34: Weekly sales trend and three-week forecast, which excludes the prior 5 completed weeks</p>
    <h2 id="calibre_link-1842" class="calibre8">How it works</h2>
    <p class="book-title--packt">The Power BI Forecast tool uses the exponential smoothing time series predictive algorithm. This method is widely used in multiple domains and helps to suppress outlier values while efficiently capturing trends. The forecast tool is currently only available to the<strong class="screentext"> Line chart</strong> visual, and <a id="calibre_link-571" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>only one measure (line) on this visual is allowed. The x-axis value needs to have a date or date/time data type or be a uniformly increasing whole number and a minimum of six date points are required.</p>
    <p class="book-title--packt">The Forecast tool in Power BI includes an <strong class="screentext">Ignore last</strong> feature, which allows the exclusion of incomplete periods (months, weeks, and days) from the forecast. However, for common additive measures, such as <strong class="screentext">Sales Amount</strong>, not filtering out the current period often significantly detracts from the usability of the visual, given the steep decline represented by the current (incomplete) period. Dynamically updated date columns, such as <strong class="screentext">IsCurrentWeek</strong>, generally resolve this issue.</p>
    <p class="book-title--packt">In the first line chart, by default, a forecast of the chosen measure is created for 10 points (months) in the future with a 95 percent <strong class="screentext">Confidence interval</strong>. The forecast automatically determines the step (monthly grain) and also determines a seasonality factor to apply to the forecast. In this example, no filters have been applied to the report, and thus the current month, which is incomplete, is initially being used by the forecast. By setting <strong class="screentext">Ignore last</strong> to <strong class="screentext">1</strong> point we exclude the most current, incomplete month. </p>
    <p class="book-title--packt">The<a id="calibre_link-78" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> forecast <a id="calibre_link-497" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>now includes a forecasted value for the current (incomplete) month. Applying the <strong class="screentext">Seasonality</strong> variable at its known grain (12 per year) overrides the default seasonality factor.</p>
    <p class="book-title--packt">When the seasonality (points per cycle) is known, it is recommended to apply this value manually to improve accuracy. Hovering over a forecast data point exposes both the forecast and the upper and lower boundary values, given the 95 percent confidence interval. </p>
    <p class="book-title--packt">In the second example, the last completed <strong class="screentext">Week Ending Date</strong> is 1/25/14. Therefore, given <strong class="screentext">5</strong> points to ignore, this point and the four previous weeks are excluded from the forecasting algorithm, such that the forecast can only use the weeks ending on 12/21/13 and earlier to generate its projections. Three additional forecast points (8 (Forecast Length) &mdash; 5 (Ignore Last)) are computed for the weeks ending on 2/1/14, 2/8/14, and 2/15/14. </p>
    <h2 id="calibre_link-1843" class="calibre8">There's more</h2>
    <p class="book-title--packt">In addition to the <a id="calibre_link-491" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>forecasting feature, the line chart visualization also now includes an anomaly detection feature. To see how this works, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Ensure that the <strong class="screentext">Anomaly detection</strong> feature is activated in the <strong class="screentext">Preview</strong> features by selecting <strong class="screentext">File</strong> | <strong class="screentext">Options and settings</strong> | <strong class="screentext">Options</strong>, and then <strong class="screentext">Preview</strong> features</li>
      <li class="calibre12">Copy the <strong class="screentext">Week Ending Date</strong> line chart to a new page</li>
      <li class="calibre12">Remove <strong class="screentext">Forecast</strong> in the <strong class="screentext">Analytics</strong> pane</li>
      <li class="calibre12">Expand <strong class="screentext">Find anomalies</strong> and choose <strong class="screentext">Add</strong>
        <figure class="mediaobject"><img src="images/000056.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.35: Find anomalies</p>
    <p class="book-title--packt">The <a id="calibre_link-1844" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>default <strong class="screentext">Sensitivity</strong> is 70 percent. Increasing the <strong class="screentext">Sensitivity</strong> identifies more anomalies.</p>
    <h2 id="calibre_link-1845" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Data Forecasting and Analytics with Power BI Desktop: <a href="https://bit.ly/3xFWakx" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3xFWakx</span></a></li>
      <li class="bullet">Anomaly detection tutorial: <a href="https://bit.ly/3t6NAIc%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3t6NAIc</span></a></li>
    </ul>
    <h1 id="calibre_link-1273" class="title">Using R and Python Visuals</h1>
    <p class="book-title--packt">The R and <a id="calibre_link-997" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Python<a id="calibre_link-869" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> programming languages, including their powerful and extensible features in data processing, advanced analytics, and visualization, are deeply integrated with Power BI. R and Python scripts can be used as a data source for a Power BI dataset, as a data transformation and shaping process within M queries, and as their own visualization type within Power BI reports and dashboards. Like standard Power BI visuals, R and Python script visuals directly leverage the relationships defined in the data model and can be dynamically filtered via other visuals, such as slicers.</p>
    <p class="book-title--packt">In this recipe, two histogram visualizations are created in Power BI Desktop with R scripts: one with R's standard distribution base graphics, and another with the popular <code class="code-in-text--packt">ggplot2</code> visualization package. Additionally, a Python visual example is included.</p>
    <h2 id="calibre_link-1846" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Download and install the R engine on the local machine using either of the following:<ul class="calibre11">
          <li class="calibre12"><a href="https://cran.r-project.org/bin/windows/base/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://cran.r-project.org/bin/windows/base/</span></a></li>
          <li class="calibre12"><a href="https://aka.ms/rclient/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://aka.ms/rclient/</span></a></li>
        </ul>
      </li>
      <li class="calibre12">Install the <code class="code-in-text--packt">ggplot2</code> package for R via the following command: <code class="code-in-text--packt">install.packages("ggplot2")</code>.</li>
      <li class="calibre12">Optionally, install an IDE for editing R scripts, such as RStudio (<a href="https://www.rstudio.com/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://www.rstudio.com/</span></a>).</li>
      <li class="calibre12">Open Power BI Desktop and confirm that the local R installation directory path is reflected <a id="calibre_link-1847" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>in<a id="calibre_link-1848" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">R script</strong> options in Power BI Desktop (<strong class="screentext">File</strong> | <strong class="screentext">Options and settings</strong> | <strong class="screentext">Options</strong>).</li>
      <li class="calibre12">Similarly, install Python from <a href="http://www.python.org" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://www.python.org</span></a> or Python bundled in Anaconda (<a href="https://www.anaconda.com/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://www.anaconda.com/</span></a>) and verify the <strong class="screentext">Python script options</strong> in Power BI Desktop (<strong class="screentext">File</strong> | <strong class="screentext">Options and settings</strong> | <strong class="screentext">Options</strong>).<figure class="mediaobject"><img src="images/000068.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.36: R script options in Power BI Desktop</p>
        <p class="packt_figref">The <strong class="screentext">Detected R IDEs</strong> and <strong class="screentext">Detected Python IDEs</strong> dropdowns can be used to choose between multiple installed IDEs. If R and Python script visuals have not been used in Power BI Desktop, an <strong class="screentext">Enable script visuals</strong> prompt will appear. Click <strong class="screentext">Enable</strong>.</p>
      </li>
      <li class="calibre12">Install matplotlib for Python using the following command: <code class="code-in-text--packt">python -m pip install matplotlib</code>.</li>
      <li class="calibre12">Install pandas for Python using the following command: <code class="code-in-text--packt">python -m pip install pandas</code>.</li>
      <li class="calibre12">Access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable<a id="calibre_link-998" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> load on the <code class="code-in-text--packt">AdWorksDW</code> query and place it into a <strong class="screentext">Data Sources</strong> query <a id="calibre_link-870" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>group.</li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">AdWorksDW</code> query and choose <strong class="screentext">Reference</strong>.</li>
      <li class="calibre12">Rename the query <strong class="screentext">Internet Sales</strong> and choose the <strong class="screentext">FactInternetSales</strong> table.</li>
      <li class="calibre12">Repeat <em class="italic">steps 4</em> and <em class="italic">5</em>, creating a <strong class="screentext">Dates</strong> query that points to the <strong class="screentext">DimDates</strong> table.</li>
      <li class="calibre12">Create a <strong class="screentext">Products</strong> query using the following code:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW,
    Navigation = Source{[Schema="dbo",Item="DimProduct"]}[Data],
    Subcategory = 
        Table.ExpandRecordColumn(
            Navigation, "DimProductSubcategory", 
            {"EnglishProductSubcategoryName", "DimProductCategory"}, 
            {"Product Subcategory", "DimProductCategory"}
        ),
    Category = 
        Table.ExpandRecordColumn(
            Subcategory, "DimProductCategory", 
            {"EnglishProductCategoryName", "ProductCategoryKey"}, 
            {"Product Category", "ProductCategoryKey"}
        )
in
   Category
</code></pre>
      </li>
      <li class="calibre12">Move the <strong class="screentext">Internet Sales</strong> query to a <strong class="screentext">Facts</strong> query group and the <strong class="screentext">Dates</strong> and <strong class="screentext">Products</strong> queries to a <strong class="screentext">Dimensions</strong> query group.</li>
      <li class="calibre12">In the <strong class="screentext">Other Queries</strong> group, create a blank query called <strong class="screentext">Calculations</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Switch to the <strong class="screentext">Model</strong> view and create a relationship between the <strong class="screentext">DateKey</strong> column in the <strong class="screentext">Dates</strong> table, and the <strong class="screentext">OrderDateKey</strong> column in the <strong class="screentext">Internet Sales</strong> table.</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">ProductKey</strong> columns in the <strong class="screentext">Products</strong> table and the <strong class="screentext">Internet Sales</strong> table.</li>
      <li class="calibre12">Save your work.</li>
    </ol>
    <h2 id="calibre_link-1849" class="calibre8">How to Use R and Python Visuals</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create<a id="calibre_link-999" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the<a id="calibre_link-871" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following measures in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Internet Gross Sales = SUM('Internet Sales'[SalesAmount])
Internet Sales Discounts = SUM('Internet Sales'[DiscountAmount])
Internet Net Sales = [Internet Gross Sales] - [Internet Sales Discounts]
</code></pre>
      </li>
      <li class="calibre12">In the <strong class="screentext">Report</strong> view, use the <strong class="screentext">Filters</strong> pane to add a filter for the <strong class="screentext">CalendarYear</strong> column from the <strong class="screentext">Dates</strong> table, and select <strong class="screentext">2013</strong> only</li>
      <li class="calibre12">Add an R script visual from the <strong class="screentext">Visualizations</strong> pane, and add the <strong class="screentext">ProductKey</strong> and <strong class="screentext">ListPrice</strong> columns from the <strong class="screentext">Products</strong> table, the <strong class="screentext">CalendarYear</strong> column from the <strong class="screentext">Dates</strong> table, and the <strong class="screentext">Internet Net Sales</strong> measure to the <strong class="screentext">Values</strong> field well</li>
      <li class="calibre12">Enter the following R script into the R script editor and click the <strong class="screentext">Run script</strong> icon:
        <pre class="programlisting"><code class="hljs">par(bg = "#E6E6E6")
hist(dataset$'ListPrice', breaks = seq(from=0, to = 2500, by = 500), col = "#2C95FF",
main = "Current Year Online Sales List Price Distribution", cex.main = 1.75, cex.axis = 1.2, cex.lab = 1.4, ylab = "Count of Products", xlab = "Product List Price Bins", las = 1, labels = TRUE, border = "black", ylim=c(0,50))
</code></pre>
        <figure class="mediaobject"><img src="images/000080.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 9.37: R script visual rendered in Power BI via Base Graphics</p>
      </li>
      <li class="calibre12">Copy <a id="calibre_link-1850" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and paste the R script visual on the same page</li>
      <li class="calibre12">Select the <a id="calibre_link-872" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>pasted R script visual and change the code to the following:
        <pre class="programlisting"><code class="hljs">prices &lt;- as.numeric(as.character(dataset$'ListPrice'))
breakpoints &lt;- seq(from=0, to = 2500, by = 500)
library("ggplot2")
ggplot(dataset, aes(x = prices)) + geom_histogram(breaks = breakpoints, fill = "#2C95FF", color = "black") + xlab("Product List Price Bins") + ylab("Count of Products") + ggtitle("Current Year Online Sales List Price Distribution") + stat_bin(breaks = breakpoints, geom="text", aes(label=..count..), vjust = -1) + coord_cartesian(ylim=c(0,50)) + theme(text = element_text(size = 16)) + theme(plot.title = element_text(hjust = .5))
</code></pre>
      </li>
      <li class="calibre12">The result of this code change is shown in <em class="italic">Figure 9.38</em>
        <figure class="mediaobject"><img src="images/000092.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.38: R script visual rendered in Power BI via the ggplot2 package</p>
    <h2 id="calibre_link-1851" class="calibre8">How it works</h2>
    <p class="book-title--packt">If a supported <a id="calibre_link-1000" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>external R IDE is installed and selected in the <strong class="screentext">Detected R IDEs</strong> R<a id="calibre_link-1852" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> scripting options, as per the <em class="italic">Getting ready</em> section, you can click on <strong class="screentext">Edit script in External R IDE</strong> (the up arrow icon). This will launch the IDE application (such as RStudio) and export the data frame from Power BI Desktop. Common features of R scripting IDEs, such as IntelliSense and Variable History, are helpful (if not essential) for developing complex R script visuals.</p>
    <p class="book-title--packt">The requirement for both visualizations in this recipe is to display the distribution of the product list prices that have been sold online in the current calendar year. The first example uses the standard <code class="code-in-text--packt">hist()</code> function with R's base graphics and the second example uses the <code class="code-in-text--packt">ggplot()</code> function provided by the <code class="code-in-text--packt">ggplot2</code> package for R.</p>
    <p class="book-title--packt">The light gray background color is set via the <code class="code-in-text--packt">par()</code> function, and arguments to the <code class="code-in-text--packt">hist()</code> function define the x- and y-axes, the text strings for the titles, data labels, font sizes, and the light blue color of the bars. The <code class="code-in-text--packt">seq()</code> function is used to configure the x-axis intervals (bins) with a width or bin size of $500, and a maximum price of $2,500.</p>
    <p class="book-title--packt"><code class="code-in-text--packt">ggplot2</code>'s <code class="code-in-text--packt">geom_histogram()</code> requires a continuous variable, and thus the <strong class="screentext">List</strong> <strong class="screentext">Price</strong> column is converted to a numeric data type in the <code class="code-in-text--packt">prices</code> variable. The vector expression (<code class="code-in-text--packt">seq()</code>) used for the x-axis (bins by 500 to 2,500) in the prior example is used as the parameter to the <strong class="screentext">breaks</strong> argument of <code class="code-in-text--packt">geom_histogram()</code> and <code class="code-in-text--packt">stat_bin()</code>. Likewise, the expression for the y-axis in the prior example is reused, but passed as a parameter to the <code class="code-in-text--packt">coord_cartesian()</code> function. The <code class="code-in-text--packt">qplot()</code> function, short for quick plot, is also available in the <code class="code-in-text--packt">ggplot2</code> package, and can result in the faster development of relatively complex visualizations with less code&mdash;often in just one line.</p>
    <p class="book-title--packt">The R script editor in Power BI Desktop automatically creates a data frame and removes duplicate rows based on the columns loaded to the <strong class="screentext">Values</strong> field well.</p>
    <figure class="mediaobject"><img src="images/000105.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 9.39: Power BI Desktop R script editor data frame and duplicate removal</p>
    <p class="book-title--packt">In this example, in <a id="calibre_link-1001" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>which the intent is to count individual products (including those with the<a id="calibre_link-873" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> same list price), it is necessary to add a separate column in the data frame (the <strong class="screentext">product key</strong> column) that makes each row of the data frame unique. In other scenarios, the <code class="code-in-text--packt">Table.AddIndexColumn()</code> M function could be used to create uniqueness.</p>
    <p class="book-title--packt">Including the <strong class="screentext">Internet Net Sales</strong> measure in the R script visuals data frame allows the visual to be filtered by the <strong class="screentext">Date</strong> dimension columns and other dimension tables on the report page.</p>
    <p class="book-title--packt">By default, the products without any sales, given this filter context, will not be included in the data frame, as per the requirements of this recipe. The <strong class="screentext">show items with no data</strong> option for the <strong class="screentext">Product Key</strong> column in the <strong class="screentext">Values</strong> field well can be used if the products without sales are to be included in this visualization.</p>
    <p class="book-title--packt">The R script data source connector is available in the <strong class="screentext">Other</strong> category of the <strong class="screentext">Get Data</strong> dialog. A <strong class="screentext">Run R Script</strong> command icon is available in the <strong class="screentext">Transform</strong> window of the Query Editor. Many custom visuals built with R are already available in AppSource, and as of July 2017, R custom visuals can include interactive features, such as selection and zoom.</p>
    <h2 id="calibre_link-1853" class="calibre8">There's more</h2>
    <p class="book-title--packt">Python can also be used to create visuals. To see how this is done, perform the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a new page and use the <strong class="screentext">Filters</strong> pane to add a filter for the <strong class="screentext">CalendarYear</strong> column from the <strong class="screentext">Dates</strong> table, and select <strong class="screentext">2013</strong> only</li>
      <li class="calibre12">Create a Python visual and add the <strong class="screentext">Product Category</strong> column from the <strong class="screentext">Products</strong> table, and the <strong class="screentext">Internet Net Sales</strong> measure to the <strong class="screentext">Values</strong> field well</li>
      <li class="calibre12">Use the following code for the Python visual, and click the <strong class="screentext">Run script</strong> icon:
        <pre class="programlisting"><code class="hljs"><span>import</span> matplotlib.pyplot <span>as</span> plt 
dataset.plot(kind='bar',x='Product Category',y='Internet Net Sales') 
plt.show() 
</code></pre>
      </li>
      <li class="calibre12">This<a id="calibre_link-874" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> code <a id="calibre_link-1002" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>change results in the visual shown in <em class="italic">Figure 9.40</em>
        <figure class="mediaobject"><img src="images/000118.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 9.40: Default Python histogram</p>
    <h2 id="calibre_link-1854" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Install <a id="calibre_link-610" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Microsoft R Client on Windows: <a href="https://bit.ly/3aYfDDl" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3aYfDDl</span></a></li>
      <li class="bullet">Create<a id="calibre_link-825" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Power BI visuals using R: <a href="https://bit.ly/3aWN4pP%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3aWN4pP</span></a></li>
      <li class="bullet">R Script Visual Showcase for Power BI: <a href="https://community.powerbi.com/t5/R-Script-Showcase/bd-p/RVisuals" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://community.powerbi.com/t5/R-Script-Showcase/bd-p/RVisuals</span></a></li>
      <li class="bullet">Run Python Scripts in Power BI Desktop: <a href="https://bit.ly/2QNtDcl" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2QNtDcl</span></a></li>
      <li class="bullet">Create Power BI visuals using Python in Power BI Desktop: <a href="https://bit.ly/3aUfVve" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3aUfVve</span></a></li>
    </ul>
    <h1 id="calibre_link-1274" class="title">Conclusion</h1>
    <p class="book-title--packt">This chapter contained a broad mix of recipes highlighting many of the latest and most popular custom visualizations and advanced analytics features of Power BI. This included custom visuals, the ArcGIS map visual, and data storytelling via animation and annotation. Additionally, examples were provided of leveraging Power BI datasets, and the DAX, R, and Python languages to embed custom statistical analyses and visualizations.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-10">
<div id="calibre_link-1855" class="calibre2">
<div id="calibre_link-1856" class="calibre3"><div id="calibre_link-1857" class="calibre4">
    <h1 class="heading">10</h1>
    <h1 id="calibre_link-1275" class="title">Administering and Monitoring Power BI</h1>
    <p class="book-title--packt">In addition to solutions targeting business processes and entities, such as sales and customers, Power BI can also serve as a platform for system monitoring and administration. Diverse system telemetry and diagnostic data sources such as logs from Azure services, performance monitor counters, and events can be integrated into Power BI datasets to deliver robust visibility to system health, activity, and performance. Although there are several dedicated monitoring tools available, such as Operations Manager in Microsoft System Center, building a custom solution with Power BI provides full flexibility and control over all layers of the solution, while leveraging relevant Power BI features, including data-driven alerts, email notifications and subscriptions, and Power BI mobile. Additionally, as more organizations adopt and deploy Power BI, existing licenses and experience can significantly reduce the costs of developing and maintaining these solutions.</p>
    <p class="book-title--packt">This chapter's recipes highlight the most common and impactful administration data sources, including Windows Performance Monitor, SQL Server Query Store, on-premises data gateways, the MSDB system database, and Extended Events. Power BI solutions built on top of these sources proactively assess usage trends and resource bottlenecks, and deliver the detailed analysis necessary to identify root causes. Additionally, the metadata of existing Power BI and SSAS data models exposed via <strong class="screentext">dynamic management views</strong> (<strong class="screentext">DMVs</strong>), such as measure and relationship definitions and resource consumption, can be integrated to provide a simplified reference or documentation asset for both BI and business teams. Erin Stellato, principal consultant from SQL skills and Microsoft Data Platform MVP, has contributed to several of these recipes, including references to the setup and utilization of relational database monitoring and administrative data sources.</p>
    <p class="book-title--packt">In this chapter, we will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Creating a centralized IT monitoring solution with Power BI</li>
      <li class="bullet">Constructing a monitoring, visualization, and analysis layer</li>
      <li class="bullet">Importing and visualizing dynamic management view (DMV) data</li>
      <li class="bullet">Increasing DBA productivity</li>
      <li class="bullet">Providing documentation</li>
      <li class="bullet">Analyzing SSAS tabular databases and gateways</li>
      <li class="bullet">Analyzing Extended Events</li>
      <li class="bullet">Visualizing log file data</li>
      <li class="bullet">Leveraging the Power BI PowerShell Module</li>
    </ul>
    <h1 id="calibre_link-1276" class="title">Technical requirements</h1>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop.</li>
      <li class="bullet">SQL Server with the <strong class="screentext">AdventureWorksDW2019</strong> database installed. This database and instructions for installing it are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a>.</li>
      <li class="bullet">Files for this chapter can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a>.</li>
    </ul>
    <h1 id="calibre_link-1277" class="title">Creating a centralized IT monitoring solution with Power BI</h1>
    <p class="book-title--packt">Power BI's <a id="calibre_link-128" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>rich data connectivity <a id="calibre_link-742" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and transformation capabilities are very well suited for the integration needs of system and database administrators. A collection of log files containing performance monitor counter statistics can be retrieved from a file directory (or multiple directories), consolidated, and further enhanced to support reporting. Additional sources, such as snapshots of performance and configuration data stored in a dedicated administrator database, can also be included in a scheduled data refresh process, and the inclusion of existing BI dimension tables, such as date and time, further simplifies the overall monitoring solution.</p>
    <p class="book-title--packt">In this recipe, a set of Windows Performance Monitor counter files containing statistics on CPU, memory, and more are integrated with administrative data stored in a SQL Server database, including query wait statistics and instance configuration values.</p>
    <h2 id="calibre_link-1858" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12">Identify the administrative stakeholders familiar with the current state of monitoring and the top priorities of the solution, such as "How is performance today?" and/or "Has a configuration changed?"</li>
      <li class="calibre12">Sharpen the meaning of these questions to identify the required data sources, including performance counters and system views</li>
      <li class="calibre12">Create a dedicated database named <strong class="screentext">Admin</strong> in SQL Server that will exclusively store system and administrative data</li>
      <li class="calibre12">Use Windows Performance Monitor to design and schedule a new data collector set containing<a id="calibre_link-129" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the following <a id="calibre_link-743" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>performance monitor counters:<ul class="calibre11">
          <li class="calibre12"><code class="code-in-text--packt">\Memory\Available Mbytes</code></li>
          <li class="calibre12"><code class="code-in-text--packt">\PhysicalDisk(_Total)\Avg. Disk sec/Read</code></li>
          <li class="calibre12"><code class="code-in-text--packt">\PhysicalDisk(_Total)\Avg. Disk sec/Write</code></li>
          <li class="calibre12"><code class="code-in-text--packt">\Processor(_Total)\% Processor Time</code></li>
          <li class="calibre12"><code class="code-in-text--packt">\SQL Server:Buffer Manager\Page life expectancy</code></li>
          <li class="calibre12"><code class="code-in-text--packt">\SQL Server:SQL Statistics\Batch Requests/sec</code></li>
        </ul>
      </li>
    </ol>
    <p class="book-title--packt">Performance Monitor defaults to <code class="code-in-text--packt">.blg</code> log files, but Power BI can only consolidate files in text, CSV, and Excel format, so set <strong class="screentext">Log format</strong> to <strong class="screentext">Comma separated</strong>. Windows Performance Monitor is well documented and understood by most administrators. Best practices and automation via PowerShell are outside the scope of this recipe.</p>
    <h2 id="calibre_link-1859" class="calibre8">How to create a centralized IT monitoring solution</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create query parameters called <strong class="screentext">SQLServer</strong>, <strong class="screentext">AdventureWorksDB</strong>, and <strong class="screentext">AdminDB</strong>, and set their values to your SQL Server instance, <strong class="screentext">AdventureWorksDW2019</strong> and <strong class="screentext">Admin</strong>, respectively.</li>
      <li class="calibre12">Create a query named <strong class="screentext">AdWorksDW</strong>:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database(SQLServer, AdventureWorksDB)
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Create a query named <strong class="screentext">AdminDB</strong>:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database(SQLServer, AdminDB)
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <strong class="screentext">AdWorksDW</strong> and <strong class="screentext">Admin</strong> queries, and place both queries into a <strong class="screentext">Data Sources </strong>query group.</li>
      <li class="calibre12">Create a <strong class="screentext">Parameters</strong> query group.</li>
      <li class="calibre12">In the <strong class="screentext">Parameters</strong> query group, create a parameter called <strong class="screentext">CounterHistoryDays</strong> and assign a value of <strong class="screentext">7</strong> or <strong class="screentext">30</strong> to limit the number of days retrieved.</li>
      <li class="calibre12">In the <strong class="screentext">Parameters</strong> query group, create a parameter called <strong class="screentext">PerformanceCountersFolder</strong> and set the value equal to the location of the performance counter log files.</li>
      <li class="calibre12">Create <a id="calibre_link-744" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a <a id="calibre_link-130" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query called <strong class="screentext">Performance Counters</strong> in the <strong class="screentext">Other Queries</strong> query group to retrieve the performance counter log files:
        <pre class="programlisting"><code class="hljs">let
    CurrentDate = DateTime.Date(DateTime.LocalNow()),
    EarliestDate = Date.AddDays(CurrentDate,-CounterHistoryDays),
    SourceFolder = Folder.Files(PerformanceCountersFolder),
    ReportFiles = Table.SelectRows(SourceFolder, each [Extension] = ".csv" and 
        DateTime.Date([Date modified]) &gt;= EarliestDate)
in
    ReportFiles
</code></pre>
      </li>
      <li class="calibre12">Click on the double arrows pointed down on the <strong class="screentext">Content</strong> column to combine the files remaining into one query. In the <strong class="screentext">Combine Files</strong> dialog, click <strong class="screentext">OK</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Transform File from Performance Counters</strong> query group, edit the <strong class="screentext">Transform Sample File</strong> query:
        <pre class="programlisting"><code class="hljs">let
    Source = Csv.Document(Parameter1,[Delimiter=",", 
        Columns=8, Encoding=1252, QuoteStyle=QuoteStyle.None]),
    PromoteHeaders = Table.PromoteHeaders(Source, [PromoteAllScalars=true]),
    ParsedDate = Table.AddColumn(PromoteHeaders, "Date", 
        each Date.From(DateTimeZone.From(
            [#"(PDH-CSV 4.0) (Eastern Daylight Time)(240)"])), type date),
    ParsedTime = Table.AddColumn(ParsedDate, "Time", 
        each Time.From(DateTimeZone.From(
            [#"(PDH-CSV 4.0) (Eastern Daylight Time)(240)"])), type time),
    RemoveColumns = Table.RemoveColumns(ParsedTime,
        {"(PDH-CSV 4.0) (Eastern Daylight Time)(240)"}),
    RenameColumns = Table.RenameColumns(RemoveColumns,
        {{"Memory\Available MBytes", "AvailableMemoryMB"}, 
        {"Buffer Manager\Page life expectancy", "PageLifeExpectancy"}, 
        {"SQL Statistics\Batch Requests/sec", "BatchRequestsPerSec"}, 
        {"PhysicalDisk(_Total)\Avg. Disk sec/Read", "AvgDiskSecPerRead"}, 
        {"PhysicalDisk(_Total)\Avg. Disk sec/Write", "AvgDiskSecPerWrite"}, 
        {"Processor(_Total)\% Processor Time", "ProcessorTime%"}}),
    HourText = Table.AddColumn(RenameColumns, "TextHour", each 
        if Time.Hour([Time]) &lt; 10 then "0" &amp; Text.From(Time.Hour([Time])) else
        Text.From(Time.Hour([Time])), type text),
    MinText = Table.AddColumn(HourText, "TextMin", each 
        if Time.Minute([Time]) &lt; 10 then "0" &amp; 
             Text.From(Time.Minute([Time])) else
             Text.From(Time.Minute([Time])), type text),
    SecText = Table.AddColumn(MinText, "TextSec", each 
        if Number.RoundDown(Time.Second([Time]),0) &lt; 10 or 
            Number.RoundUp(Time.Second([Time]),0) &lt; 10 then "0" &amp; 
            Text.From(Number.RoundDown(Time.Second([Time]),0)) 
        else Text.From(Number.RoundDown(Time.Second([Time]),0)), type text),
    SecondCol = Table.AddColumn(SecText,"SecondOfDay",  
        each [TextHour] &amp; [TextMin] &amp; [TextSec], type text),
    RemoveOtherColumns = Table.SelectColumns(SecondCol,
        {"AvailableMemoryMB", "PageLifeExpectancy", "BatchRequestsPerSec", 
        "AvgDiskSecPerRead", "AvgDiskSecPerWrite", "ProcessorTime%", 
        "Date", "Time", "SecondOfDay"})
in
    RemoveOtherColumns
</code></pre>
      </li>
      <li class="calibre12">On the <strong class="screentext">Performance Counters</strong> query, remove the automatically added <strong class="screentext">Changed Type</strong> query step and replace this with your own manually set types:
        <pre class="programlisting"><code class="hljs">    TypeChanges = Table.TransformColumnTypes(PreviousStep,
        {{"AvailableMemoryMB", Int64.Type}, {"PageLifeExpectancy", Int64.Type}, 
        {"BatchRequestsPerSec", type number}, 
        {"AvgDiskSecPerRead", type number}, 
        {"AvgDiskSecPerWrite", type number}, {"ProcessorTime%", type number}, 
        {"Date", type date}, {"Time", type time}, {"SecondOfDay", type text}})
</code></pre>
      </li>
      <li class="calibre12">In the <strong class="screentext">Other Queries</strong> group, create <a id="calibre_link-131" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a <a id="calibre_link-745" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>blank query called <strong class="screentext">Calculations</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a <strong class="screentext">Dates</strong> table using the following DAX code:
        <pre class="programlisting"><code class="hljs">Dates = 
    VAR __Today = TODAY()
RETURN
    CALENDAR(DATE(YEAR(__Today)-1,1,1),DATE(YEAR(__Today)+1,12,31))
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Time</strong> table:
        <pre class="programlisting"><code class="hljs">Time = 
    VAR __hrs = SELECTCOLUMNS(GENERATESERIES(1,23,1),"Hour",[Value])
    VAR __mins = SELECTCOLUMNS(GENERATESERIES(0,59,1),"Minutes",[Value])
    VAR __secs = SELECTCOLUMNS(GENERATESERIES(0,59,1),"Seconds",[Value])
    VAR __hoursMinutes = GENERATEALL(__hrs, __mins)
    VAR __hoursMinutesSeconds = GENERATEALL(__hoursMinutes,__secs)
    VAR __final = ADDCOLUMNS(ADDCOLUMNS(__hoursMinutesSeconds,
            "Time", TIMEVALUE(FORMAT([Hour],"00") &amp; ":" &amp; 
                FORMAT([Minutes],"00") &amp; ":" &amp; FORMAT([Seconds],"00"))),
            "SecondOfDay", FORMAT([Hour],"00") &amp; FORMAT([Minutes],"00") &amp; 
                FORMAT([Seconds],"00"))
RETURN __final
</code></pre>
      </li>
      <li class="calibre12">Change the <strong class="screentext">Data type</strong> of the <strong class="screentext">Date</strong> column in the <strong class="screentext">Dates</strong> table to <strong class="screentext">Date</strong>.</li>
      <li class="calibre12">Change the <strong class="screentext">Data type</strong> of the <strong class="screentext">SecondOfDay</strong> column in the <strong class="screentext">Time</strong> table to <strong class="screentext">Text</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Model</strong> view, create a relationship between the <strong class="screentext">Date</strong> columns in the <strong class="screentext">Dates</strong> table and the <strong class="screentext">Performance Counters</strong> table.</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">SecondOfDay</strong> columns in the <strong class="screentext">Time</strong> table and the <strong class="screentext">Performance Counters</strong> table.</li>
      <li class="calibre12">Save your work.</li>
    </ol>
    <h2 id="calibre_link-1860" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">The scheduled data collector set will automatically generate a subdirectory for each new file output. The Power BI M query references the root directory (or parent), and all supported file formats in subdirectories of this query are available for retrieval. Depending on the volume of counters, their time interval (that is, 15 seconds), and the schedule and duration of the collector set, a significant volume of files can accumulate.</p>
    <p class="book-title--packt">If the source <code class="code-in-text--packt">DateTime</code> column is already rounded to whole seconds, such as SQL Server <code class="code-in-text--packt">datetime2(0)</code>, then a <strong class="screentext">Time</strong> column created via the <code class="code-in-text--packt">DateTime.Time</code> M function can be used for<a id="calibre_link-1861" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the<a id="calibre_link-1862" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> relationship to the <strong class="screentext">Time </strong>dimension table. </p>
    <p class="book-title--packt">Casting SQL Server datetime data type columns to <code class="code-in-text--packt">datetime2(0)</code> in the SQL view used to import to Power BI is recommended in order to avoid additional rounding logic implemented in a Power BI query. In the case of Performance Monitor Counter log files, the <code class="code-in-text--packt">DateTime</code> column is not rounded to the whole second, and therefore, rounding logic is applied within the M query to create a six-character text column. The concatenated <code class="code-in-text--packt">SecondOfDay</code> column is used for the relationship with the <strong class="screentext">Time </strong>dimension table.</p>
    <p class="book-title--packt">In this example, the <strong class="screentext">Time</strong> dimension table has 86,400 rows, or 1 row for every second of a day. The detail at this granularity can be helpful in troubleshooting and deeper analysis, but a time dimension at the minute grain with only 1,440 rows may be sufficient. Whether in seconds or minutes, a <strong class="screentext">Time</strong> dimension table is especially recommended for filtering multiple fact tables in the same report and for providing useful groupings, such as the 7 A.M. to 9 A.M. timeframe.</p>
    <h2 id="calibre_link-1863" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Additional performance data can be added to the model; SQL performance metrics, including wait statistics and the instance configuration data store. Tables can be created in the <strong class="screentext">Admin</strong> database, such as <strong class="screentext">WaitStats </strong>and <strong class="screentext">ConfigData</strong>, with columns that correspond to the <code class="code-in-text--packt">sys.dm_os_wait_stats</code> and <code class="code-in-text--packt">sys.configurations</code> system views, respectively. Essentially, these tables contain snapshots of performance or configuration data, just as performance counters represent point-in-time values at the intervals chosen. Maintaining these data collection processes enables tools such as Power BI to generate insights and drive appropriate responses. Refer to the following sources for further information:</p>
    <ul class="calibre9">
      <li class="bullet">The setup of the wait statistics data store and the capture of wait statistics are described by Erin Stellato in the following blog post: <a href="https://sqlperformance.com/2015/10/sql-performance/proactive-sql-server-health-checks-5" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://sqlperformance.com/2015/10/sql-performance/proactive-sql-server-health-checks-5</span></a></li>
      <li class="bullet">The setup of the instance configuration data store and the capture of these values are also described by Erin Stellato in this blog post: <a href="https://sqlperformance.com/2015/02/system-configuration/proactive-sql-server-health-checks-3" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://sqlperformance.com/2015/02/system-configuration/proactive-sql-server-health-checks-3</span></a></li>
    </ul>
    <p class="book-title--packt">SQL views should <a id="calibre_link-746" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>be created in the <a id="calibre_link-132" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>admin database for both <code class="code-in-text--packt">Wait Stats</code> and the <code class="code-in-text--packt">Config Data</code> tables. Each view should apply report-friendly column aliases and <code class="code-in-text--packt">WHERE</code> clauses to only import the timeframes required. The <code class="code-in-text--packt">value</code> and <code class="code-in-text--packt">value_in_use</code> columns in the <code class="code-in-text--packt">sys.configurations</code> view and table to be created in the <strong class="screentext">Admin</strong> database are stored in a <code class="code-in-text--packt">sql_variant</code> data type. The view used to import this data to Power BI casts these columns as an <strong class="screentext">Integer</strong> data type and casts the datetime <strong class="screentext">CaptureDate</strong> column to <code class="code-in-text--packt">datetime2(0)</code>, to round this column to seconds. </p>
    <p class="book-title--packt">Import the two views for <strong class="screentext">WaitStats</strong> and <strong class="screentext">ConfigData</strong> into the Power BI model and build the appropriate relationships as required. Additional inputs, such as SQL Server Agent and backup log files, can also be integrated to aid administrators in assessing the causes and impacts of changes in available resources, workloads, and system configurations.</p>
    <h2 id="calibre_link-1864" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Combine <a id="calibre_link-109" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>binaries in Power BI Desktop: <a href="http://bit.ly/2oL2nM4" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2oL2nM4</span></a></li>
    </ul>
    <h1 id="calibre_link-1278" class="title">Constructing a monitoring, visualization, and analysis layer</h1>
    <p class="book-title--packt">Monitoring<a id="calibre_link-655" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and <a id="calibre_link-1139" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>administration<a id="calibre_link-53" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> tools, such as Performance Monitor, SQL Server Activity Monitor, Query Store, and Extended Events, include their own graphical interfaces for viewing and analyzing their own specific datasets. However, these features are limited relative to the data exploration and visualization capabilities provided by dedicated BI tools, such as Power BI. Additionally, as per the first recipe of this chapter, system and database administrators require an integrated view over distinct data sources with a common and flexible visual surface. The ability to define logic on top of monitoring source data, along with the "anywhere" availability of Power BI content and its data alert and advanced analytics features, further enhances the value of integrated monitoring datasets.</p>
    <p class="book-title--packt">In this recipe, the monitoring dataset created in the first recipe of this chapter is leveraged to develop reporting content that addresses top stakeholder priorities, such as "How is the performance today?" and "Has any configuration value changed?" A report visualization <a id="calibre_link-1865" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>specific to SQL Server Query Store is<a id="calibre_link-1866" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> included <a id="calibre_link-1867" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>in the <em class="italic">There's more...</em> section.</p>
    <h2 id="calibre_link-1868" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Obtain guidance from stakeholders and subject matter experts (SMEs) on performance baselines and threshold values. For example, should the metric "available memory" be compared to the last 7, 30, or more days? Are there good (green), satisfactory (yellow), and problem (red) values associated with wait statistics measures or CPU time?</li>
      <li class="calibre12">Complete the first recipe in this chapter, <em class="italic">Creating a centralized IT monitoring solution with Power BI</em>.</li>
    </ol>
    <h2 id="calibre_link-1869" class="calibre8">How to construct a monitoring visualization and analysis layer</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Calculations</strong> table, create simple DAX measures (<code class="code-in-text--packt">AVERAGE</code>, <code class="code-in-text--packt">MIN</code>, and <code class="code-in-text--packt">MAX</code>) for the performance counters, and date intelligence measures to support a comparison of performance monitoring counters against prior time periods or baselines:
        <pre class="programlisting"><code class="hljs">Available Memory MB (Today) = CALCULATE([Available Memory (MB)],
    FILTER(ALL('Dates'),'Dates'[Date] = [Today]))
Batch Requests per Sec (Yesterday) = CALCULATE([Batch Requests Per Sec],
    FILTER(ALL('Dates'),'Dates'[Date] = [Yesterday]))
Min Available Memory MB (Today) = CALCULATE([Min Available Memory (MB)],
    FILTER(ALL('Dates'),'Dates'[Date] = [Today]),ALL('Time'))
</code></pre>
      </li>
      <li class="calibre12">Create an <strong class="screentext">Hour Time</strong> column in the <strong class="screentext">Time</strong> table to enable slicer selection:
        <pre class="programlisting"><code class="hljs">Hour Time = TIMEVALUE(FORMAT('Time'[Hour],"00") &amp; ":00")
</code></pre>
      </li>
      <li class="calibre12">Create a report page based on the performance monitor counters that addresses top visibility needs, such as "How is performance today?" and "How close <a id="calibre_link-54" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>are <a id="calibre_link-656" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>we to <a id="calibre_link-1140" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>resource thresholds?".<figure class="mediaobject"><img src="images/000129.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.1: Performance Monitoring Report page leveraging Windows Performance Monitor counters</p>
    <h2 id="calibre_link-1870" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">The two gauge visuals and the KPI visuals are used to display the highest priority counters relative to predefined thresholds or baselines. For example, <strong class="screentext">Disk Seconds Per Read</strong> is highlighted in green, given the lower value than the goal of .003; <strong class="screentext">Disk Seconds Per Write</strong> is highlighted in red due to the higher value than the goal of .004. All four visuals respect the hour filter control (a custom Chiclet slicer) from the lower left, and a <strong class="screentext">Minute of Day Time</strong> data type column from the <strong class="screentext">Time</strong> dimension table is used for the KPI visual's <strong class="screentext">Trend axis</strong>. </p>
    <p class="book-title--packt">A <strong class="screentext">Today's High and Low Values</strong> group of Card visuals ignores the <strong class="screentext">Time</strong> filter selection (for example, 9:00 P.M. from the slicer), but applies the current date filter. CPU (% processor), batch requests per second, and available memory are plotted against the prior day values in the line charts in this example. Seven- and 30-day average measures are <a id="calibre_link-55" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>commonly <a id="calibre_link-657" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>used for the<a id="calibre_link-1141" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> performance baseline.</p>
    <h2 id="calibre_link-1871" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Report visualizations can also be created for the wait statistics and configuration values, if implemented from the previous recipe. To see how this works, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create DAX measures to identify database instance configuration changes:
        <pre class="programlisting"><code class="hljs">Config Value = IF(AND(HASONEVALUE('Configuration Values'[ConfigurationID]),
     HASONEVALUE('Dates'[Date])), 
     MAX('Configuration Values'[Configuration Value]),BLANK())
Config Value (Today) = CALCULATE([Config Value],
     FILTER(ALL('Dates'),'Dates'[Date] = [Today]))
Config Value (Yesterday) = CALCULATE([Config Value], FILTER(ALL('Dates'),
     'Dates'[Date] = [Yesterday]))
Config Change (Today) = IF([Config Value (Today)] &lt;&gt; [Config Value (Yesterday)],
"Config Change", "No Change")
Config Changes = IF([Config Value] = [Prior Day Config],0,1)
</code></pre>
        <figure class="mediaobject"><img src="images/000141.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.2: Instance Configuration Report page: Current day and trailing 30-day history of changes</p>
      </li>
      <li class="calibre12">The <strong class="screentext">Current Day Configuration Changes</strong> table visual uses a visual-level filter on the <strong class="screentext">Config Change (Today)</strong> measure such that only changed configurations (for<a id="calibre_link-56" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <a id="calibre_link-658" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>current day) are<a id="calibre_link-1142" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> displayed. The<strong class="screentext"> Prior 30 Days Configuration Changes</strong> table visual uses two visual-level filters. One filter is applied to the <strong class="screentext">Date</strong> column from the <strong class="screentext">Dates</strong> dimension table and uses the relative date filtering feature to retrieve the past 30 days but excludes the current day; the other filter condition is applied against the <strong class="screentext">Config Changes </strong>measure for values of <code class="code-in-text--packt">1</code>.</li>
      <li class="calibre12">Create similar DAX measures for the <strong class="screentext">Wait Statistics</strong> table, such as the current-day average wait in seconds.</li>
      <li class="calibre12">On a new page, compare the average of the current day's wait statistics capture data against a prior date:<figure class="mediaobject"><img src="images/000154.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.3: Wait Statistics report sample: KPIs, Waterfall, and Scatter Chart visuals</p>
    <blockquote class="packt_quote pcalibre6">"Wait statistics are probably the single best way to start troubleshooting a SQL Server performance issue. SQL Server knows why execution is being stalled (in other words, why threads are having to wait), so using this information to identify bottlenecks and avenues for further investigation can dramatically reduce the time it takes to diagnose the cause of workload degradation."<p class="cite">&mdash;Paul Randal, CEO of SQLskills, Microsoft Data Platform MVP</p></blockquote>
    
    <p class="book-title--packt">In this limited sample of a wait statistics report, relative date filtering is applied at the page level to only include the past 30 days; thus, the 30-day trend is displayed in the background of the two KPI visuals. Relative date filters are also applied at the visual level to the waterfall and scatter charts to include only the last 2 days and the current day, respectively. The breakdown field well of the Waterfall chart is used to automatically identify the largest drivers of the change in wait seconds (wait types) from the prior day to the current day.</p>
    <p class="book-title--packt">A high-level wait statistics report can be used as a quick starting point of analysis to identify bottlenecks in a system. Additionally, with mature and predictable baseline data in place, the <a id="calibre_link-57" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>report<a id="calibre_link-659" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> can <a id="calibre_link-1143" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>be used to troubleshoot performance degradation issues. For example, a sudden spike in <code class="code-in-text--packt">PAGEIOLATCH_EX</code> waits may indicate a missing index issue, related database schema, or code change.</p>
    <h2 id="calibre_link-1872" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">SQL Server Wait Types library: <a href="https://www.sqlskills.com/help/waits/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://www.sqlskills.com/help/waits/</span></a>.</li>
    </ul>
    <h1 id="calibre_link-1279" class="title">Importing and visualizing dynamic management view (DMV) data</h1>
    <p class="book-title--packt">Analysis<a id="calibre_link-410" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Services data models and Power<a id="calibre_link-415" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> BI instances include many dynamic management views (DMVs), which can be used to retrieve both schema metadata and resource usage associated with the various database objects. Query performance for imported data models is directly impacted by the amount of memory consumed. Therefore, having visibility to memory consumption and factors impacting memory consumption, such as compression and cardinality, is essential in performance tuning efforts. Power BI integration and visualization tools can enhance the value of the system information provided by DMVs to provide owners of Power BI and SSAS datasets with an intuitive, sustainable reporting layer in support of these assets.</p>
    <p class="book-title--packt">In this recipe, M queries are created to retrieve and transform DMV information from a Power BI dataset. Essential relationships, measures, and report visuals are then built to support memory usage analysis.</p>
    <h2 id="calibre_link-1873" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the Power BI Desktop file containing the dataset to be analyzed. This file must remain open during data retrieval.</li>
      <li class="calibre12">Open DAX Studio from <strong class="screentext">External Tools</strong>.</li>
      <li class="calibre12">Retrieve the server name and port associated with the running Power BI Desktop <a id="calibre_link-411" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>file from the bottom right<a id="calibre_link-416" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> of the DAX Studio status bar; an example would be <code class="code-in-text--packt">localhost:56514</code>.</li>
      <li class="calibre12">In DAX Studio, in the upper-left corner under <strong class="screentext">Metadata</strong>, right-click the database ID and choose <strong class="screentext">Copy Database ID</strong>.</li>
      <li class="calibre12">Open a new Power BI Desktop file and click on <strong class="screentext">Transform data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong> window.</li>
      <li class="calibre12">Create two parameters, <strong class="screentext">Server</strong> and <strong class="screentext">Database</strong>, and apply the values retrieved from DAX Studio as the current values:<figure class="mediaobject"><img src="images/000167.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.4: Query Parameters with values for the local Power BI model</p>
    <h2 id="calibre_link-1874" class="calibre8">How to import and visualize DMV data</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a <strong class="screentext">Segments</strong> query:
        <pre class="programlisting"><code class="hljs">let Source = AnalysisServices.Database
(Server, Database,[Query="Select * From $SYSTEM.DISCOVER_STORAGE_TABLE_COLUMN_SEGMENTS"]),
    Segments = Table.AddColumn(Source, "Structure Type", each
        if Text.Range([TABLE_ID],1,1) &lt;&gt; "$" then "Data"
        else if Text.Start([TABLE_ID],2) = "H$" then "Column Hierarchy" 
        else if Text.Start([TABLE_ID],2) = "U$" then "User Hierarchy"
        else if Text.Start([TABLE_ID],2) = "R$" then "Relationship"
        else "unknown", type text),
    RenameTable = Table.RenameColumns(Segments,{{"DIMENSION_NAME", "Table"}}),
    KeyColumn = Table.AddColumn(RenameTable, "ColumnKey", each [Table] &amp; "-" &amp; [COLUMN_ID], type text)
in KeyColumn
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Columns</strong> query:
        <pre class="programlisting"><code class="hljs">let Source = AnalysisServices.Database
(Server, Database,[Query="Select * From $SYSTEM.DISCOVER_STORAGE_TABLE_COLUMNS"]),
    BasicData = Table.SelectRows(Source, each ([COLUMN_TYPE] = "BASIC_DATA")),
    RenameTable = Table.RenameColumns(BasicData,{{"DIMENSION_NAME", "Table"},{"ATTRIBUTE_NAME","Column"}}),
    KeyColumn = Table.AddColumn(RenameTable, "ColumnKey", each [Table] &amp; "-" &amp; [COLUMN_ID], type text),
    DateRetrieved = Table.AddColumn(KeyColumn, "Date Retrieved", each DateTime.Date(DateTime.LocalNow()), type date)
in DateRetrieved
</code></pre>
      </li>
      <li class="calibre12">Create <a id="calibre_link-412" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a <a id="calibre_link-417" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>blank query called <strong class="screentext">Calculations</strong></li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">In <strong class="screentext">Model</strong> view, create a relationship between the <strong class="screentext">ColumnKey</strong> columns in the <strong class="screentext">Segments</strong> and <strong class="screentext">Columns</strong> tables</li>
      <li class="calibre12">Create the following DAX measures:
        <pre class="programlisting"><code class="hljs">BytesPerMB = 1048576
Segment Size (MB) = DIVIDE(SUM(Segments[USED_SIZE]),[BytesPerMB])
Dictionary Size (MB) = DIVIDE(SUM('Columns'[DICTIONARY_SIZE]),[BytesPerMB])
Data Size (MB) = 
    CALCULATE([Segment Size (MB)],Segments[Structure Type] = "Data")
Column Hierarchies Size (MB) = 
    CALCULATE([Segment Size (MB)],Segments[Structure Type] = "Column Hierarchy")
User Hierarchy Size (MB) = 
    CALCULATE([Segment Size (MB)],Segments[Structure Type] = "User Hierarchy")
Relationship Size (MB) = 
    CALCULATE([Segment Size (MB)],Segments[Structure Type] = "Relationship") 
Total Column Size (MB) = [Data Size (MB)] + [Dictionary Size (MB)]
Total Size (MB) = [Column Hierarchies Size (MB)] + [Relationship Size
(MB)] + 
    [User Hierarchy Size (MB)] + [Dictionary Size (MB)] + [Data Size (MB)]
Last Refresh Message = VAR RefreshDate = MAX('Columns'[Date Retrieved]) 
    RETURN "Last Refreshed: " &amp; RefreshDate
</code></pre>
      </li>
      <li class="calibre12">Create <a id="calibre_link-413" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a Power BI report page<a id="calibre_link-418" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> based on the retrieved and modeled DMV data, as seen in <em class="italic">Figure 10.5:</em>
        <figure class="mediaobject"><img src="images/000180.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.5: Summary Memory report of the Power BI dataset</p>
    <h2 id="calibre_link-1875" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">For the <strong class="screentext">Segments</strong> query, the <strong class="screentext">Server</strong> and <strong class="screentext">Database</strong> parameters, along with a SQL statement <a id="calibre_link-1876" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>against the <code class="code-in-text--packt">DISCOVER_STORAGE_TABLE_COLUMN_SEGMENTS</code> DMV, are used to extract and access memory usage <a id="calibre_link-1877" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>data from the running Power BI Desktop file (which contains an analysis services instance). The conditional column, <strong class="screentext">Structure Type</strong>, is added to identify the memory structure represented by each row, and a concatenated column, <strong class="screentext">ColumnKey</strong>, is created to support a relationship with the <strong class="screentext">Columns</strong> table.</p>
    <p class="book-title--packt">For the <strong class="screentext">Columns</strong> query, the <code class="code-in-text--packt">DISCOVER_STORAGE_TABLE_COLUMNS</code> DMV is filtered based on the <strong class="screentext">Column_Type</strong> column and a concatenated column, <strong class="screentext">ColumnKey</strong>, is created for the relationship with the <strong class="screentext">Segments</strong> table. Additionally, a dynamic <strong class="screentext">Date Retrieved</strong> column is added to support the reporting layer.</p>
    <p class="book-title--packt">The memory columns for both source DMVs are<a id="calibre_link-593" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in terms of bytes. <strong class="screentext">Megabytes</strong> (<strong class="screentext">MB</strong>) are more intuitive and presentable given that they have fewer digits; thus, the <strong class="screentext">BytesPerMB</strong> measure (which is hardcoded to 1,048,576) is used to <code class="code-in-text--packt">DIVIDE</code> the <code class="code-in-text--packt">SUM</code> of the <strong class="screentext">USER_SIZE</strong> and <strong class="screentext">DICTIONARY_SIZE</strong> columns. The <strong class="screentext">Structure Type</strong> column created in the <strong class="screentext">Segments</strong> query is used to support different components of overall memory usage, and two total measures are created for summary-level reports.</p>
    <p class="book-title--packt">Card visuals are used to display overall memory usage; two table visuals with top <em class="italic">N</em> visual-level filters provide additional details. In this example, the <strong class="screentext">Reseller Sales XL</strong> table is by far the largest table in the model, and specifically, the <strong class="screentext">CarrierTrackingNumber</strong>, <strong class="screentext">SalesOrderNumber</strong>, and <strong class="screentext">CustomerPONumber </strong>columns of this table are consuming the most memory. Clicking on a table name in the <strong class="screentext">Top 5 Tables</strong> visual cross-filters the <strong class="screentext">Top 5 Columns</strong> visual.</p>
    <p class="book-title--packt">More DMVs and logic can be added to build a more robust template report for use across Power BI projects. Note that the <strong class="screentext">Server</strong> and <strong class="screentext">Database</strong> parameters will need to be updated <a id="calibre_link-419" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>when a PBIX file being analyzed <a id="calibre_link-414" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>has been closed and reopened.</p>
    <h2 id="calibre_link-1878" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">In addition to the compressed data memory structures for each column, dictionary and column hierarchy structures (<strong class="screentext">H$</strong>) are also created internally for imported data models to support queries. The dictionary structure, retrieved via the columns DMV, stores the unique values of a column, and so it is larger for high-cardinality columns. Two additional memory structures include user-defined hierarchies (<strong class="screentext">U$</strong>) and table relationships (<strong class="screentext">R$</strong>).</p>
    <p class="book-title--packt">In this recipe, the memory allocated to column hierarchy structures (<strong class="screentext">H$</strong>) is excluded from the <strong class="screentext">Total Column Size</strong> measure but included in the <strong class="screentext">Total Size</strong> measure. This is intended to focus analysis on the larger components of memory that can be directly impacted by revisions to the data model. Likewise, the memory used for relationships and user-defined hierarchies is small relative to the data and dictionary size of the model's columns. </p>
    <p class="book-title--packt">Basic performance tuning of imported data models largely focuses on minimizing high-cardinality columns and relationships to reduce the memory scanned. More advanced tuning, generally reserved for SSAS models, involves the partitioning of tables, segment sizes, and optimizing the sort order used by the engine during compression. Only the sort order is available to Power BI datasets.</p>
    <p class="book-title--packt">The Vertipaq Analyzer utilizes DMVs to collect information on datasets and is now integrated into DAX Studio under the <strong class="screentext">Advanced</strong> menu as well as in Tabular Editor 3. Using the Vertipaq Analyzer is a quicker and easier way to analyze the memory size, cardinality, and other aspects of your data model versus writing your own queries against the DMVs.</p>
    <h2 id="calibre_link-1879" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Kasper de Jonge has published a blog on building an SSAS memory report with Power BI: <a href="http://bit.ly/2tDumgk" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2tDumgk</span></a>.</li>
      <li class="bullet">SQL BI's Vertipaq Analyzer Excel file: <a href="http://bit.ly/2sTTuSO" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2sTTuSO</span></a>.</li>
      <li class="bullet"><strong class="screentext">Dynamic Management Views</strong> (<strong class="screentext">DMVs</strong>) in Analysis Services: <a href="https://bit.ly/33etDoc" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/33etDoc</span></a>.</li>
      <li class="bullet">Vertipaq Analyzer script for Tabular Editor 2: <a href="https://bit.ly/2YA97zv%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2YA97zv</span></a></li>
    </ul>
    <h1 id="calibre_link-1280" class="title">Increasing DBA productivity</h1>
    <p class="book-title--packt">SQL Server Query <a id="calibre_link-373" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Store is a monitoring feature available to all editions of SQL Server 2016 and later&mdash;it significantly simplifies and expedites query tuning and troubleshooting. The Query Store database provides aggregated metrics regarding query executions, query plans, and wait statistics to enable visibility to performance trends and usage patterns.</p>
    <blockquote class="packt_quote pcalibre6">"Query Store is a fantastic flight data recorder for your execution plans. It will help you troubleshoot parameter sniffing issues, connection settings issues, plan regressions, bad stats, and much more."<p class="cite">&mdash;Brent Ozar, Author and Microsoft-Certified Master in SQL Server</p></blockquote>
    
    <p class="book-title--packt">Query Store includes a graphical interface of charts and user controls, and its schema lends itself to custom T-SQL queries such as <em class="italic">10 longest-running queries in the past hour</em>. While these are great features and sufficient for certain scenarios, administrators often have to make trade-offs between the flexibility of T-SQL and the graphical controls provided by Query Store. In this recipe, simple T-SQL statements are passed from Power BI to SQL Server Query Store in order to identify and analyze recent performance issues, as well as the performance of a specific stored procedure.</p>
    <h2 id="calibre_link-1880" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Enable Query Store<a id="calibre_link-1027" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in the latest version of <strong class="screentext">SQL Server Management Studio</strong> (<strong class="screentext">SSMS</strong>), either via the <strong class="screentext">Database Properties</strong> dialog in the Object Explorer interface (right-click on the database and choose <strong class="screentext">Properties</strong>) or via the following T-SQL statement:
        <pre class="programlisting"><code class="hljs">ALTER DATABASE AdventureWorksDW2019 SET QUERY_STORE = ON;
</code></pre>
      </li>
      <li class="calibre12">Configure Query Store settings, such as <strong class="screentext">Statistics Collection Intervals</strong>, <strong class="screentext">Retention</strong>, and <strong class="screentext">Max Size (MB)</strong> according to your requirements.</li>
    </ol>
    <p class="book-title--packt">In this example, the performance of individual queries will be aggregated or summarized into 5-minute time frames. Smaller collection time intervals provide greater details, but also require more storage and collection resources. For maximum detail with no grouping of queries, an Extended Events session can be scheduled. Refer to the <em class="italic">Analyzing Extended Events</em> recipe later in this chapter for more details.</p>
    <h2 id="calibre_link-1881" class="calibre8">How to increase DBA productivity</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Build and<a id="calibre_link-374" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> test the T-SQL statements to retrieve the required Query Store statistics:
        <pre class="programlisting"><code class="hljs">SELECT 
[rs].[avg_duration], [rs].[avg_logical_io_reads], [qst].[query_text_id], [qsq].[query_id], 
[qst].[query_sql_text], CASE WHEN [qsq].[object_id] = 0 
       THEN N'Ad-hoc' ELSE OBJECT_NAME([qsq].[object_id])  
       END AS [ObjectName],
[qsp].[plan_id], GETUTCDATE() AS CurrentUTCTime,
[rs].[last_execution_time], 
       CAST((DATEADD(MINUTE, 
              -(DATEDIFF(MINUTE, GETDATE(), GETUTCDATE())),
              [rs].[last_execution_time])) AS datetime2(0)) 
       AS LocalLastExecutionTime
FROM 
       [sys].[query_store_query] [qsq] 
       JOIN [sys].[query_store_query_text] [qst] ON 
              [qsq].[query_text_id] = [qst].[query_text_id]
       JOIN [sys].[query_store_plan] [qsp] ON 
              [qsq].[query_id] = [qsp].[query_id]
       JOIN [sys].[query_store_runtime_stats] [rs] ON 
       [qsp].[plan_id] = [rs].[plan_id] 
WHERE [rs].[last_execution_time] &gt; DATEADD(hour, -8, GETUTCDATE())  
</code></pre>
      </li>
      <li class="calibre12">Create an additional T-SQL statement containing similar performance-related columns, filtered to a specific stored procedure that also retrieves the collection interval times:
        <pre class="programlisting"><code class="hljs">SELECT * FROM 
[sys].[query_store_query] [qsq] 
JOIN [sys].[query_store_query_text] [qst] ON 
       [qsq].[query_text_id] = [qst].[query_text_id]
JOIN [sys].[query_store_plan] [qsp]  ON 
       [qsq].[query_id] = [qsp].[query_id]
JOIN [sys].[query_store_runtime_stats] [rs] ON 
       [qsp].[plan_id] = [rs].[plan_id]
JOIN [sys].[query_store_runtime_stats_interval] [rsi] ON 
       [rs].[runtime_stats_interval_id] = [rsi].[runtime_stats_interval_id]
WHERE [qsq].[object_id] = OBJECT_ID(N'Sales.usp_GetFullProductInfo')
</code></pre>
      </li>
      <li class="calibre12">Create a view <a id="calibre_link-375" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and a parameterized stored procedure in SQL Server for the two <strong class="screentext">Query Store</strong> queries, without the <code class="code-in-text--packt">WHERE</code> clause filter&mdash;this condition will be driven by the Power BI parameter.</li>
      <li class="calibre12">Design the SQL Server stored procedures to include a <code class="code-in-text--packt">WHERE</code> clause with a parameter that will be passed from Power BI, such as the following:
        <pre class="programlisting"><code class="hljs">CREATE PROCEDURE [Website].[QueryStoreProc]
@QSProcedure nvarchar(55)
AS ......
WHERE [qsq].[object_id] = OBJECT_ID(@QSProcedure)
</code></pre>
      </li>
      <li class="calibre12">Open a Power BI Desktop file locally and add server and database parameters for the Query Store database.</li>
      <li class="calibre12">Create a new query, <strong class="screentext">AdWorksDW</strong>, with the <code class="code-in-text--packt">Sql.Database</code> function that references these two parameters.</li>
      <li class="calibre12">Create a parameter, <strong class="screentext">HoursInPast</strong>, with a data type of decimal number and a <strong class="screentext">QueryStoreProcedure</strong> text parameter.</li>
      <li class="calibre12">Create a new M query, <strong class="screentext">Query Store DurationIO</strong>, that retrieves the I/O and duration statistics for all queries and uses the <strong class="screentext">HoursInPast</strong> parameter:
        <pre class="programlisting"><code class="hljs">let
    Source = AdWorksDW, 
    SQLView = Source{[Schema="Website", Item="QueryStoreDurationIO"]}[Data],
    ParamFilter = Table.SelectRows(SQLView, each 
        [LocalLastExecutionTime] &gt;= 
            (DateTime.LocalNow() - #duration(0,HoursInPast,0,0))),
    ExecutionDate = Table.AddColumn(ParamFilter, 
        "Last Execution Date", 
        each DateTime.Date([LocalLastExecutionTime]), type date),
    ExecutionTime = Table.AddColumn(ExecutionDate, 
        "Time", each DateTime.Time([LocalLastExecutionTime]), type time)
in ExecutionTime
</code></pre>
      </li>
      <li class="calibre12">Create a new M query, <strong class="screentext">Query Store Procedure</strong>:
        <pre class="programlisting"><code class="hljs">let 
    Source = AdWorksDW,
    Procedure = Value.NativeQuery(Source, 
        "EXECUTE Website.QueryStoreProc @QSProcedure = " 
        &amp; "'" &amp; QueryStoreProcedure &amp; "'"),
    InsertedDate = Table.AddColumn(Procedure, "Date", 
        each DateTime.Date([end_time]), type date),
    InsertedTime = Table.AddColumn(InsertedDate, "Time", 
        each DateTime.Time([end_time]), type time)
in InsertedTime
</code></pre>
      </li>
      <li class="calibre12">Create <a id="calibre_link-376" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a blank query called <strong class="screentext">Calculations</strong>.</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a <strong class="screentext">Dates</strong> table using the following DAX code:
        <pre class="programlisting"><code class="hljs">Dates = 
    VAR __Today = TODAY()
RETURN
    CALENDAR(DATE(YEAR(__Today)-1,1,1),DATE(YEAR(__Today)+1,12,31))
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Time</strong> table:
        <pre class="programlisting"><code class="hljs">Time = 
    VAR __hrs = SELECTCOLUMNS(GENERATESERIES(1,23,1),"Hour",[Value])
    VAR __mins = SELECTCOLUMNS(GENERATESERIES(0,59,1),"Minutes",[Value])
    VAR __secs = SELECTCOLUMNS(GENERATESERIES(0,59,1),"Seconds",[Value])
    VAR __hoursMinutes = GENERATEALL(__hrs, __mins)
    VAR __hoursMinutesSeconds = GENERATEALL(__hoursMinutes,__secs)
    VAR __final = ADDCOLUMNS(ADDCOLUMNS(__hoursMinutesSeconds,
            "Time", TIMEVALUE(FORMAT([Hour],"00") &amp; ":" &amp; 
                FORMAT([Minutes],"00") &amp; ":" &amp; FORMAT([Seconds],"00"))),
            "SecondOfDay", FORMAT([Hour],"00") &amp; FORMAT([Minutes],"00") &amp; 
                FORMAT([Seconds],"00"))
RETURN __final
</code></pre>
      </li>
      <li class="calibre12">Change the <strong class="screentext">Data type</strong> of the <strong class="screentext">Date</strong> column in the <strong class="screentext">Dates</strong> table to <strong class="screentext">Date</strong>.</li>
      <li class="calibre12">Change the <strong class="screentext">Data type</strong> of the <strong class="screentext">SecondOfDay</strong> column in the <strong class="screentext">Time</strong> table to <strong class="screentext">Text</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Model</strong> view, create relationships between the <strong class="screentext">Query Store DurationIO</strong> and <strong class="screentext">Query Store Procedure</strong> tables with the <strong class="screentext">Dates</strong> and <strong class="screentext">Time</strong> tables.</li>
      <li class="calibre12">Add DAX measures to the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Average CPU Time (QS Proc) = AVERAGE('Query Store Procedure'[avg_cpu_time])
Average Duration (QS Proc) = AVERAGE('Query Store Procedure'[avg_duration])
Average Logical IO Reads (QS Proc) = 
     AVERAGE('Query Store Procedure'[avg_logical_io_reads])
</code></pre>
      </li>
      <li class="calibre12">Create dedicated report pages for the two Query Store tables leveraging the measures<a id="calibre_link-1882" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and relationships:</li>
    </ol>
    <figure class="mediaobject"><img src="images/000193.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 10.6: Query Store Sample report page &ndash; Stored Procedure</p>
    <p class="book-title--packt">The <strong class="screentext">Query Store Stored Procedure</strong> report page breaks out measures of performance by <strong class="screentext">Context Settings ID</strong> and individual <strong class="screentext">Query ID</strong>. A combination chart displays the trend of CPU and duration performance across the intervals; the SQL statement associated with the procedure is displayed via a table visual. Additionally, a custom Chiclet slicer is used to give the user simple filtering control for the hourly time frames.</p>
    <h2 id="calibre_link-1883" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">SQL Server Query Store collects compile and runtime information related to the queries and query plans of a database. This persisted data is made available for analysis via three separate data stores:</p>
    <ul class="calibre9">
      <li class="bullet">A plan store containing query execution plan information</li>
      <li class="bullet">A runtime stats store of execution statistics</li>
      <li class="bullet">A wait stats store of query wait statistics</li>
    </ul>
    <p class="book-title--packt">These three<a id="calibre_link-377" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> data stores can be queried in SQL Server 2016 or later via the following system views: <code class="code-in-text--packt">sys.query_store_plan</code>, <code class="code-in-text--packt">sys.query_store_runtime_stats</code>, and <code class="code-in-text--packt">sys.query_store_wait_stats</code>.</p>
    <p class="book-title--packt">The first T-SQL query retrieves the average duration and logical I/O reads of the Query Store intervals collected over the previous 8 hours, as well as the SQL statement itself and the <strong class="screentext">Query ID</strong>. A parameter can be set for the number of hours to retrieve in Power BI, and thus the SQL view created for retrieving this data does not require a <code class="code-in-text--packt">WHERE</code> clause. Power BI will dynamically build a T-SQL statement with a <code class="code-in-text--packt">WHERE</code> clause filter containing the parameter via Query Folding. </p>
    <p class="book-title--packt">Note that the <strong class="screentext">LocalLastExecutionTime</strong> column is cast to a <code class="code-in-text--packt">datetime2(0)</code> data type to provide a date value, rounded to the nearest second.</p>
    <p class="book-title--packt">The second T-SQL query demonstrates how to return Query Store statistics for a stored procedure, since the Query Store user interface does not support the analyzing of any activity specific to a stored procedure. Administrators often require visibility to both the specific timeframes and the overall performance to pinpoint when a performance issue occurred, and its significance relative to a baseline.</p>
    <p class="book-title--packt">For the <strong class="screentext">Query Store DurationIO</strong> query, the <strong class="screentext">LocalLastExecutionTime</strong> column is filtered by the <code class="code-in-text--packt">DateTime</code> value that is based on the current local <code class="code-in-text--packt">DateTime</code>, and the value in the <strong class="screentext">HoursInPast</strong> parameter. You may click on <strong class="screentext">View Native Query</strong> to confirm that the query was folded to the server. A <strong class="screentext">Date</strong> and <strong class="screentext">Time</strong> column are added via the <code class="code-in-text--packt">DateTime.Date</code> and <code class="code-in-text--packt">DateTime.Time</code> M functions. These added columns will be used in relationships with the <strong class="screentext">Date</strong> and <strong class="screentext">Time</strong> dimension tables, respectively.</p>
    <p class="book-title--packt">The SQL Server stored procedure <code class="code-in-text--packt">Website.QueryStoreProc</code> is executed via the <code class="code-in-text--packt">Value.NativeQuery</code> function and the Power BI parameter <strong class="screentext">QueryStoreProcedure</strong> is passed into the concatenated text string. <strong class="screentext">Date</strong> and <strong class="screentext">Time</strong> columns are also added to support relationships with the <strong class="screentext">Date</strong> and <strong class="screentext">Time</strong> dimension tables. Like the <strong class="screentext">Query Store</strong> <strong class="screentext">DurationIO</strong> query, the <code class="code-in-text--packt">end_time</code> in the stored procedure is of the <code class="code-in-text--packt">datetime2(0)</code> data type, such that <strong class="screentext">Time</strong> columns created via <code class="code-in-text--packt">DateTime.Time</code> will be rounded off to the nearest<a id="calibre_link-378" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> second.</p>
    <h2 id="calibre_link-1884" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Individual <a id="calibre_link-1024" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>SQL query statements can also be retrieved from Query Store and Extended Events. The top <em class="italic">N</em> visual-level filter can be applied to a table visual based on an <code class="code-in-text--packt">Avg Duration</code> measure, as seen in <em class="italic">Figure 10.7</em>:</p>
    <figure class="mediaobject"><img src="images/000205.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 10.7: A Table Visual filtered for the top 10 SQL Query values based on the Duration measure</p>
    <h2 id="calibre_link-1885" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Monitoring performance by using the Query Store: <a href="http://bit.ly/2s9Cx5r" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2s9Cx5r</span></a></li>
    </ul>
    <h1 id="calibre_link-1281" class="title">Providing documentation</h1>
    <p class="book-title--packt">As data models<a id="calibre_link-397" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> grow and change to support new business processes and logic, access to current documentation becomes imperative. Visibility to basic metadata, such as the relationships of the model, columns of the tables, and the filtering logic built into measures, can significantly aid business teams in utilizing Power BI datasets. Additionally, business intelligence and IT professionals who may be new to a specific model or unfamiliar with a component of the model can benefit greatly from direct access to technical metadata, such as data source parameters, SQL and M queries, and the configured security roles.</p>
    <p class="book-title--packt">In this recipe, several <strong class="screentext">dynamic management views</strong> (<strong class="screentext">DMVs</strong>) related to the schema of a Power BI dataset<a id="calibre_link-420" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are accessed and integrated into a Power BI report. A template is then created with parameters, enabling standard documentation reports across multiple Power BI datasets.</p>
    <h2 id="calibre_link-1886" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the Power BI Desktop file containing the dataset to be analyzed. This file must remain open during data retrieval.</li>
      <li class="calibre12">Open DAX Studio from <strong class="screentext">External Tools</strong>.</li>
      <li class="calibre12">Retrieve the server name and port associated with the running Power BI Desktop file from the bottom right of the DAX Studio status bar, such as <strong class="screentext">localhost:56514</strong>. </li>
      <li class="calibre12">In DAX Studio, near the upper-left corner under <strong class="screentext">Metadata</strong>, right-click the database ID and choose <strong class="screentext">Copy Database ID</strong>.</li>
      <li class="calibre12">Open a new Power BI Desktop file and click on <strong class="screentext">Transform data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab to open the <strong class="screentext">Power Query Editor</strong> window.</li>
      <li class="calibre12">Create two parameters, <strong class="screentext">Server</strong> and <strong class="screentext">Database</strong>, and apply the values retrieved from DAX Studio as the current values.</li>
    </ol>
    <h2 id="calibre_link-1887" class="calibre8">How to provide documentation</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a new blank M query called <strong class="screentext">TablesDMV</strong> that retrieves the <code class="code-in-text--packt">TMSCHEMA_TABLES</code> DMV via the <strong class="screentext">Server</strong> and <strong class="screentext">Database</strong> parameters:<figure class="mediaobject"><img src="images/000216.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.8: Table metadata of the running Power BI Desktop file</p>
      </li>
      <li class="calibre12">Duplicate the <strong class="screentext">TablesDMV</strong> query to retrieve the following five schema DMVs as well:<ul class="calibre11">
          <li class="calibre12"><code class="code-in-text--packt">SYSTEM.TMSCHEMA_COLUMNS</code></li>
          <li class="calibre12"><code class="code-in-text--packt">SYSTEM.TMSCHEMA_MEASURES</code></li>
          <li class="calibre12"><code class="code-in-text--packt">SYSTEM.TMSCHEMA_ROLES</code></li>
          <li class="calibre12"><code class="code-in-text--packt">SYSTEM.TMSCHEMA_TABLE_PERMISSIONS</code></li>
          <li class="calibre12"><code class="code-in-text--packt">SYSTEM.TMSCHEMA_RELATIONSHIPS</code>:</li>
        </ul>
      </li>
      <li class="calibre12">Name the<a id="calibre_link-398" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> queries according to their source, and organize these and their parameters into their own folders:<figure class="mediaobject"><img src="images/000228.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.9: Parameters and DMV queries used to support model documentation</p>
      </li>
      <li class="calibre12">Create a third query group named <strong class="screentext">Documentation</strong> and a new blank query named <strong class="screentext">Columns</strong>:
        <pre class="programlisting"><code class="hljs">let 
    Tables = TablesDMV, Columns = ColumnsDMV,
    Join = Table.NestedJoin(Columns,{"TableID"},Tables,{"ID"},
        "TableColumns",JoinKind.LeftOuter),
    TableExpand = Table.ExpandTableColumn(Join,"TableColumns",
        {"Name"},{"Table"}),
    DataType = Table.AddColumn(TableExpand, "Data Type", each 
        if [ExplicitDataType] = 2 then "Text" else 
        if [ExplicitDataType] = 6 then "Whole Number" else
        if [ExplicitDataType] = 8 then "Decimal Number" else
        if [ExplicitDataType] = 9 then "Date" else 
        if [ExplicitDataType] = 10 then "Fixed Decimal Number" else "Other", 
            type text),
    ColumnType = Table.AddColumn(DataType, "Column Type", each
        if [Type] = 1 then "Standard" else
        if [Type] = 2 then "Calculated" else "Other", type text),
    Filter = Table.SelectRows(ColumnType, each 
            not Text.StartsWith([ExplicitName], "RowNumber")
            and not Text.StartsWith([Table],"LocalDate")
            and not Text.StartsWith([Table], "DateTableTemplate")),
    Rename = Table.RenameColumns(Filter,
        {{"ExplicitName","Column"}, {"DataCategory", "Data Category"}, 
        {"IsHidden", "Is Hidden"}, {"FormatString", "Column Format"}})
in Rename
</code></pre>
      </li>
      <li class="calibre12">Create a new<a id="calibre_link-399" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> blank query named <strong class="screentext">Relationships</strong> and identify the tables and columns for each relationship:
        <pre class="programlisting"><code class="hljs">let 
    Relationships = RelationshipsDMV, 
    Tables = TablesDMV, Columns = ColumnsDMV,
    FromTableJoin = Table.NestedJoin(Relationships,
        {"FromTableID"}, Tables, {"ID"},"FromTableCols",JoinKind.Inner),
    FromTable = Table.ExpandTableColumn(FromTableJoin,
        "FromTableCols",{"Name"},{"From Table"}),
    ToTableJoin = Table.NestedJoin(FromTable,
        {"ToTableID"},Tables,{"ID"},"ToTableCols",JoinKind.Inner),
    ToTable = Table.ExpandTableColumn(ToTableJoin,"ToTableCols",
        {"Name"},{"To Table"}),
    FilterDateTbls = Table.SelectRows(ToTable, 
        each not Text.StartsWith([To Table],"LocalDateTable")),
    FromColumnJoin = Table.NestedJoin(FilterDateTbls,
        {"FromColumnID"},Columns,{"ID"},"FromColumnCols",JoinKind.Inner),
    FromColumn = Table.ExpandTableColumn(FromColumnJoin,"FromColumnCols",
        {"ExplicitName"},{"From Column"}),
    ToColumnJoin = Table.NestedJoin(FromColumn,
        {"ToColumnID"},Columns,{"ID"},"ToColumnCols",JoinKind.Inner),
    ToColumn = Table.ExpandTableColumn(ToColumnJoin,"ToColumnCols",
        {"ExplicitName"},{"To Column"}),
    CrossFiltering = Table.AddColumn(ToColumn, "Cross Filtering", 
        each if [CrossFilteringBehavior] = 1 then "Single Direction" 
            else "Bidirectional", type text),
    Rename = Table.RenameColumns(CrossFiltering,{{"ID","Relationship ID"}})
in Rename
</code></pre>
      </li>
      <li class="calibre12">Create a <a id="calibre_link-400" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>simple query called <strong class="screentext">Metrics</strong> based on the <strong class="screentext">MeasuresDMV</strong> query that adds the table name via a join to the <strong class="screentext">TablesDMV</strong> query</li>
      <li class="calibre12">Add a query called <strong class="screentext">Security Roles</strong> that joins the <strong class="screentext">RolesDMV</strong> query with the <strong class="screentext">TablePermissionsDMV</strong> query and the <strong class="screentext">TablesDMV</strong> query, such that the name of the security role, the filter condition, and the table of the filter condition are included in the query</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">In <strong class="screentext">Report</strong> view, create the following four report pages:<ul class="calibre11">
          <li class="calibre12">Columns</li>
          <li class="calibre12">Relationships</li>
          <li class="calibre12">Measures</li>
          <li class="calibre12">Security</li>
        </ul>
      </li>
      <li class="calibre12">Use table visuals to expose the most important columns from each integrated M query on each page:<figure class="mediaobject"><img src="images/000239.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.10: Relationships metadata report page</p>
    <p class="book-title--packt">The alternating rows Matrix style is useful for simple table lists such as metadata documentation. For larger, more complex models, slicer visuals give users the ability to quickly answer their <a id="calibre_link-401" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>own questions about the model such as "Which tables are related to internet sales?" or "Which measures are hidden from the Fields list?":</p>
    <figure class="mediaobject"><img src="images/000252.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 10.11: Measures metadata report page</p>
    <p class="book-title--packt">Table and matrix visuals support word wrap for both headers and individual values. For table visuals exposing the <strong class="screentext">DAX Expression</strong> column and other long columns such as SQL statements, enable <strong class="screentext">Word wrap</strong> in the <strong class="screentext">Values </strong>card of the formatting pane.</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">With the report pages complete, save the Power BI Desktop file and publish the report to the Power BI service.</li>
      <li class="calibre12">In Desktop, click on <strong class="screentext">File</strong>, and then on <strong class="screentext">Export</strong>, to save a Power BI template file (<code class="code-in-text--packt">.pbit</code>).</li>
      <li class="calibre12">Test the template by retrieving the port and catalog name for a separate dataset and opening the template:<figure class="mediaobject"><img src="images/000263.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.12: Opening the template (.pbit) file to generate documentation on a separate Power BI dataset</p>
    <p class="book-title--packt">With the target dataset open, the queries will prompt for authorization, but will then load the report pages.</p>
    <h2 id="calibre_link-1888" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">When used as a<a id="calibre_link-402" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> dataset rather than a report with a live connection, an open Power BI Desktop file includes an instance of SQL Server Analysis Services (SSAS). Therefore, all data model objects (including DMVs) contained within a Power BI Desktop file can be accessed as an SSAS data source. For example, SQL Server Profiler, SQL Server Management Studio, and Microsoft Excel can all reference the same port and catalog name to establish a connection to the data source. Additionally, the same approach in this recipe is applicable to Power BI Desktop models in DirectQuery mode:</p>
    <figure class="mediaobject"><img src="images/000274.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 10.13: Windows Task Manager: SQL Server Analysis Services processes associated with open PBIX datasets</p>
    <p class="book-title--packt">The <strong class="screentext">Columns</strong> query joins the <strong class="screentext">Columns</strong> and <strong class="screentext">Tables</strong> DMV queries and creates two new columns to identify data types and any calculated columns. Additionally, filters are applied to remove metadata associated with the internal date tables that Power BI creates for date columns, and a few columns are renamed to support the documentation reports.</p>
    <p class="book-title--packt">The <strong class="screentext">Relationships</strong> DMV contains the Table and Column ID keys for each side of every relationship defined in the model. Therefore, four separate join expressions are used to retrieve the <strong class="screentext">From Table</strong> and <strong class="screentext">From Column</strong> as well as the <strong class="screentext">To Table</strong> and <strong class="screentext">To Column</strong>. Additionally, a column is added to identify any bidirectional cross-filtering relationships, and filters are<a id="calibre_link-1889" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> applied to remove internal date tables.</p>
    <h2 id="calibre_link-1890" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">For SSAS tabular documentation, additional DMVs such as <code class="code-in-text--packt">TMSCHEMA_KPIS</code> and <code class="code-in-text--packt">TMSCHEMA_PERSPECTIVES</code> may be utilized, along with more details on the display folders of columns and measures, the descriptions entered by model authors for various objects, and partitions. It's possible that metadata currently specific to SSAS, such as perspectives and KPIs, will also be utilized by Power BI datasets in the future.</p>
    <h2 id="calibre_link-1891" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><em class="italic">Four Different Ways to Find Your Power BI Local Port Number</em>: <a href="https://bit.ly/3uiVO1d" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3uiVO1d</span></a></li>
      <li class="bullet"><em class="italic">Dynamic Management Views (DMVs) in Analysis Services</em>: <a href="https://bit.ly/33etDoc%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/33etDoc</span></a></li>
    </ul>
    <h1 id="calibre_link-1282" class="title">Analyzing SSAS tabular databases and gateways</h1>
    <p class="book-title--packt">A Microsoft <a id="calibre_link-1042" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>on-premises <a id="calibre_link-672" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>data gateway enables specific cloud services, including Power BI, Azure Analysis Services, Power Apps, and Power Automate, to securely connect to on-premises data sources. In the context of Power BI, these connections support both the scheduled refresh of imported datasets stored in Power BI, as well as DirectQuery and Live Connection datasets, in which only report queries and their results are exchanged between Power BI and the on-premises source. As the availability and performance of the gateway are critical for any Power BI and other supported cloud service deployment requiring on-premises data, regular monitoring of both the gateway service and its host server(s) is recommended.</p>
    <p class="book-title--packt">In this recipe, performance monitor counters specific to the on-premises data gateway and SQL Server Analysis Services are integrated into a single Power BI dataset. This source data is dynamically retrieved and enhanced via M queries, and sample report visualizations are created to support monitoring and analysis.</p>
    <h2 id="calibre_link-1892" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">For the initial deployment or planning phases, review the available documentation, tips, and best practices on both SSAS tabular and the on-premises data gateway, including the recommended hardware and network configuration.<p class="packt_figref">SSAS tabular servers should have 2.5x the RAM of their compressed in-memory databases, and outbound port 443 should be opened to run the on-premises data gateway in the default HTTPS mode (ports 9350-9353 if TCP mode). Despite sufficient hardware, the design and complexity of data models, M queries, and DAX measures can significantly impact resource usage and performance. See <em class="italic">Chapter 11</em>, <em class="italic">Enhancing and Optimizing Existing Power BI Solutions,</em> for more details.</p>
      </li>
      <li class="calibre12">Identify <a id="calibre_link-1893" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a secure network location directory to store the performance counter file. This <a id="calibre_link-1894" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>path could use a common network drive and the parent folder of other monitoring log files.</li>
      <li class="calibre12">Use Windows Performance Monitor to design and schedule a new data collector set that contains the following performance monitor counters:<ul class="calibre11">
          <li class="calibre12">\MSOLAP:Memory\Memory Limit Hard KB</li>
          <li class="calibre12">\MSOLAP:Memory\Memory Limit High KB</li>
          <li class="calibre12">\MSOLAP:Memory\Memory Limit Low KB</li>
          <li class="calibre12">\MSOLAP:Memory\Memory Limit Vertipaq KB</li>
          <li class="calibre12">\MSOLAP:Memory\Memory Usage KB</li>
        </ul>
      </li>
    </ol>
    <p class="book-title--packt">Performance Monitor defaults to <code class="code-in-text--packt">.blg</code> log files, but Power BI can only consolidate files in text, CSV, and Excel format, so set <strong class="screentext">Log format</strong> to <strong class="screentext">Comma separated</strong>. Windows Performance Monitor is well documented and understood by most administrators. Best practices and automation via PowerShell are outside the scope of this recipe.</p>
    <h2 id="calibre_link-1895" class="calibre8">How to analyze SSAS tabular models and gateways</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a new Power BI Desktop file to be used for both the SSAS tabular and on-premises data gateway counters.</li>
      <li class="calibre12">Create data source parameters for the <strong class="screentext">Server</strong>, <strong class="screentext">Database</strong>, and the number of days of history (<strong class="screentext">CounterHistoryDays</strong>) to retrieve.</li>
      <li class="calibre12">Define a query, <strong class="screentext">AdWorksDW</strong>, that exposes the database objects (tables and views).</li>
      <li class="calibre12">Create a new query called <strong class="screentext">SSAS Memory</strong> that selects the parent folder location of the SSAS tabular performance counters, and follow the same steps of importing performance monitor counter files described in the <em class="italic">Creating a centralized IT monitoring</em> <em class="italic">solution with Power BI</em> recipe earlier in this chapter.</li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create <a id="calibre_link-1043" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a <strong class="screentext">Dates</strong> table using the following <a id="calibre_link-673" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>DAX code:
        <pre class="programlisting"><code class="hljs">Dates = 
    VAR __Today = TODAY()
RETURN
    CALENDAR(DATE(YEAR(__Today)-1,1,1),DATE(YEAR(__Today)+1,12,31))
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Time</strong> table:
        <pre class="programlisting"><code class="hljs">Time = 
    VAR __hrs = SELECTCOLUMNS(GENERATESERIES(1,23,1),"Hour",[Value])
    VAR __mins = SELECTCOLUMNS(GENERATESERIES(0,59,1),"Minutes",[Value])
    VAR __secs = SELECTCOLUMNS(GENERATESERIES(0,59,1),"Seconds",[Value])
    VAR __hoursMinutes = GENERATEALL(__hrs, __mins)
    VAR __hoursMinutesSeconds = GENERATEALL(__hoursMinutes,__secs)
    VAR __final = ADDCOLUMNS(ADDCOLUMNS(__hoursMinutesSeconds,
            "Time", TIMEVALUE(FORMAT([Hour],"00") &amp; ":" &amp; 
                FORMAT([Minutes],"00") &amp; ":" &amp; FORMAT([Seconds],"00"))),
            "SecondOfDay", FORMAT([Hour],"00") &amp; FORMAT([Minutes],"00") &amp; 
                FORMAT([Seconds],"00"))
RETURN __final
</code></pre>
      </li>
      <li class="calibre12">Change the <strong class="screentext">Data type</strong> of the <strong class="screentext">Date</strong> column in the <strong class="screentext">Dates</strong> table to <strong class="screentext">Date</strong>.</li>
      <li class="calibre12">Change the <strong class="screentext">Data type</strong> of the <strong class="screentext">SecondOfDay</strong> column in the <strong class="screentext">Time</strong> table to <strong class="screentext">Text</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Model</strong> view, create a relationship between the <strong class="screentext">Date</strong> columns in the <strong class="screentext">Dates</strong> table and the <strong class="screentext">SSAS Memory</strong> table.</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">SecondOfDay</strong> columns in the <strong class="screentext">Time</strong> table and the <strong class="screentext">SSAS Memory</strong> table.</li>
      <li class="calibre12">Create DAX measures to support reporting and analysis, such as the following:
        <pre class="programlisting"><code class="hljs">KB to GB Conversion = 1048576
Avg Memory Limit Hard (GB) = 
     DIVIDE(AVERAGE('SSAS Memory'[Memory Limit Hard KB]),[KB to GB Conversion])
Avg Memory Usage GB (Today) = 
     CALCULATE([Avg Memory Usage (GB)], 
          FILTER(ALL('Date'),'Date'[Date] = [Current Date]))
Max Memory Usage GB (Today) = 
     CALCULATE([Max Memory Usage (GB)],
          FILTER(ALL('Date'),'Date'[Date] = [Current Date]))
Max Memory GB (Today, All Time) = 
     CALCULATE([Max Memory Usage GB (Today)],ALL('Time'))
</code></pre>
      </li>
      <li class="calibre12">Create <a id="calibre_link-674" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>an <a id="calibre_link-1044" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>SSAS tabular memory report leveraging the consolidated counter files, model relationships, and measures:<figure class="mediaobject"><img src="images/000287.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.14: SQL Server Analysis Services server properties &ndash; memory properties</p>
    <h2 id="calibre_link-1896" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">SSAS Tabular requires memory during processing operations to load new data, in addition to the memory used for existing data. Additionally, temporary memory structures are sometimes created to resolve certain queries. These three components comprise the 2.5x RAM recommendation (2x for current and new data and .5x for temporary structures).</p>
    <p class="book-title--packt">As the memory required by the SSAS instance exceeds certain memory limits or thresholds, given the amount of RAM available to the server and the memory properties defined in analysis server properties, SSAS takes various actions, ranging from clearing out low-priority memory caches (<code class="code-in-text--packt">LowMemoryLimit</code>) to aggressively terminating user sessions (<code class="code-in-text--packt">HardMemoryLimit</code>). A reference to SSAS memory property documentation is included in the <em class="italic">See also</em> section.</p>
    <p class="book-title--packt">The DAX measures convert the memory counter values from KB to GB and make it easy to compare the <a id="calibre_link-1897" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>current day versus the prior day in different filter<a id="calibre_link-1898" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> contexts. For example, the <strong class="screentext">Avg Memory Usage GB (Today)</strong> measure is filtered to the current date but will respect user or report filter selections on the <strong class="screentext">Time</strong> dimension table. The <strong class="screentext">Max Memory GB (Today, All Time)</strong> measure, however, will ignore both <strong class="screentext">Dates</strong> and <strong class="screentext">Time</strong> filter selections to always show the highest memory usage value for the current day.</p>
    <p class="book-title--packt">Significant spikes in memory usage may indicate sub-optimal DAX measures or inefficient report queries that require large, temporary memory structures. BI teams would want to ensure that memory usage does exceed the memory limits identified by the counters, to avoid performance degradation. Increases in the SSAS memory limit property settings, or simply more overall RAM for the SSAS server, are two options to avoid memory shortages.</p>
    <h2 id="calibre_link-1899" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Scheduled refreshes of imported datasets to Power BI can require significant resources at the time of refresh, based on the size of the dataset and whether its M queries can be folded to the data source as SQL statements. For example, if an M function that doesn't have an equivalent expression in the source Oracle database is used, the M engine in the gateway will be used to execute the logic, such as filter, sort, and aggregate.</p>
    <p class="book-title--packt">DirectQuery and SSAS live connections are less resource-heavy, however, as only queries and query result data are transferred across the gateway. Despite this, it is important to consider the fact that these connections generate a high frequency of queries based on the number of concurrent users, their usage or interaction with the published reports, the type and volume of visualizations, and whether <strong class="screentext">row-level security</strong> (<strong class="screentext">RLS</strong>) roles <a id="calibre_link-991" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>have been configured.</p>
    <p class="book-title--packt">Performance reports can also be created for Power BI gateways. To understand how this is done, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create and schedule a new performance monitor data collector set containing the on-premises<a id="calibre_link-1045" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> data<a id="calibre_link-675" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> gateway counters:<figure class="mediaobject"><img src="images/000299.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.15: On-premises data gateway performance counters</p>
      </li>
      <li class="calibre12">In the same Power BI Desktop file containing the SSAS counters, create an additional query to the parent folder of the gateway counter files and apply the same M query transformations to filter the files imported, adjust data types, rename columns, and add <strong class="screentext">Date</strong> and <strong class="screentext">Time</strong> columns to support relationships to the <strong class="screentext">Dates</strong> and <strong class="screentext">Time</strong> dimension tables</li>
      <li class="calibre12">Build basic aggregation measures against the different gateway counter columns</li>
      <li class="calibre12">Build additional DAX measures that apply or remove filter contexts from the <strong class="screentext">Dates </strong>and <strong class="screentext">Time </strong>tables, following the same expression patterns as the <strong class="screentext">SSAS Memory</strong> DAX measures</li>
      <li class="calibre12">Design a dedicated gateway report page for the gateway performance counters:<figure class="mediaobject"><img src="images/000311.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.16: Gateway performance report</p>
    <p class="book-title--packt">In this example, the<a id="calibre_link-1046" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> organization is using an SSAS 2014 Tabular<a id="calibre_link-676" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Server as a primary data source for Power BI report and dashboard content. Therefore, measures based on the ADOMD gateway counters are used to expose the volume of this workload (bottom chart). The <strong class="screentext"># of all queries executed / sec</strong> performance counter is used by the top chart, as well as the average and maximum card visuals above the line chart. Though less common, the organization also uses this gateway to support certain import refreshes of Power BI datasets (Mashup counters) and DirectQuery datasets (ADO.NET counters).</p>
    <p class="book-title--packt">Card, gauge, and standard KPI visuals pinned as tiles to dashboards can drive data alerts and email notifications. In the context of this recipe, memory usage in excess of the Vertipaq and other memory limits could warrant a data alert. Likewise, a high number of query failures, or an unexpected query type activity reported by the gateway counters, could also drive a data alert. For example, if a particular gateway is intended to be dedicated to Import (Mashup) workloads, the counters shouldn't report query activity for ADO.NET (DirectQuery) or OLEDB connections.</p>
    <p class="book-title--packt">It should be noted that the on-premises data gateway supports logging via the <strong class="screentext">Diagnostics </strong>tab of the management application. Detailed logging can be enabled by toggling the <strong class="screentext">Additional logging</strong> option on although this should only be used when troubleshooting and not left on permanently as this considerably increases the number and size of log files. The<a id="calibre_link-1047" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> gateway logs can be exported on the<a id="calibre_link-677" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> same <strong class="screentext">Diagnostics</strong> tab.</p>
    <h2 id="calibre_link-1900" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><em class="italic">Guidance for Deploying a Data Gateway for Power BI</em>: <a href="http://bit.ly/2t8hk9i" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2t8hk9i</span></a></li>
      <li class="bullet"><em class="italic">SQL Server Analysis Services Memory Properties</em>: <a href="http://bit.ly/2vuY1I2" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2vuY1I2</span></a></li>
      <li class="bullet"><em class="italic">Monitor and optimize on-premises data gateway performance</em>: <a href="https://bit.ly/3nffIJQ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3nffIJQ</span></a></li>
    </ul>
    <h1 id="calibre_link-1283" class="title">Analyzing Extended Events</h1>
    <p class="book-title--packt">Extended Events is <a id="calibre_link-472" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a highly configurable and lightweight performance monitoring system available to both the SQL Server relational database engine and Analysis Services. A vast library of events is available to specific sessions, which can be saved, scheduled, and then analyzed to support performance tuning, troubleshooting, and general monitoring. However, similar to other monitoring tools (such as Windows Performance Monitor and SQL Server Query Store), the Extended Events graphical interface lacks the rich analytical capabilities and flexibility of reporting tools such as Power BI.</p>
    <p class="book-title--packt">In this recipe, the output of an Extended Events session containing query execution statistics is retrieved in a dedicated Power BI event analysis report file. The 1.4 million rows of event data from this file are enhanced during the import process, and report visualizations are developed to call out the most meaningful trends and measures, as well as support further self-service analysis.</p>
    <h2 id="calibre_link-1901" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Identify the events associated with the top monitoring and troubleshooting use cases</li>
      <li class="calibre12">Create separate extended event sessions tailored to these use cases with filters to exclude irrelevant or redundant data<figure class="mediaobject"><img src="images/000323.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.17: An Extended Events session with two events and a filter</p>
      </li>
      <li class="calibre12">Determine the data storage target for the session(s), such as an <strong class="screentext">event file</strong>, and the location of this file</li>
      <li class="calibre12">Optionally, configure settings such as <strong class="screentext">Event retention mode</strong> and <strong class="screentext">Max memory size</strong> and/or optionally configure a SQL Agent job to start and stop the event session</li>
    </ol>
    <h2 id="calibre_link-1902" class="calibre8">How to analyze Extended Events</h2>
    <p class="book-title--packt">To<a id="calibre_link-473" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Obtain access<a id="calibre_link-1028" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to the Extended Events target XEL target file and open it from <strong class="screentext">SQL Server Management Studio</strong> (<strong class="screentext">SSMS</strong>), or open it directly from Windows Explorer in a distinct instance of SSMS.</li>
      <li class="calibre12">With the XEL file open in SSMS, click on the <strong class="screentext">Extended Events</strong> tab on the toolbar and select <strong class="screentext">Export to</strong> at the bottom.</li>
      <li class="calibre12">Choose the <strong class="screentext">CSV File</strong> option, enter a filename describing the session, and select a network path common to Extended Events and, potentially, other performance and administrative log files:<figure class="mediaobject"><img src="images/000334.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.18: An Extended Events session target XEL file and its export as a CSV file</p>
      </li>
      <li class="calibre12">Open a Power BI Desktop file that already contains <strong class="screentext">Dates</strong> and <strong class="screentext">Time</strong> tables, or create these tables using the same process as described in the <em class="italic">Creating a centralized IT monitoring solution with Power BI </em>recipe earlier in this chapter</li>
      <li class="calibre12">Click <strong class="screentext">Transform data</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open <strong class="screentext">Power Query Editor</strong></li>
      <li class="calibre12">Create a parameter for the directory folder path of the event session files and a parameter for the session filename</li>
      <li class="calibre12">Open a blank query that concatenates the two parameters into a full file path. Name this query <strong class="screentext">XEventsSession</strong>:<figure class="mediaobject"><img src="images/000346.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.19: Query Editor view with the Data Sources parameter and XEventsSession query</p>
      </li>
      <li class="calibre12">Create a <a id="calibre_link-474" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query that uses the text/CSV data connector, and replace the file path with the <strong class="screentext">XEventsSession</strong> query</li>
      <li class="calibre12">Promote the top row as the column headers and convert the data types via the <code class="code-in-text--packt">Table.TransformColumnTypes</code> function</li>
      <li class="calibre12">Add a <strong class="screentext">Date</strong> column based on the <strong class="screentext">Timestamp</strong> column of the source file:
        <pre class="programlisting"><code class="hljs">let
    Source = Csv.Document(File.Contents(XEventsSession),
        [Delimiter=",", Columns=31, Encoding=65001,QuoteStyle=QuoteStyle.None]),
    PromotedHeaders = Table.PromoteHeaders(Source, [PromoteAllScalars=true]),
    ChangeTypes = Table.TransformColumnTypes(PromotedHeaders,
        {{"timestamp", type datetime}, {"duration", Int64.Type}}), 
    DateColumn = Table.AddColumn(RenameColumns, "Timestamp Date", 
        each DateTime.Date([timestamp]), type date)
in
    DateColumn
</code></pre>
      </li>
      <li class="calibre12">Add a <strong class="screentext">Time</strong> column and a <strong class="screentext">SecondOfDay</strong> column to support a relationship with the <strong class="screentext">Time</strong> dimension table<p class="packt_figref">See the <em class="italic">Creating a centralized IT monitoring solution with Power BI</em> recipe earlier in this chapter for the <strong class="screentext">SecondOfDay</strong> column logic and syntax. Like the Performance Monitor Counter data in that example, the timestamp from the Extended Events session is not at the seconds grain, and so adding a time column via the <code class="code-in-text--packt">DateTime.Time</code> M function is not sufficient to support a model relationship with the <strong class="screentext">Time</strong> dimension table</p>
      </li>
      <li class="calibre12">Name this query <strong class="screentext">Execution Stats</strong>; disable the load of the <strong class="screentext">XEventsSession</strong> query</li>
      <li class="calibre12">Create a<a id="calibre_link-475" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> blank query called <strong class="screentext">Calculations</strong></li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create many-to-one, single-direction relationships from <strong class="screentext">Execution Stats</strong> to the <strong class="screentext">Dates</strong> and <strong class="screentext">Time</strong> tables</li>
      <li class="calibre12">Develop and format simple DAX measures to support common aggregations of Extended Events fact columns, such as the average, minimum, and maximum of query duration, CPU time, and logical reads and writes:
        <pre class="programlisting"><code class="hljs">Average CPU Time = AVERAGE('Execution Stats'[cpu_time])
Max Duration = MAX('Execution Stats'[duration])
Minimum Logical Reads = MIN('Execution Stats'[logical_reads])
</code></pre>
      </li>
      <li class="calibre12">Create a report to visualize the data, like the one shown in <em class="italic">Figure 10.20</em>:<figure class="mediaobject"><img src="images/000357.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.20: Extended Events Execution Stats Report page</p>
    <p class="book-title--packt">In this <a id="calibre_link-1903" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>example, 3 line charts highlight spikes in logical reads, CPU time, and query duration that occurred during the 30-minute Extended Events session. The scatter chart plots individual <code class="code-in-text--packt">query_hash</code> values by duration and CPU time and uses the Tooltip to expose the individual SQL statement represented. A table visual with word wrapping is used to display the SQL statement associated with the user's selection as well. Refer to the <em class="italic">How it worksâ¦</em> section for more details on the sample report visual.</p>
    <h2 id="calibre_link-1904" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">By design, Extended Events sessions cannot be written to tables within SQL Server. Additional options for capturing and analyzing event session data are available, such as the <strong class="screentext">histogram </strong>and <strong class="screentext">pair matching</strong> targets. Data can also be viewed live via <strong class="screentext">Watch Live Data</strong>; the CSV and table export options expose this data to tools such as Power BI.</p>
    <p class="book-title--packt">Note that if the events file was exported to a table in SQL Server, the Power BI dataset could be configured for DirectQuery mode. Avoiding the import to Power BI via DirectQuery could be a useful or even a necessary design choice if large and/or multiple event session files are needed in the same Power BI dataset. The dedicated <strong class="screentext">Admin</strong> database described in the first recipe of this chapter could store the Extended Events data, and essential <strong class="screentext">Dates</strong> and <strong class="screentext">Time</strong> tables could be imported into this same server and database, thereby permitting DirectQuery mode.</p>
    <h2 id="calibre_link-1905" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">SQL Server Profiler is supported in SQL Server 2016, but is now a deprecated feature for the relational database engine; Extended Events is its long-term replacement. Profiler is not a deprecated feature for Analysis Services, although a graphical interface to Extended Events is a new feature in SSAS 2016, and several new SSAS trace events are exclusively available via Extended Events. Regardless of the database engine (relational or analytical), Extended Events is more efficient and flexible than SQL Server Profiler, thus allowing for more nuanced event data collection with less impact on production workloads. Events associated with new SQL Server features are exclusive to Extended Events.</p>
    <p class="book-title--packt">Additional <a id="calibre_link-476" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>standard event sessions, such as blocking and deadlocking sessions, could be integrated into the Power BI dataset, similar to the consolidated dataset and visualization layer described earlier in this chapter. As the solution matures, custom groupings of events and/or bins of numerical columns could be embedded in the dataset to simplify analysis further.</p>
    <p class="book-title--packt">In Azure, Azure Log Analytics can be used to monitor activities of virtual machines and other resources running in Azure. Kusto queries can be written to extract log events from this data. These Kusto queries can then be exported to <strong class="screentext">Power Query (M)</strong> using the <strong class="screentext">Export</strong> menu. These <strong class="screentext">Power Query (M)</strong> queries can then be pasted into a blank query in Power BI to extract the same data and include in a model.</p>
    <h2 id="calibre_link-1906" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><em class="italic">Quickstart: Extended Events in SQL Server</em>: <a href="https://bit.ly/2Ss8pRN" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2Ss8pRN</span></a></li>
      <li class="bullet"><em class="italic">XEvents overview&mdash;SQL Server</em>: <a href="https://bit.ly/2QJmfPj" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2QJmfPj</span></a></li>
      <li class="bullet"><em class="italic">Log Analytics tutorial - Azure Monitor</em>: <a href="https://bit.ly/3hn3NGn%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3hn3NGn</span></a></li>
    </ul>
    <h1 id="calibre_link-1284" class="title">Visualizing log file data</h1>
    <p class="book-title--packt">Log files <a id="calibre_link-573" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>containing SQL Server Agent job history and the Power BI usage activities stored in the Office 365 audit log and Power BI activity log can also be integrated into the Power BI monitoring solution described earlier in this chapter. For example, SQL Agent job data can reveal important trends, such as the performance of a nightly job used to load a data warehouse and the duration and reliability of individual steps within these jobs. Likewise, detailed reporting and, optionally, alerts based on user activities in the Power BI service, such as deleting a dashboard, enable BI and IT administrators to better manage and govern Power BI deployments.</p>
    <p class="book-title--packt">In this recipe, transformations are applied to the structure of the Power BI audit log to convert the audit data stored in JSON format and adjust for local time reporting. Additionally, an advanced T-SQL query is used to access the job history data in SQL Server Agent system tables, and to prepare this data for visualization in Power BI. While this recipe covers the Office 365 audit log, similar information can be obtained using the Power BI activity log. Refer to the <em class="italic">See also</em> section of this recipe for more information on the Power BI activity log.</p>
    <h2 id="calibre_link-1907" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for <a id="calibre_link-1908" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the Power BI Admin portal, select <strong class="screentext">Tenant Settings</strong> and enable audit logging:<figure class="mediaobject"><img src="images/000368.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.21: Power BI audit logging enabled</p>
      </li>
      <li class="calibre12">Make sure that you are an Office 365 Global Administrator, or otherwise have permissions enabled to access the Office 365 audit logs</li>
      <li class="calibre12">Run a <strong class="screentext">PowerShell</strong> session as <strong class="screentext">Administrator</strong></li>
      <li class="calibre12">Set your execution policy:
        <pre class="programlisting"><code class="hljs">Set-ExecutionPolicy RemoteSigned
</code></pre>
      </li>
      <li class="calibre12">Run the following command to install the Exchange Online Management module:
        <pre class="programlisting"><code class="hljs">Install-Module ExchangeOnlineManagement
</code></pre>
      </li>
      <li class="calibre12">Connect to Microsoft Exchange Online (where &lt;UPN&gt; is your Office 365 email address):
        <pre class="programlisting"><code class="hljs">Connect-ExchangeOnline -UserPrincipalName &lt;UPN&gt;
</code></pre>
      </li>
      <li class="calibre12">Make sure that you are able to run PowerShell remotely (where &lt;UPN&gt; is your Office 365 email address):
        <pre class="programlisting"><code class="hljs">Set-User -Identity &lt;UPN&gt; -RemotePowerShellEnabled $true
</code></pre>
      </li>
      <li class="calibre12">Verify audit log access:
        <pre class="programlisting"><code class="hljs">Search-UnifiedAuditLog -StartDate 5/1/2021 -EndDate 5/4/2021 -RecordType PowerBI -ResultSize 1000 | Format-Table | More
</code></pre>
      </li>
      <li class="calibre12">Export the audit log to a CSV file:
        <pre class="programlisting"><code class="hljs">Search-UnifiedAuditLog -StartDate $startDt -EndDate $endDt -RecordType PowerBI | Export-Csv $csvFile
</code></pre>
      </li>
      <li class="calibre12">Create a <a id="calibre_link-574" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>view in the <strong class="screentext">Admin</strong> SQL Server database (described in the <em class="italic">Creating a centralized IT monitoring solution with Power BI</em> recipe earlier in this chapter) that queries the <code class="code-in-text--packt">dbo.sysjobhistory</code> and <code class="code-in-text--packt">dbo.sysjobs</code> tables in the <code class="code-in-text--packt">msdb</code> database:
        <pre class="programlisting"><code class="hljs">CREATE VIEW vFact_AgentJobHistory AS SELECT
 [h].[server] as [Server], [j].[name] AS [Job Name], 
CASE [j].[enabled] WHEN 0 THEN 'Disabled' WHEN 1 THEN 'Enabled' END AS [Job Status]
, [j].[date_created] as [Date Created], [j].[date_modified] as [Date Modified] 
, [j].[description] as [Job Description], [h].[step_id] AS [Step ID], [h].[step_name] AS [Step Name]
, CAST(STR([h].[run_date],8, 0) AS date) AS [Run Date]
, CAST(STUFF(STUFF(RIGHT('000000' + CAST ( [h].[run_time] AS VARCHAR(6 ) ) ,6),5,0,':'),3,0,':') as time(0)) AS [Run Time]
, (([run_duration]/10000*3600 + ([run_duration]/100)%100*60 + [run_duration]%100 + 31 ) / 60) 
    AS [Run Duration Minutes]
, CASE [h].[run_status] WHEN 0 THEN 'Failed' WHEN 1 THEN 'Succeeded' WHEN 2 THEN 'Retry' 
WHEN 3 THEN 'Cancelled' WHEN 4 THEN 'In Progress' END AS [Execution Status], 
[h].[message] AS [Message Generated] 
FROM [msdb].[dbo].[sysjobhistory] [h] INNER JOIN [msdb].[dbo].[sysjobs] [j] ON [h].[job_id] = [j].[job_id]
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1909" class="calibre8">How to visualize log file data</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In Power BI Desktop, create parameters for the file path and filename; local time zone offsets to UTC</li>
      <li class="calibre12">Create a blank query called <strong class="screentext">PBIAuditLog</strong> that returns the full file path based on the parameters; disable the load:<figure class="mediaobject"><img src="images/000379.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.22: PBIAuditLog file path query and other parameters in Query Editor</p>
      </li>
      <li class="calibre12">Create <a id="calibre_link-575" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a new query called <strong class="screentext">O365PBIAuditLog</strong>:
        <pre class="programlisting"><code class="hljs">let 
    Source = Csv.Document(File.Contents(PBIAuditLog),
        [Delimiter=",", Columns=13, Encoding=65001, QuoteStyle=QuoteStyle.Csv]),
    RemoveTopRows = Table.Skip(Source,1),
    PromoteHeaders = Table.PromoteHeaders(RemoveTopRows, [PromoteAllScalars=true]),
    ApplyDateType = Table.TransformColumnTypes(PromoteHeaders,
        {{"CreationDate", type datetime}}),
    AddCreationDateColumn = Table.AddColumn(ApplyDateType, 
        "CreationDateOnly", each DateTime.Date([CreationDate]), type date),
    AddLocalTime = Table.AddColumn(AddCreationDateColumn,"LocalCreationDate",
        each [CreationDate] + #duration(0,USEasternDSTOffset,0,0)),
    AddLocalCreationDateColumn = Table.AddColumn(AddLocalTime, 
        "LocalCreationDateOnly", each DateTime.Date([LocalCreationDate]), type date),
    ParseJSON = Table.TransformColumns(AddLocalCreationDateColumn,
        {{"AuditData", Json.Document}})
in
    ParseJSON
</code></pre>
      </li>
      <li class="calibre12">Add steps to expand the <strong class="screentext">Audit</strong> column and set the appropriate data types for the expanded columns</li>
      <li class="calibre12">Create or reuse <strong class="screentext">Server</strong> and <strong class="screentext">Database</strong> parameters to create a query called <strong class="screentext">SQLAgentHistory</strong> that retrieves the agent data:<figure class="mediaobject"><img src="images/000389.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.23: SQL Server Agent History view exposed in the "AdminProd" query</p>
      </li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from<a id="calibre_link-576" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a <strong class="screentext">Dates</strong> table using the following DAX code:
        <pre class="programlisting"><code class="hljs">Dates = 
    VAR __Today = TODAY()
RETURN
    CALENDAR(DATE(YEAR(__Today)-1,1,1),DATE(YEAR(__Today)+1,12,31))
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Time</strong> table:
        <pre class="programlisting"><code class="hljs">Time = 
    VAR __hrs = SELECTCOLUMNS(GENERATESERIES(1,23,1),"Hour",[Value])
    VAR __mins = SELECTCOLUMNS(GENERATESERIES(0,59,1),"Minutes",[Value])
    VAR __secs = SELECTCOLUMNS(GENERATESERIES(0,59,1),"Seconds",[Value])
    VAR __hoursMinutes = GENERATEALL(__hrs, __mins)
    VAR __hoursMinutesSeconds = GENERATEALL(__hoursMinutes,__secs)
    VAR __final = ADDCOLUMNS(ADDCOLUMNS(__hoursMinutesSeconds,
            "Time", TIMEVALUE(FORMAT([Hour],"00") &amp; ":" &amp; 
                FORMAT([Minutes],"00") &amp; ":" &amp; FORMAT([Seconds],"00"))),
            "SecondOfDay", FORMAT([Hour],"00") &amp; FORMAT([Minutes],"00") &amp; 
                FORMAT([Seconds],"00"))
RETURN __final
</code></pre>
      </li>
      <li class="calibre12">Change the <strong class="screentext">Data type</strong> of the <strong class="screentext">Date</strong> column in the <strong class="screentext">Dates</strong> table to <strong class="screentext">Date</strong></li>
      <li class="calibre12">Change the <strong class="screentext">Data type</strong> of the <strong class="screentext">SecondOfDay</strong> column in the <strong class="screentext">Time</strong> table to <strong class="screentext">Text</strong></li>
      <li class="calibre12">In the <strong class="screentext">Model</strong> view, create relationships between the <strong class="screentext">Dates</strong> and <strong class="screentext">Time</strong> tables and the <strong class="screentext">O365PBIAuditLog</strong> and <strong class="screentext">SQLAgentHistory</strong> tables</li>
      <li class="calibre12">Create DAX measures and report visuals to break out agent jobs by their steps and duration over time</li>
      <li class="calibre12">Create <a id="calibre_link-1910" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>report pages to visualize the data:<figure class="mediaobject"><img src="images/000401.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.24: SQL Server Agent History visuals&mdash;Average Duration by Run Date and Job and Step</p>
    <h2 id="calibre_link-1911" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">The <code class="code-in-text--packt">Search-UnifiedAuditLog</code> cmdlet for PowerShell is used to access Power BI data from the Office 365 audit log. Variables for the full CSV file path and start and end date can be defined, evaluated, and passed as parameters to the <code class="code-in-text--packt">Search-UnifiedAuditLog</code> cmdlet. Refer to the <em class="italic">See also</em> section of this recipe for additional information.</p>
    <p class="book-title--packt">Over 20 SQL Server Agent system tables are available in the <code class="code-in-text--packt">dbo</code> schema of the <code class="code-in-text--packt">msdb</code> database. In the view created in the <em class="italic">Getting ready</em> section of this recipe, the <code class="code-in-text--packt">run_date </code>and <code class="code-in-text--packt">run_time</code> columns are stored as integers by SQL Server and are thus converted to date and time data types, respectively. The <code class="code-in-text--packt">run_duration</code> column is stored as an integer in the <code class="code-in-text--packt">HHMMSS</code> format and is converted to minutes. The <code class="code-in-text--packt">run_status</code> column is replaced with an <strong class="screentext">Execution Status </strong>column to display a user-friendly value, such as <strong class="screentext">succeeded</strong>, and likewise a <strong class="screentext">Job Status</strong> column is created from the enabled source column to display disabled versus enabled values.</p>
    <p class="book-title--packt">For the SQL Agent report in this recipe, a stacked bar chart is used to display the individual steps comprising each job; hovering over the bars displays details specific to the job step. User selections on the bar chart filter the line chart, enabling easy access to the recent performance of any job step. Analyzing SQL Agent job history in Power BI is vastly easier and more flexible than the Job Activity Monitor and Log File Viewer interfaces in SQL Server Management Studio.</p>
    <h2 id="calibre_link-1912" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">The Power BI service provides free usage reporting for dashboards and published reports. These usage reports can be easily extended to analyze activity for all reports and dashboards contained in an app workspace using the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the app workspace in the Power BI service and select the vertical ellipses for a report or dashboard; choose <strong class="screentext">View usage metrics report</strong> (usage metrics can also be <a id="calibre_link-577" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>accessed with the report or dashboard open via the toolbar ellipses (â¦) and selecting <strong class="screentext">Open usage metrics</strong>):<figure class="mediaobject"><img src="images/000414.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.25: Usage metrics report</p>
      </li>
      <li class="calibre12">With the usage metrics report open, click on <strong class="screentext">File</strong> | <strong class="screentext">Save as</strong> to add a new report to the app workspace:<figure class="mediaobject"><img src="images/000426.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.26: Save as to create a dataset of usage metrics for the workspace</p>
      </li>
      <li class="calibre12">Open the new report and simply remove the report-level filter such that all reports and dashboards are included:<figure class="mediaobject"><img src="images/000436.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 10.27: Usage metrics report</p>
    <p class="book-title--packt">Note that individual users are included in the dataset and default report, making it easy to identify<a id="calibre_link-578" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> who is or isn't accessing content. </p>
    <h2 id="calibre_link-1913" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><em class="italic">SQL Server Agent Table documentation</em>: <a href="http://bit.ly/2v7kWdc" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2v7kWdc</span></a></li>
      <li class="bullet"><em class="italic">Monitor usage metrics in the new workspace experience</em>: <a href="https://bit.ly/2SrjylV" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2SrjylV</span></a></li>
      <li class="bullet"><em class="italic">Track user activities in Power BI</em>: <a href="https://bit.ly/3raDXZD" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3raDXZD</span></a></li>
    </ul>
    <h1 id="calibre_link-1285" class="title">Leveraging the Power BI PowerShell Module</h1>
    <p class="book-title--packt">Power BI administrators can automate common tasks by developing PowerShell scripts which leverage commands included in the Microsoft Power BI Management PowerShell module such as Get-PowerBIWorkspace and Add-PowerBIWorkspaceUser. In addition, custom administrative solutions can be developed using the Power BI REST APIs and .NET client library. Using the Power BI REST API, administrators can automate the creation of workspaces and dashboards, publish workspace content, share workspace content, remove access to workspaces, delete workspaces, and much more.</p>
    <p class="book-title--packt">This recipe demonstrates how to connect to Power BI via PowerShell and perform simple administrative functions.</p>
    <h2 id="calibre_link-1914" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Enable Power BI APIs in <strong class="screentext">Tenant settings</strong> of the Power BI service:<figure class="mediaobject"><img src="images/000447.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 10.28: Power BI APIs tenant settings in the Power BI service</p>
      </li>
      <li class="calibre12">Make sure<a id="calibre_link-814" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> that you are a Power BI Administrator or otherwise have permissions for Power BI</li>
      <li class="calibre12">Run a <strong class="screentext">PowerShell</strong> session as <strong class="screentext">Administrator</strong></li>
      <li class="calibre12">Set your execution policy:
        <pre class="programlisting"><code class="hljs">Set-ExecutionPolicy RemoteSigned
</code></pre>
      </li>
      <li class="calibre12">Run the following command to install the Exchange Online Management module:
        <pre class="programlisting"><code class="hljs">Install-Module MicrosoftPowerBIMgmt -Force
</code></pre>
      </li>
      <li class="calibre12">Connect to Power BI:
        <pre class="programlisting"><code class="hljs">Login-PowerBI
</code></pre>
      </li>
      <li class="calibre12">Verify access:
        <pre class="programlisting"><code class="hljs">Get-PowerBIWorkspace | Format-Table
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1915" class="calibre8">How to leverage the Power BI PowerShell Module</h2>
    <p class="book-title--packt">To implement this recipe, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In PowerShell, get a list of all new workspaces, including personal workspaces, and export this as a CSV file:
        <pre class="programlisting"><code class="hljs">Get-PowerBIWorkspace -Scope Organization -All | Export-Csv c:\temp\workspaces.csv
</code></pre>
      </li>
      <li class="calibre12">Get a list of all workspaces, including classic workspaces, but excluding personal workspaces, and export this to a CSV file:
        <pre class="programlisting"><code class="hljs">Get-PowerBIWorkspace -All | Export-Csv c:\temp\workspaces2.csv
</code></pre>
      </li>
      <li class="calibre12">Get a list of all workspace users for all new workspaces:
        <pre class="programlisting"><code class="hljs">Get-PowerBIWorkspace -Scope Organization -Include All -All |
ForEach-Object {
$Workspace = $_.name
$WorkspaceId = $_.Id
foreach ($User in $_.Users) {
[PSCustomObject]@{
Workspace = $Workspace
Id = $WorkspaceId
Role = $User.accessright
User = $user.Identifier}}} | Export-Csv "c:\temp\workspaceusers.csv" -NoTypeInformation
</code></pre>
      </li>
      <li class="calibre12">Create a<a id="calibre_link-815" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> query called <strong class="screentext">Workspaces2</strong> and disable the load:
        <pre class="programlisting"><code class="hljs">let
    Source = Csv.Document(File.Contents("C:\temp\workspaces2.csv"),
        [Delimiter=",", Columns=15, Encoding=1252, QuoteStyle=QuoteStyle.None]),
    RemoveRows = Table.Skip(Source,1),
    Headers = Table.PromoteHeaders(RemoveRows, [PromoteAllScalars=true]),
    ChangeTypes = Table.TransformColumnTypes(Headers,{{"Id", type text}, 
        {"Name", type text}, {"IsReadOnly", type logical}, 
        {"IsOnDedicatedCapacity", type logical}, {"CapacityId", type text}, 
        {"Description", type text}, {"Type", type text}, {"State", type text}, 
        {"IsOrphaned", type logical}, {"Users", type text}, 
        {"Reports", type text}, {"Dashboards", type text}, 
        {"Datasets", type text}, {"Dataflows", type text}, 
        {"Workbooks", type text}})
in ChangeTypes
</code></pre>
      </li>
      <li class="calibre12">Create a query called <strong class="screentext">Workspaces</strong>:
        <pre class="programlisting"><code class="hljs">let
    Source = Csv.Document(File.Contents("C:\temp\workspaces.csv"),
        [Delimiter=",", Columns=15, Encoding=1252, QuoteStyle=QuoteStyle.None]),
    RemoveRows = Table.Skip(Source,1),
    Headers = Table.PromoteHeaders(RemoveRows, [PromoteAllScalars=true]),
    ChangeTypes = Table.TransformColumnTypes(Headers,{{"Id", type text}, 
        {"Name", type text}, {"IsReadOnly", type logical}, 
        {"IsOnDedicatedCapacity", type logical}, {"CapacityId", type text}, 
        {"Description", type text}, {"Type", type text}, {"State", type text}, 
        {"IsOrphaned", type logical}, {"Users", type text}, 
        {"Reports", type text}, {"Dashboards", type text}, 
        {"Datasets", type text}, {"Dataflows", type text}, 
        {"Workbooks", type text}}),
    AppendQuery = Table.Combine({ChangeTypes, Workspaces2}),
    RemoveDups = Table.Distinct(AppendQuery, {"Id"})
in
    RemoveDups
</code></pre>
      </li>
      <li class="calibre12">Create a<a id="calibre_link-816" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> query called <strong class="screentext">WorkspaceUsers</strong>:
        <pre class="programlisting"><code class="hljs">let
    Source = Csv.Document(File.Contents("c:\temp\workspaceusers.csv"),
        [Delimiter=",", Columns=4, Encoding=1252, QuoteStyle=QuoteStyle.None]),
    Headers = Table.PromoteHeaders(Source, [PromoteAllScalars=true]),
    ChangeType = Table.TransformColumnTypes(Headers,
        {{"Workspace", type text}, {"Id", type text}, 
        {"Role", type text}, {"User", type text}})
in ChangeType
</code></pre>
      </li>
      <li class="calibre12">Optionally, create export files for Reports, Dashboards, Datasets, Dataflows, and Workbooks within each workspace, similar to the following:
        <pre class="programlisting"><code class="hljs">Get-PowerBIWorkspace -Scope Organization -Include All -All |
ForEach-Object {
$Workspace = $_.name
$WorkspaceId = $_.Id
foreach ($Report in $_.Reports) {
[PSCustomObject]@{
Workspace = $Workspace
Id = $WorkspaceId
ReportID = $Report.Id
Report = $Report.Name}}} | Export-Csv "c:\temp\wsreports.csv" -NoTypeInformation
</code></pre>
      </li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab.</li>
      <li class="calibre12">Create a relationship between the <strong class="screentext">ID</strong> columns in the <strong class="screentext">Workspaces</strong> and <strong class="screentext">WorkspaceUsers</strong> tables.</li>
      <li class="calibre12">Optionally, create additional relationships between the <strong class="screentext">ID</strong> columns in the <strong class="screentext">Workspaces</strong> table and other tables for Reports, Dashboards, Datasets, Dataflows, and Workbooks.</li>
      <li class="calibre12">Create a measure to concatenate the users:
        <pre class="programlisting"><code class="hljs">Users = CONCATENATEX('WorkspaceUsers',[User],", ")
</code></pre>
      </li>
      <li class="calibre12">Create a matrix visualization using the <strong class="screentext">Name</strong> column from the <strong class="screentext">Workspaces</strong> table as <strong class="screentext">Rows</strong>, the <strong class="screentext">Role</strong> column from the <strong class="screentext">WorkspaceUsers</strong> table as <strong class="screentext">Column</strong>, and the <strong class="screentext">Users</strong> measure as <strong class="screentext">Values</strong>.</li>
    </ol>
    <h2 id="calibre_link-1916" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">Classic Power BI <a id="calibre_link-817" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>workspaces have less functionality than newer ones. With Classic workspaces, the list of user permissions cannot be retrieved through the Power BI API because access is granted through Office 365 groups. In addition, <code class="code-in-text--packt">PSCustomObject</code> is not included in cmdlet calls that support classic workspaces. As a Power BI Admin, you can upgrade workspaces by accessing the Power BI <strong class="screentext">Admin portal</strong> and selecting <strong class="screentext">Workspaces</strong>. In the <strong class="screentext">Workspaces</strong> listed, select one or more workspaces, and then click <strong class="screentext">Upgrade</strong> from the toolbar.</p>
    <p class="book-title--packt">With the matrix visualization created in this recipe, it is easy to find classic workspaces by clicking on the dropdown for the <strong class="screentext">Name</strong> column in the <strong class="screentext">Rows</strong> field and selecting <strong class="screentext">Show items with no data</strong>. Non-orphaned workspaces with no users listed, such as <strong class="screentext">Admin</strong>, <strong class="screentext">Contributor</strong>, <strong class="screentext">Member</strong>, or <strong class="screentext">Viewer</strong>, are almost certainly classic workspaces that should be upgraded.</p>
    <h2 id="calibre_link-1917" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">There are many PowerShell cmdlets available for Power BI, including the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Get a list of all deleted workspaces:
        <pre class="programlisting"><code class="hljs">Get-PowerBIWorkspace -Scope Organization -Deleted -All
</code></pre>
      </li>
      <li class="calibre12">Restore a workspace:
        <pre class="programlisting"><code class="hljs">Restore-PowerBIWorkspace -Id "&lt;Workspace GUID&gt;" -RestoredName "&lt;Workspace Name&gt;" -AdminEmailAddress "&lt;Admin UPN&gt;"
</code></pre>
      </li>
      <li class="calibre12">Find orphaned workspaces:
        <pre class="programlisting"><code class="hljs">Get-PowerBIWorkspace -Scope Organization -Orphaned -All
</code></pre>
      </li>
      <li class="calibre12">To resolve an orphaned workspace issue:
        <pre class="programlisting"><code class="hljs">Add-PowerBIWorkspaceUser -Scope Organization -Id &lt;Workspace ID&gt; -UserPrincipalName '&lt;User UPN&gt;' -AccessRight Admin
</code></pre>
      </li>
      <li class="calibre12">Get Power BI Activity Log events:
        <pre class="programlisting"><code class="hljs">$events = Get-PowerBIActivityEvent -StartDateTime '2021-07-14T00:00:00' -EndDateTime '2021-07-14T23:59:59' -ActivityType 'ViewDashboard' | ConvertFrom-Json
$events.Count
$events[0]
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">Not all Power BI <a id="calibre_link-818" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>REST API calls have corresponding PowerShell cmdlets. However, this does not mean that these REST API calls cannot still be used from PowerShell. The Power BI cmdlets for PowerShell include the general <code class="code-in-text--packt">Invoke-PowerBIRestMethod</code> method. This method allows the calling of any Power BI REST API call, such as in this example, which creates a JSON file with all workspaces, including associated users, reports, dashboards, datasets, and workbooks:</p>
    <pre class="programlisting"><code class="hljs">Invoke-PowerBIRestMethod -Url 'https://api.powerbi.com/v1.0/myorg/admin/Groups?$top=5000&amp;$expand=users,reports,dashboards,datasets,workbooks' -Method Get &gt; c:\temp\workspaces.json
</code></pre>
    <p class="book-title--packt">This method uses the same credentials as set by the <code class="code-in-text--packt">Login-PowerBI</code>, <code class="code-in-text--packt">Login-PowerBIServiceAccount</code>, or <code class="code-in-text--packt">Connect-PowerBIServiceAccount</code> calls. To use the authenticated session outside of PowerShell, use the following command:</p>
    <pre class="programlisting"><code class="hljs">Get-PowerBIAccessToken -AsString
</code></pre>
    <h2 id="calibre_link-1918" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">PowerShell cmdlets, REST APIs, and .NET client libraries for administrators: <a href="https://bit.ly/3vDJ5qc" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3vDJ5qc</span></a></li>
      <li class="bullet">Power BI REST APIs: <a href="https://bit.ly/3eR7OR6" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3eR7OR6</span></a></li>
      <li class="bullet">Power BI Cmdlets reference: <a href="https://bit.ly/3h1ShR2" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3h1ShR2</span></a></li>
      <li class="bullet">Track user activities in Power BI: <a href="https://bit.ly/3raDXZD" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3raDXZD</span></a></li>
    </ul>
    <h1 id="calibre_link-1286" class="title">Conclusion</h1>
    <p class="book-title--packt">This chapter's recipes highlighted the most common and impactful administration data sources, including Windows Performance Monitor, SQL Server Query Store, the on-premises data gateway, the MSDB system database, and Extended Events. Power BI solutions built on top of these sources proactively assess usage trends and resource bottlenecks, while delivering the detailed analysis necessary to identify root causes. Additionally, this chapter covered the metadata of existing Power BI and SSAS data models exposed via <strong class="screentext">dynamic management views</strong> (<strong class="screentext">DMVs</strong>), such as measure and relationship definitions and resource consumption.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-11">
<div id="calibre_link-1919" class="calibre2">
<div id="calibre_link-1920" class="calibre3"><div id="calibre_link-1921" class="calibre4">
    <h1 class="heading">11</h1>
    <h1 id="calibre_link-1287" class="title">Enhancing and Optimizing Existing Power BI Solutions</h1>
    <p class="book-title--packt">Power BI projects often begin by focusing on specific functional requirements, such as a set of dashboards and reports for a given business area and team. With relatively narrow requirements and small datasets, sufficient performance and reliability is often achievable without design and code enhancements to the data retrieval, model, and reporting layers. Additionally, Power BI Premium capacity and in certain cases Analysis Services resources provide viable options to enhance the scalability of a dataset.</p>
    <p class="book-title--packt">For larger Power BI projects&mdash;particularly when the options of Power BI Premium and Analysis Services are not available&mdash;it becomes important to identify opportunities to improve report query performance and to more efficiently use system resources to store and refresh the dataset.</p>
    <p class="book-title--packt">Additionally, the data import process can often be made more resilient and less resource intensive. Furthermore, the application of standard coding syntax, variables, and comments in both Power Query (M) and DAX expressions further improves the sustainability of Power BI datasets. </p>
    <p class="book-title--packt">This chapter's recipes contain top data modeling, DAX measure, and M query patterns to enhance the performance, scalability, and reliability of Power BI datasets. This includes performance tuning examples of both data models and measures, error handling and query folding examples of M queries, and supporting details on the DAX and M query engines.</p>
    <p class="book-title--packt">In this chapter, we will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Enhancing Data Model Scalability and Usability</li>
      <li class="bullet">Improving DAX Measure Performance</li>
      <li class="bullet">Pushing Query Processing Back to Source Systems</li>
      <li class="bullet">Strengthening Data Import and Integration Processes</li>
      <li class="bullet">Isolating and Documenting DAX Expressions</li>
      <li class="bullet">Improving Data Load Speeds with Incremental Refresh</li>
    </ul>
    <h1 id="calibre_link-1288" class="title">Technical Requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop</li>
      <li class="bullet">SQL Server with the <code class="code-in-text--packt">AdventureWorksDW2019</code> database installed. This database and instructions for installing are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a></li>
      <li class="bullet">Files for this chapter and can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a></li>
    </ul>
    <h1 id="calibre_link-1289" class="title">Enhancing Data Model Scalability and Usability</h1>
    <p class="book-title--packt">The <a id="calibre_link-262" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>performance of all Power BI reports is impacted <a id="calibre_link-268" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>by the design of the data model. The DAX queries executed upon accessing a report and when dynamically updating report visuals in interactive, self-service user sessions all rely on the relationships defined in the model and optimizations applied to the model's tables. For in-memory models, the cardinality of the columns imported and the compression of these columns contribute to the size of the dataset and query duration. For DirectQuery data models, the referential integrity of the source tables and the optimization of the relational source largely drive query performance.</p>
    <p class="book-title--packt">This recipe includes three optimization processes, all focused on a Reseller Sales fact table with 11.7 million rows. The first example leverages the DMVs and Power BI memory report created in <em class="italic">Chapter 10, Administering and Monitoring Power BI</em>, to identify and address the most expensive columns. The second example splits a dimension table into two smaller tables, and the final example applies a custom sort order to the imported fact table to optimize the compression of a column commonly used by reports.</p>
    <h2 id="calibre_link-1922" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Obtain a sharp definition of the goal of the optimization or the problem being resolved. For example, is the intent to reduce the size of the overall dataset such that more data can be loaded while remaining under 1 GB? Alternatively, is the goal to make the dataset easier to manage and less error prone during refresh, or is it to improve the query performance experienced with Power BI reports?</li>
      <li class="calibre12">Document the current state or baseline, such as query duration, to evaluate the effectiveness of the modifications.</li>
    </ol>
    <p class="book-title--packt">Performance optimization <a id="calibre_link-717" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is a broad area in Power BI, as many components are involved, including the data sources, data access queries, data models, and DAX measure calculations. Performance is also significantly impacted by the design of reports and dashboards with more dense, unfiltered, and complex report pages and visuals consuming more resources. Additionally, despite efficiency in all of these areas, sufficient hardware must be provisioned to support the given processing and analytical query workloads, such as the server(s) for the on-premises data gateway and Power BI Premium capacity.</p>
    <p class="book-title--packt">The good<a id="calibre_link-263" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> news is that it is usually not difficult to align a <a id="calibre_link-269" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>particular issue, such as an excessively large dataset or a slow query, with at least one of its main contributing factors, and there are often simple modifications that can deliver noticeable improvements. Additionally, there are many tools available to analyze and monitor the different components of Power BI as described in <em class="italic">Chapter 10</em>, <em class="italic">Administering and Monitoring Power BI</em> and there are free features in the Power BI service, such as <strong class="screentext">Usage Metrics Reports</strong> and <strong class="screentext">View related</strong>, that can be of further assistance in isolating issues.</p>
    <p class="book-title--packt">This recipe relies on previous recipes, specifically:</p>
    <ul class="calibre9">
      <li class="bullet"><em class="italic">Importing and Visualizing Dynamics Management View (DMV) Data in </em><em class="italic">Chapter 10</em><em class="italic">, Administering and Monitoring Power BI</em></li>
      <li class="bullet"><em class="italic">Selecting and Renaming Columns</em> in<em class="italic"> </em><em class="italic">Chapter 2</em><em class="italic">, Accessing and Retrieving Data</em></li>
    </ul>
    <h2 id="calibre_link-1923" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Retrieve and analyze the memory consumed by the columns of the largest fact table or tables. The <code class="code-in-text--packt">DISCOVER_STORAGE_TABLE_COLUMN_SEGMENTS</code> DMV used in the previous chapter's <em class="italic">Importing and visualizing dynamic management view (DMV) data </em>recipe provides this detail.</li>
      <li class="calibre12">As per the <em class="italic">Selecting and Renaming Columns </em>recipe of <em class="italic">Chapter 2</em>, <em class="italic">Accessing and Retrieving Data</em>, identify expensive columns that may not be needed in the dataset or that can be rounded to lower precision, split as separate columns, or expressed via simple measures.<p class="packt_figref">For import mode models, an expensive column is one with many unique values (high cardinality), such as the <strong class="screentext">Order Number</strong> columns used as examples in <em class="italic">Chapter 2</em>, <em class="italic">Accessing and Retrieving Data</em>. Likewise, a <strong class="screentext">DateTime</strong> column with multiple time values per date will consume more memory than two separate <strong class="screentext">Date</strong> and <strong class="screentext">Time</strong> columns. Preferably, only the <strong class="screentext">Date</strong> column or only the <strong class="screentext">Date</strong> and <strong class="screentext">Time</strong> columns should be imported, rather than the <strong class="screentext">DateTime</strong> column.</p>
        <p class="packt_figref">Also, per the <em class="italic">Selecting and Renaming Columns </em>recipe, DAX measures that execute simple arithmetic against low-cardinality columns, such as <strong class="screentext">Unit Price</strong> and <strong class="screentext">Quantity</strong>, can eliminate the need to import more expensive derived columns such as <strong class="screentext">Sales Amount</strong> and <strong class="screentext">Sales Amount with Taxes</strong>. Furthermore, though counter-intuitive, the <code class="code-in-text--packt">SUMX</code> measure with arithmetic across multiple columns often outperforms the simple <code class="code-in-text--packt">SUM</code> measure.</p>
      </li>
      <li class="calibre12">Identify<a id="calibre_link-264" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> columns that are stored as decimal number <a id="calibre_link-270" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>data types with a high scale (number of digits to the right of the decimal point). If this level of precision is not required, consider rounding off these columns in the SQL view or via the M import query to reduce the cardinality (unique values) and thus improve compression. If a (19,4) column will provide sufficient size and precision, apply the fixed decimal number type in the model.</li>
      <li class="calibre12">Replace any DAX calculated columns on large fact tables since imported columns achieve much better compression than calculated columns. Calculated columns on fact tables can often be addressed with DAX measures without sacrificing performance but if DAX measures are not an option, move the column's logic to the SQL view or M query of the fact table, or within the data source itself. If the M query is revised, ensure that the logic is folded to the source system.</li>
      <li class="calibre12">Remove or replace DAX calculated columns on any large dimension tables as well by moving this logic to the data retrieval process or leveraging the source system.<p class="packt_figref">Look for calculated columns with a <code class="code-in-text--packt">RELATED</code> or <code class="code-in-text--packt">LOOKUPVALUE</code> function, which, like an Excel <code class="code-in-text--packt">VLOOKUP</code> function, simply retrieves column values from a table on the one side of a many-to-one relationship with a fact table. Business users often utilize the <code class="code-in-text--packt">RELATED</code> and <code class="code-in-text--packt">LOOKUPVALUE</code> functions to flatten or de-normalize a fact table as they would in standard Excel worksheets, but this duplication is rarely necessary in Power BI, and calculated columns are not compressed like standard imported columns. Additionally, look to migrate the logic of calculated column expressions, such as calculated dates, differences in dates, and derived numerical columns, into DAX measures.</p>
      </li>
      <li class="calibre12">In this example, the current state of the dataset is 334 MB of compressed disk space (the size of the PBIX file converted from KB) and 674 MB of total memory per the memory report introduced in <em class="italic">Chapter 10, Administering and Monitoring Power BI</em>.<p class="packt_figref">Following the steps<a id="calibre_link-265" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> outlined, several quick wins are identified on <a id="calibre_link-271" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Reseller Sales</strong> fact table (11.7M rows), including the following: </p>
        <ul class="calibre11">
          <li class="calibre12">Only the last four characters of the <strong class="screentext">CarrierTrackingNumber</strong> are needed for analysis.</li>
          <li class="calibre12">The <strong class="screentext">Order Date</strong>, <strong class="screentext">Ship Date</strong>, and <strong class="screentext">Due Date</strong> columns in <code class="code-in-text--packt">YYYYMMDD</code> format can be removed, as they are redundant with the date data types for these columns, and only the date data types are used for relationships.</li>
          <li class="calibre12">Four calculated columns can be removed (<strong class="screentext">Days between Due Date</strong>, <strong class="screentext">Order Days</strong>, <strong class="screentext">Reseller</strong>, and <strong class="screentext">Product Name</strong>) as a <code class="code-in-text--packt">DATEDIFF</code> DAX measure, and existing dimension columns can be used instead.</li>
          <li class="calibre12">The <strong class="screentext">Sales Amount</strong>, <strong class="screentext">Extended Amount</strong>, and <strong class="screentext">Total Product Cost</strong> columns can be removed, as simple DAX measures can compute their values.<figure class="mediaobject"><img src="images/000458.png" alt="" class="calibre14" /></figure>
          </li>
        </ul>
      </li>
    </ol>
    <p class="book-title--packt">Figure 11.1: Power BI Dataset Memory Report refreshed with a revised SQL view for Reseller Sales</p>
    <p class="book-title--packt">After making the <a id="calibre_link-786" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>revisions, the dataset is now 429 MB in memory and the <strong class="screentext">Power BI Desktop file</strong> (<strong class="screentext">PBIX</strong>) is 221 MB on disk, representing 33%+ savings in memory and disk space.</p>
    <p class="book-title--packt">Large-dimension tables (approximately 1 million+ rows), with their high-cardinality relationships to fact tables, are a major performance bottleneck with Power BI and SSAS Tabular import models. Consider the following dimension table with attributes describing both resellers and promotions:</p>
    <figure class="mediaobject"><img src="images/000469.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 11.2: Reseller promotion dimension table</p>
    <ol class="calibre9">
      <li class="calibre12" value="7">The consolidated table contains 10,520 rows and the relationship column on the <strong class="screentext">Reseller Sales</strong> table is 19.4 MB in size.<figure class="mediaobject"><img src="images/000480.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 11.3: Reseller promo key, approximately 20 MB in size</p>
      </li>
      <li class="calibre12">We can<a id="calibre_link-266" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> split (normalize) this table into smaller <strong class="screentext">Reseller</strong><code class="code-in-text--packt"> </code>(701 rows) and <strong class="screentext">Promotion</strong> (16 rows) dimension tables and drop the <a id="calibre_link-272" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>consolidated <strong class="screentext">Reseller Promotion</strong> dimension table and the expensive <code class="code-in-text--packt">ResellerPromoKey</code> column on the fact table.<figure class="mediaobject"><img src="images/000491.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 11.4: Reseller and Promotion Tables Replace Consolidated Reseller Promotion</p>
    <p class="book-title--packt">Smaller relationships improve the performance of queries accessing the <strong class="screentext">Promotion </strong>and <strong class="screentext">Reseller </strong>columns. Additionally, the size of the dataset will be reduced by removing the <code class="code-in-text--packt">ResellerPromoKey</code> relationship column.</p>
    <p class="book-title--packt">In this particular example, the row counts are small enough that little impact is observed, but consider splitting large dimension tables over 200,000 rows into smaller tables (lower granularity) as query workloads increase. For example, a 1 million-row customer table could possibly be split into two tables for the data model based only on common query patterns such as customer regions or geographies.</p>
    <h2 id="calibre_link-1924" class="calibre8">How it works...</h2>
    <p class="book-title--packt">Remember <a id="calibre_link-1925" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>that DAX queries executed against import mode models<a id="calibre_link-1926" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> access and scan the memory associated with individual columns. Therefore, several very expensive columns with millions of unique values could be present on a fact table but may not negatively impact the performance of a query that does not reference these columns. Removing these expensive columns or replacing them with less expensive columns reduces the overall size of the dataset but you should not expect query performance to improve.</p>
    <p class="book-title--packt">When data is loaded into a Power BI Desktop model (import mode), the VertiPaq storage engine applies compression algorithms to each column to reduce the memory and thus improve performance. </p>
    <p class="book-title--packt">VertiPaq<a id="calibre_link-1123" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> first stores all unique values of a column (either via value encoding or hash encoding), and then, more importantly, applies <strong class="screentext">run-length encoding</strong> (<strong class="screentext">RLE</strong>) to<a id="calibre_link-996" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> store a repeated value only once for a set of contiguous rows in which it appears. Therefore, columns with few unique values, such as month names, are highly compressed, while primary key and GUID columns are not compressed at all.</p>
    <p class="book-title--packt">The data models in Power BI Desktop (and Power Pivot for Excel) are stored in column segments of 1 million rows. For example, a 20 million-row sales fact table will contain approximately 20 distinct segments. If the data required of report queries is spread across all 20 segments, then more resources (and a longer duration) are required to access each segment and consolidate these results to resolve the query. However, if the segments are ordered by date or perhaps by a given dimension (for example, <strong class="screentext">StoreID</strong>) and a report query contains a filter that uses this order, such as fiscal year or store region, then only a subset of the segments is queried.</p>
    <p class="book-title--packt">As a simple example, assume a 20 million-row fact table is ordered by date when importing to Power BI and each calendar year represents 1 million rows. A report query that is filtered on only 2 years will therefore need to access only two of the 20 column segments as the other 18 segments contain dates outside the scope of the query.</p>
    <p class="book-title--packt">Vertipaq Analyzer<a id="calibre_link-1124" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is now integrated into DAX Studio under the <strong class="screentext">Advanced</strong> menu as well as in Tabular Editor 3. Vertipaq Analyzer is an easy way to quickly identify the columns consuming the most memory. This and the Best Practice Analyzer in Tabular Editor are <a id="calibre_link-267" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>two of the most common and easy-to-use tools to analyze<a id="calibre_link-273" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the health of a Power BI dataset. </p>
    <h2 id="calibre_link-1927" class="calibre8">There's more...</h2>
    <p class="book-title--packt">While analyzing the data model and making optimizations is important, optimizations can also be made <a id="calibre_link-691" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>within the Power Query Editor. For example, avoid loading tables that are only used for data retrieval/transformation logic, such as staging queries, to a data model. Even if hidden from the <strong class="screentext">Fields</strong> list, these tables consume processing and storage resources like all other tables of the model and add unnecessary complexity. Right-click on these queries in the Power Query Editor and disable <strong class="screentext">Enable load</strong> to remove the table from the data model. Keep in mind that data models with many M queries, whether loaded or not, can overwhelm the available threads/resources of the source system during a refresh as all queries are submitted simultaneously.</p>
    <p class="book-title--packt">Also, identify tables that rarely change and consider disabling the default <strong class="screentext">Include in report refresh</strong> property (by right-clicking the query in the Power Query Editor). The table can still be loaded to the data model and thus be available for relationships and DAX measures, but its source query will no longer be executed with each refresh. Typical candidates for this include an annual budget or plan table that is only updated once a year, a <code class="code-in-text--packt">Currency</code> table, and possibly a geographic or demographic table.</p>
    <p class="book-title--packt">Finally, Power BI applies sophisticated algorithms during the import process to determine the sort order that maximizes compression. However, the chosen sort order might not align with the top performance priorities of the model. For example, it may be more important to improve query performance for reports accessing a certain column, such as <strong class="screentext">StoreID</strong> or <strong class="screentext">Date</strong> (via relationships to dimension tables), rather than minimizing the size of the overall dataset. Ordering the imported data by these priority columns maximizes their compression while potentially reducing the compression applied to other columns. To demonstrate this, consider the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Identify the column (or columns) to order by and note the current memory. In this example, the <strong class="screentext">OrderDate</strong> column is 16.7 MB.<figure class="mediaobject"><img src="images/000001.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 11.5: OrderDate column of 16.5 MB in Data Size (without sort)</p>
      </li>
      <li class="calibre12">Add an <a id="calibre_link-692" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>expression to the fact table M query that uses the <code class="code-in-text--packt">Table.Sort</code> function to order by the <strong class="screentext">OrderDate</strong> column.
        <pre class="programlisting"><code class="hljs">let 
    Source = AdWorksDW,
    ResellerSales = Source{[Schema="BI",Item = "vFactResellerSalesXL"]}[Data],
    OrderDateSort = Table.Sort(ResellerSales,{{"OrderDate", Order.Descending}})
in
    OrderDateSort
</code></pre>
      </li>
      <li class="calibre12">Right-click on the last step in the <strong class="screentext">Power Query Editor</strong> and click on <strong class="screentext">View Native Query</strong> to ensure the sorting was folded to the source.</li>
      <li class="calibre12">If <strong class="screentext">View Native Query</strong> is grayed out, consider moving the sort step to the first transformation step in the preceding code. Upon refreshing the <strong class="screentext">Reseller Sales</strong> fact table, the data size of <strong class="screentext">OrderDate</strong> is reduced by 36% to 10.6 MB.<figure class="mediaobject"><img src="images/000012.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 11.6: Improved compression for the OrderDate column due to the sort order of the Import query</p>
      </li>
      <li class="calibre12">Determine whether any other columns, particularly relationship columns such as <strong class="screentext">ProductKey</strong>, increased in size.</li>
      <li class="calibre12">Optionally (though it is recommended), evaluate top or common DAX queries for performance changes.</li>
    </ol>
    <p class="book-title--packt">Specifying an <code class="code-in-text--packt">Order By</code> clause in the import to Power BI exposes the given column to maximum RLE compression given the cardinality of the column. In many scenarios, optimizing the compression on the active relationship date column via sorting offers the best overall <a id="calibre_link-693" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>performance advantage. However, depending on the structure and distribution of reports and users, ordering by a different fact table column such as <strong class="screentext">ProductKey</strong> or <strong class="screentext">StoreID</strong> could be the best choice. DAX Studio makes it relatively easy to test the performance of queries against many different model designs.</p>
    <p class="book-title--packt">Passing the Order By operation back to the source (via query folding) is generally good for the refresh process and certainly good for the on-premises data gateway. However, with large fact tables (10 million+ rows) this can require large amounts of source system resources.</p>
    <h2 id="calibre_link-1928" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Best practice rules <a id="calibre_link-108" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to improve your model's performance: <a href="https://bit.ly/3xPgDn4" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3xPgDn4</span></a></li>
      <li class="bullet">Best practice rules for <a id="calibre_link-107" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Tabular Editor: <a href="https://bit.ly/3l5325w" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3l5325w</span></a></li>
      <li class="bullet">Vertipaq Analyzer script for<a id="calibre_link-1125" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Tabular Editor 2: <a href="https://bit.ly/2YA97zv" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2YA97zv</span></a></li>
    </ul>
    <h1 id="calibre_link-1290" class="title">Improving DAX Measure Performance</h1>
    <p class="book-title--packt">Just as specific<a id="calibre_link-358" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> columns and relationships can be optimized for performance per the prior recipe, frequently used DAX measures can also be targeted for performance improvements. Existing DAX measures may contain inefficient data access methods that generate additional, unnecessary queries or that largely execute in a single CPU thread. Revising measures to better leverage the multi-threaded storage engine and to avoid or reduce unnecessary queries and iterations can deliver significant performance improvements without invasive, structural modifications to the model.</p>
    <p class="book-title--packt">In this recipe, DAX queries executed by Power BI visuals are captured and analyzed using the Performance Analyzer feature of Power BI Desktop. The first example highlights a common misuse of the <code class="code-in-text--packt">FILTER</code> function for basic measures. In the second example, two alternative approaches to implementing an <code class="code-in-text--packt">OR</code> filter condition across separate tables are described relative to a common but less efficient approach. Additional details of the DAX query engine, using DAX variables to improve performance, and DAX as a query language, are also covered.</p>
    <h2 id="calibre_link-1929" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for <a id="calibre_link-359" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the Power BI Desktop file containing the data model and measures to be analyzed</li>
      <li class="calibre12">Select <strong class="screentext">DAX Studio</strong> from the ribbon of the <strong class="screentext">External Tools</strong> tab</li>
      <li class="calibre12">If necessary, build a sample report page that aligns with a poorly performing report or a common report layout</li>
      <li class="calibre12">In Power BI Desktop, select <strong class="screentext">Performance analyzer</strong> from the ribbon of the <strong class="screentext">View</strong> tab</li>
    </ol>
    <h2 id="calibre_link-1930" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the <strong class="screentext">Performance analyzer</strong> pane, select <strong class="screentext">Start recording</strong>.</li>
      <li class="calibre12">Make a selection on one of the Power BI Desktop report visuals and observe the DAX queries in <strong class="screentext">Performance analyzer</strong>. In this case, the measure under study is the <code class="code-in-text--packt">Gross_Sales_Warehouse</code> measure defined as follows:
        <pre class="programlisting"><code class="hljs">Gross_Sales_Warehouse = CALCULATE([Reseller Gross Sales], FILTER('Reseller','Reseller'[Business Type] = "Warehouse"))
</code></pre>
      </li>
      <li class="calibre12">Expand the visual in <strong class="screentext">Performance analyzer</strong> containing the desired measure and choose <strong class="screentext">Copy query</strong>:
        <pre class="programlisting"><code class="hljs">DEFINE
 VAR __DS0FilterTable = FILTER(KEEPFILTERS(VALUES('Date'[Calendar Year])),
      OR('Date'[Calendar Year] = 2016, 'Date'[Calendar Year] = 2017))
 VAR __DS0FilterTable2 = FILTER(KEEPFILTERS(VALUES('Product'[Product Category])),
     'Product'[Product Category] = "Bikes")
 VAR __DS0FilterTable3 = FILTER(KEEPFILTERS(VALUES('Promotion'[Promotion Type])),
      OR(OR(OR('Promotion'[Promotion Type] = "Excess Inventory",
      'Promotion'[Promotion Type] = "New Product"),'Promotion'[Promotion Type] = "No Discount"),
      'Promotion'[Promotion Type] = "Volume Discount"))
 EVALUATE
   TOPN(1001,SUMMARIZECOLUMNS('Reseller'[Reseller],__DS0FilterTable,__DS0FilterTable2,__DS0FilterTable3,
       "Gross_Sales_Warehouse", 'Reseller Sales'[Gross Sales Warehouse]),
     [Gross_Sales_Warehouse],0,'Reseller'[Reseller],1)
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">In this case, the <code class="code-in-text--packt">FILTER</code> function does not operate on the results of an <code class="code-in-text--packt">ALL</code> function like with date intelligence <a id="calibre_link-360" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>patterns. The <code class="code-in-text--packt">TOPN</code> function accepts the table from <code class="code-in-text--packt">SUMMARIZECOLUMNS</code>, which groups by individual Reseller companies and their associated gross sales warehouse values:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In DAX Studio, enable <strong class="screentext">Server Timings</strong> and <strong class="screentext">Query Plan</strong> on the top toolbar</li>
      <li class="calibre12">With the DAX Studio trace running, click on <strong class="screentext">Run</strong> or the <em class="italic">F5</em> key and note the performance in the <strong class="screentext">Server Timings</strong> window</li>
      <li class="calibre12">Click on <strong class="screentext">Clear Cache</strong> and execute the query again to obtain a baseline average for the duration, SE queries (storage engine), and SE %</li>
      <li class="calibre12">In Power BI Desktop, create a new measure that avoids the <code class="code-in-text--packt">FILTER</code> function:
        <pre class="programlisting"><code class="hljs">Gross Sales Warehouse Rev = CALCULATE([Reseller Gross Sales],
'Reseller'[Business Type] = "Warehouse")
</code></pre>
      </li>
    </ol>
    <p class="book-title--packt">Within the DAX query engine, the <strong class="screentext">Gross Sales Warehouse Rev</strong> measure is expressed as the following:</p>
    <pre class="programlisting"><code class="hljs">CALCULATE([Reseller Gross Sales],FILTER(ALL('Reseller'[Business Type]),'Reseller'[Business Type] = "Warehouse"))
</code></pre>
    <p class="book-title--packt">Some BI organizations may adopt standards that require the longer, more explicit version and avoid "syntax sugar."</p>
    <p class="book-title--packt">Return to DAX Studio and replace the existing references to the current measure with the name of the measure:</p>
    <pre class="programlisting"><code class="hljs">EVALUATE
 TOPN(1001,SUMMARIZECOLUMNS('Reseller'[Reseller],__DS0FilterTable,__DS0FilterTable2,__DS0FilterTable3,
 "Gross Sales Warehouse Rev", [Gross Sales Warehouse Rev]),[Gross Sales Warehouse Rev],0,
'Reseller'[Reseller],1)
</code></pre>
    <p class="book-title--packt">With the cache cleared, execute the query with the revised measure. Create a revised average based on 4-5 separate query executions:</p>
    <figure class="mediaobject"><img src="images/000024.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 11.7: Server timings of the baseline query with original measure versus revised measure in DAX Studio</p>
    <p class="book-title--packt">The baseline query executed 35% faster (<strong class="screentext">69 ms</strong> to <strong class="screentext">45 ms</strong>) with the revised measure and only needed <strong class="screentext">1 SE</strong> query.</p>
    <h2 id="calibre_link-1931" class="calibre8">How it works...</h2>
    <p class="book-title--packt">The reason the first <a id="calibre_link-361" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>measure is slower is that with the <code class="code-in-text--packt">FILTER</code> on <strong class="screentext">Reseller</strong>, the filter selections on slicer visuals of the report (<strong class="screentext">Date</strong>, <strong class="screentext">Product</strong>, and <strong class="screentext">Promotion</strong>) have to be respected before the filter on warehouse is executed. For example, the <strong class="screentext">Reseller</strong> dimension table will be filtered to only include resellers with bike category sales in 2016-2017 and of certain promotions before the <strong class="screentext">Warehouse</strong> filter is applied. This requires additional scans of the fact table and is thus less efficient.</p>
    <p class="book-title--packt">DAX queries from Power BI report visuals are resolved by the DAX formula engine and the DAX storage engine. The storage engine is the in-memory columnar compressed database for import mode models (also known as VertiPaq) and is the relational database for DirectQuery models. In either mode, the formula engine is responsible for generating query plans and can execute all DAX functions, including complex expression logic, though it is limited to a single thread and no cache.</p>
    <p class="book-title--packt">The formula engine sends requests to the storage engine and if the storage engine does not have the requested data in an existing data cache, the storage engine utilizes multiple threads to access segments of data (1 thread per segment, 1 million rows per segment) from the data model. The storage engine executes a simple join, grouping, filter, and aggregations, including distinct count, to make requested data caches available to the formula engine. Given this architecture, a fundamental DAX and Power BI model design practice is to maximize the allocation of queries to the storage engine and minimize the size of data caches operated on by the formula engine.</p>
    <p class="book-title--packt">Given the performance advantage of reducing storage, engine requests also consider the use of variables. While the primary benefit of DAX variables is improved readability, variables can also reduce the number of queries associated with a measure (and hence its execution duration) since variables are evaluated only once and can be reused multiple times in an expression. Look for DAX measures with multiple branches of <code class="code-in-text--packt">IF</code> or <code class="code-in-text--packt">SWITCH</code> conditions that reference the same calculation or measure multiple times. For these measures, consider declaring a variable that simply references the existing measure (<code class="code-in-text--packt">VAR MyVariable = [Sales Amount]</code>) and then reference this variable in each logical condition, rather than the measure.</p>
    <p class="book-title--packt">While the DAX <a id="calibre_link-1932" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>queries generated by Power BI cannot be edited, DAX queries can be completely authored from scratch for other tools such as the datasets in <strong class="screentext">SQL Server Reporting Services</strong> (<strong class="screentext">SSRS</strong>) reports. Many of the newer DAX functions, such as <strong class="screentext">TREATAS</strong> <strong class="screentext">and</strong> <strong class="screentext">SUMMARIZECOLUMNS</strong>, are particularly helpful with queries and generally the same performance considerations apply to both measures and queries. Studying Power BI-generated DAX queries is a great way to learn how to write efficient DAX queries and DAX in general.</p>
    <h2 id="calibre_link-1933" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Another example <a id="calibre_link-356" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of where a DAX measure can be optimized is in this example where a measure must be filtered by an <code class="code-in-text--packt">OR</code> condition on two columns from separate tables. A <code class="code-in-text--packt">FILTER</code> function cannot be avoided in this scenario like in the prior example, since multiple columns must be referenced in the same expression (the <code class="code-in-text--packt">OR</code> condition). The current measure is defined as follows:</p>
    <pre class="programlisting"><code class="hljs">Reseller Gross Sales (Filter OR) = 
CALCULATE([Reseller Gross Sales], FILTER('Reseller Sales',    
RELATED('Product'[Product Subcategory]) = "Mountain Bikes" || RELATED('Reseller'[Reseller Country]) IN {"United States", "Australia"}))
</code></pre>
    <p class="book-title--packt">A <code class="code-in-text--packt">FILTER</code> is applied on the fact table and separate <code class="code-in-text--packt">RELATED</code> functions are used to implement the required <code class="code-in-text--packt">OR</code> logic. To see how this measure can be optimized, consider the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Just like in the previous example, capture a sample DAX query generated in Power BI Desktop from the <strong class="screentext">Performance analyzer</strong> pane</li>
      <li class="calibre12">Test and analyze the query in DAX Studio to establish a baseline for the current measure</li>
      <li class="calibre12">Now create two separate alternative measures&mdash;one with <code class="code-in-text--packt">SUMMARIZE</code> and another with <code class="code-in-text--packt">CROSSJOIN</code>:
        <pre class="programlisting"><code class="hljs">Reseller Gross Sales (Summarize OR) = 
CALCULATE([Reseller Gross Sales], FILTER(
SUMMARIZE('Reseller Sales','Product'[Product Subcategory],'Reseller'[Reseller Country]),    'Product'[Product Subcategory] = "Mountain Bikes" || 'Reseller'[Reseller Country] IN {"United States", "Australia"})) 
Reseller Gross Sales (Crossjoin OR) = 
CALCULATE([Reseller Gross Sales], FILTER(
CROSSJOIN(ALL('Product'[Product Subcategory]),ALL(Reseller[Reseller Country])), 'Product'[Product Subcategory] = "Mountain Bikes" || 'Reseller'[Reseller Country] IN {"United States", "Australia"})) 
</code></pre>
      </li>
      <li class="calibre12">In Power BI <a id="calibre_link-1934" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Desktop, confirm that the new measures produce the same results as the current measure</li>
      <li class="calibre12">In DAX Studio, replace the references to the (filter <code class="code-in-text--packt">OR</code>) measure with references to the new measures</li>
      <li class="calibre12">Repeat the process of executing multiple queries with the cache cleared and documenting the performance to establish baselines for all three versions of the measure<figure class="mediaobject"><img src="images/000036.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 11.8: Server timings of the baseline query (filter OR) measure versus the two new measures in DAX Studio</p>
    <p class="book-title--packt">Both new measures were 16.7X faster than the current state (2,844 to 170 ms) and were over 90% executed in <a id="calibre_link-1065" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">storage engine</strong><strong class="screentext"> </strong>(<strong class="screentext">SE</strong>). In this scenario, the <code class="code-in-text--packt">CROSSJOIN</code> approach was slightly faster than <code class="code-in-text--packt">SUMMARIZE</code> but this comparison would vary based on the cardinality of the columns involved. The larger point from this example is the danger associated with implementing logic that's not supported by the storage engine within the expression parameter of iterating functions like <code class="code-in-text--packt">FILTER</code> and <code class="code-in-text--packt">SUMX</code>. This is especially true when the table parameter to these functions has many rows such as the 11.7 million-row <strong class="screentext">Reseller Sales</strong> fact table used in this recipe.</p>
    <p class="book-title--packt">Note that the <code class="code-in-text--packt">ALL</code> function can be used to produce the table parameter if both columns are from the same table, such as <code class="code-in-text--packt">ALL('Product'[Product Category],'Product'[Product Color])</code>. <code class="code-in-text--packt">ALL</code> cannot directly access columns from separate tables.</p>
    <p class="book-title--packt">At a high level, always <a id="calibre_link-357" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>think about the size of the table being filtered and look for simple filter conditions and single columns that can be used to reduce the size of this table. For example, replace the table parameter of functions like <code class="code-in-text--packt">SUMX</code> and <code class="code-in-text--packt">FILTER</code> with a <code class="code-in-text--packt">CALCULATETABLE</code> function that implements simple, efficient filter conditions. More complex expressions that cannot be handled by the storage engine can then operate against this smaller table. Similarly, consider (and test) nesting filter conditions such that the most selective, efficient filter condition is applied first (the inner <code class="code-in-text--packt">FILTER</code>, the outer <code class="code-in-text--packt">CALCULATE</code>):</p>
    <pre class="programlisting"><code class="hljs">CALCULATE(
  CALCULATE(&lt;param1&gt;, &lt;param2&gt;
) //outer calculate
FILTER(
  FILTER(&lt;param1&gt;,&lt;param2&gt;), // inner FILTER
  &lt;param2&gt;
)
</code></pre>
    <h2 id="calibre_link-1935" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Use Performance analyzer<a id="calibre_link-716" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> to examine report element performance in Power BI Desktop: <a href="https://bit.ly/3eWXdEb" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3eWXdEb</span></a></li>
    </ul>
    <h1 id="calibre_link-1291" class="title">Pushing Query Processing Back to Source Systems</h1>
    <p class="book-title--packt">During the scheduled<a id="calibre_link-928" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> refresh of datasets retrieving<a id="calibre_link-1018" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> from on-premises sources, any query transformations not executed by the source system will require local resources of the <strong class="screentext">M</strong> (<strong class="screentext">Mashup</strong>) engine <a id="calibre_link-625" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of the on-premises data gateway server. With larger datasets, and potentially with other scheduled refreshes occurring on the same gateway server at the same time, it becomes important to design M queries that take full advantage of source system resources via query folding. Although transformations against some sources such as files will always require local resources, in many scenarios M queries can be modified to help the engine generate an equivalent SQL statement and thus minimize local resource consumption.</p>
    <p class="book-title--packt">In this recipe, a process and list of items is provided to identify queries not currently folding and the potential causes. Additionally, a query based on an existing SQL statement is redesigned with M expressions to allow query folding.</p>
    <h2 id="calibre_link-1936" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare<a id="calibre_link-1937" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> for this <a id="calibre_link-1938" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Identify the dataset to evaluate for query folding</li>
      <li class="calibre12">Use gateway server memory performance counter data to establish a baseline of the resources currently used to perform refreshes as these counters should be impacted by any changes</li>
    </ol>
    <p class="book-title--packt">Also, establish a baseline for query performance using the new <strong class="screentext">Diagnostic tools</strong> within Power Query Editor's <strong class="screentext">Tools</strong> tab.</p>
    <p class="book-title--packt">The dataset to be optimized will generally be a large PBIX file (100 MB+) published to the Power BI service with a scheduled refresh configured to use an on-premises data gateway and that queries a relational database (SQL, Oracle) as the primary source. If the large PBIX file is retrieving from a file or a collection of files within a folder, revisions are certainly possible, such as filtering out files based on their modified date relative to the current date, however, query folding is not an option for file sources.</p>
    <h2 id="calibre_link-1939" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">The following steps outline the general query folding analysis process:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the Power BI <a id="calibre_link-916" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Desktop file used as the published dataset with scheduled refreshes of on-premises data.</li>
      <li class="calibre12">Click on <strong class="screentext">Edit Queries</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to open the Power Query Editor.</li>
      <li class="calibre12">Starting with the largest queries (the fact tables), right-click on the final step exposed in the <strong class="screentext">Query Settings</strong> window.<figure class="mediaobject"><img src="images/000048.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 11.9: View Native Query disabled for final query step</p>
        <p class="packt_figref">If the <strong class="screentext">View Native Query</strong> option is disabled, then the local M engine is performing at least this final step. If <strong class="screentext">View Native Query</strong> is not disabled, you can optionally view the<a id="calibre_link-1940" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> SQL statement as per prior recipes.</p>
      </li>
      <li class="calibre12">Check the<a id="calibre_link-929" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> previous steps to determine which <a id="calibre_link-1019" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>steps, if any, were folded, and thus the step that caused the query to use local resources. Once a step (M variable expression) in a query uses local resources all subsequent steps in the query will also use local resources.</li>
      <li class="calibre12">Identify the cause of the local operation, such as a specific M function not supported by the source system.</li>
      <li class="calibre12">Consider revising the source database object, the M expressions, and data source privacy levels to enable query folding.</li>
    </ol>
    <p class="book-title--packt">As an example of performing this process, consider the following case, where a business analyst has used a SQL statement and the Query Editor to construct a customer query:</p>
    <figure class="mediaobject"><img src="images/000060.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 11.10: Customer query based on native SQL statement and M transformations</p>
    <p class="book-title--packt">In this scenario, the SQL statement is against the base customer table in the data warehouse (not the view) and the subsequent transformations applied against the query results all use local gateway server resources during each refresh process since the first step executes a native SQL query. The existing SQL view (<strong class="screentext">vDim_Customer</strong>) contains the <strong class="screentext">Customer Name</strong> column, eliminating the need for the merge operation, though the <strong class="screentext">Marital Status</strong> column is not transformed into the longer <strong class="screentext">Married</strong> or <strong class="screentext">Single</strong> string as per the analyst's transformations. The query can be modified to perform better by taking advantage of <a id="calibre_link-917" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query folding as follows:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a new <a id="calibre_link-930" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>M query that uses parameters<a id="calibre_link-1020" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> for the server and database and that uses the customer SQL view:
        <pre class="programlisting"><code class="hljs">let Source = AdWorksProd,
Customer = AdWorksProd{[Schema = "BI", Item = "vDim_Customer"]}[Data],
SelectColumns = Table.SelectColumns(Customer,{"Customer Key", "Customer Name", "Date of Birth", 
"Marital Status", "Annual Income"}),
MarriageStatus = Table.AddColumn(SelectColumns, "M Status", each if [Marital Status] = "M" then "Married" else "Single", type text),
RemovedColumns = Table.RemoveColumns(MarriageStatus,{"Marital Status"}),
RenamedColumns = Table.RenameColumns(RemovedColumns,{{"M Status", "Marital Status"}, 
{"Annual Income", "Yearly Income"}})
in RenamedColumns
</code></pre>
        <p class="packt_figref">The existing SQL view, <strong class="screentext">vDim_Customer</strong>, is leveraged and the <strong class="screentext">Marital Status</strong> conditional logic is built within a <code class="code-in-text--packt">Table.AddColumn</code> expression. The few remaining steps simply select, remove, and rename columns and are all transformations that can be folded back to SQL Server.</p>
      </li>
      <li class="calibre12">Right-click on the final step of the new, revised query and ensure that <strong class="screentext">View Native Query</strong> is enabled.<figure class="mediaobject"><img src="images/000072.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 11.11: Native query (folded) based on the revised M query for Customers</p>
    <p class="book-title--packt">The new query returns the same results but is now folded back to SQL Server rather than using local resources. The <code class="code-in-text--packt">if...then...else</code> M expression was folded into a <code class="code-in-text--packt">CASE</code> expression for SQL Server to execute.</p>
    <h2 id="calibre_link-1941" class="calibre8">How it works...</h2>
    <p class="book-title--packt">Query folding is <a id="calibre_link-918" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>impacted by the<a id="calibre_link-931" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> transformations supported by the source system, internal proprietary M engine logic, privacy levels assigned to data sources, the use of native database queries (SQL statements), and the use <a id="calibre_link-1021" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of custom M functions and logic. For example, even if query folding is appropriate from a performance standpoint such as using a server in a join operation with a local file, folding will not occur if the local file is configured as a private data source.</p>
    <p class="book-title--packt">As per the query folding redesign example in this recipe, if the first step or <strong class="screentext">Source</strong> step of the query is a native SQL statement, consider revising the M query steps to help the M engine form a SQL query (fold the M query). Any M transformation applied on top of a native SQL database query (via <code class="code-in-text--packt">Value.NativeQuery</code>) will not be folded to the source system. If native SQL queries are used, such as the stored procedure calls, the recommendation is to embed all query steps and transformations in the native SQL query itself. If this is not possible, embed the most resource-intensive operations in the stored procedure and pass filtering parameters from Power BI to the stored procedure to reduce the workload on the local M engine.</p>
    <p class="book-title--packt">If there are required transformations or logic that are not supported by the source system for query folding, the recommendation is to move these steps to the very end of the query. For example, allow SQL Server to execute the filter, the derived columns, and other simple steps via <a id="calibre_link-919" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query folding, and only then apply the complex steps locally on top of the SQL query result set.</p>
    <p class="book-title--packt">Several common <a id="calibre_link-932" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>M functions are not supported by most<a id="calibre_link-1022" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> relational database sources, such as <code class="code-in-text--packt">Table.Distinct</code>, which removes duplicate rows from tables, and <code class="code-in-text--packt">Table.RemoveRowsWithErrors</code>, which removes rows with errors from tables. If data sources are merged in the query, check their privacy settings (<strong class="screentext">Data source settings</strong> | <strong class="screentext">Edit Permissions...</strong>) to ensure that privacy is configured to allow folding, such as from an organizational source to a different organizational source.</p>
    <p class="book-title--packt">In general, the following operations are not supported by query folding:</p>
    <ul class="calibre9">
      <li class="bullet">Changing column data types</li>
      <li class="bullet">Adding index columns</li>
      <li class="bullet">Merging or appending queries from different sources</li>
      <li class="bullet">Adding custom columns using Power Query functions that have no equivalent function in the data source</li>
    </ul>
    <h2 id="calibre_link-1942" class="calibre8">There's more...</h2>
    <p class="book-title--packt">For large models with many<a id="calibre_link-1086" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> queries and large tables, consider disabling the default parallel loading of tables in <strong class="screentext">File</strong> | <strong class="screentext">Options</strong> | <strong class="screentext">Options and settings</strong> | <strong class="screentext">CURRENT FILE </strong>as many queries executed simultaneously may overwhelm source system resources and cause the refresh process to fail.</p>
    <figure class="mediaobject"><img src="images/000084.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 11.12: Parallel loading of tables &ndash; CURRENT FILE setting</p>
    <p class="book-title--packt">Just because a query is folded into a SQL statement, it does not mean there are no possible performance issues. For example, the query might be selecting more columns than needed by the data model or might be executing outer join queries when the database schema supports inner joins. Visibility of these queries can inform changes to the BI architecture and M queries.</p>
    <p class="book-title--packt">Owners of the<a id="calibre_link-1943" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> relational database system or data warehouse can take note of Power BI's folded SQL queries via tools like <strong class="screentext">Extended Events</strong>. For example, database administrators or BI team members could revise existing SQL views, table indexes, and more based upon the information gathered. Likewise, the Power BI query author could be informed of better or preferred methods of accessing the same data such as joining on different columns.</p>
    <h2 id="calibre_link-1944" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power Query <a id="calibre_link-913" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query folding: <a href="https://bit.ly/3jB5wrx" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3jB5wrx</span></a></li>
      <li class="bullet">Optimize Power Query when<a id="calibre_link-849" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> expanding table columns: <a href="https://bit.ly/3trdKFA" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3trdKFA</span></a></li>
    </ul>
    <h1 id="calibre_link-1292" class="title">Strengthening Data Import and Integration Processes</h1>
    <p class="book-title--packt">Many Power BI<a id="calibre_link-244" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> datasets must be created without the benefit of a data <a id="calibre_link-560" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>warehouse or even a relational database source system. These datasets, which often transform and merge less structured and governed data sources such as text and Excel files, generally require more complex M queries to prepare the data for analysis. The combination of greater M query complexity and periodic structural changes and data quality issues in these sources can lead to refresh failures and challenges in supporting the dataset. Additionally, as M queries are sometimes initially created exclusively via the Query Editor interface, the actual M code generated may contain unexpected logic that can lead to incorrect results and unnecessary dependencies on source data.</p>
    <p class="book-title--packt">This recipe includes practical examples of increasing the reliability and manageability of data import processes including data source consolidation, error handling and comments, and accounting for missing or changed source columns.</p>
    <h2 id="calibre_link-1945" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Identify the dataset to evaluate for data refresh reliability, such as a dataset that imports information from a <strong class="screentext">comma-separated values</strong> (<strong class="screentext">CSV</strong>) File</li>
      <li class="calibre12">Open the PBIX for the dataset in Power BI Desktop</li>
    </ol>
    <p class="book-title--packt">The objective of this example is to retrieve four columns from a text file containing 30 columns describing customers.</p>
    <h2 id="calibre_link-1946" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement<a id="calibre_link-1947" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Connect to <a id="calibre_link-1948" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the file with the text/CSV connector and replace the hardcoded path with a query created from parameters:
        <pre class="programlisting"><code class="hljs">let Source = Csv.Document(File.Contents(CustomerTextFile),[Delimiter=" ", Columns=30, Encoding=1252, QuoteStyle=QuoteStyle.None]),    
PromotedHeaders = Table.PromoteHeaders(Source, [PromoteAllScalars=true]) 
in PromotedHeaders
</code></pre>
      </li>
      <li class="calibre12">Delete the default <code class="code-in-text--packt">Columns</code> parameter of the <code class="code-in-text--packt">Csv.Document</code> function (<code class="code-in-text--packt">Columns=30</code>)</li>
      <li class="calibre12">Use a <code class="code-in-text--packt">Table.SelectColumns</code> function to select the four columns needed and specify the optional <code class="code-in-text--packt">MissingField.UseNull</code> parameter</li>
      <li class="calibre12">Finally, set the data types for each of the four columns:
        <pre class="programlisting"><code class="hljs">let Source = Csv.Document(File.Contents(CustomerTextFile),
       [Delimiter=" ", Encoding=1252, QuoteStyle=QuoteStyle.None]),    
PromoteHeaders = Table.PromoteHeaders(Source, [PromoteAllScalars=true]),    
SelectColumns = Table.SelectColumns(PromoteHeaders,
       {"CustomerKey", "CustomerAlternateKey", "EmailAddress", "BirthDate"},  MissingField.UseNull),    
TypeChanges = Table.TransformColumnTypes(SelectColumns,
       {{"CustomerKey", Int64.Type}, {"CustomerAlternateKey", type text}, {"BirthDate", type date}})
in TypeChanges
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1949" class="calibre8">How it works...</h2>
    <p class="book-title--packt">With these changes, the query has access to all columns of the source file (not just 30) but only creates dependencies on the four columns needed. Most importantly, the <code class="code-in-text--packt">MissingField.UseNull</code> option protects the query from failing if one of the four columns is renamed or removed from the source file. With the <code class="code-in-text--packt">MissingField.UseNull</code> option, if one of the four columns selected is removed or renamed, a null value is substituted thus avoiding query failure.</p>
    <figure class="mediaobject"><img src="images/000097.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 11.13: Four columns selected from the text file despite the BirthDate column removed from the source</p>
    <p class="book-title--packt">A <code class="code-in-text--packt">MissingField.Ignore</code> option is also available to retrieve only the columns found in <code class="code-in-text--packt">Table.SelectColumns</code>. </p>
    <p class="book-title--packt">Be sure to<a id="calibre_link-245" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> avoid the automatic data type changes applied by default to unstructured sources. If enabled, this will effectively create a hardcoded dependency to each of the columns in the source. Likewise, for all other transformations, try to limit or avoid explicitly referencing column names and always favor selecting <a id="calibre_link-561" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>required columns rather than removing unnecessary columns. The columns explicitly selected are less likely to be changed or removed in the future and removing columns creates a risk that new columns added to the source will be loaded to the data model.</p>
    <h2 id="calibre_link-1950" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">In addition to improvements in reliability, one can also use<a id="calibre_link-907" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> <strong class="screentext">Query Diagnostics</strong>, available in the <strong class="screentext">Tools</strong> ribbon of the Power Query Editor, to analyze query performance. There are also methods for improving the overall maintainability of Power Query code. Two such methods are comments<a id="calibre_link-841" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and data source management.</p>
    <p class="book-title--packt">As with all coding languages, comments can be used to improve the overall maintainability of M code, as in the example below:</p>
    <pre class="programlisting"><code class="hljs">/* This query joins the Product query to the Product Subcategory query. 
   The product subcategory column 'EnglishProductSubcategoryName' is renamed 'Product Subcategory' */
let ProductToProductSubCatJoin = 
try
// Nested outer join based on Subcategory Surrogate Key
Table.NestedJoin(Product,{"ProductSubcategoryKey"},#"Product Subcategory",{"ProductSubcategoryKey"},"ProductSubCatColumns",JoinKind.LeftOuter) otherwise Product,
AddProductSubCatColumn = 
try
// Will return nulls if EnglishProductSubcategoryName is renamed or missing in Product Subcategory query
Table.ExpandTableColumn(ProductToProductSubCatJoin, "ProductSubCatColumns",{"EnglishProductSubcategoryName"}, {"Product Subcategory"}) otherwise Product
in AddProductSubCatColumn
</code></pre>
    <p class="book-title--packt">Comments<a id="calibre_link-166" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are used in both multi-line and single-line formats to help explain the logic. Multi-line comments begin with <code class="code-in-text--packt">/* </code>and end with <code class="code-in-text--packt">*/ </code>while single-line comments are preceded by the <code class="code-in-text--packt">//</code> characters. Variable names (that is, <code class="code-in-text--packt">AddProductSubCatColumn</code>) are in proper casing with no spaces so as to avoid unnecessary double quotes and to further describe the process.</p>
    <p class="book-title--packt">Another method of<a id="calibre_link-286" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> increasing the maintainability of Power Query code is through proper data source management. Consider a PBIX file that includes 10 queries access three different data sources are hardcoded into each query. In this example, 10 queries use three separate sources (SQL Server, an Excel file, and an MS Access database file). Any change to the data source paths or connection information would require changing up to 10 different queries. To see how this can be resolved, consider the<a id="calibre_link-1951" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the Power BI Desktop file and identify the data sources being accessed by all queries</li>
      <li class="calibre12">The <strong class="screentext">Data source settings</strong> dialog from the <strong class="screentext">Transform data</strong> dropdown in the ribbon of the <strong class="screentext">Home</strong> tab in <strong class="screentext">Report</strong> view will expose current file sources</li>
      <li class="calibre12">For greater detail, open the <strong class="screentext">Power Query Editor</strong> and click on <strong class="screentext">Query Dependencies</strong> from the ribbon of the <strong class="screentext">View</strong> tab<figure class="mediaobject"><img src="images/000110.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 11.14: Query Dependencies view of 10 queries</p>
      </li>
      <li class="calibre12">Create the following folder groups in the queries window: <strong class="screentext">Parameters</strong>, <strong class="screentext">Data Source Queries</strong>, <strong class="screentext">Dimensions</strong>, and <strong class="screentext">Facts</strong></li>
      <li class="calibre12">Create six<a id="calibre_link-842" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> text parameters to abstract the file<a id="calibre_link-287" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> name, file path, server, and database names from the three sources</li>
      <li class="calibre12">Develop three data source queries from individual blank queries that reference these parameters:
        <pre class="programlisting"><code class="hljs">= Sql.Database(#"SQL Server AdWorks Server", #"SQL Server AdWorks DB")
= #"MS Access AdWorks Path" &amp; "\" &amp; #"MS Access AdWorks DB" &amp; ".accdb"
= #"MS Excel Ad Works Path" &amp; "\" &amp; #"MS Excel Ad Works File" &amp; ".xlsx"
</code></pre>
      </li>
      <li class="calibre12">Assign names to these queries such as <strong class="screentext">MS Access Ad Works Connection</strong> and disable their load to the data model</li>
      <li class="calibre12">Finally, modify each of the 10 queries to reference one of the three data source queries such as the following:
        <pre class="programlisting"><code class="hljs">let Source = Access.Database(File.Contents(#"MS Access Ad Works Connection"), [CreateNavigationProperties=true]),
Customer = Source{[Schema="",Item="DimCustomer"]}[Data]
in Customer
</code></pre>
        <figure class="mediaobject"><img src="images/000121.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 11.15: Consolidated and parameterized data sources organized in the Power Query Editor</p>
    <p class="book-title--packt">The <a id="calibre_link-843" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>folder groups, parameters, and data source queries make<a id="calibre_link-908" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> it easier to understand and manage the retrieval process.</p>
    <h2 id="calibre_link-1952" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet"><em class="italic">10 Common Mistakes in Power Query and How to Avoid Pitfalls</em> by Gil Raviv: <a href="http://bit.ly/2uW6c33" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2uW6c33</span></a></li>
      <li class="bullet"><em class="italic">Query Diagnostics</em>: <a href="https://bit.ly/2YBEmKv" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2YBEmKv</span></a></li>
    </ul>
    <h1 id="calibre_link-1293" class="title">Isolating and Documenting DAX Expressions</h1>
    <p class="book-title--packt">Isolating expressions into <a id="calibre_link-344" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>independent and interchangeable DAX measures <a id="calibre_link-341" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>or as variables within measures is recommended to simplify development and ownership of the dataset. Independent measures can be hidden from the <strong class="screentext">Fields</strong> list yet contain core business definitions and efficient filtering logic to drive the results and performance of many other measures in the model. Although scoped to each measure, DAX variables provide a self-documenting coding style and, unlike scalar-valued measures, also support table values thus allowing for even greater modularity.</p>
    <p class="book-title--packt">In this recipe, DAX variables, measures, and comments are used in different examples that demonstrate best practices around the creation and use of DAX expressions.</p>
    <h2 id="calibre_link-1953" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <strong class="screentext">AdWorksDW</strong> query and place it in a <strong class="screentext">Data Sources </strong>query group</li>
      <li class="calibre12">Right-click the <strong class="screentext">AdWorksDW</strong> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Reseller Sales</strong> and choose the <strong class="screentext">FactResellerSales</strong> table</li>
      <li class="calibre12">Repeat <em class="italic">steps 4</em> and <em class="italic">5</em> to create a <strong class="screentext">Resellers</strong> table that chooses the <strong class="screentext">DimReseller</strong> table and a <strong class="screentext">Dates</strong> query that chooses the <strong class="screentext">DimDate</strong> table.</li>
      <li class="calibre12">Move the <strong class="screentext">Reseller Sales</strong> query to a <strong class="screentext">Facts</strong> query group and the <strong class="screentext">Resellers</strong> and <strong class="screentext">Dates</strong> queries to a <strong class="screentext">Dimensions</strong> query group</li>
      <li class="calibre12">In the <strong class="screentext">Other Queries</strong> query group, create a blank query called <strong class="screentext">Calculations</strong></li>
      <li class="calibre12">Choose <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Save your work</li>
    </ol>
    <h2 id="calibre_link-1954" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To <a id="calibre_link-345" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>implement <a id="calibre_link-342" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create the following base measures in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Reseller Gross Sales = SUM('Reseller Sales'[SalesAmount])
Reseller Discount Amount = SUM('Reseller Sales'[DiscountAmount])
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Reseller Margin %</strong> measure in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Reseller Margin % = 
/*
Net Sales = Gross sales net of discounts that have shipped
Product Cost = Product standard cost of all ordered products 
(including not shipped). A Date of 12/31/2099 used for 
unshipped sales order lines since 1/1/2015
*/
    VAR ShippedSales = CALCULATETABLE('Reseller Sales',
        'Reseller Sales'[ShipDate] &lt;&gt; DATEVALUE("12/31/2099"))
    VAR NetSalesShipped = CALCULATE([Reseller Gross Sales] - 
        [Reseller Discount Amount],ShippedSales) 
    VAR ProductCost = SUMX('Reseller Sales',
        'Reseller Sales'[OrderQuantity] * 
        'Reseller Sales'[ProductStandardCost])
RETURN
    DIVIDE(NetSalesShipped - ProductCost,NetSalesShipped)
</code></pre>
      </li>
      <li class="calibre12">Create a <strong class="screentext">Reseller Gross Sales (Custom)</strong> measure in the <strong class="screentext">Calculations</strong> table:
        <pre class="programlisting"><code class="hljs">Reseller Gross Sales (Custom) = 
    VAR CurrentDate = MAX('Dates'[FullDateAlternateKey])
    VAR ResellerTypes = CALCULATETABLE('Resellers',
        Resellers[BusinessType] = "Warehouse")
    VAR DateHistory = --Trailing 10 Days
    FILTER(ALL('Dates'),'Dates'[FullDateAlternateKey] &lt;= CurrentDate &amp;&amp; 
        'Dates'[FullDateAlternateKey] &gt;= CurrentDate - 10)
RETURN
    CALCULATE([Reseller Gross Sales],ResellerTypes,DateHistory)
</code></pre>
      </li>
    </ol>
    <h2 id="calibre_link-1955" class="calibre8">How it works...</h2>
    <p class="book-title--packt">The <strong class="screentext">Reseller Margin % </strong>measure includes three lines of comments to describe the business definitions of the measure's components. Comments can also be added per line via the -- and // characters and Power BI applies green color coding to this text. Embedding comments is recommended for both complex measures with multiple components and<a id="calibre_link-346" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> simple measures, which form the foundation of many other <a id="calibre_link-343" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>measures.</p>
    <p class="book-title--packt">The <strong class="screentext">ShippedSales</strong> variable filters the <strong class="screentext">Reseller Sales</strong> fact table to exclude the unshipped sales order lines and this table is used as a filter parameter in the <strong class="screentext">NetSalesShipped</strong> variable. The existing <strong class="screentext">Reseller</strong> <strong class="screentext">Gross</strong> <strong class="screentext">Sales</strong> and <strong class="screentext">Reseller</strong> <strong class="screentext">Discount</strong> <strong class="screentext">Amount</strong> measures are referenced, but the <strong class="screentext">ProductCost</strong> variable is explicitly defined against the <strong class="screentext">Reseller</strong> <strong class="screentext">Sales</strong> fact table (shipped or not). Though significantly longer than alternative DAX expressions for the same calculation, the use of variables and comments eliminates (or reduces) the need to review other measures to understand the logic and source columns.</p>
    <p class="book-title--packt">For the <strong class="screentext">Reseller Gross Sales (Custom)</strong> measure, variables are declared for each of the tables to be filtered and a comment (<strong class="screentext">Trailing 10 Days</strong>) is inserted to help explain the <strong class="screentext">DateHistory</strong> variable. The variables are invoked as filter parameters to <code class="code-in-text--packt">CALCULATE</code>, and so the <strong class="screentext">Reseller Gross Sales</strong> measure reflects this modified filter context. The same functional <a id="calibre_link-1956" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>result can be achieved by defining all the filtering logic within <code class="code-in-text--packt">CALCULATE</code>, but this <a id="calibre_link-1957" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>would make the expression less readable and thus more difficult to support.</p>
    <h2 id="calibre_link-1958" class="calibre8">There's more...</h2>
    <p class="book-title--packt">DAX Formatter<a id="calibre_link-349" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> can be used within DAX Studio to align parentheses with their associated functions. Long, complex DAX measures can be copied from Power BI Desktop into <a id="calibre_link-366" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>DAX Studio to be formatted. To use DAX Studio to format queries, open DAX Studio, copy and paste the query from Power BI Desktop into the main window, and then click on <strong class="screentext">Format Query</strong> in DAX Studio. Copy and paste the query from DAX Studio and replace the expression in Power BI Desktop with the formatted expression.</p>
    <figure class="mediaobject"><img src="images/000133.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 11.16: DAX Formatter in DAX Studio used to format a year-to-date measure</p>
    <p class="book-title--packt">DAX authoring<a id="calibre_link-337" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in Power BI Desktop also supports parentheses highlighting, but DAX Formatter isolates functions to individual lines and indents inner function parameters. Without the function isolation and indentation provided by DAX Formatter, complex expressions are often wide and difficult to interpret or troubleshoot.</p>
    <h2 id="calibre_link-1959" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Improve Power BI Performance<a id="calibre_link-792" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> by Optimizing DAX: <a href="https://bit.ly/3uqUs4x" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3uqUs4x</span></a></li>
    </ul>
    <h1 id="calibre_link-1294" class="title">Improving Data Load Speeds with Incremental Refresh</h1>
    <p class="book-title--packt">Incremental refresh <a id="calibre_link-551" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is a feature originally released for Power BI Premium capacities but has become a feature for Pro licenses as well. Prior to incremental refresh, Power BI only had a single mode of operation when refreshing datasets, full load. In other words, the existing data in the dataset was removed and entirely replaced each time the dataset refreshed. The full load refresh process could take a long time when dealing with large fact tables with millions of rows. Incremental refresh solves this problem by only refreshing new and changed data within the dataset. Since incremental refresh is relatively new, older datasets are likely still using the full load process and thus might benefit from being retrofitted with incremental refresh.</p>
    <p class="book-title--packt">This recipe demonstrates<a id="calibre_link-552" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> how to set up and configure <a id="calibre_link-246" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>incremental refresh in Power BI.</p>
    <h2 id="calibre_link-1960" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a Power BI Desktop file locally and access the <strong class="screentext">Power Query Editor</strong> by clicking on <strong class="screentext">Transform Data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Create a query named <code class="code-in-text--packt">AdWorksDW</code> similar to the following:
        <pre class="programlisting"><code class="hljs">let
    Source = Sql.Database("localhost\MSSQLSERVERDEV", "AdventureWorksDW2019")
in
    Source
</code></pre>
      </li>
      <li class="calibre12">Disable load on the <code class="code-in-text--packt">AdWorksDW</code> query and place it in a <strong class="screentext">Data Sources </strong>query group</li>
      <li class="calibre12">Right-click the <code class="code-in-text--packt">AdWorksDW</code> query and choose <strong class="screentext">Reference</strong></li>
      <li class="calibre12">Rename the query <strong class="screentext">Reseller Sales</strong> and choose the <strong class="screentext">FactResellerSales</strong> table</li>
      <li class="calibre12">Move the <strong class="screentext">Reseller Sales</strong> query to a <strong class="screentext">Facts</strong> query</li>
      <li class="calibre12">In the <strong class="screentext">Other Queries</strong> query group, create a blank query called <strong class="screentext">Calculations</strong></li>
      <li class="calibre12">Choose <strong class="screentext">Close &amp; Apply</strong> from the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Save your work</li>
    </ol>
    <h2 id="calibre_link-1961" class="calibre8">How to do itâ¦</h2>
    <p class="book-title--packt">To implement<a id="calibre_link-553" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> this recipe, use the following <a id="calibre_link-247" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In Power BI Desktop, click the <strong class="screentext">Data</strong> view and sort the <strong class="screentext">OrderDate</strong> column in the <strong class="screentext">Reseller Sales</strong> table in descending order by right-clicking the column in the main table window (not the <strong class="screentext">Fields</strong> list) and choosing <strong class="screentext">Sort descending</strong></li>
      <li class="calibre12">Note the last date, <strong class="screentext">11/29/2013 12:00:00 AM</strong></li>
      <li class="calibre12">Sort the <strong class="screentext">OrderDate</strong> column in ascending order and note the first date, <strong class="screentext">12/29/2010 12:00:00 AM</strong></li>
      <li class="calibre12">In <strong class="screentext">Report </strong>view, click <strong class="screentext">Transform data</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">In the Power Query Editor, click <strong class="screentext">Manage parameters</strong> in the ribbon of the <strong class="screentext">Home</strong> tab</li>
      <li class="calibre12">Click <strong class="screentext">New</strong>, provide a <strong class="screentext">Name</strong> of <strong class="screentext">RangeStart</strong>, a <strong class="screentext">Type</strong> of <strong class="screentext">Date/Time</strong>, and a <strong class="screentext">Current Value</strong> of <strong class="screentext">12/28/2010 12:00:00 AM </strong>(one day less than the minimum value)</li>
      <li class="calibre12">Click <strong class="screentext">New</strong> to create another parameter with a <strong class="screentext">Name</strong> of <strong class="screentext">RangeEnd</strong>, a <strong class="screentext">Type</strong> of <strong class="screentext">Date/Time</strong>, and a <strong class="screentext">Current Value</strong> of <strong class="screentext">11/28/2013 12:00:00 AM</strong> (one day less than the maximum value)</li>
      <li class="calibre12">Move <strong class="screentext">RangeStart</strong> and <strong class="screentext">RangeEnd</strong> to a <strong class="screentext">Parameters</strong> query group</li>
      <li class="calibre12">Select the <strong class="screentext">Resellers Sales</strong> query</li>
      <li class="calibre12">In the <strong class="screentext">OrderDate</strong> column header, select the drop-down button and choose <strong class="screentext">Date/Time Filters</strong> and then <strong class="screentext">Custom Filterâ¦</strong></li>
      <li class="calibre12">Fill in the <strong class="screentext">Filter Rows</strong> dialog as follows:<figure class="mediaobject"><img src="images/000146.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 11.17: Configuring filters for incremental refresh</p>
      </li>
      <li class="calibre12">Click <strong class="screentext">Close &amp; Apply</strong></li>
      <li class="calibre12">In <strong class="screentext">Data</strong> view, sort the <strong class="screentext">OrderDate</strong> column in descending order and note that rows for <strong class="screentext">11/29/2013 12:00:00 AM</strong> are not present</li>
      <li class="calibre12">While still in <strong class="screentext">Data </strong>view, right-click the <strong class="screentext">Reseller Sales</strong> table and select <strong class="screentext">Incremental refresh</strong></li>
      <li class="calibre12">In <a id="calibre_link-554" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Incremental refresh</strong> dialog, toggle <strong class="screentext">Incremental refresh</strong> to <strong class="screentext">On</strong> for the <strong class="screentext">Reseller Sales</strong> table and<a id="calibre_link-248" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> set <strong class="screentext">Store rows</strong>â¦ to <strong class="screentext">30</strong> <strong class="screentext">Years</strong> and <strong class="screentext">Refresh rowsâ¦</strong> to <strong class="screentext">3 Days</strong>, as shown in the following image:<figure class="mediaobject"><img src="images/000159.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 11.18: Incremental refresh dialog settings</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Apply all</strong> button</li>
      <li class="calibre12">Create a simple Card visualization for the report that displays the <strong class="screentext">Latest</strong> <strong class="screentext">OrderDate</strong></li>
      <li class="calibre12">Publish <a id="calibre_link-1962" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the report to the Power BI service</li>
      <li class="calibre12">Open the <a id="calibre_link-1963" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>workspace where the report was published in the Power BI service</li>
      <li class="calibre12">Open the <strong class="screentext">Settings</strong> for the dataset</li>
      <li class="calibre12">If necessary, add the data source to any gateway cluster</li>
      <li class="calibre12">Open the workspace where the report was published in the Power BI service</li>
      <li class="calibre12">Click the <strong class="screentext">Refresh now</strong> icon for the dataset</li>
      <li class="calibre12">Open the <strong class="screentext">Settings</strong> for the dataset and investigate the <strong class="screentext">Refresh history</strong></li>
      <li class="calibre12">Wait for the dataset to refresh and then open the report to verify that the <strong class="screentext">Latest</strong> <strong class="screentext">OrderDate</strong> is now <strong class="screentext">11/29/2013 12:00:00 AM</strong></li>
    </ol>
    <h2 id="calibre_link-1964" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">Incremental refresh uses the reserved parameter names <strong class="screentext">RangeStart</strong> and <strong class="screentext">RangeEnd</strong> in executing incremental refresh. While initially set during the configuration of incremental refresh, these parameters are thereafter updated by the Power BI service to determine which rows within the dataset to refresh incrementally.</p>
    <p class="book-title--packt">When configuring the filter rows for incremental refresh, it is important that the two conditions for <strong class="screentext">RangeStart</strong> and <strong class="screentext">RangeEnd</strong> do not both include an equal to (=) clause as this may result in duplicate data. Only configure one of the conditions to include an equal to (=) clause in order to avoid such circumstances.</p>
    <p class="book-title--packt">Upon first refreshing the data in the service, Power BI refreshes the entire dataset per the <strong class="screentext">Store rows where column is in the last </strong>setting in the <strong class="screentext">Incremental refresh </strong>dialog. In other words, during the first refresh of a dataset configured for incremental refresh, the refresh process functions like a full reload of all of the data. All rows within the store period are included in the dataset unless other filters apply. Subsequent refreshes only refresh the new <a id="calibre_link-249" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>data per the <strong class="screentext">Refresh rows where column is in the last</strong> setting.</p>
    <p class="book-title--packt">It is important <a id="calibre_link-555" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to remember that once incremental refresh is configured, the Power BI file can no longer be exported from the service. Thus, it is imperative that the original Power BI desktop file be preserved in the event that changes need to be made.</p>
    <h2 id="calibre_link-1965" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">There are two optional incremental refresh<a id="calibre_link-557" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> settings in the <strong class="screentext">Incremental refresh</strong> dialog. These optional settings are the following:</p>
    <ul class="calibre9">
      <li class="bullet">Detect data changes</li>
      <li class="bullet">Only refresh complete days</li>
    </ul>
    <p class="book-title--packt">The <strong class="screentext">Detect data changes</strong> setting can be used to further optimize the data refreshed by incremental refresh. A column of type <strong class="screentext">Date/Time</strong> must be used for this setting and this column should not be the same column used for the <strong class="screentext">RangeStart</strong> and <strong class="screentext">RangeEnd</strong> parameters. The Power BI service evaluates the maximum value of this column when refreshing and if the value has not change<a id="calibre_link-381" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>d since the previous refresh then no data is refreshed within the dataset.</p>
    <p class="book-title--packt">The <strong class="screentext">Only refresh complete days</strong> setting<a id="calibre_link-671" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is used to prevent partial days from being included in data refreshes. For example, in the event that the refresh operation detects that a day is incomplete, such as a scheduled refresh at 4 AM, then that day's data is not included in the refresh operation. This can be useful for organizations that only want complete daily information in their datasets for reporting purposes.</p>
    <h2 id="calibre_link-1966" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Incremental refresh<a id="calibre_link-556" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in Power BI: <a href="https://bit.ly/3f3DSkM" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3f3DSkM</span></a></li>
      <li class="bullet">Incremental refresh for datasets in Power BI: <a href="https://bit.ly/3w10oSv" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3w10oSv</span></a></li>
    </ul>
    <h1 id="calibre_link-1295" class="title">Conclusion</h1>
    <p class="book-title--packt">This chapter's recipes contained top data modeling, DAX measure, and M query patterns to enhance the performance, scalability, and reliability of Power BI datasets. This included performance tuning examples of both data models and measures, error handling, and query folding examples of M queries in addition to supporting details on the DAX and M query engines. The next chapter is all about deploying and distributing Power BI content using the Power BI service, Teams, and mobile devices.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-12">
<div id="calibre_link-1967" class="calibre2">
<div id="calibre_link-1968" class="calibre3"><div id="calibre_link-1969" class="calibre4">
    <h1 class="heading">12</h1>
    <h1 id="calibre_link-1296" class="title">Deploying and Distributing Power BI Content</h1>
    <p class="book-title--packt">Thus far, much of this book has focused on the individual BI professional working with Power BI to create data models, reports, dashboards, and other BI and system assets. However, BI is all about providing insights and information to the business. Thus, for any BI project to be successful, the data and insights created must be shared and distributed throughout the organization.</p>
    <p class="book-title--packt">This chapter contains detailed examples and considerations for deploying and distributing Power BI content via the Power BI service and Power BI mobile application. This includes the creation and configuration of app workspaces and apps, procuring and assigning Power BI premium capacities, configuring data sources and refresh schedules, and deriving greater value from the Power BI mobile application. Additionally, topics such as staging deployments across development and production environments, as well as multi-node premium capacity deployments, are covered.</p>
    <p class="book-title--packt">In this chapter, we will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Preparing for Content Creation and Collaboration</li>
      <li class="bullet">Managing Content between Environments</li>
      <li class="bullet">Sharing Content with Colleagues</li>
      <li class="bullet">Configuring Workspaces</li>
      <li class="bullet">Configuring On-Premises Gateway Data Connections</li>
      <li class="bullet">Publishing Apps</li>
      <li class="bullet">Publishing Reports to the Public Internet</li>
      <li class="bullet">Enabling the Mobile Experience</li>
      <li class="bullet">Distributing Content with Teams</li>
    </ul>
    <p class="book-title--packt">At the end of this chapter, you will be well informed about how to deploy and distribute your Power BI content.</p>
    <h1 id="calibre_link-1297" class="title">Technical Requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop.</li>
      <li class="bullet">SQL Server with the<span class="url"> </span><code class="code-in-text--packt">AdventureWorksDW2019</code> database installed. This database and instructions for installing it are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a>.</li>
      <li class="bullet">Files for this chapter and can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a></li>
    </ul>
    <h1 id="calibre_link-1298" class="title">Preparing for Content Creation and Collaboration</h1>
    <p class="book-title--packt">Power BI <a id="calibre_link-190" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>collaboration <a id="calibre_link-185" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>environments can take many forms, ranging from a small group of Power BI Pro users creating and sharing content with each other in a single app workspace to large-scale corporate BI scenarios characterized by many read-only users accessing Power BI premium capacity resources via Power BI apps. Given the cost advantages of the capacity-based pricing model Power BI Premium provides, as well as the enhanced performance and scalability features it delivers, it is important to properly provision and manage these resources.</p>
    <p class="book-title--packt">This recipe provides two processes fundamental to the overall purpose of this chapter: deploying and distributing Power BI content. The first process highlights several critical questions and issues in planning and managing a Power BI deployment. The second process details the provisioning of Power BI Premium dedicated capacity resources and the allocation of those resources to specific deployment workloads via app workspaces.</p>
    <h2 id="calibre_link-1970" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">There are five main licensing mechanisms for Power BI</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Free</li>
      <li class="bullet">Power BI Pro</li>
      <li class="bullet">Dedicated capacity (Embedded, Premium)</li>
      <li class="bullet">Premium Per User</li>
      <li class="bullet">On-premises (Power BI Report Server)</li>
    </ul>
    <p class="book-title--packt">Power BI Free provides extremely limited sharing and distribution features (Publish to web) while Power BI Pro and Premium Per User require every user that creates or consumes Power BI content to be licensed. Dedicated capacities such as Embedded and Premium allow free users to consume content published to embedded or premium dedicated capacity workspaces. On-premises implementations are licensed via Power BI Report Server, a superset of SQL Server Reporting Services (SSRS).</p>
    <p class="book-title--packt">It is essential to carefully review the licensing and features associated with each deployment option. For example, many of the features in the Power BI service such as dashboards and Q&amp;A (natural language queries) are not available in on-premises Power BI Report Server. Likewise, certain Power BI Premium SKUs are exclusive to embedding Power BI into<a id="calibre_link-191" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> applications. For a more complete treatment of Power<a id="calibre_link-186" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> BI licensing options, see the <em class="italic">See also</em> section of this recipe.</p>
    <h2 id="calibre_link-1971" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12">Determine how Power BI content (datasets, reports, and dashboards) will be deployed and consumed by users.<ul class="calibre11">
          <li class="calibre12">Will content be deployed to the Power BI service and accessed via apps and Power BI mobile apps?</li>
          <li class="calibre12">Will content be deployed to the Power BI service but embedded into business applications?</li>
          <li class="calibre12">Will content be deployed to the Power BI report server on-premises and accessed via the reporting services web portal as well as the Power BI mobile app?</li>
        </ul>
        <p class="packt_figref">For hybrid deployments, such as using both the Power BI service and embedding, or using the Power BI service and Power BI Report Server, estimate the resources required for each of these workloads and evaluate both a consolidated licensing model and separate, dedicated licenses. For example, if 16 virtual cores are provisioned with a Power BI premium P2 SKU, 16 separate cores are also available for licensing Power BI Report Server on-premises. Such consolidated licensing may be more advantageous than licensing Power BI Report Server separately and paying for additional Power BI Pro licenses.</p>
      </li>
      <li class="calibre12">Identify or estimate the Power BI Pro and Power BI Free users based on their roles and needs in the organization.<ul class="calibre11">
          <li class="calibre12">Will the user create and publish content (Power BI Pro)?</li>
          <li class="calibre12">Will the user only consume content and optionally create content for their personal use (Power BI Free)?</li>
        </ul>
        <p class="packt_figref">Connecting to published datasets via Analyze in Excel and Power BI service Live Connections are Power BI Pro features and are thus not available to Power BI Free users even if the dataset is assigned to a Power BI Premium capacity. However, a Power BI Free user can still view and subscribe to reports and dashboards in Premium capacities, and can also export content to CSVs and PowerPoint.</p>
      </li>
      <li class="calibre12">For larger deployments with many read-only users, estimate the Power BI Premium resources required.<ul class="calibre11">
          <li class="calibre12">Use the Power BI Dedicated Capacity Load Assessment Tool referenced in the <em class="italic">See also</em> section as a starting point.</li>
          <li class="calibre12">Plan how deployment workloads will be allocated across premium capacity nodes.</li>
          <li class="calibre12">Will a<a id="calibre_link-187" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> given<a id="calibre_link-192" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> workload (or perhaps a business function) have its own capacity, or will a single, larger capacity support multiple or all workloads or teams?</li>
        </ul>
        <p class="packt_figref">If Power BI datasets in import mode will serve as the primary data storage option supporting reports and dashboards, consider their memory usage relative to the memory available per Power BI Premium SKU. For example, 25 GB of RAM is currently available in a P1 capacity node, and this may be insufficient for larger dataset (model) sizes stored in the service with a scheduled refresh. Like SSAS tabular models, 2.5X of memory should be provisioned to support both processing and refreshing, queries, and temporary memory structures created during queries.</p>
      </li>
      <li class="calibre12">Evaluate and plan data modeling tools (datasets).<ul class="calibre11">
          <li class="calibre12">Will Power BI Desktop be used for both data modeling and report development or will Analysis Services be used for data modeling and Power BI Desktop only used for reporting?</li>
          <li class="calibre12">What will the storage mode of these new semantic models be (Import, DirectQuery, Composite) and what are the implications for required memory? For example, aggregations are exclusively available with Power BI Premium and thus significantly less memory would need to be provisioned if aggregations are used correctly.</li>
          <li class="calibre12">Are changes to a relational data source or infrastructure necessary to support performance?</li>
        </ul>
        <p class="packt_figref">In some scenarios, the relational data source must be revised or enhanced to support sufficient DirectQuery performance. These enhancements vary based on the source but may include indexes (such as Columnstore indexes in SQL Server), greater compute and memory resources, denormalization, and referential integrity.</p>
        <p class="packt_figref">If SSAS is being used on-premises as the source for Power BI (via the on-premises data gateway), it may be beneficial to utilize Azure ExpressRoute to create a private connection to the Azure data center of the Power BI tenant.</p>
      </li>
      <li class="calibre12">Plan for scaling and migrating Power BI projects as adoption and needs change and identify key points of the project lifecycle and the capabilities needed to migrate and scale as needs change.<p class="packt_figref">Examples of this include adding separate Power BI Premium capacity nodes (scale out), larger capacity nodes (scale up), migrating a Power BI Desktop dataset to SSAS or Azure Analysis Services, staging deployments across Dev, Test, and<a id="calibre_link-193" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Production Power BI workspaces and apps, moving <a id="calibre_link-188" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>workspaces into and out of premium capacities, and transferring ownership of content across teams, such as from a business team to a corporate BI team.</p>
      </li>
      <li class="calibre12">Assign roles and responsibilities to Power BI team members.<ul class="calibre11">
          <li class="calibre12">Dataset authors, including source connectivity, retrieval queries, data modeling, and measuring development</li>
          <li class="calibre12">Report authors, including dashboards, mobile-optimized reports and dashboards, and apps</li>
          <li class="calibre12">Administrators, including the on-premise data gateway, premium capacities, and tenant settings</li>
        </ul>
      </li>
      <li class="calibre12">Target skills and knowledge specific to these team roles.<ul class="calibre11">
          <li class="calibre12">Dataset authors should learn the fundamentals of DAX, M, and data modeling for Power BI and SSAS.</li>
          <li class="calibre12">Report authors should know or learn about visualization standards, interactivity and filtering, and custom visuals.</li>
          <li class="calibre12">Administrators should study monitoring tools and data available for on-premises gateway monitoring, workspaces, premium capacities, the Office 365 audit log, and the Power BI activity log.</li>
        </ul>
        <p class="packt_figref">Report authors, who are often business analysts outside of IT or BI organizations, should regularly review new and recent report features released in the Power BI monthly updates.</p>
      </li>
      <li class="calibre12">Build collaboration processes across teams.<ul class="calibre11">
          <li class="calibre12">Dataset authors should collaborate with the owners and subject matter experts of data sources. For example, any changes to data source schemas or resources should be communicated.</li>
          <li class="calibre12">Report authors should have access to dataset documentation and collaborate with dataset authors. For example, metrics or dimensions not available for new reports should be communicated. Any standards such as a corporate Power BI report theme or fonts should be documented.</li>
          <li class="calibre12">Administrators should collaborate with the Office 365 global admin, data <a id="calibre_link-194" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>governance, and security teams. For <a id="calibre_link-189" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>example, administrators should confirm that Power BI tenant settings align with organizational policies. Additionally, administrators can request or procure security groups to manage Power BI.</li>
          <li class="calibre12">Plan for common support scenarios, new project requests, and requests for enhancements. For example, create a process for automatically assigning Power BI licenses and security group memberships. Additionally, plan for questions or issues from consumers of Power BI content.</li>
        </ul>
      </li>
    </ol>
    <p class="book-title--packt">Successful Power BI deployments of any significant scale require planning, team and cross-team collaboration, business processes, active management, and targeted skills and resources. The steps in this recipe only identify several of the fundamental topics&mdash;the actual process is always specific to an organization and its deployment goals, policies, and available skills and resources.</p>
    <h2 id="calibre_link-1972" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Power BI Premium<a id="calibre_link-793" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> was introduced to support large-scale deployments of Power BI for enterprises. Power BI Premium is, at its core, a pool of dedicated hardware resources for a given organization to configure and utilize according to their own use cases and policies. Although other legacy Microsoft BI technologies such as Analysis Services and Reporting Services will continue to be supported, all new features and capabilities, such as composite models and aggregations, are exclusively available to Power BI Premium customers. Additionally, Power BI Premium capacity enables new scenarios including embedding content in applications and using a combination of both the Power BI public cloud service and an on-premises deployment of the Power BI Report Server. Perhaps most importantly for large deployments, Power BI Premium avoids the need to purchase licenses for each user since read-only users can access Power BI Premium content without a pro license. Additionally, as a managed cloud service, resources can be aligned with the changing needs of an organization via simple scale-up and scale-out options.</p>
    <blockquote class="packt_quote pcalibre6">"In many cases Power BI Premium was built to address the challenges of deploying Power BI at scale where you have larger data models that have grown over time and when you have more users that are accessing the content." <p class="cite">- Adam Wilson, Power BI group program manager</p></blockquote>
   
    <p class="book-title--packt">In this example, workspaces<a id="calibre_link-1973" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> specific to functional areas in an organization are associated with two separate Power BI Premium capacity nodes. </p>
    <p class="book-title--packt">An additional workspace and the <strong class="screentext">My Workspace</strong> associated with all accounts (Power BI Free and Pro) are included in a shared capacity--the multi-tenancy environment of the Power BI Service. The process for provisioning and configuring such an environment is as follows:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">A Microsoft 365 global admin or billing admin purchases the required Pro and Free licenses in the <strong class="screentext">Microsoft 365 admin center</strong>.</li>
      <li class="calibre12">These licenses are assigned to users according to the roles determined in the planning stage earlier.<figure class="mediaobject"><img src="images/000171.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.1: Microsoft 365 admin center &ndash; Purchase services</p>
      </li>
      <li class="calibre12">Purchase a <a id="calibre_link-794" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI Premium P2 capacity node by scrolling down, clicking the <strong class="screentext">Details</strong> button under the <strong class="screentext">Power BI Premium P2</strong> heading, and then clicking the <strong class="screentext">Buy</strong> button.<figure class="mediaobject"><img src="images/000183.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.2: Purchasing a Power BI Premium P2 capacity</p>
      </li>
      <li class="calibre12">Purchase a Power BI Premium P3 capacity.</li>
      <li class="calibre12">Confirm that the new Power BI Premium subscriptions appear in the <strong class="screentext">Your products</strong> window along with any purchased Power BI Pro and Power BI Free licenses.</li>
      <li class="calibre12">The Microsoft 365 global admin or Power BI Service Administrator opens the Power BI admin portal. In the Power BI service, click on the gear icon at the top right and select <strong class="screentext">Admin Portal</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">Capacity settings</strong> from<a id="calibre_link-795" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the admin portal and then click on <strong class="screentext">Set up new capacity</strong>.</li>
      <li class="calibre12">Give the capacity a descriptive name and assign the capacity admin role to a user or users.<p class="packt_figref">Global admins and Power BI Service Admins are capacity admins by default, but the capacity admin role can be assigned to users that are not Power BI Service Admins. Capacity admin role privileges are specific to the given capacity.</p>
      </li>
      <li class="calibre12">Grant workspace assignment permissions to specific Power BI Pro users or groups for the capacity.<figure class="mediaobject"><img src="images/000197.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.3: User permissions in Capacity settings</p>
      </li>
      <li class="calibre12">Set up the other capacity purchased, assign its capacity admins, and grant its workspace assignment permissions.</li>
      <li class="calibre12">Power BI Pro users with workspace assignment permissions can create premium workspaces in the Power BI service.</li>
    </ol>
    <p class="book-title--packt">In the Power BI admin portal, capacity admins can assign or remove workspaces from premium capacity, as well as whitelisting users such that all of a given user's workspaces are assigned to premium capacity.</p>
    <figure class="mediaobject"><img src="images/000208.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.4: Power BI Premium capacity assigned to workspaces</p>
    <p class="book-title--packt">In this example, three<a id="calibre_link-796" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> workspaces (sales, marketing, and finance) are assigned to a Power BI Premium Capacity named <strong class="screentext">Enterprise BI (P3)</strong>. Additionally, this capacity also supports the embedded reporting needs of a custom application. The larger P3 (32 cores, 100 GB RAM) capacity was chosen given the higher volume of query traffic for these workspaces, as well as the need for larger dataset sizes.</p>
    <p class="book-title--packt">Supply chain and operations workspaces were assigned to a P2 capacity. In this case, though less of a workload than the P3 capacity, these groups still need to share content with many free users. Finally, a workspace for a small group of IT users (IT Admin) with Power BI Pro licenses is maintained in Shared Capacity. This workspace did not require Power BI Premium, given minimal needs for distribution to free users and given smaller datasets with relatively infrequent refresh schedules.</p>
    <p class="book-title--packt">Scaling out Power BI Premium involves distributing provisioned capacity (v-cores) across multiple capacities. For example, the 32 v-cores purchased as part of a P3 capacity node could optionally be split into three separate capacities: two P1 capacities of 8 v-cores each and one P2 capacity of 16 v-cores (<em class="italic">8 + 8 + 16 = 32</em>). This ability to distribute v-cores across distinct premium capacities is referred to as <em class="italic">v-core pooling</em>.</p>
    <p class="book-title--packt">In-place scaling of Premium capacities involves purchasing an additional capacity node in the Microsoft 365 admin center as per the recipe, then adjusting the capacity size of a given premium capacity to reflect the additional cores:</p>
    <figure class="mediaobject"><img src="images/000220.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.5: Available v-cores for a capacity in the Power BI admin portal</p>
    <p class="book-title--packt">For example, if a P1 capacity<a id="calibre_link-797" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is determined to be insufficient for the desired performance or scalability, an additional P1 capacity can be purchased. At this point, with two P1 capacities purchased at 8 v-cores each, a P2 capacity size (16 v-cores) can be set for the original capacity in the Power BI admin portal. This makes it quick and easy to incrementally scale up as requirements change.</p>
    <h2 id="calibre_link-1974" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power BI Licensing in Pictures: <a href="https://bit.ly/2R4xYYN" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2R4xYYN</span></a></li>
      <li class="bullet">What is Microsoft Power BI Premium?: <a href="https://bit.ly/3eyrpq8" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3eyrpq8</span></a> </li>
      <li class="bullet">Planning a Power BI enterprise deployment whitepaper: <a href="http://bit.ly/2wBGPRJ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2wBGPRJ</span></a></li>
      <li class="bullet">Capacity and SKUs in Power BI embedded analytics: <a href="https://bit.ly/2REM437" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2REM437</span></a></li>
      <li class="bullet">Capacity planning: <a href="https://bit.ly/3tG66aR" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3tG66aR</span></a></li>
    </ul>
    <h1 id="calibre_link-1299" class="title">Managing Content between Environments</h1>
    <p class="book-title--packt">Corporate <a id="calibre_link-177" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>BI and IT teams familiar with project lifecycles, source control systems, and managing development, testing, and production environments should look to apply these processes to Power BI deployments as well. Power BI Desktop does not natively interface with standard source control systems such as Azure DevOps. However, Power BI files can be stored in SharePoint Online Team site and OneDrive for Business to provide visibility to version history, synchronization between local device and the cloud service, restore capabilities, and more. In the Power BI service, separate development, test, and production workspaces and their corresponding apps can be created to support a staged deployment. Utilizing these tools and features enables Power BI teams to efficiently manage their workflows and to deliver consistent, quality content to users. </p>
    <p class="book-title--packt">This recipe contains a recipe for deploying content using Power BI Deployment Pipelines, which is a Premium feature. Alternative methods for those without Premium are included in the <em class="italic">There's more</em> section.</p>
    <h2 id="calibre_link-1975" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the Power BI Service, create a new Premium workspace.</li>
      <li class="calibre12">Open a <a id="calibre_link-1976" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>report in Power BI Desktop that includes query parameters and <strong class="screentext">Publish </strong>the report to the Premium workspace created in Step 1. The query parameters should be set to <strong class="screentext">Text</strong>.</li>
    </ol>
    <p class="book-title--packt">Again, this recipe requires a Power BI Premium capacity.</p>
    <h2 id="calibre_link-1977" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">Creating and using Power BI Deployment Pipelines is relatively easy. To create and use a pipeline follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the Power BI Service, choose <strong class="screentext">Deployment pipelines</strong> from the left navigation pane.</li>
      <li class="calibre12">Choose <strong class="screentext">Create a pipeline</strong>.</li>
      <li class="calibre12">Provide a <strong class="screentext">Pipeline name</strong> and click the <strong class="screentext">Create </strong>button.</li>
      <li class="calibre12">Click the <strong class="screentext">Assign a workspace</strong> button.</li>
      <li class="calibre12">Choose the Premium workspace created in Step 1, assign the deployment stage for the workspace of <strong class="screentext">Development </strong>and click the <strong class="screentext">Assign </strong>button.<figure class="mediaobject"><img src="images/000231.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.6: Assign a workspace to a deployment pipeline</p>
      </li>
      <li class="calibre12">Under <a id="calibre_link-178" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Development </strong>stage, click the <strong class="screentext">Deploy to test</strong> button. This creates a new workspace and deploys the content in <strong class="screentext">Development </strong>to this workspace.<figure class="mediaobject"><img src="images/000243.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.7: Power BI deployment pipeline</p>
      </li>
      <li class="calibre12">Once the content is deployed to <strong class="screentext">Test</strong>, click the lightning bolt icon in the <strong class="screentext">Test </strong>stage header.</li>
      <li class="calibre12">Click on the dataset under the <strong class="screentext">Datasets </strong>heading.</li>
      <li class="calibre12">Expand <strong class="screentext">Parameter rules</strong> and click the <strong class="screentext">Add rule </strong>button.</li>
      <li class="calibre12">Under the <strong class="screentext">For this parameter heading</strong>, choose a parameter.</li>
      <li class="calibre12">Under the <strong class="screentext">Apply this value</strong>, edit the parameter and click the <strong class="screentext">Save </strong>button.<figure class="mediaobject"><img src="images/000255.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 12.8: Power BI deployment pipeline parameter rule</p>
    <p class="book-title--packt">Now, every time the dataset is deployed to the Test stage, the parameter will point to the test SQL <a id="calibre_link-179" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Server instead of the development SQL Server. For more information about Power BI pipelines and how to use them in Power BI deployment scenarios, see the <em class="italic">See also</em> section of this recipe.</p>
    <h2 id="calibre_link-1978" class="calibre8">How it works...</h2>
    <p class="book-title--packt">Power BI deployment pipelines allow the easy movement of content between Development, Test, and Production deployment stages. These deployment stages are tied to individual workspaces that are created automatically by the pipeline. As content is changed within the different stages, that content can be deployed to previous stages or subsequent stages. In addition, rules can be defined within Test and Production stages that change data sources or parameters to point to the appropriate source systems.</p>
    <p class="book-title--packt">The Development stage is designed to be the working area for report development. The Test stage is where developed content can be shared with business users for user acceptance testing. Finally, the Production stage is where the final product is presented to the business.</p>
    <h2 id="calibre_link-1979" class="calibre8">There's more...</h2>
    <p class="book-title--packt">If you do not have Power BI Premium, the Power BI REST API's can be used to deploy content between workspaces. In addition, the ALM Toolkit allows you to compare two compare and merge Analysis Services tabular models using the open-source BISM Normalizer toolset. BISM stands for Business Intelligence Semantic Model and is a defined Microsoft model for reporting, analytics, scorecards, and dashboards. </p>
    <p class="book-title--packt">BISM includes three layers, the <strong class="screentext">Data model layer</strong> (tabular and multi-dimensional), <strong class="screentext">Business logic and queries layer</strong> (DAX and MDX), and the <strong class="screentext">Data access layer</strong> (ROLAP, MOLAP, Vertipaq, and DirectQuery). The ALM Toolkit uses the BISM foundation to generate a comparison of Analysis Services models and can then merge the changes in one model with another model. For more information about the ALM Toolkit and how to use it in deployment scenarios, see the <em class="italic">See also</em> section of this recipe.</p>
    <p class="book-title--packt">Finally, Maik van der Gaag developed a free set of tasks for Azure DevOps Pipelines called <strong class="screentext">Power BI Actions</strong>. This set of tasks allows common deployment actions to be automated via Azure DevOps Pipelines, allowing the creation of a continuous integration, continuous<a id="calibre_link-180" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> development (CICD) process for Power BI deployments. For more information about the CICD with Azure DevOps and how to use it in Power BI deployment scenarios, see the <em class="italic">See also</em> section of this recipe.</p>
    <h2 id="calibre_link-1980" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power BI REST API reference for Report operations: <a href="https://docs.microsoft.com/en-gb/rest/api/power-bi/?redirectedfrom=MSDN" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2v8ifKg</span></a></li>
      <li class="bullet">ALM Toolkit documentation: <a href="https://bit.ly/3f95ODQ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3f95ODQ</span></a></li>
      <li class="bullet">AzureDevOps: CICD for PowerBI Reports: <a href="https://bit.ly/3hfrHnM" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3hfrHnM</span></a></li>
      <li class="bullet">Introduction to deployment pipelines: : <a href="https://bit.ly/3uxzMrT" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3uxzMrT</span></a></li>
    </ul>
    <h1 id="calibre_link-1300" class="title">Sharing Content with Colleagues</h1>
    <p class="book-title--packt">Power BI apps<a id="calibre_link-181" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> are the recommended content distribution method for large corporate BI deployments, but for small teams and informal collaboration scenarios, sharing dashboards and reports provides a simple alternative. By sharing a dashboard, the recipient obtains read access to the dashboard, the reports supporting the dashboards tiles, and immediate visibility of any changes in the dashboard. Additionally, dashboards and reports can be shared with Power BI Pro users external to an organization via security groups and distribution lists, and Power BI Pro users can leverage <strong class="screentext">Analyze in Excel</strong> as well as the Power BI mobile apps to access the shared data. Moreover, Power BI Free users can consume dashboards and reports shared with them from Power BI Premium capacity.</p>
    <p class="book-title--packt">In this recipe, a Power BI dashboard is shared with a colleague as well as a contact in an external organization. Guidance on configuring and managing shared dashboards and additional considerations is included throughout the recipe and the <em class="italic">How it works...</em> and <em class="italic">There's more...</em> sections.</p>
    <h2 id="calibre_link-1981" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">Confirm that both the owner of the dashboard and the recipient(s) or consumers have Power BI Pro licenses. If the recipient(s) does not have a Power BI Pro license, check if the dashboard is contained in a workspace that has been assigned to premium capacity. Either Pro licenses or Premium capacity are required to share the dashboard. A Power BI Pro user cannot share a dashboard hosted in Power BI shared capacity with a Power BI free user.</p>
    <p class="book-title--packt">Enable the external sharing feature in the Power BI Admin Portal, either for the organization or specific security groups. The owner of a shared dashboard can allow recipients to reshare a dashboard but any dashboards shared with external users cannot be shared. Additionally, user<a id="calibre_link-182" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> access to the dashboard and the ability to reshare can be removed by the dashboard owner. Unlike the <strong class="screentext">Publish to web</strong> feature described later in this chapter, external sharing can be limited to specific security groups or excluded from specific security groups.</p>
    <p class="book-title--packt">In this example, Jennifer from the BI team is responsible for sharing a dashboard with Brett from the Canada sales team and another person, Jack, from outside the organization. Brett will need the ability to share the dashboard with a few members of his team.</p>
    <h2 id="calibre_link-1982" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create a dedicated workspace in the Power BI service.</li>
      <li class="calibre12">Set the privacy level of the workspace to allow members to edit content and add team members to the workspace.</li>
      <li class="calibre12">Create a security role in Power BI Desktop for the <strong class="screentext">Canada sales team</strong>.</li>
      <li class="calibre12">Publish the Power BI Desktop file to the workspace and add members or security groups to the <strong class="screentext">Canada sales team</strong> role.<p class="packt_figref">By using security roles, an existing Power BI Sales dataset containing sales for other countries can be used for the dashboard. Brett will be allowed to share the dashboard, but RLS will prevent him and those mapped to the security role via security groups from viewing sales data for other countries. See <em class="italic">Chapter 8</em>, <em class="italic">Implementing Dynamic User-Based Visibility in Power BI</em>, for details on configuring RLS.</p>
      </li>
      <li class="calibre12">Create new Power BI Desktop report files with live connections to the published dataset in the workspace.</li>
      <li class="calibre12">Build essential visualizations in each file and publish these reports.</li>
      <li class="calibre12">In the Power BI service, create a new dashboard, <strong class="screentext">Canada Sales Dashboard</strong>, and pin visuals from reports, and adjust the layout.</li>
      <li class="calibre12">Click on <strong class="screentext">Share</strong> from the <strong class="screentext">Canada Sales Dashboard</strong> in the workspace of the Power BI service.<figure class="mediaobject"><img src="images/000266.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.9: Sharing the Canada Sales dashboard</p>
      </li>
      <li class="calibre12">Add Brett, the <a id="calibre_link-183" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>external user, and optionally a message on the <strong class="screentext">Share dashboard</strong> form.<figure class="mediaobject"><img src="images/000277.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.10: Share dashboard form in the Power BI service</p>
        <p class="packt_figref">Power BI will detect and attempt to auto-complete as email addresses are entered in the Grant access to input box. Additionally, though sharing dashboards is sometimes referred to as peer-to-peer sharing, a list of email addresses can be pasted in, and all common group entities are supported, including distribution lists, security groups, and Office 365 groups. Per the image, a warning will appear if a user external to the organization is entered.</p>
      </li>
      <li class="calibre12">In this example, leave the <strong class="screentext">Allow recipients to share this dashboard</strong> option enabled below the message. Click on <strong class="screentext">Grant Access.</strong></li>
    </ol>
    <p class="book-title--packt">If left enabled on the share form, recipients will receive an email notification as well as a notification in Power BI.</p>
    <figure class="mediaobject"><img src="images/000290.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.11: Notification center in the Power BI service of the dashboard recipient</p>
    <p class="book-title--packt">For the recipient, the dashboard appears in the <strong class="screentext">Shared with me</strong> tab. If enabled by the dashboard owner (and if the user is internal to the organization), the option to reshare the dashboard with others is enabled. The user will be able to favorite the dashboard, access it from the<a id="calibre_link-184" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Power BI mobile app, and interact with the content, such as filtering selections, but cannot edit the report or dashboard. </p>
    <h2 id="calibre_link-1983" class="calibre8">How it works...</h2>
    <p class="book-title--packt">Content should always be distributed from workspaces and not <strong class="screentext">My Workspace</strong>. Even in relatively informal scenarios such as sharing a dashboard with one user, sharing a dashboard from <strong class="screentext">My Workspace </strong>creates a dependency on the single user (Jennifer in this case) to maintain the content. Sharing the content from a workspace with multiple members of the BI team addresses the risk of Jennifer not being available to maintain the content and benefits from Microsoft's ongoing investments in administration and governance features for workspaces.</p>
    <p class="book-title--packt">Members of the workspace with edit rights can disable reshares of the dashboard and stop sharing altogether. To edit rights, open the dashboard, click on <strong class="screentext">Share</strong>, click the ellipsis (<strong class="screentext">â¦</strong>), and then <strong class="screentext">Manage permissions</strong> to identify and optionally revise the current access.</p>
    <figure class="mediaobject"><img src="images/000302.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.12: Share dashboard, Manage permissions</p>
    <p class="book-title--packt">In the <strong class="screentext">Manage permissions</strong> pane, click <strong class="screentext">Advanced</strong> at the bottom and then click on the <strong class="screentext">Direct access</strong> tab. Here<a id="calibre_link-1984" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> you can add users, edit permissions and remove access as shown in <em class="italic">Figure 12.13</em>.</p>
    <figure class="mediaobject"><img src="images/000314.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.13: Sharing and access options</p>
    <h2 id="calibre_link-1985" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Sharing reports in the Power BI service operates identically as sharing dashboards in terms of the user interface. The only difference is that the process starts on a report page in the service rather than a dashboard.</p>
    <p class="book-title--packt">Datasets can also be shared by providing read access to the dataset specifically. This is done by clicking the three vertical dots next to a dataset either in the left-hand navigation pane or when viewing the <strong class="screentext">Datasets + dataflows</strong> pane of a workspace.</p>
    <h2 id="calibre_link-1986" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Share Power BI reports and dashboards with coworkers and others: <a href="https://bit.ly/3f99llw" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3f99llw</span></a></li>
      <li class="bullet">Ways to collaborate and share in Power BI: <a href="https://bit.ly/3tylUMv" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3tylUMv</span></a> </li>
    </ul>
    <h1 id="calibre_link-1301" class="title">Configuring Workspaces</h1>
    <p class="book-title--packt">Workspaces (formerly<a id="calibre_link-1164" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> App workspaces) are shared areas in the Power BI service for Power BI Pro users to develop content. The datasets, reports, and dashboards contained within workspaces can be published as a Power BI app for distribution to groups of users. Additionally, workspaces can be assigned to Power BI Premium capacities of dedicated hardware to enable all users, regardless of license, to consume the published app and to provide consistent performance and greater scalability. Furthermore, workspaces retain a one-to-one mapping to published apps, enabling members and administrators of workspaces to stage and test iterations prior to publishing updates to apps.</p>
    <p class="book-title--packt">Understanding the history of workspaces is beneficial when reading various historical documentation on the subject. When Power BI was first released, the service included the concept of workspaces. However, these workspaces were tied to Office 365 groups and had various limitations. Microsoft released an update to group workspaces and named these new workspaces. Traditional workspaces were labeled <strong class="screentext">Classic workspaces</strong>. Today, all new workspaces are workspaces and are now known simply as <strong class="screentext">workspaces</strong> since Classic workspaces have been all but phased out. While this may all seem a bit Istanbul, not Constantinople, just understand that when reading blog posts and other information that refers to workspaces, that this simply means the modern workspace experience in the Power BI service.</p>
    <p class="book-title--packt">In this recipe, a workspace is created and configured. Within the recipe and in the supporting sections, all primary considerations are identified, including the scope or contents of workspaces and the assignment of workspaces to premium capacity.</p>
    <h2 id="calibre_link-1987" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Confirm that Power BI Pro licenses are available to administrators and members of the workspace.</li>
      <li class="calibre12">Ensure that the workspace aligns with the policy or standard of the organization for Power BI content distribution.</li>
      <li class="calibre12">If premium capacity has been provisioned but not bulk assigned to all workspaces of an organization, determine if the new workspace will be hosted in a premium capacity.</li>
      <li class="calibre12">If Premium capacity has been provisioned and authorized for the new workspace, evaluate the current utilization of premium capacity, and determine if the expected workload of datasets and user queries from the new app deployment will require a larger or separate capacity. In addition, confirm that the workspace administrator has workspace assignment permission, or assign this permission in the Power BI admin portal per the first step in <em class="italic">How to do it...</em>.</li>
      <li class="calibre12">Retrieve your Power BI tenant's UTC offset by clicking the question mark (?) icon in the upper-right corner of the Power BI service and choose <strong class="screentext">About Power BI</strong>. The UTC offset is <a id="calibre_link-1165" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>shown in <em class="italic">Figure 12.14</em>, in this case -0400:<figure class="mediaobject"><img src="images/000326.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 14: UTC offset of Power BI tenant</p>
      </li>
      <li class="calibre12">Retrieve the Premium capacity ID from the <strong class="screentext">Capacity settings</strong> of the admin portal in the Power BI service.</li>
      <li class="calibre12">While in <strong class="screentext">Capacity settings</strong>, click the gear icon under <strong class="screentext">Actions</strong> for the desired capacity and note the <strong class="screentext">CAPACITY ID</strong>.</li>
      <li class="calibre12">From a workspace in the Power BI service, select <strong class="screentext">Get data</strong> from the lower-left corner of the screen.</li>
      <li class="calibre12">In the <strong class="screentext">Services</strong> section, click the <strong class="screentext">Get</strong> button.</li>
      <li class="calibre12">Search for <strong class="screentext">Premium</strong> and choose the <strong class="screentext">Premium Gen2 Capacity Utilization Metrics</strong> app.</li>
      <li class="calibre12">On the <strong class="screentext">AppSource</strong> page for the template app, click the <strong class="screentext">Get it Now</strong> button as shown in <em class="italic">Figure 12.15</em>:<figure class="mediaobject"><img src="images/000337.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.15: Premium Gen2 Capacity Utilization Metrics App in AppSource</p>
      </li>
      <li class="calibre12">Fill in the contact <a id="calibre_link-1166" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>information, accept the terms and conditions, and click the <strong class="screentext">Continue</strong> button.</li>
      <li class="calibre12">Click the radio button for <strong class="screentext">Install to a new workspace</strong>, provide a workspace name, and then click the <strong class="screentext">Install</strong> button to install the app.</li>
    </ol>
    <p class="book-title--packt">This completes the steps to prepare for this recipe.</p>
    <h2 id="calibre_link-1988" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the new workspace and choose <strong class="screentext">Apps</strong> from the navigation pane in the Power BI service.</li>
      <li class="calibre12">Click on the <strong class="screentext">Gen2 Utilization Metrics</strong> app.</li>
      <li class="calibre12">At the top of the screen, click on <strong class="screentext">Connect your data</strong> as shown in <em class="italic">Figure 12.16</em> below:<figure class="mediaobject"><img src="images/000349.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.16: Gen2 Utilization Metrics prompt to Connect your data</p>
      </li>
      <li class="calibre12">Enter the <strong class="screentext">CapacityId</strong> and other information requested by the app and click the <strong class="screentext">Next</strong> button.<figure class="mediaobject"><img src="images/000360.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.17: Connect to Gen2 Utilization Metrics</p>
      </li>
      <li class="calibre12">On the next<a id="calibre_link-1167" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> screen, choose <strong class="screentext">Sign in and connect</strong> and sign in to the Power BI service.</li>
      <li class="calibre12">View the recent performance of the capacity via the usage measurements for CPU, memory, and queries.</li>
      <li class="calibre12">Assuming that the capacity metrics are in order, exit the app by clicking the <strong class="screentext">Go back</strong> link in the lower-left corner of the app.</li>
      <li class="calibre12">Click on the arrow next to <strong class="screentext">Workspaces</strong> and then click on <strong class="screentext">Create a workspace</strong>.<figure class="mediaobject"><img src="images/000371.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.18: Create a workspace in the Power BI service</p>
        <p class="packt_figref">Workspaces<a id="calibre_link-1989" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> assigned to premium capacity are identified with a diamond icon in the Power BI service.</p>
      </li>
      <li class="calibre12">Provide a workspace name, expand the <strong class="screentext">Advanced</strong> section, choose a <strong class="screentext">License</strong> <strong class="screentext">mode</strong> of <strong class="screentext">Premium per capacity</strong> and select a capacity.<figure class="mediaobject"><img src="images/000382.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.19: Creating a Premium workspace</p>
      </li>
      <li class="calibre12">Click <a id="calibre_link-1168" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Save</strong> button to create the workspace.</li>
      <li class="calibre12">In the workspace, click the <strong class="screentext">Access</strong> link in the header to add workspace members.</li>
    </ol>
    <p class="book-title--packt">Workspace members can now publish datasets and reports and create dashboards to distribute via an app. Technically it is possible to add members to a view-only group and assign developers to the role of workspace admin such that they can edit content. This method of collaboration is not recommended, as the view-only members will have immediate visibility of all changes, as with sharing dashboards. Published apps from workspaces provide for staging deployments and are the recommended solution for distributing content to read-only members.</p>
    <h2 id="calibre_link-1990" class="calibre8">How it works...</h2>
    <p class="book-title--packt">Per the <em class="italic">Preparing for Content Creation and Collaboration </em>recipe earlier in this chapter, workspaces have a one-to-one mapping to apps and can have a wide scope (for example, sales), a narrow scope such as a specific dashboard, or a balance between these two extremes, such as European sales. If broad workspaces are used, then it may not be necessary to create a new workspace for a particular project or dashboard as new content can be added to an existing workspace. However, as an increasing volume of reports and dashboards are added to workspaces, it may be beneficial to consider new, more focused <a id="calibre_link-1169" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>workspaces and revisions to the policy.</p>
    <p class="book-title--packt">Apps are simply the published versions of workspaces.</p>
    <figure class="mediaobject"><img src="images/000393.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.20: Workspaces: one-to-one relationship with published apps</p>
    <p class="book-title--packt">Users consume and interact with apps. Content is created and managed in workspaces. Consumers of apps only have visibility of published versions of apps, not the workspace content. Per the <em class="italic">Preparing for Content Creation and Collaboration</em> and <em class="italic">Managing Content between Environments</em> recipes in this chapter, not all content from a workspace has to be included in the published app.</p>
    <h2 id="calibre_link-1991" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Office 365 Global Admins and Power BI Admins are Capacity Admins of Power BI Premium capacities by default. These admins can assign users as Capacity Admins per capacity during the initial setup of the capacity and later via <strong class="screentext">Admin permissions</strong> within the <strong class="screentext">Capacity settings</strong> of a capacity in the Power BI admin portal. Capacity Admins have administrative control over the given capacity but must also be granted assignment permissions in the <strong class="screentext">Contributor permissions</strong> setting to assign workspaces to premium capacities if the capacity admin will also be responsible for associating a workspace to premium<a id="calibre_link-1992" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> capacity.</p>
    <h2 id="calibre_link-1993" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Manage Power BI Premium: <a href="http://bit.ly/2vq8WHe" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2vq8WHe</span></a></li>
      <li class="bullet">Monitor Power BI Premium capacities: <a href="https://bit.ly/3xZqp6f" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3xZqp6f</span></a></li>
    </ul>
    <h1 id="calibre_link-1302" class="title">Configuring On-Premises Gateway Data Connections</h1>
    <p class="book-title--packt">The promise <a id="calibre_link-683" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of leveraging the Power BI service and mobile application to provide access to a rich set of integrated dashboards and reports across all devices requires thoughtful configuration of both the data sources and the datasets which use those sources. For many organizations, the primary business intelligence data sources are hosted on-premises, and thus, unless Power BI reports are exclusively deployed to on-premises Power BI Report Server, the on-premises data gateway is needed to securely facilitate the transfer of queries and data between the Power BI service and on-premises systems. Additionally, the datasets which typically support many reports and dashboards must be configured to utilize an on-premises data gateway for either a scheduled refresh to import data into Power BI or to support DirectQuery and Live Connection queries generated from Power BI.</p>
    <p class="book-title--packt">This recipe contains two examples of configuring data sources and scheduled refreshes for published datasets. The first example configures two on-premises data sources (SQL Server and Excel) for an import mode Power BI dataset and schedules a daily refresh. The second example configures a separate on-premise SQL Server database for a DirectQuery Power BI dataset and sets a 15-minute dashboard tile refresh schedule.</p>
    <h2 id="calibre_link-1994" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Download, install, and configure the on-premises data gateway as per <em class="italic">Creating an On-Premises Data Gateway </em>in<em class="italic"> </em><em class="italic">Chapter 1</em><em class="italic">, Configuring Power BI Tools</em>.</li>
      <li class="calibre12">Become an administrator of the on-premises data gateway.<figure class="mediaobject"><img src="images/000405.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 12.21: Administrators of an on-premises data gateway</p>
    <p class="book-title--packt">It is strongly<a id="calibre_link-684" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> recommended to have at least two administrators for each gateway installed to provide redundancy and backup of administrative functions.</p>
    <h2 id="calibre_link-1995" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">In this example, an import mode dataset has been created with Power BI Desktop to retrieve from two on-premises data sources, a SQL Server database and an Excel file. To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Identify the server name and database name used in the Power BI Desktop file.</li>
      <li class="calibre12">Identify the full path of the Excel file.</li>
      <li class="calibre12">In the Power BI service, click on the gear icon in the top-right corner and select <strong class="screentext">Manage Gateways</strong>.</li>
      <li class="calibre12">From the <strong class="screentext">Manage Gateways</strong> interface, click on <strong class="screentext">ADD DATA SOURCE</strong> and choose <strong class="screentext">SQL Server</strong>.</li>
      <li class="calibre12">Provide an intuitive source name that won't conflict with other sources and enter the server and database names.<figure class="mediaobject"><img src="images/000417.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.22: Adding a SQL Server database as a source for an on-premises data gateway</p>
        <p class="packt_figref">The server <a id="calibre_link-1996" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and database names for the gateway must exactly match the names used in the Power BI dataset.</p>
        <p class="packt_figref">If configuring an SSAS data source (data source type = analysis services) for a gateway, ensure that the credentials used are also an SSAS server administrator for the given SSAS instance. The server administrator credential is used in establishing the connection but each time a user interacts with the SSAS data source from Power BI, their UPN (user principal name) is passed to the server via the <code class="code-in-text--packt">EffectiveUserName</code> connection property. This allows RLS roles defined in the SSAS database to be applied to Power BI users.</p>
      </li>
      <li class="calibre12">Under <strong class="screentext">Advanced Settings</strong>, check that the source uses the appropriate privacy level, such as organizational or private.</li>
      <li class="calibre12">Click on <strong class="screentext">Add</strong> and then, via the <strong class="screentext">Users</strong> tab, add users authorized to use this gateway for this data source.<figure class="mediaobject"><img src="images/000428.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.23: Successful setup of a data source for the on-premises data gateway</p>
      </li>
      <li class="calibre12">Add an additional data source for the Excel file using the file data source type.</li>
      <li class="calibre12">Like the SQL Server data source, authorize users for this gateway and this data source <a id="calibre_link-685" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>via the <strong class="screentext">Users</strong> page.</li>
      <li class="calibre12">Publish the import mode Power BI Desktop file (dataset) to a workspace in the Power BI service.</li>
      <li class="calibre12">Access the workspace and from the <strong class="screentext">Datasets + dataflows</strong> list, click on the <strong class="screentext">Schedule refresh</strong> icon for the dataset.<figure class="mediaobject"><img src="images/000439.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.24: Actions available to a published dataset in the Power BI service</p>
      </li>
      <li class="calibre12">Expand the <strong class="screentext">Gateway connection</strong> section.<p class="packt_figref">The gateway will appear as an option for data refresh if the following three criteria are met:</p>
        <ul class="calibre11">
          <li class="calibre12">The user is listed on the <strong class="screentext">Users</strong> page of the data source(s) within the gateway</li>
          <li class="calibre12">The server and database names configured in the Power BI Service for the gateway match the names used in the Power BI Desktop file</li>
          <li class="calibre12">Each data source used by the dataset is configured as a data source for the gateway</li>
        </ul>
      </li>
      <li class="calibre12">In the <strong class="screentext">Data sources included in this dataset</strong> section, use the <strong class="screentext">Maps to</strong> dropdown to<a id="calibre_link-686" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> select the configured gateway data source connection.<figure class="mediaobject"><img src="images/000450.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.25: Associating the data source with the Power BI gateway data connection</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Apply</strong> button to connect the data source to the gateway.</li>
      <li class="calibre12">Now expand the <strong class="screentext">Scheduled refresh</strong> section.</li>
      <li class="calibre12">Click the <strong class="screentext">Add another time</strong> link to add a scheduled time for the refresh to occur.</li>
      <li class="calibre12">Once you've finished adding refresh times, click the <strong class="screentext">Apply</strong> button.<figure class="mediaobject"><img src="images/000461.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 12.26: Scheduled refresh of the dataset</p>
    <p class="book-title--packt">Your dataset<a id="calibre_link-1997" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> is now scheduled to refresh.</p>
    <h2 id="calibre_link-1998" class="calibre8">How it works...</h2>
    <p class="book-title--packt">For shared capacities, there is no guarantee that scheduled refreshes will occur at the exact time they are scheduled, such as 5:00 AM in this example. The actual refresh may take place as long as 20-30 minutes after the time scheduled in the Power BI service.</p>
    <p class="book-title--packt">Data caches used by dashboard tiles are updated after refresh operations for import mode datasets (or manually). The Power BI service also caches data for report visuals and updates these caches as datasets are refreshed. Dashboard tiles can be refreshed manually in the Power BI service via the <strong class="screentext">Refresh visuals</strong> menu item (top-right, circular arrow icon). Likewise, reports can be manually refreshed from the Power BI service, but this is only relevant for DirectQuery and SSAS live connections; this does <em class="italic">not</em> initiate a refresh for an import mode dataset.</p>
    <p class="book-title--packt">Import mode datasets can be refreshed via the schedule in the Power BI service or via the REST API. Power BI data refresh APIs allow BI teams to trigger refresh operations in the Power BI service programmatically.</p>
    <p class="book-title--packt">For example, a step can be added to an existing nightly (or more frequent) data warehouse or ETL process that initiates the refresh of a Power BI dataset that uses this data source. This allows dashboards and reports in the Power BI service to reflect the latest successful refresh of the data source(s) as soon as possible. In other words, the gap or lag between the source system refresh and the Power BI dataset scheduled refresh can be reduced to the amount of time needed to refresh the dataset in the Power BI service. </p>
    <p class="book-title--packt">To trigger a <a id="calibre_link-687" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>refresh for a dataset in the Power BI service, simply make the following HTTP request:</p>
    <pre class="programlisting"><code class="hljs">POST https://api.powerbi.com/v1.0/myorg/groups/{group_id}/datasets/{dataset_id}/refreshes
</code></pre>
    <p class="book-title--packt">See the documentation on Power BI REST API authentication and the Power BI REST API reference in the <em class="italic">See also </em>section of this recipe.</p>
    <h2 id="calibre_link-1999" class="calibre8">There's more...</h2>
    <p class="book-title--packt">In this example, a Power BI Desktop file (dataset) in DirectQuery mode based on a separate on-premise SQL Server database must be deployed to the Power BI service. The intent is for the dashboards based on this dataset to be as current as possible. To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Like the import mode dataset, add the SQL Server database as a data source to the gateway.</li>
      <li class="calibre12">Assign user(s) to this data source and gateway.</li>
      <li class="calibre12">Publish the DirectQuery Power BI Desktop file (dataset) to an App Workspace in the Power BI service.<figure class="mediaobject"><img src="images/000472.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.27: Publishing a DirectQuery dataset from Power BI Desktop</p>
        <p class="packt_figref">Power BI automatically configures the dataset to use a gateway by matching the data sources configured in the PBIX file and the sources configured in the Power BI service for the gateway. The user must also be listed for the gateway.</p>
      </li>
      <li class="calibre12">Access the workspace in the Power BI service and from the datasets list, click on <strong class="screentext">Settings</strong> via the ellipsis (<strong class="screentext">...</strong>).</li>
      <li class="calibre12">Modify the <a id="calibre_link-688" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>scheduled cache refresh frequency from 1 hour to 15 minutes.<figure class="mediaobject"><img src="images/000483.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 12.28: DirectQuery dataset settings</p>
    <p class="book-title--packt">By default, the dashboard tiles are refreshed each hour for DirectQuery and Live Connection datasets. In this process, queries are sent by the Power BI service through the gateway to the dataset sources. In this scenario, the organization is comfortable with the more frequent queries, but in other scenarios simply a daily or even a weekly dashboard refresh would be sufficient to avoid adding workload to the data source.</p>
    <h2 id="calibre_link-2000" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Power BI REST API Datasets &ndash; Refresh Dataset: <a href="https://bit.ly/3xWvE6J" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3xWvE6J</span></a></li>
      <li class="bullet">Add or remove a gateway data source: <a href="https://bit.ly/3f7GvSG" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3f7GvSG</span></a></li>
      <li class="bullet">How to configure a Power BI report scheduled refresh: <a href="https://bit.ly/3evfZU7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3evfZU7</span></a></li>
    </ul>
    <h1 id="calibre_link-1303" class="title">Publishing Apps</h1>
    <p class="book-title--packt">Apps in Power BI <a id="calibre_link-79" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>are collections of related dashboards and reports from a single workspace focused on a given subject area. Apps are the recommended distribution method for larger solutions involving several distinct reporting artifacts and targeting groups of end users who only need read access.</p>
    <p class="book-title--packt">In this recipe, we demonstrate how to create and publish an app in the Power BI service.</p>
    <h2 id="calibre_link-2001" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, complete the first recipe <em class="italic">Building a Dashboard </em>in <em class="italic">Chapter 5</em>, <em class="italic">Working in the Service</em>.</p>
    <h2 id="calibre_link-2002" class="calibre8">How to do itâ¦</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the Power BI service, select a workspace, such as the workspace containing the <strong class="screentext">North American Sales</strong> dashboard created in <em class="italic">Chapter 5</em>, <em class="italic">Working in the Service, Building a Dashboard</em>.</li>
      <li class="calibre12">Toggle datasets to <strong class="screentext">No</strong> and all other items to <strong class="screentext">Yes </strong>in the <strong class="screentext">Include in app</strong> column.<figure class="mediaobject"><img src="images/000494.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.29: Workspace contents</p>
      </li>
      <li class="calibre12">Click<a id="calibre_link-80" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Create app</strong> button.</li>
      <li class="calibre12">On the <strong class="screentext">Setup</strong> tab, edit the <strong class="screentext">App name</strong> and enter a <strong class="screentext">Description</strong>. You can upload a custom <strong class="screentext">App logo</strong> and set the <strong class="screentext">App theme color</strong> and <strong class="screentext">Contact Information</strong> as well.<figure class="mediaobject"><img src="images/000004.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.30: App Setup tab</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Navigation</strong> tab.</li>
      <li class="calibre12">Use the <strong class="screentext">New</strong> dropdown and choose <strong class="screentext">Section</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">New section</strong> and change the <strong class="screentext">Name</strong> to <strong class="screentext">North America</strong>.</li>
      <li class="calibre12">Create three additional sections for <strong class="screentext">Global Sales Reports</strong>, <strong class="screentext">Customers</strong>, and <strong class="screentext">Supporting Materials</strong>.</li>
      <li class="calibre12">Move report element links into sections by clicking on the item in the <strong class="screentext">Navigation</strong> pane<a id="calibre_link-2003" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and selecting a section from the <strong class="screentext">Section</strong> dropdown.<figure class="mediaobject"><img src="images/000016.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.31: App Navigation tab</p>
      </li>
      <li class="calibre12">Select the <strong class="screentext">Permissions</strong> tab.</li>
      <li class="calibre12">Add specific individuals or groups to have access to the app and set the permissions. It is recommended that you uncheck the settings under the <strong class="screentext">Allow everyone who has app access to </strong>heading and instead control permissions at the dataset level. In addition, it is generally recommended to check the checkbox for <strong class="screentext">Install this app automatically</strong> under the <strong class="screentext">Installation </strong>heading.<figure class="mediaobject"><img src="images/000028.png" alt="Graphical user interface, text, application, email  Description automatically generated" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.32: App Permissions tab</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Publish app</strong> button <a id="calibre_link-81" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>in the lower-right corner.</li>
      <li class="calibre12">A popup with the name of the app will appear. Click the <strong class="screentext">Publish</strong> button.</li>
      <li class="calibre12">In the <strong class="screentext">Successfully published</strong> dialog, click the <strong class="screentext">Go to app</strong> button.<figure class="mediaobject"><img src="images/000040.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.33: App successfully published</p>
      </li>
      <li class="calibre12">The app will look similar to the following:<figure class="mediaobject"><img src="images/000052.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.34: Published app</p>
      </li>
      <li class="calibre12">In the<a id="calibre_link-82" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> top-left corner, click <strong class="screentext">Go back</strong>.</li>
      <li class="calibre12">In the left navigation pane, select <strong class="screentext">Apps</strong>.</li>
      <li class="calibre12">The app should be listed.<figure class="mediaobject"><img src="images/000064.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 12.35: Apps</p>
    <p class="book-title--packt">You have now built your first app!</p>
    <h2 id="calibre_link-2004" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">Apps are a content type in the Power BI service that allows multiple dashboards, reports, and workbooks to be shared and accessed in a single place. Apps are limited to a single app per workspace and while apps can contain links to content outside of the workspace, those links will not function as part of the app but rather simply transport the user to the external dashboard, report, or web address. </p>
    <p class="book-title--packt">Even with these limitations, apps are advantageous when it comes to sharing multiple content items at the same time when the designer does not want to give business users permissions to the entire workspace. Business <a id="calibre_link-83" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>users benefit by having a single link for all of the content included in the app.</p>
    <h2 id="calibre_link-2005" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Once an app is published, it can be modified. This is done from the workspace by clicking the <strong class="screentext">Update app</strong> button in the upper-right corner where the <strong class="screentext">Publish app</strong> button was located. The tabs for configuring the app are the same as when publishing, except the <strong class="screentext">Permissions</strong> tab now includes a <strong class="screentext">Links</strong> area:</p>
    <figure class="mediaobject"><img src="images/000076.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.36: Links area on the app's Permissions tab</p>
    <p class="book-title--packt">The settings for the app on all three tabs can be edited and then, once complete, simply click the <strong class="screentext">Update app</strong> button in the lower-right corner where the <strong class="screentext">Publish app</strong> button was located originally.</p>
    <p class="book-title--packt">Apps can also be unpublished. This is also done from the workspace by using the ellipsis (<strong class="screentext">â¦</strong>) and then selecting <strong class="screentext">Unpublish App</strong>.</p>
    <figure class="mediaobject"><img src="images/000088.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.37: Unpublish App</p>
    <p class="book-title--packt">As you can see, apps <a id="calibre_link-84" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>provide a flexible method of distributing content to users.</p>
    <h2 id="calibre_link-2006" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">What is a Power BI app?: <a href="https://bit.ly/3fMYsI5" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3fMYsI5</span></a></li>
      <li class="bullet">Publish an app in Power BI: <a href="https://bit.ly/39NWl2S" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/39NWl2S</span></a></li>
    </ul>
    <h1 id="calibre_link-1304" class="title">Publishing Reports to the Public Internet</h1>
    <p class="book-title--packt">The <strong class="screentext">Publish to web</strong> feature<a id="calibre_link-972" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> in the Power BI service allows <a id="calibre_link-863" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI reports to be shared with the general public by embedding the report within websites, blog posts, and sharing URL links. If the <strong class="screentext">publish to web </strong>tenant setting is enabled and if a user has edit rights to a report, an embed code can be generated containing both the HTML code for embedding the report and a URL to the report. All pages of the report, including any supported custom visuals and standard interactive functionalities such as filtering and cross highlighting, are available to consumers of the report. Additionally, the report is automatically updated to reflect refreshes of its source dataset and embed codes can be managed and optionally deleted if necessary, to eliminate access to the report via the embed code and URL.</p>
    <p class="book-title--packt">This recipe walks through the fundamental steps and considerations in utilizing the <strong class="screentext">publish to web </strong>feature.</p>
    <h2 id="calibre_link-2007" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the Power BI service, click on the gear icon in the upper-right corner and select <strong class="screentext">Admin portal</strong>.</li>
      <li class="calibre12">In <a id="calibre_link-864" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the<a id="calibre_link-973" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Admin portal, click <strong class="screentext">Tenant settings</strong>.</li>
      <li class="calibre12">Under <strong class="screentext">Export and sharing settings</strong>, find and expand <strong class="screentext">Publish to web</strong>.</li>
      <li class="calibre12">Enable <strong class="screentext">Publish to web</strong> if disabled.</li>
    </ol>
    <figure class="mediaobject"><img src="images/000101.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.38: Publish to web setting within the tenant settings of the Power BI admin portal</p>
    <p class="book-title--packt">The <strong class="screentext">publish to web</strong> feature can be either enabled or disabled for all users in the organization, enabled for specific security groups, or disabled for specific security groups. Given the real security risk posed by <strong class="screentext">Publish to web</strong>, it is highly recommended to keep this setting disabled unless the business requires this capability, and even then to limit the feature to specific security groups.</p>
    <h2 id="calibre_link-2008" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create<a id="calibre_link-865" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> a <a id="calibre_link-974" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>workspace in the Power BI service to host <strong class="screentext">Publish to web</strong> reports.</li>
      <li class="calibre12">Assign a descriptive name to the workspace that associates it to <strong class="screentext">publish to web </strong>content or publicly available data.</li>
      <li class="calibre12">Allow members to edit content and only add the individual users that require edit rights to the content.</li>
      <li class="calibre12">Create a new Power BI Desktop file that will serve as the dataset for the <strong class="screentext">publish to web</strong> report.</li>
      <li class="calibre12">Develop essential data connections, queries, model relationships, and measures to support the report.</li>
      <li class="calibre12">Save the file and publish it to the app workspace created earlier.</li>
      <li class="calibre12">Open a new Power BI Desktop file that will serve as the <strong class="screentext">publish to web </strong>report.</li>
      <li class="calibre12">Click on <strong class="screentext">Get Data</strong> and connect to the published dataset via the Power BI datasets connector.</li>
      <li class="calibre12">Develop the report including all visuals, layout, and formatting options, including page size (16:9 or 4:3).</li>
      <li class="calibre12">Name the file, save, and click on <strong class="screentext">Publish</strong>. The report will be published to the workspace of the source dataset.</li>
      <li class="calibre12">Access the workspace in the Power BI service.</li>
      <li class="calibre12">Add any new on-premises data sources to the on-premises data gateway in the manage gateways portal.</li>
      <li class="calibre12">Open the settings for the dataset, assign a gateway (if applicable), and configure a scheduled refresh.</li>
      <li class="calibre12">Open the report, click on <strong class="screentext">File, Embed report</strong>, and then<strong class="screentext"> Publish to web (public)</strong>.<figure class="mediaobject"><img src="images/000114.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.39: The Publish to web option for a report in the Power BI service</p>
      </li>
      <li class="calibre12">Click<a id="calibre_link-866" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> on <strong class="screentext"><a id="calibre_link-975" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a></strong><strong class="screentext">Create embed code</strong> and then <strong class="screentext">Publish</strong>.</li>
      <li class="calibre12">A <strong class="screentext">Success</strong>! dialog is displayed allowing you to copy the embed codes for the report.<figure class="mediaobject"><img src="images/000125.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 12.40: Successful Publish to web</p>
    <p class="book-title--packt">You are <a id="calibre_link-2009" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>now <a id="calibre_link-2010" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>ready to share the <strong class="screentext">Publish to web</strong> URL or use the HTML code in your own website.</p>
    <h2 id="calibre_link-2011" class="calibre8">How it works...</h2>
    <p class="book-title--packt">A separate workspace is not technically necessary for <strong class="screentext">publish to web</strong>, but this isolation is recommended for manageability and limiting the risk of publishing confidential or proprietary information. Similarly, Premium capacity is not required but could be appropriate for larger datasets or when more frequent data refreshes and consistent performance are important.</p>
    <p class="book-title--packt">The HTML code provided can be edited manually to improve the fit of the report on the destination for embedding. Adding 56 pixels to the height dimension can adjust the size of the bottom bar. Setting the page size in Power BI Desktop, the view mode in the Power BI service (the <strong class="screentext">View</strong> icon in the report header at the upper right), and manually adjusting the iFrame height and width values may be necessary for a perfect fit.</p>
    <p class="book-title--packt">Per <em class="italic">Figure 12.39</em>, Power BI reports can also be embedded in SharePoint Online. Clicking on <strong class="screentext">SharePoint Online</strong> provides a URL that can be used with a Power BI web part in SharePoint online. Users accessing the SharePoint online page must also have access to the report in the Power BI service.</p>
    <p class="book-title--packt">Power BI caches the report definition and the results of the queries required to view the report as users view the report. Given the cache, it can take approximately one hour before changes to the report definition or the impact of dataset refreshes are reflected in the version of the report viewed by users.</p>
    <h2 id="calibre_link-2012" class="calibre8">There's more...</h2>
    <p class="book-title--packt">All <strong class="screentext">Publish to web</strong> and other embed codes can be managed by members of the workspace where the embed code was created. In addition, all embed codes from all workspaces can be managed by administrators in a central location. To see how this is accomplished, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the Power BI service, open the workspace where the <strong class="screentext">Publish to web</strong> embed code<a id="calibre_link-867" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> was <a id="calibre_link-976" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>created. </li>
      <li class="calibre12">Click the gear icon in the upper-right corner and select <strong class="screentext">Manage embed codes</strong>.</li>
      <li class="calibre12">All embed codes created for the workspace are displayed and these codes can be retrieved or deleted using the ellipsis (<strong class="screentext">â¦</strong>).<figure class="mediaobject"><img src="images/000137.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.41: Manage embed codes interface for a workspace</p>
      </li>
      <li class="calibre12">Now click on the gear icon again and choose <strong class="screentext">Admin portal</strong>.</li>
      <li class="calibre12">In the admin portal, select <strong class="screentext">Embed Codes</strong>.</li>
      <li class="calibre12">All embed codes for all workspaces are displayed and the three vertical dots allow the reports to be viewed or the embed code deleted.<figure class="mediaobject"><img src="images/000150.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 12.42: Manage embed codes in the admin portal</p>
    <p class="book-title--packt">A <strong class="screentext">Status</strong> of <strong class="screentext">Not Supported</strong> indicates<a id="calibre_link-977" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> that one of the few unsupported<a id="calibre_link-868" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> features has been used by the report, such as RLS, SSAS tabular on premises, R visuals, or ArcGIS Maps for Power BI.</p>
    <h2 id="calibre_link-2013" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Publish to web from Power BI: <a href="https://bit.ly/3bezKxq" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3bezKxq</span></a></li>
    </ul>
    <h1 id="calibre_link-1305" class="title">Enabling the Mobile Experience</h1>
    <p class="book-title--packt">Power BI mobile <a id="calibre_link-626" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>apps have been designed to align closely with the user experience and feature set available in the Power BI service. This provides a simple, familiar navigation experience for users and allows BI and IT teams to leverage existing Power BI assets and knowledge to enhance the mobile experience in their organization.</p>
    <p class="book-title--packt">This recipe contains two processes to take advantage of Power BI's mobile capabilities. The first process helps identify "quick win" opportunities that require limited BI/IT investment to better utilize basic Power BI mobile features. The second process identifies somewhat less common yet powerful and emerging use cases for Power BI mobile applications.</p>
    <h2 id="calibre_link-2014" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Identify the most highly used dashboards and reports by opening the Power BI admin portal (gear icon: <strong class="screentext">Admin portal</strong>) and select the <strong class="screentext">Usage metrics</strong> menu item.</li>
      <li class="calibre12">Decide which<a id="calibre_link-627" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> dashboards and reports to target for mobile enhancements.<figure class="mediaobject"><img src="images/000176.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 12.43: Usage metrics in the Power BI admin portal</p>
    <p class="book-title--packt">The most consumed dashboards and packages visuals provide a summary of consumption or usage by count of users. For much more granular analysis of usage, the Microsoft 365 audit log for Power BI events can be imported and analyzed per <em class="italic">Chapter 10, Administering and Monitoring Power BI</em>. Additionally, usage metrics reports specific to individual dashboards and reports are now available in the Power BI service in the ellipsis (<strong class="screentext">â¦</strong>) menu. Though scoped to a specific item, these reports also indicate the split between web and mobile usage.</p>
    <h2 id="calibre_link-2015" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Optimize a Power BI dashboard for mobile consumption by opening the dashboard and switching to <strong class="screentext">Mobile view</strong>.<figure class="mediaobject"><img src="images/000189.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.44: Switching to Mobile view for a dashboard in the Power BI service</p>
      </li>
      <li class="calibre12">Unpin<a id="calibre_link-628" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a><a id="calibre_link-2016" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> image, text, and less mobile-friendly or relevant tiles from the Mobile view.</li>
      <li class="calibre12">Resize and organize KPIs and essential visuals at the top of the <strong class="screentext">Mobile view</strong>.<figure class="mediaobject"><img src="images/000201.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.45: Customizing the Mobile view of a dashboard in the Power BI service</p>
      </li>
      <li class="calibre12">Open the PBIX file for a report.</li>
      <li class="calibre12">Choose <strong class="screentext">Mobile layout</strong> in the ribbon of the <strong class="screentext">View</strong> tab of the most important report pages and design the custom mobile layout of the page. See <em class="italic">Chapter 4</em>, <em class="italic">Authoring Power BI Reports</em>, for details on this process.</li>
      <li class="calibre12">Publish the updated Power BI report to a workspace in the Power BI service and re-pin any dashboard tiles.</li>
      <li class="calibre12">Test the <a id="calibre_link-2017" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>mobile-optimized dashboards and reports from mobile devices.</li>
      <li class="calibre12">Publish updates from Power BI workspaces to Power BI apps containing these mobile enhancements.</li>
      <li class="calibre12">Check that <strong class="screentext">Favorites</strong> are being used for dashboards and for apps by mobile users.</li>
      <li class="calibre12">Demonstrate the process of configuring a data alert with a notification on a dashboard tile in the Power BI mobile app.<figure class="mediaobject"><img src="images/000212.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.46: Notifications of data alerts appear outside the mobile app</p>
      </li>
      <li class="calibre12">Demonstrate the annotate and share feature and related scenarios to mobile users.<figure class="mediaobject"><img src="images/000224.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.47: Annotation added to a Power BI report in Power BI mobile and shared via email</p>
        <p class="packt_figref">In this<a id="calibre_link-629" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> example, a report accessed in Power BI Mobile is lightly annotated, and a short message is shared with a colleague, requesting further analysis. A link to the report annotated is built into the shared email enabling the recipient to immediately act on the message and optionally share an annotated response that addresses the request.</p>
      </li>
      <li class="calibre12">Use the Windows 10 Power BI app in meetings and presentations.<figure class="mediaobject"><img src="images/000235.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.48: Windows 10 Power BI app</p>
        <p class="packt_figref">The Windows 10 Power BI app supports touch-enabled devices, annotations, and easy navigation controls.</p>
      </li>
      <li class="calibre12">Optimize datasets for Q&amp;A. See the recipe <em class="italic">Preparing for Q&amp;A </em>in <em class="italic">Chapter 5</em>, <em class="italic">Working in the Service</em>, for more details.</li>
      <li class="calibre12">Test<a id="calibre_link-630" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> common questions and provide users with examples and keywords to better use the feature.</li>
    </ol>
    <p class="book-title--packt">Building and optimizing mobile experiences can greatly aid in the adoption of Power BI.</p>
    <h2 id="calibre_link-2018" class="calibre8">How it works...</h2>
    <p class="book-title--packt">Only the owner of the dashboard will have the option to customize the Mobile view in the Power BI service. As per <em class="italic">Chapter 4</em>, <em class="italic">Authoring Power BI Reports</em>, the mobile layout for report pages is implemented within Power BI Desktop files. Therefore, any Power BI Pro user with access to the workspace of the report in the Power BI service and the source PBIX file(s) could optimize these reports for mobile consumption.</p>
    <p class="book-title--packt">By enabling the Responsive Visuals property for Cartesian visuals such as the column, bar, and line charts, these visuals will be optimized to display their most important elements as their size is reduced. This effectively makes it realistic to use these more dense visuals in the mobile layout for reports and mobile view for dashboards. However, it still may make sense to prioritize KPI, card, and gauge visuals in mobile layouts, given the limited space.</p>
    <p class="book-title--packt">Data alerts configured by users are only visible to those users, and there are no limits on the volume of alerts that can be configured. For example, a user may want to set two alerts for the same dashboard tile to advise of both a high and a low value. Currently, data alert and favorite activity is not stored in the Office 365 audit logs, so it's necessary to engage mobile users on these features to understand adoption levels.</p>
    <h2 id="calibre_link-2019" class="calibre8">There's more...</h2>
    <p class="book-title--packt">The Power BI team at Microsoft has provided many options for working with Power BI on mobile devices such as tablets, phones, and even watches. Examples of these options include integration with Apple Watch, the ability to connect and view on-premises Reporting Services<a id="calibre_link-631" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> reports from phones, and continuous updates to the features and functionality of the Power BI mobile application for iOS and Android devices.</p>
    <p class="book-title--packt">Power BI dashboards can be synchronized with the Apple Watch via the Power BI for iOS application.</p>
    <figure class="mediaobject"><img src="images/000248.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.49: Index Screen (left) and the In-Focus Tile (right) of the Power BI mobile app on the Apple Watch</p>
    <p class="book-title--packt">Simply open a dashboard in Power BI for iOS, click on the ellipsis (<strong class="screentext">...</strong>) and then click on <strong class="screentext">Sync with watch</strong>. Only card and KPI tiles are supported, but Apple Watch faces can be configured to display one of the Power BI tiles.</p>
    <p class="book-title--packt">SSRS reports can be accessed and viewed from the Power BI mobile apps by tapping your profile image icon in the upper-left corner of the app and then <strong class="screentext">Connect to server</strong>.</p>
    <figure class="mediaobject"><img src="images/000259.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 12.50: Navigation menu in Power BI Mobile with connection to a report server</p>
    <p class="book-title--packt">As you can see, Power <a id="calibre_link-632" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>BI has wide support for a variety of different mobile devices.</p>
    <h2 id="calibre_link-2020" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Microsoft Power BI on the Apple App Store: <a href="https://apple.co/2R6kaNs" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://apple.co/2R6kaNs</span></a></li>
      <li class="bullet">Power BI mobile apps documentation: <a href="https://bit.ly/33wKWB3" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/33wKWB3</span></a></li>
      <li class="bullet">View on-premises report server reports and KPIs in Power BI Mobile: <a href="http://bit.ly/2noIloX%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2noIloX</span></a></li>
    </ul>
    <h1 id="calibre_link-1306" class="title">Distributing Content with Teams</h1>
    <p class="book-title--packt">Microsoft<a id="calibre_link-172" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> Teams is a unified platform for collaboration<a id="calibre_link-1095" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> and communication, combining video meetings, phone calls, file storage, persistent workplace chat, and application integration into a unified interface. Teams is a part of the Microsoft 365 office productivity suite, integrating natively with Word, PowerPoint, Excel, and SharePoint Online. In addition, feature extensions provide support for integrating with third-party applications.</p>
    <p class="book-title--packt">Microsoft Teams has seen explosive growth in recent years, particularly during the pandemic in 2020. In fact, between March and June 2020, Microsoft Teams had nearly 900% growth. For over half a million organizations, Microsoft Teams has become an essential tool used daily to drive communication and collaboration. It is no surprise then that Microsoft has recently released integration between Power BI and Teams that enables Teams to act as a distribution channel for dashboards, reports, and other content.</p>
    <p class="book-title--packt">This recipe demonstrates how to utilize Teams to distribute and collaborate on Power BI content.</p>
    <h2 id="calibre_link-2021" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Ensure that you have published a report, dashboard, or app to the Power BI service.</li>
      <li class="calibre12">Open Microsoft Teams and join or create a team.</li>
    </ol>
    <p class="book-title--packt">You are now prepared to complete this recipe.</p>
    <h2 id="calibre_link-2022" class="calibre8">How to do itâ¦</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Within Teams, select <strong class="screentext">Teams</strong> in the navigation pane and then select a channel within a team.</li>
      <li class="calibre12">In the team's header area (tabs), select the plus icon (<strong class="screentext">+</strong>) to <strong class="screentext">Add a tab</strong>.<figure class="mediaobject"><img src="images/000270.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.51: Add a tab in Microsoft Teams</p>
      </li>
      <li class="calibre12">Within the <strong class="screentext">Add a tab</strong> dialog, search for <em class="italic">power bi</em> and select the Power BI app.<figure class="mediaobject"><img src="images/000282.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.52: Add a Power BI tab in Microsoft Teams</p>
      </li>
      <li class="calibre12">In the <a id="calibre_link-1096" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power<a id="calibre_link-173" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> BI dialog, select a dashboard or report from <strong class="screentext">Workspaces</strong>, <strong class="screentext">Apps</strong>, or <strong class="screentext">Shared with me</strong>.<figure class="mediaobject"><img src="images/000295.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.53: Adding Power BI content to Teams</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Save</strong> button.</li>
      <li class="calibre12">The report or <a id="calibre_link-2023" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>dashboard name is added as a tab for<a id="calibre_link-2024" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the team.</li>
      <li class="calibre12">If <strong class="screentext">Post to the channel about this tab</strong> is checked, a post appears in the <strong class="screentext">Posts</strong> tab of the <strong class="screentext">General</strong> channel.</li>
    </ol>
    <p class="book-title--packt">Congratulations on publishing your first Power BI report to Teams!</p>
    <h2 id="calibre_link-2025" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">Adding a Power BI tab in Teams does not generate an embed code like <strong class="screentext">Publish to web</strong> or embedding in SharePoint online but rather uses Teams' feature extension capabilities to integrate with Power BI. Additionally, the creation of a Power BI tab in Teams does not grant permissions to the dashboard or report distributed via Teams. Members of the given Team must be granted permissions to the Power BI content via the Power BI service.</p>
    <h2 id="calibre_link-2026" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">Adding Power BI tabs to teams within Microsoft Teams is not the only way that Power BI is integrated with Microsoft Teams. Two additional integrations exist, <strong class="screentext">Chat in Teams</strong> and pinning the Power BI Windows 10 app to the Teams navigation pane. To see how these<a id="calibre_link-1097" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> additional <a id="calibre_link-174" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>integrations work, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Log in to the Power BI service and open a dashboard, report, or app.</li>
      <li class="calibre12">In the header bar, click <strong class="screentext">Chat in Teams</strong>.<figure class="mediaobject"><img src="images/000307.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.54: Chat in Teams</p>
      </li>
      <li class="calibre12">Search for a Team or a Channel to share a link to the Power BI content.<figure class="mediaobject"><img src="images/000319.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.55: Share to Microsoft Teams</p>
      </li>
      <li class="calibre12">Click<a id="calibre_link-175" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the <strong class="screentext">Share</strong> button.</li>
      <li class="calibre12">A post <a id="calibre_link-1098" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>containing a link to the Power BI content is posted to the <strong class="screentext">Posts</strong> tab of the selected team and channel.<figure class="mediaobject"><img src="images/000331.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.56: Power BI report link shared to Teams Posts tab</p>
      </li>
      <li class="calibre12">In Teams, select<a id="calibre_link-2027" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> the ellipsis (<code class="code-in-text--packt">â¦</code>) from the navigation<a id="calibre_link-2028" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a> pane and search for <em class="italic">power bi</em>.<figure class="mediaobject"><img src="images/000342.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 12.57: Adding the Power BI app in Teams</p>
      </li>
      <li class="calibre12">Select the Power BI app and then click the <strong class="screentext">Add</strong> button.</li>
      <li class="calibre12">The Power BI app is now pinned to the Teams navigation bar.<figure class="mediaobject"><img src="images/000354.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 12.58: The Power BI app in Teams</p>
    <p class="book-title--packt">As you can see, there <a id="calibre_link-176" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>are many integration points between <a id="calibre_link-1099" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI and Teams.</p>
    <h2 id="calibre_link-2029" class="calibre8">See Also</h2>
    <ul class="calibre9">
      <li class="bullet">Collaborate in Microsoft Teams with Power BI: <a href="https://bit.ly/2QYrXgl" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2QYrXgl</span></a></li>
      <li class="bullet">Add the Power BI app to Microsoft Teams: <a href="https://bit.ly/2RD8ly8" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2RD8ly8</span></a></li>
    </ul>
    <h1 id="calibre_link-1307" class="title">Conclusion</h1>
    <p class="book-title--packt">This chapter contained detailed examples and considerations for deploying and distributing Power BI content via the Power BI service and Power BI mobile applications. This included the creation and configuration of app workspaces and apps, procuring and assigning Power BI Premium capacities, configuring data sources and refresh schedules, and deriving greater value from Power BI mobile applications. Additionally, processes and sample architectures were shared, describing staged deployments across development and production environments and multi-node premium capacity deployments.</p>
    <p class="book-title--packt">In the next chapter, we will explore integrating Power BI with other applications, including SQL Server Reporting Services, Excel, PowerPoint, Azure Analysis Services, Dataverse, Dynamics 365, and more!</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-13">
<div id="calibre_link-2030" class="calibre2">
<div id="calibre_link-2031" class="calibre3"><div id="calibre_link-2032" class="calibre4">
    <h1 class="heading">13</h1>
    <h1 id="calibre_link-1308" class="title">Integrating Power BI with Other Applications</h1>
    <p class="book-title--packt">Power BI tools and services including Power BI Desktop, the Power BI web service, and Power BI mobile applications form a modern, robust business intelligence and analytics platform by themselves. Power BI Premium further extends the scalability and deployment options of Power BI solutions, enabling organizations to deliver Power BI content to large groups of users via apps in the Power BI service, embedded within custom applications, the on-premises Power BI Report Server, or some combination of these distribution options.</p>
    <p class="book-title--packt">However, many organizations either already have extensive self-service and corporate BI assets and skills in other tools, such as Excel, Analysis Services (Azure Analysis Services (AAS) or SQL Server Analysis Services (SSAS)), and SQL Server Reporting Services (SSRS), or are interested in utilizing the unique features of these tools as part of their Power BI solutions. As one example, an organization may choose to keep many existing Excel reports in Excel rather than convert them to Power BI reports given the unique features of Excel such as cube formulas. Similarly, some organizations may continue to use an existing AAS resource for semantic models rather than migrate these models to Power BI Premium for some time due to significant reporting dependencies on these models. Moreover, given the many additional features and benefits of Power BI datasets, organizations with legacy Excel-based Data Models (formerly Power Pivot) may choose to migrate these assets to Power BI.</p>
    <p class="book-title--packt">The recipes in this chapter highlight powerful integration points between Power BI, SSRS, Analysis Services, Excel, PowerPoint, Power Apps, and Power Automate. In this chapter, we will cover the following recipes:</p>
    <ul class="calibre9">
      <li class="bullet">Integrating SSRS and Excel</li>
      <li class="bullet">Migrating from Power Pivot for Excel to Power BI</li>
      <li class="bullet">Accessing and Analyzing Power BI Datasets in Excel</li>
      <li class="bullet">Building Power BI Reports into PowerPoint Presentations</li>
      <li class="bullet">Connecting to Azure Analysis Services</li>
      <li class="bullet">Integrating with Power Automate and Power Apps</li>
      <li class="bullet">Leveraging Dataverse and Dynamics 365</li>
      <li class="bullet">Connecting Dynamics 365 Finance and Operations and the Power Platform</li>
    </ul>
    <p class="book-title--packt">At the end of this chapter you will have a firm understanding of how Power BI works and integrates with other Microsoft technologies.</p>
    <h1 id="calibre_link-1309" class="title">Technical Requirements</h1>
    <p class="book-title--packt">The following are required to complete the recipes in this chapter:</p>
    <ul class="calibre9">
      <li class="bullet">Power BI Desktop</li>
      <li class="bullet">Excel</li>
      <li class="bullet">Visual Studio</li>
      <li class="bullet">SQL Server with the <strong class="screentext">AdventureWorksDW2019</strong> database installed. This database and instructions for installing it are available here: <a href="http://bit.ly/2OVQfG7" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2OVQfG7</span></a></li>
      <li class="bullet">Files for this chapter can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://github.com/PacktPublishing/Microsoft-Power-BI-Cookbook-Second-Edition</span></a></li>
    </ul>
    <h1 id="calibre_link-1310" class="title">Integrating SSRS and Excel</h1>
    <p class="book-title--packt">Power BI Desktop is the primary report authoring tool for content published to the Power BI service <a id="calibre_link-1032" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>as well as for Power BI <a id="calibre_link-447" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>report visuals embedded in custom applications. However, for many organizations a significant portion of existing or legacy reporting workloads built with SSRS and Excel must be maintained. In many cases, existing SSRS and Excel reports can be converted to modern Power BI reports and dashboards but Power BI is not intended as a full replacement for all the features and use cases for these other tools. In addition to supporting paginated reports (aka SSRS reports) via Power BI Premium and data refresh of Excel reports built against Power BI datasets, the Power BI service offers further methods of integrating content from Excel and SSRS into Power BI. Additionally, given the common database engine and DAX language of Power BI, Power Pivot for Excel, and Analysis Services, BI teams can take full control of reports rendered in SSRS and Excel by authoring custom DAX queries.</p>
    <p class="book-title--packt">This recipe contains two examples of authoring and publishing content from SSRS and Excel to Power BI.</p>
    <h2 id="calibre_link-2033" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare <a id="calibre_link-1033" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for this recipe, follow <a id="calibre_link-448" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>these steps:</p>
    <ol class="calibre9">
      <li class="calibre12">If necessary, download, install, and configure Microsoft SSRS: <a href="https://bit.ly/3yfdTjk" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3yfdTjk</span></a>.</li>
      <li class="calibre12">Ensure that SSRS is configured for Power BI integration: <figure class="mediaobject"><img src="images/000365.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.1: Report Server Configuration Manager&mdash;Power BI Integration</p>
      </li>
      <li class="calibre12">The <strong class="screentext">Power BI Integration </strong>menu item is at the bottom of the list and includes the Power BI tenant name (ID). You must have configured the web service URL and web portal URL to configure this setting.</li>
      <li class="calibre12">Ensure that you have Visual Studio installed and verify that in Visual Studio you have <strong class="screentext">SQL Server Data Tools </strong>installed, the <strong class="screentext">Workload</strong> for <strong class="screentext">Data storage and processing</strong>, and the <strong class="screentext">Extension</strong> for <strong class="screentext">Microsoft Reporting Services Projects</strong>. Install the appropriate items as necessary in Visual Studio. To understand how to install Visual Studio, use this link: <a href="https://bit.ly/389eozC" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/389eozC</span></a>. </li>
    </ol>
    <p class="book-title--packt">You are now ready to complete the steps for this recipe.</p>
    <h2 id="calibre_link-2034" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement <a id="calibre_link-1034" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Create or <a id="calibre_link-449" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>identify a workspace in the Power BI service to host the report content.</li>
      <li class="calibre12">Create or identify the dashboards in this workspace that will display the report content.</li>
      <li class="calibre12">Create a new <strong class="screentext">Report Server Project</strong> in Visual Studio or open an existing one.</li>
      <li class="calibre12">Configure the <strong class="screentext">AdventureWorksDW2019</strong> database on your <strong class="screentext">SQL Server</strong> as a <strong class="screentext">Shared Data Source</strong> for the project:<figure class="mediaobject"><img src="images/000376.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.2: Report Server Project &mdash;shared data source Configuration for an SQL database</p>
      </li>
      <li class="calibre12">Right-click on the <strong class="screentext">Reports</strong> folder and choose <strong class="screentext">Add</strong> <strong class="screentext">New Report</strong>.</li>
      <li class="calibre12">Right-click <strong class="screentext">Data Sources</strong> and choose <strong class="screentext">Add Data Sourceâ¦</strong>.</li>
      <li class="calibre12">Choose the <strong class="screentext">Shared data source</strong> option, select the <strong class="screentext">Shared Data Source</strong> created in Step 4, and press the <strong class="screentext">Next&gt;</strong> button.</li>
      <li class="calibre12">Build your own query or use the following query:
        <pre class="programlisting"><code class="hljs">SELECT
  vProducts.ProductKey AS [vProducts ProductKey]
  ,vProducts.EnglishProductSubcategoryName
  ,vProducts.EnglishProductName
  ,vProducts.DaysToManufacture
  ,vProducts.Color
  ,FactInternetSales.ProductKey AS [FactInternetSales ProductKey]
  ,FactInternetSales.OrderQuantity
  ,FactInternetSales.UnitPrice
  ,FactInternetSales.DiscountAmount
  ,FactInternetSales.SalesAmount
  ,FactInternetSales.TaxAmt
  ,FactInternetSales.Freight
  ,vProducts.EnglishProductCategoryName
  ,FactInternetSales.OrderDate
FROM
  vProducts
  INNER JOIN FactInternetSales
    ON vProducts.ProductKey = FactInternetSales.ProductKey
</code></pre>
      </li>
      <li class="calibre12">Click <a id="calibre_link-1035" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">OK</strong> button to exit <strong class="screentext">Query Designer</strong> and then click the <strong class="screentext">Next&gt;</strong> button.</li>
      <li class="calibre12">Choose <strong class="screentext">Tabular </strong>and click the <strong class="screentext">Next&gt;</strong> button.</li>
      <li class="calibre12">Click <a id="calibre_link-450" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Finish&gt;&gt;</strong> button.</li>
      <li class="calibre12">Click the <strong class="screentext">Finish</strong> button.</li>
      <li class="calibre12">Remove the table created in the central design panel (design surface).</li>
      <li class="calibre12">Use the dataset to create SSRS report visuals for pinning. Charts, gauge panels, maps, and images can be pinned from SSRS to Power BI dashboards.</li>
      <li class="calibre12">Deploy the SSRS report to a report folder in the SSRS portal and confirm that it renders properly:<figure class="mediaobject"><img src="images/000398.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.3: Pin SSRS report visual to Power BI Dashboard</p>
      </li>
      <li class="calibre12">Click on <a id="calibre_link-2035" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the Power BI icon <a id="calibre_link-2036" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and then click on the chart in the report you wish to pin.</li>
      <li class="calibre12">Choose the <strong class="screentext">Workspace</strong>, the <strong class="screentext">Dashboard</strong>, and the <strong class="screentext">Frequency of updates</strong>: <figure class="mediaobject"><img src="images/000163.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.4: Pin to Power BI from SSRS</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Pin</strong> button.</li>
      <li class="calibre12">In the <a id="calibre_link-1036" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>SSRS portal, click on <a id="calibre_link-451" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the gear icon and select <strong class="screentext">My subscriptions</strong> to confirm the <strong class="screentext">Power BI Dashboard</strong> subscription:<figure class="mediaobject"><img src="images/000422.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.5: My subscriptions in SSRS</p>
      </li>
      <li class="calibre12">In the Power BI service, adjust the size, position, and optionally the title and subtitle of the dashboard tile.</li>
      <li class="calibre12">Click on the dashboard tile to test that the URL opens the report in the SSRS portal. Set the link to open in a separate tab.</li>
    </ol>
    <p class="book-title--packt">This recipe is now complete.</p>
    <h2 id="calibre_link-2037" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">Microsoft has been clear that Power BI and SSRS are designed for unique BI workloads and scenarios and organizations can choose the tool that is best suited for their given projects, as well as using multiple report authoring tools within the same solution and overall BI deployment. Power BI is designed for a modern, interactive, and rich data exploration experience. </p>
    <p class="book-title--packt">SSRS, now included with Power BI Report Server, continues to deliver robust enterprise reporting capabilities with updated paginated report objects suited for operational reporting and distribution features such as subscriptions.</p>
    <p class="book-title--packt">In certain reporting scenarios, a paginated or "classic" report with a fully configured page and report layout defined in a Visual Studio SSRS project is appropriate. Additionally, for organizations that can only deploy BI on-premises or if certain BI content such as highly sensitive reports must remain on-premises, Power BI Report Server provides a single on-premises solution and portal to include both traditional SSRS reports and optionally Power BI reports as well. Finally, Power BI Premium includes the capability to deploy SSRS paginated reports to the Power BI service.</p>
    <p class="book-title--packt">Operational <a id="calibre_link-2038" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>reporting workloads <a id="calibre_link-2039" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>in which relatively simple, tabular report documents need to be distributed or made available across groups or teams in a specific file format such as PDF or Excel align well with SSRS. Paginated SSRS reports can provide a basic level of user interaction and data visualization via report parameters and charts, but this is not its strength or core use case. Note that SSRS also has a mobile report type and mobile report authoring tool in Microsoft SQL Server Mobile Report Publisher. Power BI supports individual user email subscriptions to reports, but SSRS supports data-driven report subscriptions that apply parameters to a report based on subscriber information, such as Eastern Region or Sales Managers.</p>
    <p class="book-title--packt">Future improvements to Power BI's report and dashboard subscription capabilities along with greater control over tabular and matrix visuals and Power BI Premium-dedicated hardware may position Power BI to assume a greater share of reporting workloads traditionally handled by SSRS.</p>
    <h2 id="calibre_link-2040" class="calibre8">There's more...</h2>
    <p class="book-title--packt">In addition to building integrations with SSRS, Microsoft has also integrated another popular BI tool, Excel, with Power BI. To demonstrate Excel's integration with Power BI, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Confirm that the Excel reporting content uses the Excel Data Model as its data source. Only workbooks with data models can be configured for a scheduled refresh in the Power BI service. For details on how to build an Excel report using the Excel Data Model, use this link: <a href="https://bit.ly/3j9AYOB" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3j9AYOB</span></a>.</li>
      <li class="calibre12">Identify the data source used by the Excel Data Model and add this source to the on-premises data gateway if necessary.</li>
      <li class="calibre12">Develop and test DAX queries in DAX Studio to be used as the datasets and tables in Excel.</li>
      <li class="calibre12">Open the Excel workbook containing the Data Model.</li>
      <li class="calibre12">From the <strong class="screentext">Data</strong> tab, click on <strong class="screentext">Existing Connections</strong> and select one of the queries used to <a id="calibre_link-452" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>load the data model. Choose one of the smaller dimension <a id="calibre_link-1037" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>table queries, such as <code class="code-in-text--packt">Currency</code>:<figure class="mediaobject"><img src="images/000433.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.6: Existing Connections&mdash;M Queries used to load the Data Model</p>
      </li>
      <li class="calibre12">Click on <strong class="screentext">Open</strong> in the <strong class="screentext">Existing Connections</strong> menu and then select <strong class="screentext">Table</strong> from the <strong class="screentext">Import Data</strong> dialog:<figure class="mediaobject"><img src="images/000444.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.7: Import Data: The Table option</p>
      </li>
      <li class="calibre12">An Excel <a id="calibre_link-1038" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>table reflecting the chosen query will be loaded to a worksheet.</li>
      <li class="calibre12">Right-click <a id="calibre_link-453" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>on any cell inside the imported table, and from the <strong class="screentext">Table</strong> options, select <strong class="screentext">Edit DAXâ¦</strong>:<figure class="mediaobject"><img src="images/000455.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.8: Excel table options&mdash;Edit DAXâ¦</p>
      </li>
      <li class="calibre12">From the <strong class="screentext">Edit DAX</strong> window, change the <strong class="screentext">Command Type </strong>dropdown from <strong class="screentext">Table</strong> to <strong class="screentext">DAX</strong> and paste in a DAX query in the <strong class="screentext">Expression</strong> area:<figure class="mediaobject"><img src="images/000466.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.9: DAX query to retrieve the top 15 products based on current year to date sales</p>
      </li>
      <li class="calibre12">Press <a id="calibre_link-1039" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">OK</strong> button.</li>
      <li class="calibre12">Choose <strong class="screentext">File</strong> and <a id="calibre_link-454" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>then <strong class="screentext">Publish</strong> from the Excel ribbon.</li>
      <li class="calibre12">In the <strong class="screentext">Publish</strong> dialog, choose the workspace and then click the <strong class="screentext">Upload</strong> button:<figure class="mediaobject"><img src="images/000477.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.10: Uploading the Excel Data Model to the Power BI workspace</p>
      </li>
      <li class="calibre12">Open the <a id="calibre_link-2041" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI service <a id="calibre_link-2042" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and navigate to the workspace containing the published Excel workbook.</li>
      <li class="calibre12">From the <strong class="screentext">Workbooks</strong> menu of the workspace, select the three vertical dots and then choose <strong class="screentext">Schedule refresh</strong>.</li>
      <li class="calibre12">Associate the data source with a data gateway, click on <strong class="screentext">Apply</strong>, and then schedule a data refresh:<figure class="mediaobject"><img src="images/000488.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.11: Gateway configuration for the workbook</p>
      </li>
      <li class="calibre12">Select the <a id="calibre_link-2043" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>workbook to open <a id="calibre_link-2044" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the report. Select the entire table and then click on <strong class="screentext">Pin</strong>.</li>
      <li class="calibre12">On the <strong class="screentext">Pin to Dashboard</strong> dialog, choose the dashboard and click on the <strong class="screentext">Pin</strong> button:<figure class="mediaobject"><img src="images/000499.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 13.12: Excel table in the published workbook selected&mdash;Pin to Dashboard is in the top right</p>
    <p class="book-title--packt">Very rarely would a plain table of data be used in a dashboard. In most cases, formatted Excel charts and pivot charts would be pinned to the dashboard. The purpose of these examples is not the visualization choices but rather the data retrieval methods with DAX queries. Note that custom DAX queries can be reused across Power BI datasets, Excel Data Models, and SSAS Tabular databases provided these three tools align to a common schema.</p>
    <p class="book-title--packt">While Power BI Desktop supports many of the most commonly used Excel features in addition to many other advantages, the free-form flexibility of spreadsheet formulas for complex "what-if" scenario modeling across many variables and granular (cell-specific) formatting controls <a id="calibre_link-1040" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>makes Excel the proper <a id="calibre_link-455" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>tool in certain small-scale self-service BI scenarios. Examples of this include budgeting or planning scenario tools and break-even or price sensitivity analyses. In addition, legacy data processes driven by Excel VBA macros are likely other good candidates to remain in Excel. Power BI Desktop supports parameter inputs and combined with DAX and M functions it can be customized to deliver these report types. However, parameters are not supported in the Power BI service and Power BI Desktop lacks the inherent flexibility of spreadsheet formulas and custom cell-level formatting and conditional logic.</p>
    <h2 id="calibre_link-2045" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">SQL Server Reporting Services Integration with Power BI: <a href="https://bit.ly/3y6LN9J" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3y6LN9J</span></a></li>
      <li class="bullet">Publish to Power BI from Microsoft Excel: <a href="https://bit.ly/3bnDaOl%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3bnDaOl</span></a></li>
    </ul>
    <h1 id="calibre_link-1311" class="title">Migrating from Power Pivot for Excel Data to Power BI</h1>
    <p class="book-title--packt">As Power BI has become more mature as a product and as business users become more comfortable <a id="calibre_link-826" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>with the platform, it is often <a id="calibre_link-466" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>beneficial to migrate data models (formerly Power Pivot) and M queries from Excel to Power BI. From a data management <a id="calibre_link-992" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and governance standpoint, it is preferable to consolidate data models to either Power BI and/or Analysis Services models and to limit Excel's role to ad hoc analysis such as pivot tables connected to datasets in the Power BI service via Analyze in Excel.</p>
    <p class="book-title--packt">In this brief recipe a data model and its source M queries contained in an Excel workbook are migrated to a Power BI dataset via the Import Excel Workbook to Power BI Desktop migration feature. Additional details on the workbook content imported and other options and considerations for Excel-to-Power BI migrations are included in the <em class="italic">How it works...</em> and <em class="italic">There's more...</em> sections.</p>
    <h2 id="calibre_link-2046" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">Analyze the Excel workbook to identify the components that can be imported to Power BI Desktop. For example, a table or range of data in an Excel worksheet will not be imported <a id="calibre_link-827" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>but tables in the Excel data model will be imported. Similarly, Power View report sheets in Excel and their visuals will <a id="calibre_link-467" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>be migrated but standard Excel charts, pivot tables, and worksheet formulas and formatting will not be migrated.</p>
    <p class="book-title--packt">In some <a id="calibre_link-747" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>scenarios it may be necessary to revise the Excel workbook to establish a data source connection and query that will be migrated. Additionally, it may be necessary to re-create Excel-specific report visualizations such as pivot tables and charts with Power BI Desktop report authoring visuals. Excel workbooks that contain a high level of customization such as VBA macros and complex Excel formula logic may require significant modifications to the Excel workbook or to the Power BI Desktop model or some combination of both to support a migration.</p>
    <h2 id="calibre_link-2047" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Save or download the latest Excel workbook</li>
      <li class="calibre12">Open a new Power BI Desktop (PBIX) file</li>
      <li class="calibre12">From <strong class="screentext">Report View</strong>, click <strong class="screentext">File</strong> | <strong class="screentext">Import</strong> | <strong class="screentext">Power Query, Power Pivot, Power View</strong>
        <figure class="mediaobject"><img src="images/000009.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.13: Import queries and models created in Excel to Power BI</p>
      </li>
      <li class="calibre12">Select <a id="calibre_link-2048" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the Excel file and click the <strong class="screentext">Open</strong> button</li>
      <li class="calibre12">A warning <a id="calibre_link-828" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>message appears <a id="calibre_link-468" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>advising that not all contents of the workbook are included in the import: <figure class="mediaobject"><img src="images/000021.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.14: Import warning when importing an Excel file to Power BI</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Start</strong> button</li>
      <li class="calibre12">A migration completion message will appear that breaks out the different items completed:<figure class="mediaobject"><img src="images/000033.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.15: Import Excel Model to Power BI Desktop Migration completed</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Close button</strong></li>
      <li class="calibre12">Save the <a id="calibre_link-748" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI Desktop file and use the <strong class="screentext">Model view</strong> to confirm all relationships were imported successfully</li>
      <li class="calibre12">Click <strong class="screentext">Refresh</strong> from the ribbon of the <strong class="screentext">Home</strong> tab to test that all <em class="italic">M</em> queries were imported successfully</li>
      <li class="calibre12">With <a id="calibre_link-2049" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>essential testing complete, click <strong class="screentext">Publish</strong> from the ribbon of the <strong class="screentext">Home</strong> tab and choose a workspace for the new dataset</li>
    </ol>
    <p class="book-title--packt">Your new <a id="calibre_link-469" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI dataset is now available in the Power BI service. You can even create new live connection reports against this dataset if desired.</p>
    <h2 id="calibre_link-2050" class="calibre8">How it works...</h2>
    <p class="book-title--packt">The migration may take a few minutes depending on the size of the data model imported. Power BI Desktop imports M queries, data model tables, DAX measures and KPIs, and any power view for Excel sheets.</p>
    <p class="book-title--packt">Workbooks with significant dependencies on items that do not import, such as Excel formulas, standard Excel tables (not model tables), worksheet range data, standard Excel charts, and conditional formatting, may need to remain supported in some capacity. For example, a minimum amount of data could be imported to Excel's data model to continue to drive Excel-based reports and this workbook could be uploaded to the Power BI service and refreshed. </p>
    <p class="book-title--packt">Power BI table and matrix visuals include the most important features of Excel pivot tables such as rich conditional formatting options, displaying multiple measures on rows, drill up/down hierarchies on rows and columns, controls for subtotals visibility, a stepped or staggered layout, percentage of row/column/totals, and more. These enhancements, along with the powerful cross highlighting capabilities exclusive to Power BI reports, make it feasible and advantageous to migrate most Excel pivot table-based reports to Power BI.</p>
    <p class="book-title--packt">For example, if the Power Pivot for Excel workbook contained several worksheets of pivot tables, pivot charts, and standard Excel charts, new Power BI reports containing the same metrics and attributes can be developed as alternatives. With both the data model and the reports completely migrated to Power BI, the Excel workbook can be removed from the Power BI service or any other refresh and distribution process.</p>
    <h2 id="calibre_link-2051" class="calibre8">There's more...</h2>
    <p class="book-title--packt">If certain Excel-specific content is needed despite the migration, the Power Pivot for Excel data <a id="calibre_link-2052" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>model can be uploaded to the <a id="calibre_link-829" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>same workspace and a refresh <a id="calibre_link-749" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>schedule can be configured on this workbook in the Power BI service. This can be accomplished by choosing <strong class="screentext">File</strong> and then <strong class="screentext">Publish</strong> from the Excel ribbon. Once the file is published to a workspace in the Power BI service, the Power Pivot dataset appears in the workspace's <strong class="screentext">Datasets</strong> while the Excel workbook appears in the workspace's <strong class="screentext">Workbooks</strong>. </p>
    <p class="book-title--packt">Workbooks can also be added to the Power BI service by using the <strong class="screentext">Get Data</strong> link in the lower-left corner of the service and then choosing <strong class="screentext">Files</strong>:</p>
    <figure class="mediaobject"><img src="images/000045.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 13.16: Publish Excel workbook with Data Model to Power BI&mdash;upload</p>
    <p class="book-title--packt">The <strong class="screentext">Export</strong> option in Excel is equivalent to the import migration process to Power BI Desktop from <a id="calibre_link-750" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>this recipe except that the <a id="calibre_link-470" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>new dataset is already published <a id="calibre_link-830" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to a workspace in the Power BI service. This approach to migration is not recommended, however, as you lose the ability to download the PBIX file of the created dataset from the Power BI service. Importing to Power BI Desktop first, per this recipe, maintains this option.</p>
    <h2 id="calibre_link-2053" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Import Excel workbooks into Power BI Desktop: <a href="https://bit.ly/3eI4gBG" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3eI4gBG</span></a></li>
    </ul>
    <h1 id="calibre_link-1312" class="title">Accessing and Analyzing Power BI Datasets in Excel</h1>
    <p class="book-title--packt">With a centralized and potentially certified Power BI dataset hosted in the Power BI service, Excel <a id="calibre_link-756" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>users with both Free and Pro licenses can take full advantage of Excel's familiar interface as well as advanced features <a id="calibre_link-761" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and use cases such as cube formulas and custom DAX queries. </p>
    <p class="book-title--packt">Although these Excel reports, like SSRS paginated reports, are <a id="calibre_link-461" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>only a supplement to the Power BI reports and dashboards in the Power BI service, they are often useful for scorecard layouts <a id="calibre_link-456" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>with custom formatting and many measures and columns. </p>
    <p class="book-title--packt">In this scenario, an experienced Excel user with deep business knowledge can leverage the performance, scale, and automatic refresh of the published Power BI dataset to create custom, fully formatted Excel reports. Additionally, the Excel report author has the flexibility to apply report-scoped logic on top of the dataset using familiar techniques and these customizations can inform BI teams or dataset owners of existing gaps or needed enhancements.</p>
    <p class="book-title--packt">This recipe contains two examples of accessing and analyzing Power BI datasets in Excel. The first example uses cube formulas and Excel slicers to produce an interactive template report. The second example passes a custom DAX query to the Power BI dataset to support an Excel map. Additional details on cube functions in Excel and new Excel visuals are included in the supporting sections.</p>
    <h2 id="calibre_link-2054" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Ensure that the user has a Power BI Pro license.</li>
      <li class="calibre12">Confirm that the Power BI Pro user has access to the workspace containing the Power BI report and dataset.</li>
      <li class="calibre12">Choose a report to use for the analysis. For example, if you have completed the recipes in <em class="italic">Chapter 5</em>, <em class="italic">Working in the Service</em> <strong class="screentext">CH5_R1_CountryMonthlyReport</strong> is a good choice. You can download the PBIX for this report from GitHub and publish it to the Power BI service.</li>
    </ol>
    <p class="book-title--packt">You are now ready to complete this recipe.</p>
    <h2 id="calibre_link-2055" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the chosen report in the Power BI service</li>
      <li class="calibre12">In the header/ribbon for the report, choose <strong class="screentext">Export</strong> and then <strong class="screentext">Analyze in Excel</strong></li>
      <li class="calibre12">Open the <a id="calibre_link-757" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Excel file downloaded from <a id="calibre_link-762" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the Power BI service</li>
      <li class="calibre12">Click on <a id="calibre_link-462" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the pivot table and add measures <a id="calibre_link-457" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and columns from the dataset:<figure class="mediaobject"><img src="images/000057.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.17: Excel Pivot Table with two Slicers based on the Power BI dataset</p>
      </li>
      <li class="calibre12">Select a cell within the pivot table</li>
      <li class="calibre12">Select the <strong class="screentext">OLAP Tools</strong> dropdown from the <strong class="screentext">PivotTable </strong><strong class="screentext">Analyze</strong> tab and click on <strong class="screentext">Convert to Formulas:</strong>
        <figure class="mediaobject"><img src="images/000069.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 13.18: Convert to Formulas Option in the PivotTable Analyze Tab of Excel</p>
    <h2 id="calibre_link-2056" class="calibre8">How it works...</h2>
    <p class="book-title--packt">The pivot table is converted to Excel formulas such as the following:</p>
    <pre class="programlisting"><code class="hljs">=CUBEVALUE("pbiazure://api.powerbi.com &lt;id&gt; Model",$A3,C$2, Slicer_Sales_Territory_Hierarchy)
</code></pre>
    <p class="book-title--packt">In this example, the workbook cell <strong class="screentext">C3</strong> references the <strong class="screentext">Total Net Sales</strong> measure in cell <strong class="screentext">A3</strong> and the <strong class="screentext">2011-Jan</strong> dimension value in cell <strong class="screentext">C2</strong>. Note that the two Excel slicer visuals remain connected to each <code class="code-in-text--packt">CUBEVALUE</code> formula cell and thus can be used for filtering the report. The calendar months (e.g. <code class="code-in-text--packt">2011-Jan</code>) are converted to <code class="code-in-text--packt">CUBEMEMBER</code> functions with a hard-coded <a id="calibre_link-758" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>reference to a specific value. These <a id="calibre_link-458" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>formulas must be maintained and/or updated <a id="calibre_link-763" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>by the Excel report author:</p>
    <pre class="programlisting"><code class="hljs">=CUBEMEMBER("pbiazure://api.powerbi.com &lt;id&gt; Model","[Dates].[Year Month].&amp;[2011-Jan]")
</code></pre>
    <p class="book-title--packt">The Excel <a id="calibre_link-463" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>report author(s) can quickly learn to customize the cube formulas such as applying different filters and to support changes to the report, including new metrics (rows) and attribute values (columns).</p>
    <p class="book-title--packt">The <code class="code-in-text--packt">CUBEVALUE</code> and <code class="code-in-text--packt">CUBEMEMBER</code> functions are the most common cube functions but several others can be used as well, such as <code class="code-in-text--packt">CUBESETCOUNT</code>. The <strong class="screentext">Formulas</strong> interface in Excel provides information on the arguments for each function. In more advanced scenarios, <strong class="screentext">Named Ranges</strong> can be assigned to cube formulas and optionally other formulas in the report, and then passed into cube formulas as parameters:</p>
    <pre class="programlisting"><code class="hljs">=CUBEMEMBER(strConn,"[PeriodStart].[Period Start].["&amp;SPUser&amp;"]")
</code></pre>
    <p class="book-title--packt">In this example, <code class="code-in-text--packt">strConn</code> is a <strong class="screentext">Named Range</strong> in Excel containing the name of the data connection to the Power BI dataset. <code class="code-in-text--packt">PeriodStart</code> is a column in a disconnected and hidden <code class="code-in-text--packt">PeriodStart</code> table in the data model and <code class="code-in-text--packt">SPUser</code> is a named range reflecting a business user's selection on a classic combo box form control in Excel. A separate <code class="code-in-text--packt">CUBEVALUE</code> function can reference this <code class="code-in-text--packt">CUBEMEMBER</code> function such that user selections in simple Excel controls can be passed via cube functions to the source dataset and reflected in the report.</p>
    <h2 id="calibre_link-2057" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Once Analyze <a id="calibre_link-2058" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>in Excel has created the connection <a id="calibre_link-2059" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>between the Power BI dataset and Excel, this <a id="calibre_link-2060" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>connection can be used to create additional <a id="calibre_link-2061" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>report elements. To see how this is done, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">In the same Excel workbook opened locally, create a <strong class="screentext">New sheet</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">Existing Connections</strong> from the ribbon of the <strong class="screentext">Data</strong> tab.</li>
      <li class="calibre12">In the <strong class="screentext">Existing Connections</strong> dialog, select the Power BI connection and select the <strong class="screentext">Open</strong> button.</li>
      <li class="calibre12">In the <strong class="screentext">Import Data</strong> dialog, choose <strong class="screentext">PivotTable</strong> <strong class="screentext">Report</strong> and then select the <strong class="screentext">OK</strong> button.</li>
      <li class="calibre12">Create a simple pivot table report with one measure and one attribute such as <strong class="screentext">Internet Net Sales</strong> by <strong class="screentext">Product Category</strong>.<figure class="mediaobject"><img src="images/000081.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.19: Excel pivot table based on the Power BI service dataset</p>
      </li>
      <li class="calibre12">Double-click on one of the measure cells such as <strong class="screentext">$339,773</strong> to execute a "drill-through" query. All columns of the underlying <strong class="screentext">Internet Sales</strong> fact table will be retrieved filtered by the <strong class="screentext">Clothing</strong> category.<figure class="mediaobject"><img src="images/000093.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.20: Excel table result from drill through</p>
      </li>
      <li class="calibre12">Select <a id="calibre_link-764" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a cell in <a id="calibre_link-464" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the Excel <a id="calibre_link-759" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>table and right-click <a id="calibre_link-459" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and choose <strong class="screentext">Table</strong> and then <strong class="screentext">Edit Query...</strong>.<figure class="mediaobject"><img src="images/000106.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.21: Excel Table Options</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">Command Text</strong><strong class="screentext"> </strong>area, enter (or paste) a custom DAX query and click on <strong class="screentext">OK</strong>.<figure class="mediaobject"><img src="images/000119.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.22: DAX Query pasted from DAX Studio into the Command Text area of the Edit OLE DB Query dialog</p>
      </li>
      <li class="calibre12">If the <a id="calibre_link-760" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>query is valid, the Excel table will <a id="calibre_link-465" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>update to return the columns specified <a id="calibre_link-460" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>in the query.</li>
      <li class="calibre12">Visuals, such <a id="calibre_link-765" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>as a map visual, can use this table (DAX query) as their data source.<figure class="mediaobject"><img src="images/000130.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 13.23: Excel table results from the DAX query (left) and Excel maps visual (right)</p>
    <p class="book-title--packt">The number of rows to retrieve can be adjusted in the <strong class="screentext">OLAP Drill Through </strong>property in <strong class="screentext">Connection Properties</strong>. A custom data label format is applied to the visual to express the values in thousands with one decimal place. Note that the default pivot table could not be used as the source for this visual or several other new Excel visuals.</p>
    <h2 id="calibre_link-2062" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Analyze in Excel: <a href="https://bit.ly/3bIMSeM" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3bIMSeM</span></a></li>
      <li class="bullet">CUBEVALUE function: <a href="https://bit.ly/3DfftUA" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3DfftUA</span></a></li>
      <li class="bullet">CUBEMEMBER function: <a href="https://bit.ly/3AXr1Kq" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3AXr1Kq</span></a></li>
    </ul>
    <h1 id="calibre_link-1313" class="title">Building Power BI Reports into PowerPoint Presentations</h1>
    <p class="book-title--packt">Microsoft PowerPoint remains a standard slide presentation application and the integration <a id="calibre_link-807" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>of data analyses <a id="calibre_link-836" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and visualizations from external tools is very commonly an essential component of effective presentation decks. In response to the volume of customer requests, the Power BI service supports the ability to export Power BI reports as PowerPoint files. Each page of the Power BI report is converted into an independent PowerPoint slide and the Power BI service creates a title page based on the report and relevant metadata, such as the last refreshed date. There are certain current limitations, such as the static nature of the exported file and the visuals supported, but the feature is available to all Power BI users to streamline the creation of presentation slides. However, even deeper integration is planned for the future, including the ability to embed dynamic Power BI reports into PowerPoint.</p>
    <p class="book-title--packt">This recipe contains a preparation process to better leverage the Export to PowerPoint feature and to avoid current limitations. Additionally, a sample process is described of a user exporting a Power BI report from a published app and accessing the content in PowerPoint.</p>
    <h2 id="calibre_link-2063" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Log in to the Power BI service.</li>
      <li class="calibre12">Click the gear icon in the upper-right corner and choose <strong class="screentext">Admin portal</strong>.</li>
      <li class="calibre12">Click on <strong class="screentext">Tenant settings</strong>.</li>
      <li class="calibre12">Under <strong class="screentext">Export and sharing</strong>, enable the <strong class="screentext">Export reports as PowerPoint presentations or PDF documents</strong> feature in the Power BI admin portal:<figure class="mediaobject"><img src="images/000142.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.24: Tenant settings in the Power BI admin portal</p>
        <p class="packt_figref">As per <a id="calibre_link-808" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the preceding <a id="calibre_link-837" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>screenshot, the Power BI admin or Office 365 global admin can also limit the feature to specific security groups.</p>
      </li>
      <li class="calibre12">Identify the Power BI report that will serve as the source of the PowerPoint to be created and its dataset.</li>
      <li class="calibre12">If the report contains many pages, count the number of report pages. Currently reports with over 15 pages cannot be exported.</li>
      <li class="calibre12">Determine whether any report visuals are not supported, including R visuals and custom visuals that have not been certified.</li>
      <li class="calibre12">Check whether any background images are used in the report visuals or if any custom page sizes have been set. It is best to avoid both background images and custom page sizes.</li>
      <li class="calibre12">Based on previous steps and initial tests of the export, either apply revisions to the existing report or create a separate report (using the current report as a starting point) that will be dedicated to PowerPoint.</li>
    </ol>
    <p class="book-title--packt">You are now ready to complete the steps for this recipe.</p>
    <h2 id="calibre_link-2064" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the report in the Power BI service.</li>
      <li class="calibre12">From <a id="calibre_link-838" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the report header, choose <strong class="screentext">Export</strong> and then <strong class="screentext">PowerPoint</strong>.<figure class="mediaobject"><img src="images/000168.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.25: Export to PowerPoint</p>
      </li>
      <li class="calibre12">An <strong class="screentext">Export</strong> dialog <a id="calibre_link-809" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>provides options, click the <strong class="screentext">Export</strong> button.<figure class="mediaobject"><img src="images/000410.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.26: Export options for PowerPoint</p>
      </li>
      <li class="calibre12">A message will indicate that the export is in progress and may take a few minutes.</li>
      <li class="calibre12">Open the PowerPoint file and make additional adjustments as needed in PowerPoint.<figure class="mediaobject"><img src="images/000217.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 13.27: An exported Power BI report in Slide Sorter view of Microsoft PowerPoint</p>
    <p class="book-title--packt">As you can see, exporting to PowerPoint is quite easy!</p>
    <h2 id="calibre_link-2065" class="calibre8">How it works...</h2>
    <p class="book-title--packt">Depending on the browser and its download settings, either the file is downloaded to a specific path <a id="calibre_link-810" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>or the browser <a id="calibre_link-839" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>displays a message for saving or opening the PowerPoint file. A title page is generated automatically by the export process, containing the name of the report and a link to the report in the Power BI service. The title page also includes a last data refresh and a downloaded at date and time value. Each report page is converted into a slide that contains a high-quality, rendered image of the report page. Any <strong class="screentext">Alt Text</strong> specified for visuals is included in the <strong class="screentext">Notes</strong> for each page.</p>
    <p class="book-title--packt">Similar to other planning and precautions with highly visible content such as executive dashboards, it is important to obtain knowledge and confidence in the data sources, refresh process, data quality, and ownership. For example, if the source dataset retrieves from multiple sources including ad hoc Excel files and has a history of refresh failures then the report might not be a good candidate for a PowerPoint presentation. A report based on an IT-managed Analysis Services model that has already been validated and has a clear owner would be a better choice.</p>
    <p class="book-title--packt">Background images will be cropped with a chart's bounding area and thus it is recommended to remove or avoid background images. Additionally, the exported report pages always result in standard 16:9 PowerPoint slide sizes and thus custom or non-standard page sizes should also be avoided. Shapes such as rectangles and lines to provide custom groupings, borders, and background colors for visuals may also need to be removed for proper PowerPoint rendering. Finally, non-certified visuals, R visuals, and Python visuals should be avoided in reports where exporting to PowerPoint is used.</p>
    <h2 id="calibre_link-2066" class="calibre8">There's more...</h2>
    <p class="book-title--packt">The Power BI service supports exporting reports to PowerPoint or PDF as well as to an image file <a id="calibre_link-2067" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>through the Power <a id="calibre_link-2068" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>BI REST API. In addition, paginated reports can be exported to the following additional formats:</p>
    <ul class="calibre9">
      <li class="bullet">MHTML</li>
      <li class="bullet">Microsoft Word</li>
      <li class="bullet">XML</li>
    </ul>
    <p class="book-title--packt">A third-party add-in is available for integrating Power BI tiles from the Power BI service into Microsoft Office documents called Power BI Tiles and is available in AppSource: <a href="https://bit.ly/3w2sUmq" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3w2sUmq</span></a>. The offering from DevScope includes an automated Office-to-Power BI refresh process and supports Word, Outlook, and PowerPoint.</p>
    <h2 id="calibre_link-2069" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Export entire reports to PowerPoint: <a href="https://bit.ly/3tIaPZl" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3tIaPZl</span></a></li>
      <li class="bullet">Power BI tiles: <a href="http://www.powerbitiles.com/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://www.powerbitiles.com/</span></a></li>
    </ul>
    <h1 id="calibre_link-1314" class="title">Connecting to Azure Analysis Services</h1>
    <p class="book-title--packt">Power BI Premium is now a superset of Analysis Services and powerful new features such as <a id="calibre_link-102" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>composite models and aggregations are exclusive to Power BI Premium. Nonetheless, it wasn't long ago in which Azure Analysis Services (AAS) was Microsoft's flagship semantic modeling tool and thus many organizations' production BI workloads currently leverage AAS models as the source for Power BI and other report types. </p>
    <p class="book-title--packt">Given the additional features and product roadmap of Power BI Premium, deep compatibility between AAS and Power Premium, as well as a straight forward migration path, many AAS (and SSAS) models will eventually be re-deployed to Power BI Premium. Nonetheless, Azure Analysis Services will remain a fully supported and common cloud service that BI developers should be familiar with.</p>
    <blockquote class="packt_quote pcalibre6">"I think it is fair to say that we're the only vendor that can claim a strong presence in self-service business intelligence with Power BI and corporate business intelligence, which is typically owned and managed by IT, with Analysis Services."<p class="cite">- Christian Wade, Senior Program Manager</p></blockquote>
    
    <p class="book-title--packt">In this recipe, an Azure Analysis Services server is created and a Power BI Desktop file is imported to this server. The migrated model is then opened in SQL Server Data Tools for Visual Studio as an Analysis Services project.</p>
    <h2 id="calibre_link-2070" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare <a id="calibre_link-2071" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Obtain an MS Azure subscription.</li>
      <li class="calibre12">Identify the location of your Power BI service tenant by clicking on the question mark in the top-right menu and selecting <strong class="screentext">About Power BI</strong>.<figure class="mediaobject"><img src="images/000229.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.28: Power BI service tenant location</p>
        <p class="packt_figref">Note that a tenant can be thought of like an apartment in an apartment building. The Power BI service in Microsoft Azure is akin to the building, providing the foundation, plumbing, and other common facilities. However, each resident within the Power BI service has their own private living area (tenant).</p>
      </li>
      <li class="calibre12">Log in to the Microsoft Azure portal, <a href="https://portal.azure.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://portal.azure.com</span></a>.</li>
      <li class="calibre12">Choose <strong class="screentext">Create a resource</strong>.</li>
      <li class="calibre12">Search for <strong class="screentext">Analysis Services</strong> and select <strong class="screentext">Create</strong>.</li>
      <li class="calibre12">Create an Azure Analysis Services server by filling in the required fields:<figure class="mediaobject"><img src="images/000240.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.29: Create an Azure Analysis Services Server</p>
        <p class="packt_figref">For minimal <a id="calibre_link-103" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>latency, the location selected should match the location of your Power BI tenant from <em class="italic">Getting ready</em>. A standard or developer tier Azure Analysis Services instance is required for the import from Power BI Desktop.</p>
      </li>
      <li class="calibre12">Click on <strong class="screentext">Create</strong> and wait for the server to be visible in the Azure portal (usually less than one minute).</li>
      <li class="calibre12">Navigate to the <strong class="screentext">Analysis Services</strong> resource and open the instance.</li>
      <li class="calibre12">Under <strong class="screentext">Models</strong>, select <strong class="screentext">Manage</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">New Model</strong>, choose <strong class="screentext">Sample data</strong>, and click the <strong class="screentext">Add</strong> button.</li>
    </ol>
    <p class="book-title--packt">A new model called <strong class="screentext">adventureworks</strong> will be added to your Analysis Services instance.</p>
    <h2 id="calibre_link-2072" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">With the Analysis Services resource open, click <strong class="screentext">Overview</strong> and obtain the <strong class="screentext">Server name</strong>.<figure class="mediaobject"><img src="images/000253.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.30: Azure Analysis Services resource in the Azure portal</p>
      </li>
      <li class="calibre12">If multiple models are on the server, confirm the model name and optionally the perspective <a id="calibre_link-2073" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to connect to. All models on the AAS server are also listed in the Azure portal.</li>
      <li class="calibre12">Open a new Power BI Desktop file, click on <strong class="screentext">Get Data</strong>, and choose <strong class="screentext">Analysis Services</strong>.</li>
      <li class="calibre12">Enter or paste the server name and the database (the name of the model) and press the <strong class="screentext">OK</strong> button:<figure class="mediaobject"><img src="images/000264.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.31: Azure Analysis Services data source configuration in Power BI Desktop</p>
      </li>
      <li class="calibre12">Authenticate using a <strong class="screentext">Microsoft account</strong>.</li>
      <li class="calibre12">Create a Power BI report and publish it to a workspace in the Power BI service.</li>
    </ol>
    <p class="book-title--packt">As you can see, connecting to an Analysis Services database is quite simple and straightforward.</p>
    <h2 id="calibre_link-2074" class="calibre8">How it works...</h2>
    <p class="book-title--packt"><strong class="screentext">Connect live</strong> is the <a id="calibre_link-171" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>default option and this should represent the vast majority if not all connections as data has already been imported to (or connected from, in the case of SSAS DirectQuery models) the Azure Analysis Services database. Importing data to Power BI Desktop <a id="calibre_link-104" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>would require its own refresh process, but in certain rare scenarios, a DAX query can retrieve from the AAS database and then optionally merge or integrate this data with other data sources in Power BI Desktop.</p>
    <p class="book-title--packt">Just like Power BI Desktop reports with live connections to datasets in the Power BI service, the report author can also create DAX measures specific to the given report with live connections to Analysis Services. This feature enables report authors familiar with DAX to address the unique metric requirements of a report. If the same report-level measures are being remade across multiple reports, the BI/IT team responsible for the Analysis Services model can consider implementing this logic into the model.</p>
    <p class="book-title--packt">Azure Analysis <a id="calibre_link-933" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Services instances are priced per hour according to <strong class="screentext">QPUs</strong> (<strong class="screentext">Query Processing Units</strong>) and memory. One virtual core is approximately equal to 20 QPUs. For example, an S4 instance with 400 QPUs has roughly 20 virtual cores and 100 GB of RAM:</p>
    <figure class="mediaobject"><img src="images/000275.png" alt="" class="calibre14" /></figure>
    <p class="book-title--packt">Figure 13.32: Azure Analysis Services instance pricing</p>
    <p class="book-title--packt">Azure Analysis <a id="calibre_link-105" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Services servers can be paused, and no charges are incurred while servers are paused. Additionally, the pricing tier of a server can be moved up or down a service tier such as from S1 to S3 or vice versa. A server can also be upgraded from lower service tiers such as from development to standard, but servers cannot be downgraded from higher service tiers. </p>
    <h2 id="calibre_link-2075" class="calibre8">There's more...</h2>
    <p class="book-title--packt">Given that Power BI and Analysis Services Tabular share the same database engine and because Azure Analysis Services eliminates the query latency and infrastructure costs of communication between the Power BI service and on-premises servers via the on-premises data gateway, organizations may consider migrating their Power BI and SSAS models to Azure Analysis Services. As one example, the data source for a model such as Teradata can remain on-premises but the scheduled or triggered model refresh process of model tables and table partitions would update the Azure-hosted model through the on-premises <a id="calibre_link-720" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>data gateway. In addition to the other cost and flexibility advantages of the Azure Analysis Services <strong class="screentext">Platform-as-a-Service</strong> (<strong class="screentext">PaaS</strong>) offering, Power BI Premium capacities can enable all business users to access the Power BI reports and dashboards built on top of Azure Analysis Services models. Once migrated to Azure Analysis Services, the tabular model can be accessed as the source for a Power BI report. </p>
    <h2 id="calibre_link-2076" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Azure Analysis Services: <a href="https://azure.microsoft.com/en-us/services/analysis-services/" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://azure.microsoft.com/en-us/services/analysis-services/</span></a></li>
      <li class="bullet">Client libraries for connection to Azure Analysis Services: <a href="http://bit.ly/2vzLAvO" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">http://bit.ly/2vzLAvO</span></a></li>
    </ul>
    <h1 id="calibre_link-1315" class="title">Integrating with Power Automate and Power Apps</h1>
    <p class="book-title--packt">Power BI's tools and services are built to derive meaning and insights from data as well as making <a id="calibre_link-731" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>those insights accessible to others. While these are both essential functions, Power BI itself is not intended to take action or execute <a id="calibre_link-721" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a business decision on the data it analyzes and visualizes. Additionally, information workers regularly interface with many applications or services and thus, to remain productive, there is a need to automate workflows and embed logic between Power BI and these applications in order to streamline business processes. Power Apps and Power Automate, both Microsoft 365 applications and part of the Business Application Platform along with Power BI, serve to address these needs by enabling business users to create custom business applications and workflow processes.</p>
    <p class="book-title--packt">In this recipe a Power Automate workflow is created to support a streaming dataset in the Power BI service. Specifically, the Power Automate workflow is configured to read from an on-premises SQL Server table every two minutes and push this data into Power BI to provide near real-time visibility and support for data-driven alerts and notifications.</p>
    <h2 id="calibre_link-2077" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open <strong class="screentext">SQL Server Management Studio (SSMS)</strong>, connect to the local SQL database <a id="calibre_link-1029" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>containing the <strong class="screentext">AdventureWorksdW2019</strong> database, and familiarize yourself with the <strong class="screentext">Columns</strong> of the <strong class="screentext">dbo.FactSurveyResponse</strong> table:<figure class="mediaobject"><img src="images/000288.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.33: dbo.FactSurveyResponse columns in the AdventureWorksDW2019 database</p>
      </li>
      <li class="calibre12">Ensure that you have a data gateway running that is compatible with Power Automate. See <em class="italic">Chapter 1</em>,<em class="italic"> </em><em class="italic">Configuring Power BI Tools</em> for installation instructions.</li>
    </ol>
    <p class="book-title--packt">In this recipe, an on-premises data gateway is used to support a Power BI streaming dataset <a id="calibre_link-732" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>from an on-premises SQL Server database table via Power Automate. Per previous chapters the same gateway that supports <a id="calibre_link-722" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI refresh processes and live connections or DirectQuery models can also be used for Power Apps and Power Automate. Depending on the workloads generated by these different activities and applications, and based on gateway resource monitoring, it may be necessary to isolate Power Apps and Power Automate to a dedicated on-premises gateway or, in the future, add a server to a high-availability gateway cluster.</p>
    <h2 id="calibre_link-2078" class="calibre8">How to do it...</h2>
    <p class="book-title--packt">To implement this recipe, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a workspace in the Power BI service and click on the <strong class="screentext">New</strong> button in the top menu bar.<figure class="mediaobject"><img src="images/000300.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.34: New options for a workspace in the Power BI service</p>
      </li>
      <li class="calibre12">Select <strong class="screentext">Streaming dataset</strong>, click the <strong class="screentext">API</strong> icon, and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Configure <a id="calibre_link-733" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the streaming dataset to align <a id="calibre_link-723" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>with the columns and data types of the <strong class="screentext">FactSurveyResponse</strong> table.<figure class="mediaobject"><img src="images/000312.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.35: Streaming dataset configuration</p>
      </li>
      <li class="calibre12">Enter <a id="calibre_link-734" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a <strong class="screentext">Dataset name</strong>, enable the <strong class="screentext">Historic data analysis</strong> setting, and click the <strong class="screentext">Create button</strong>. </li>
      <li class="calibre12">Copy <a id="calibre_link-724" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Push URL</strong> value and click the <strong class="screentext">Done</strong> button.</li>
      <li class="calibre12">Log in to Power Automate in Microsoft 365: <a href="https://flow.microsoft.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://flow.microsoft.com</span></a>.</li>
      <li class="calibre12">In the left navigation pane, click <strong class="screentext">Create</strong>.</li>
      <li class="calibre12">In the <strong class="screentext">Start from blank</strong> area, click <strong class="screentext">Scheduled cloud flow</strong>.</li>
      <li class="calibre12">Provide a <strong class="screentext">Flow name</strong>, set the workflow to <strong class="screentext">Repeat every 5 Minute</strong>, and then click the <strong class="screentext">Create</strong> button.<figure class="mediaobject"><img src="images/000324.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.36: Creating a Power Automate workflow</p>
      </li>
      <li class="calibre12">On the <a id="calibre_link-2079" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>design screen, click <strong class="screentext">New step</strong>.</li>
      <li class="calibre12">Search <a id="calibre_link-2080" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for SQL Server and in <strong class="screentext">Actions</strong> choose <strong class="screentext">Get rows (V2)</strong>.<figure class="mediaobject"><img src="images/000335.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.37: Get rows SQL Server action in Power Automate</p>
      </li>
      <li class="calibre12">Enter in the connection information for the SQL Server and then click the <strong class="screentext">Create</strong> button. For the gateway to appear, the connection information must match a data source configured on the gateway.<figure class="mediaobject"><img src="images/000347.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.38: SQL Server connection information in Power Automate</p>
      </li>
      <li class="calibre12">Configure <a id="calibre_link-735" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Get rows (V2)</strong> step:<figure class="mediaobject"><img src="images/000358.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.39: Configuration of the SQL Server Get rows (V2) step in Power Automate</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">New step</strong> button.</li>
      <li class="calibre12">Search <a id="calibre_link-725" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>for <strong class="screentext">Power BI</strong> and choose <strong class="screentext">Add rows to a dataset (Preview)</strong>.</li>
      <li class="calibre12">Configure <a id="calibre_link-2081" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Add rows to a dataset (Preview)</strong> step for the <strong class="screentext">Workspace</strong> and <strong class="screentext">Dataset</strong> created previously.</li>
      <li class="calibre12">Choose <strong class="screentext">RealTimeData</strong> as the <strong class="screentext">Table</strong> and configure the columns for the dataset.<figure class="mediaobject"><img src="images/000369.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.40: Configuration of the Add rows to a dataset step in Power Automate</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Save</strong> button when complete.</li>
      <li class="calibre12">Click on <strong class="screentext">My flows</strong> and <strong class="screentext">Run</strong> the workflow.</li>
      <li class="calibre12">Monitor <a id="calibre_link-736" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the flow by clicking on the <strong class="screentext">Flow Runs Page</strong> link and waiting for the flow to complete.</li>
      <li class="calibre12">Open a <a id="calibre_link-726" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>new Power BI Desktop file.</li>
      <li class="calibre12">Click <strong class="screentext">Get data</strong> and choose <strong class="screentext">Power BI datasets</strong>.</li>
      <li class="calibre12">Select the <strong class="screentext">Customer Survey Responses</strong> dataset and click the <strong class="screentext">Create</strong> button.</li>
      <li class="calibre12">Create a simple visual that counts the rows in the dataset.</li>
    </ol>
    <p class="book-title--packt">In a production scenario, this recipe would need to be modified such that each run of the Power Automate flow does not duplicate the rows already present in the Power BI dataset. </p>
    <h2 id="calibre_link-2082" class="calibre8">How it works...</h2>
    <p class="book-title--packt">When historical data analysis is enabled for a streaming dataset in the Power BI service, the dataset created is both a streaming dataset and a push dataset. As a push dataset, a database and table for the dataset are created in the Power BI service allowing Power BI report visuals <a id="calibre_link-2083" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and functionality to be created from this <a id="calibre_link-2084" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>table. Without historical data analysis enabled (the default), the dataset is only a streaming dataset. Power BI temporarily caches the data but there is no underlying database, and thus the only method for visualizing this data is via a real-time streaming dashboard tile.</p>
    <p class="book-title--packt">Power Automate <a id="calibre_link-1004" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>flows are conceptually similar to the control flow interface for <strong class="screentext">SQL Server Integration Services (SSIS)</strong> packages. Complex logic can be added to Power Automate workflows via branching conditions, scopes, and looping constructs. Power Automate is designed for self-service scenarios and business power users. Power Automate utilizes Azure Logic Apps, a cloud-based integration service that is more oriented toward developers and enterprise integration scenarios.</p>
    <p class="book-title--packt">The run history of the flow, including successful and unsuccessful executions, is available by clicking on the flow name in the <strong class="screentext">My Flows</strong> area of the Power Automate website. Additionally, the <strong class="screentext">My Flows</strong> page specific to the given flow allows for adding owners, viewing connections, editing the flow, and turning the flow off.</p>
    <h2 id="calibre_link-2085" class="calibre8">There's more...</h2>
    <p class="book-title--packt">In addition to Power Automate, Power Apps also has integrations with Power BI. To see how this integration works, perform the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Log in to Power Apps in Microsoft 365: <a href="https://powerapps.microsoft.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://powerapps.microsoft.com</span></a></li>
      <li class="calibre12">Expand <strong class="screentext">Data</strong> in the left navigation pane</li>
      <li class="calibre12">Select <strong class="screentext">Tables</strong></li>
      <li class="calibre12">Select the <strong class="screentext">Data</strong> dropdown and choose <strong class="screentext">Get data</strong> and then <strong class="screentext">Get data</strong> again<figure class="mediaobject"><img src="images/000380.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.41: Getting data</p>
      </li>
      <li class="calibre12">Choose <strong class="screentext">Power Platform dataflows</strong></li>
      <li class="calibre12">For <strong class="screentext">Connection</strong>, choose <strong class="screentext">Create new connection</strong> and authenticate</li>
      <li class="calibre12">Click <a id="calibre_link-737" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Next</strong> button</li>
      <li class="calibre12">Choose <a id="calibre_link-727" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a table from a dataflow and click <strong class="screentext">Next</strong>
        <figure class="mediaobject"><img src="images/000390.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.42: Choosing a dataflow table</p>
      </li>
      <li class="calibre12">Click the <strong class="screentext">Next</strong> button</li>
      <li class="calibre12">Choose <strong class="screentext">Load to new table</strong> and click the <strong class="screentext">Next</strong> button<figure class="mediaobject"><img src="images/000402.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.43: Load as a new table</p>
      </li>
      <li class="calibre12">Select <a id="calibre_link-738" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>whether to refresh manually or automatically and click the <strong class="screentext">Publish </strong>button</li>
      <li class="calibre12">Back on <a id="calibre_link-2086" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Tables </strong>screen, in the left navigation pane, click <strong class="screentext">Create</strong></li>
      <li class="calibre12">Choose <strong class="screentext">Canvas app from blank</strong>
        <figure class="mediaobject"><img src="images/000155.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.44: Three ways to create a Power app</p>
      </li>
      <li class="calibre12">Provide an <strong class="screentext">App name</strong> and then click the <strong class="screentext">Create</strong> button<figure class="mediaobject"><img src="images/000437.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.45: Create app from blank</p>
      </li>
      <li class="calibre12">Select <a id="calibre_link-739" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Insert</strong> menu option</li>
      <li class="calibre12">Click <a id="calibre_link-728" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>on the <strong class="screentext">Charts</strong> dropdown and choose <strong class="screentext">Power BI tile</strong>
        <figure class="mediaobject"><img src="images/000010.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.46: Insert Power BI tile</p>
      </li>
      <li class="calibre12">Choose a <strong class="screentext">Workspace</strong>, <strong class="screentext">Dashboard</strong>, and <strong class="screentext">Tile</strong> from the Power BI service<figure class="mediaobject"><img src="images/000283.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.47: Choosing a dashboard tile</p>
      </li>
      <li class="calibre12">From <a id="calibre_link-740" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Home</strong> menu, select <strong class="screentext">New screen</strong> and <a id="calibre_link-729" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>choose <strong class="screentext">List</strong>
        <figure class="mediaobject"><img src="images/000500.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.48: Creating a new List screen</p>
      </li>
      <li class="calibre12">Select a <a id="calibre_link-741" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>list item and edit the <strong class="screentext">Data</strong> source to <a id="calibre_link-730" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>choose the table created previously (in this case, <strong class="screentext">DimProduct</strong>)</li>
      <li class="calibre12">For <strong class="screentext">Fields</strong>, choose <strong class="screentext">Edit</strong> and change <strong class="screentext">Title2</strong> to be <strong class="screentext">Product Name</strong></li>
      <li class="calibre12">Save the app</li>
    </ol>
    <h2 id="calibre_link-2087" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Integrate Power BI data alerts with Power Automate: <a href="https://bit.ly/3tHLv5R" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3tHLv5R</span></a></li>
      <li class="bullet">Announcing the new Power Automate visual for Power BI: <a href="https://bit.ly/3vY9C1J" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3vY9C1J</span></a></li>
      <li class="bullet">Export and email a report with Power Automate: <a href="https://bit.ly/3fc8eBT" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3fc8eBT</span></a></li>
      <li class="bullet">Power Apps and Power BI, together at last: <a href="https://bit.ly/2QbQHkC" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/2QbQHkC</span></a></li>
      <li class="bullet">Power Apps visual for Power BI: <a href="https://bit.ly/3yg5a0n" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3yg5a0n</span></a></li>
    </ul>
    <h1 id="calibre_link-1316" class="title">Leveraging Dataverse and Dynamics 365</h1>
    <p class="book-title--packt">The Microsoft Power Platform includes Dataverse, what was formerly called the <strong class="screentext">Common Data Service (CDS)</strong>. Dataverse <a id="calibre_link-167" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>stores business data securely in the cloud and allows you <a id="calibre_link-297" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to manage the data used by business applications. Dataverse stores data in tables and includes base tables for <a id="calibre_link-422" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>common scenarios but also allows the creation of new, custom tables. Dynamics 365 applications such as Dynamics 365 Sales, Dynamics 365 Talent, and Dynamics 365 Customer Service store data natively in Dataverse and in addition, Power Apps can be used to build applications against this core data without the need for integration. Finally, Dynamics 365 Business Central and Dynamics 365 Finance and Operations also have native integrations with Dataverse.</p>
    <p class="book-title--packt">This recipe demonstrates how to use Power BI with Dataverse and Dynamics 365.</p>
    <h2 id="calibre_link-2088" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">If you have not already done so, configure a connection to your <strong class="screentext">AdventureWorksDW2019</strong> database in your data gateway. See <em class="italic">Chapter 12</em>,<em class="italic"> </em><em class="italic">Deploying and Distributing Power BI Content</em> for details.</li>
      <li class="calibre12">Open a web browser, go to <a href="https://admin.powerplatform.microsoft.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://admin.powerplatform.microsoft.com</span></a>, and log on with your Microsoft 365 account. This is the Power Platform admin center.</li>
      <li class="calibre12">In the left-hand navigation pane, click on <strong class="screentext">Environments</strong>.</li>
      <li class="calibre12">In the ribbon area, click <strong class="screentext">+ New</strong>. This opens a <strong class="screentext">New environment</strong> pane on the right-hand side of the page. <figure class="mediaobject"><img src="images/000022.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.49: Power Platform admin center</p>
      </li>
      <li class="calibre12">In the <strong class="screentext">New environment</strong> pane, enter a <strong class="screentext">Name</strong> for the environment, choose a <strong class="screentext">Type</strong> (either <strong class="screentext">Production</strong>, <strong class="screentext">Sandbox</strong>, or <strong class="screentext">Trial</strong>), and choose a <strong class="screentext">Region</strong>. Additionally, toggle <strong class="screentext">Create a database for this environment</strong> to <strong class="screentext">Yes</strong> and click the <strong class="screentext">Next</strong> button at the bottom of the pane.</li>
      <li class="calibre12">Choose a <strong class="screentext">Language</strong> and <strong class="screentext">Currency</strong>. Provide a <strong class="screentext">URL</strong> if desired. </li>
      <li class="calibre12">Toggle <strong class="screentext">Enable Dynamics 365 apps </strong>to <strong class="screentext">Yes</strong>.</li>
      <li class="calibre12">Click the <a id="calibre_link-423" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>dropdown for <strong class="screentext">Automatically deploy these apps</strong> and check all the boxes. </li>
      <li class="calibre12">Click <a id="calibre_link-298" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Save</strong> button at the bottom of the pane.</li>
      <li class="calibre12">Click the environment and note the <strong class="screentext">Environment URL</strong>.</li>
    </ol>
    <p class="book-title--packt">You are now ready to complete this recipe.</p>
    <h2 id="calibre_link-2089" class="calibre8">How to do itâ¦</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Navigate to <a href="https://powerapps.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://powerapps.com</span></a> and switch to the new environment created in <em class="italic">Getting ready</em>. The current environment is located in the upper-right corner.</li>
      <li class="calibre12">In the left-hand navigation, expand <strong class="screentext">Data</strong> and click <strong class="screentext">Dataflows</strong>. </li>
      <li class="calibre12">Click on the <strong class="screentext">Create a dataflow </strong>button and choose <strong class="screentext">Start from blank</strong>.</li>
      <li class="calibre12">Provide a <strong class="screentext">Name</strong> for your dataflow like <strong class="screentext">Customers</strong> and click the <strong class="screentext">Create</strong> button.</li>
      <li class="calibre12">Choose <strong class="screentext">SQL Server database</strong>.</li>
      <li class="calibre12">Enter the connection information for your on-premises <strong class="screentext">AdventureWorksDW2019</strong> database.</li>
      <li class="calibre12">Choose your gateway from the dropdown for <strong class="screentext">On-premises data gateway</strong>.</li>
      <li class="calibre12">Enter your authentication information and click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Select the <strong class="screentext">DimCustomer</strong> table and click the <strong class="screentext">Transform data</strong> button.</li>
      <li class="calibre12">Expand the <strong class="screentext">DimGeography</strong> column for the following columns and uncheck <strong class="screentext">Use original column name as prefix</strong>:<ul class="calibre11">
          <li class="calibre12">City</li>
          <li class="calibre12">StateProvinceName</li>
          <li class="calibre12">EnglishCountryRegionName</li>
          <li class="calibre12">PostalCode</li>
        </ul>
      </li>
      <li class="calibre12">Click <a id="calibre_link-299" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Select <strong class="screentext">Load to existing</strong> <strong class="screentext">table </strong>and choose <strong class="screentext">Contact</strong> as the <strong class="screentext">Table display name</strong>.</li>
      <li class="calibre12">Create <a id="calibre_link-424" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the following mappings:<ul class="calibre11">
          <li class="calibre12"><code class="code-in-text--packt">City = Address1_City</code></li>
          <li class="calibre12"><code class="code-in-text--packt">EnglishCountryRegionName = Address1_Country</code></li>
          <li class="calibre12"><code class="code-in-text--packt">AddressLine1 = Address1_Line1</code></li>
          <li class="calibre12"><code class="code-in-text--packt">AddressLine2 = Address1_Line2</code></li>
          <li class="calibre12"><code class="code-in-text--packt">PostalCode = Address1_PostalCode</code></li>
          <li class="calibre12"><code class="code-in-text--packt">StateProvinceName = Address1_StateOrProvince</code></li>
          <li class="calibre12"><code class="code-in-text--packt">Phone = Address1_Telephone1</code></li>
          <li class="calibre12"><code class="code-in-text--packt">YearlyIncome = AnnualIncome</code></li>
          <li class="calibre12"><code class="code-in-text--packt">BirthDate = BirthDate</code></li>
          <li class="calibre12"><code class="code-in-text--packt">FirstName = FirstName</code></li>
          <li class="calibre12"><code class="code-in-text--packt">Title = JobTitle</code></li>
          <li class="calibre12"><code class="code-in-text--packt">LastName = LastName</code></li>
          <li class="calibre12"><code class="code-in-text--packt">TotalChildren = NumberOfChildren</code></li>
          <li class="calibre12"><code class="code-in-text--packt">Phone = Telephone1</code></li>
        </ul>
      </li>
      <li class="calibre12">With all other columns set to <strong class="screentext">(none)</strong>, click the <strong class="screentext">Next</strong> button.</li>
      <li class="calibre12">Leave the default for <strong class="screentext">Refresh manually</strong> and click the <strong class="screentext">Create</strong> button.</li>
      <li class="calibre12">A refresh will start automatically, allow the refresh to complete.</li>
      <li class="calibre12">Create a new Power BI Desktop file</li>
      <li class="calibre12">Choose <strong class="screentext">Get data</strong> and then <strong class="screentext">Dataverse</strong>.</li>
      <li class="calibre12">Enter the <strong class="screentext">Environment URL</strong> from <em class="italic">Step 10 </em>of <em class="italic">Getting started</em>.</li>
      <li class="calibre12">Sign in and click the <strong class="screentext">Connect</strong> button.</li>
      <li class="calibre12">Choose <strong class="screentext">Contact</strong> in the <strong class="screentext">Navigator</strong> and click the <strong class="screentext">Load button</strong>.</li>
      <li class="calibre12">Create a <a id="calibre_link-300" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>simple report visual to display the contacts loaded <a id="calibre_link-425" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>into the <strong class="screentext">Dataverse</strong> environment:<figure class="mediaobject"><img src="images/000034.png" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 13.50: Customers in the Dataverse environment</p>
    <p class="book-title--packt"><em class="italic">Figure 13.50 </em>shows customer locations loaded into the Dataverse.</p>
    <h2 id="calibre_link-2090" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">Power Apps dataflows use the same Power Query technology used by Power BI. These dataflows can ingest data from many different sources, including on-premises sources via the data gateway and cloud-based sources as well. Once data is imported into Dataverse, this data can be accessed by Power BI either via Import or DirectQuery.</p>
    <p class="book-title--packt">It is important to point out that Power Apps and Power Automate can also natively access data stored in a Dataverse environment. </p>
    <h2 id="calibre_link-2091" class="calibre8">There's moreâ¦</h2>
    <p class="book-title--packt">In addition to the Dataverse, Power BI has native integration with Dynamics 365 applications, allowing Power BI dashboards to be displayed within Dynamics 365 applications. To demonstrate this functionality, do the following:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open the Power Platform admin center, <a href="https://admin.powerplatform.microsoft.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://admin.powerplatform.microsoft.com</span></a></li>
      <li class="calibre12">In the left-hand navigation pane, click on <strong class="screentext">Environments</strong></li>
      <li class="calibre12">Click on <a id="calibre_link-2092" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the environment created in this recipe</li>
      <li class="calibre12">Click on <a id="calibre_link-426" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the link for the <strong class="screentext">Environment URL</strong> to open the environment</li>
      <li class="calibre12">Select the gear icon in the upper-right corner and choose <strong class="screentext">Advanced Settings</strong></li>
      <li class="calibre12">From the <strong class="screentext">Settings</strong> dropdown in the upper left, select <strong class="screentext">Administration</strong>:<figure class="mediaobject"><img src="images/000070.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.51: Dynamics 365 settings</p>
      </li>
      <li class="calibre12">Select <strong class="screentext">System Settings</strong></li>
      <li class="calibre12">Click the <strong class="screentext">Reporting</strong> tab and set <strong class="screentext">Allow Power BI visualization embedding</strong> to <strong class="screentext">Yes</strong></li>
      <li class="calibre12">Click the <strong class="screentext">OK</strong> button</li>
      <li class="calibre12">Open the Sales Hub app for the environment and click on <strong class="screentext">Dashboards</strong></li>
      <li class="calibre12">Select <strong class="screentext">New</strong> and then <strong class="screentext">Power BI Dashboard</strong></li>
      <li class="calibre12">Sign in to Power BI if necessary</li>
      <li class="calibre12">Select a <strong class="screentext">Workspace</strong> and a <strong class="screentext">Dashboard </strong>and click the <strong class="screentext">Save</strong> button</li>
      <li class="calibre12">Select New and then <strong class="screentext">Dynamics 365 Dashboard</strong></li>
      <li class="calibre12">Choose a layout and then click the <strong class="screentext">Create</strong> button</li>
      <li class="calibre12">Click the <strong class="screentext">Add a Power BI tile to the dashboard</strong> icon:<figure class="mediaobject"><img src="images/000082.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.52: Add a Power BI tile to the dashboard icon in Dynamics 365</p>
      </li>
      <li class="calibre12">Choose a <strong class="screentext">Workspace</strong>, a <strong class="screentext">Dashboard</strong>, and a <strong class="screentext">Tile</strong> and then click the <strong class="screentext">OK</strong> button</li>
      <li class="calibre12">Provide a <strong class="screentext">Name</strong> for the dashboard and click <strong class="screentext">Save</strong> and then click <strong class="screentext">Close</strong></li>
    </ol>
    <p class="book-title--packt">Power BI dashboards and tiles continue to exhibit their link behavior to the underlying report. Clicking on <a id="calibre_link-301" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>a report tile opens the underlying report and this report <a id="calibre_link-427" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>is interactive, meaning that clicking on visuals will cross filter other visuals in the report exactly the same as if viewing the report in the Power BI service.</p>
    <h2 id="calibre_link-2093" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Administer Power Platform: <a href="https://bit.ly/3bqaKTQ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3bqaKTQ</span></a></li>
      <li class="bullet">Create and use dataflows in Power Apps: <a href="https://bit.ly/3eP6tLL" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3eP6tLL</span></a></li>
    </ul>
    <h1 id="calibre_link-1317" class="title">Connecting Dynamics 365 Finance and Operations and the Power Platform</h1>
    <p class="book-title--packt">Power BI is part of Microsoft's Power Platform family of products. The Power Platform includes <a id="calibre_link-428" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>Power BI, Power Apps, Power Automate, and Power Virtual Agents. However, the Power Platform is also part of a larger <a id="calibre_link-831" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>family of products, Microsoft Business Applications. Microsoft Business Applications are applications built around Dynamics 365 for Sales, Dynamics 365 Business Central, and Dynamics 365 Finance and Operations. Microsoft actually breaks down Business Applications into the following:</p>
    <ul class="calibre9">
      <li class="bullet">Microsoft Power Platform</li>
      <li class="bullet">Customer Service</li>
      <li class="bullet">Field Service</li>
      <li class="bullet">Finance</li>
      <li class="bullet">Marketing</li>
      <li class="bullet">Operations</li>
      <li class="bullet">Commerce</li>
      <li class="bullet">Human Resources</li>
      <li class="bullet">Sales</li>
    </ul>
    <p class="book-title--packt">However, note that Customer Service, Field Service, Marketing, Commerce, Human Resources, and Sales <a id="calibre_link-209" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>are all built around the Microsoft <strong class="screentext">customer relationship management (CRM)</strong> system, which used to be called Microsoft CRM. The extensible Microsoft CRM system, sometimes called XRM, is actually <a id="calibre_link-2094" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the heart of Dataverse. The Finance <a id="calibre_link-2095" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and Operations applications refer to the <strong class="screentext">enterprise resource planning (ERP)</strong> applications, either Dynamics 365 Finance <a id="calibre_link-440" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>and Operations or Dynamics 365 Business Central. Note that Dynamics 365 Finance and Operations is built from Dynamics <strong class="screentext">AX (Axapta)</strong> and Dynamics 365 Business Central is built from Dynamics <strong class="screentext">NAV (Navision)</strong>. Dynamics <strong class="screentext">GP (Great Plains)</strong> did not make the transition to the cloud.</p>
    <p class="book-title--packt">The Power Platform admin center provides a central location that is built for integrating the various products in the Microsoft Business Applications portfolio. This also includes powerful data integration features that allow administrators to integrate data from many different environments into Dataverse environments. Similar to dataflows, these data integration projects facilitate central control of data management policies and the flow of business information.</p>
    <p class="book-title--packt">This recipe demonstrates how to use the Power Platform admin center to create a data integration project that synchronizes Dynamics 365 Finance and Operations data with a Dataverse environment and then builds a Power BI report from that data.</p>
    <h2 id="calibre_link-2096" class="calibre8">Getting ready</h2>
    <p class="book-title--packt">To prepare for this recipe, follow these steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Open a web browser, go to <a href="https://admin.powerplatform.microsoft.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://admin.powerplatform.microsoft.com</span></a>, and log on with your Microsoft 365 account. This is the Power Platform admin center.</li>
      <li class="calibre12">In the left-hand navigation pane, click on <strong class="screentext">Environments</strong>.</li>
      <li class="calibre12">In the ribbon area, click <strong class="screentext">+ New</strong>. This opens a <strong class="screentext">New environment</strong> pane on the right-hand side of the page. </li>
      <li class="calibre12">In the <strong class="screentext">New environment</strong> pane, enter a <strong class="screentext">Name</strong> for the environment, choose a <strong class="screentext">Type</strong> (either <strong class="screentext">Production</strong>, <strong class="screentext">Sandbox</strong>, or <strong class="screentext">Trial</strong>), and choose a <strong class="screentext">Region</strong>. Additionally, toggle <strong class="screentext">Create a database for this environment</strong> to <strong class="screentext">Yes</strong> and click the <strong class="screentext">Next</strong> button at the bottom of the pane.</li>
      <li class="calibre12">Choose a <strong class="screentext">Language</strong> and <strong class="screentext">Currency</strong>. Provide a <strong class="screentext">URL</strong> if desired. </li>
      <li class="calibre12">Toggle <strong class="screentext">Enable Dynamics 365 apps</strong> to <strong class="screentext">Yes</strong>.</li>
      <li class="calibre12">Click the <a id="calibre_link-832" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>dropdown for <strong class="screentext">Automatically deploy these apps</strong> and check all the boxes. </li>
      <li class="calibre12">Click the <strong class="screentext">Save</strong> button at the bottom of the pane.</li>
      <li class="calibre12">Click the <a id="calibre_link-429" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>environment and note the <strong class="screentext">Environment URL</strong>.</li>
      <li class="calibre12">Click the <strong class="screentext">Environment URL</strong> to open the environment.</li>
      <li class="calibre12">Click the gear icon in the upper-right corner and select <strong class="screentext">Advanced Settings</strong>.</li>
      <li class="calibre12">Click <strong class="screentext">Settings</strong> and then <strong class="screentext">Security</strong>.</li>
      <li class="calibre12">Select <strong class="screentext">Teams</strong>.</li>
      <li class="calibre12">Check the box next to the default team and select <strong class="screentext">MANAGE ROLES</strong>.</li>
      <li class="calibre12">Check the box for <strong class="screentext">System Administrator</strong> and click the <strong class="screentext">OK</strong> button.</li>
    </ol>
    <h2 id="calibre_link-2097" class="calibre8">How to do itâ¦</h2>
    <p class="book-title--packt">To implement this recipe, use the following steps:</p>
    <ol class="calibre9">
      <li class="calibre12" value="1">Navigate to <a href="https://powerapps.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://powerapps.com</span></a> and switch to the new environment created in <em class="italic">Getting ready</em>. The current environment is located in the upper-right corner.</li>
      <li class="calibre12">Expand <strong class="screentext">Data</strong> and choose <strong class="screentext">Connections</strong>.</li>
      <li class="calibre12">Click <strong class="screentext">New connection</strong>.</li>
      <li class="calibre12">Search for <strong class="screentext">Dynamics</strong> and add a <strong class="screentext">Fin &amp; Ops Apps (Dynamics 365)</strong> connection.</li>
      <li class="calibre12">Repeat <em class="italic">Steps 3 </em>and <em class="italic">4</em> to add a <strong class="screentext">Dataverse</strong> connection and a <strong class="screentext">Dynamics 365 (deprecated)</strong> connection.</li>
      <li class="calibre12">Under the <strong class="screentext">Data</strong> heading, now choose <strong class="screentext">Tables</strong>.</li>
      <li class="calibre12">Switch to the <strong class="screentext">All</strong> view and search for <em class="italic">warehouse</em>.</li>
      <li class="calibre12">Click the <strong class="screentext">Warehouse</strong> table.</li>
      <li class="calibre12">Click <strong class="screentext">Add</strong> <strong class="screentext">column</strong>.</li>
      <li class="calibre12">Add a <strong class="screentext">City</strong> text column.</li>
      <li class="calibre12">Click <strong class="screentext">Save Table</strong> in the lower-right corner.</li>
      <li class="calibre12">Navigate to the Power Platform admin center.</li>
      <li class="calibre12">Click on <strong class="screentext">Data</strong> <strong class="screentext">integration</strong>.</li>
      <li class="calibre12">Click <strong class="screentext">New connection set</strong>.</li>
      <li class="calibre12">Provide a descriptive value for <strong class="screentext">Connection set name</strong>.</li>
      <li class="calibre12">For the <strong class="screentext">First app connection</strong>, choose your <strong class="screentext">Finance and Operations apps</strong> connection created previously and select the correct environment.</li>
      <li class="calibre12">For the <strong class="screentext">Second app connection</strong>, choose <strong class="screentext">Dynamics 365 for Sales</strong> and select the environment created in this recipe. Note that at the time of writing, <strong class="screentext">Dynamics 365 for Sales</strong> is the correct connection type. The legacy <strong class="screentext">Common Data Service</strong> connection type does not work and the new <strong class="screentext">Dataverse</strong> connection type does not appear in the list of available applications. In the future, the <strong class="screentext">Dataverse</strong> connection type will likely be the correct choice.</li>
      <li class="calibre12">Select the <a id="calibre_link-833" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>correct organization, such as <strong class="screentext">USMF</strong> for <strong class="screentext">Finance and Operations apps</strong>, and the environment name for the <strong class="screentext">Dynamics 365 for Sales</strong> organization.</li>
      <li class="calibre12">Click <a id="calibre_link-430" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Save</strong> button.</li>
      <li class="calibre12">Click <strong class="screentext">New</strong> <strong class="screentext">project</strong>.</li>
      <li class="calibre12">Provide a <strong class="screentext">Project name</strong> such as <strong class="screentext">Warehouse Sync</strong>.</li>
      <li class="calibre12">Click <strong class="screentext">Choose an existing connection set</strong> and select the connection set created previously.</li>
      <li class="calibre12">Click <strong class="screentext">Choose template</strong>, select the <strong class="screentext">Warehouses (Fin and Ops to Field Service)</strong> template, and click the <strong class="screentext">OK</strong> button.</li>
      <li class="calibre12">Select the organization pair under <strong class="screentext">Organizations</strong> and click the <strong class="screentext">Create</strong> button.</li>
      <li class="calibre12">Click the <strong class="screentext">Warehouse Sync</strong> project.</li>
      <li class="calibre12">Click <strong class="screentext">Refresh tables</strong>.</li>
      <li class="calibre12">Under the <strong class="screentext">Map</strong> column, click the <strong class="screentext">&gt;</strong> icon.</li>
      <li class="calibre12">Delete any mappings with a <strong class="screentext">Destination</strong> of <strong class="screentext">None</strong>.</li>
      <li class="calibre12">Click <strong class="screentext">Add mapping</strong>.</li>
      <li class="calibre12">Add a mapping from <strong class="screentext">PRIMARYADDRESSCITY</strong> to the <strong class="screentext">City</strong> column created previously.<figure class="mediaobject"><img src="images/000094.png" alt="" class="calibre14" /></figure>
        <p class="packt_figref">Figure 13.53: Warehouse sync sources and destinations</p>
      </li>
      <li class="calibre12">Click <strong class="screentext">Save</strong>.</li>
      <li class="calibre12">Click the <a id="calibre_link-834" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>project name in the breadcrumb.</li>
      <li class="calibre12">Click <strong class="screentext">Run project</strong>.</li>
      <li class="calibre12">Click <a id="calibre_link-431" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the <strong class="screentext">Execution history</strong> tab and wait for the synchronization to complete. There should be 31 <strong class="screentext">Upserts</strong>.</li>
      <li class="calibre12">Create a new Power BI Desktop file.</li>
      <li class="calibre12">Choose <strong class="screentext">Get data</strong> and then <strong class="screentext">Dataverse</strong>.</li>
      <li class="calibre12">Enter the <strong class="screentext">Environment URL</strong> from <em class="italic">Step 9</em> of <em class="italic">Getting started</em>.</li>
      <li class="calibre12">Sign in and click the <strong class="screentext">Connect</strong> button.</li>
      <li class="calibre12">Choose <strong class="screentext">msdyn_warehouse</strong> in the <strong class="screentext">Navigator</strong> and click the <strong class="screentext">Load </strong>button.</li>
      <li class="calibre12">Create a simple report visual to display the warehouses loaded into the <strong class="screentext">Dataverse</strong> environment.</li>
      <li class="calibre12">Save and publish the report to the Power BI service.</li>
      <li class="calibre12">Open the report in the Power BI service and pin the report visual to a dashboard:<figure class="mediaobject"><img src="images/000107.jpg" alt="" class="calibre14" /></figure>
      </li>
    </ol>
    <p class="book-title--packt">Figure 13.54: Warehouses in the Dataverse environment</p>
    <p class="book-title--packt"><em class="italic">Figure 13.54</em> shows the location of warehouses from Dynamics 365 Finance and Operations loaded into Dataverse.</p>
    <h2 id="calibre_link-2098" class="calibre8">How it worksâ¦</h2>
    <p class="book-title--packt">While provisioning <a id="calibre_link-835" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>the environment, you are given the option <a id="calibre_link-432" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>to either create a database or not. You might choose to not create a database if the environment is to be used solely for Power Apps and Power Automate development with source data coming from somewhere other than the Dataverse environment. By creating the Dataverse environment with a database and checking the box to <strong class="screentext">Deploy Dynamics 365 apps</strong> to <strong class="screentext">Yes</strong>, additional tables are added to the environment to support the chosen applications.</p>
    <p class="book-title--packt">It is important that you set the role for the default team to <strong class="screentext">System Administrator</strong> or <strong class="screentext">System Customizer</strong>. By default, the team created as part of the provisioning process has no rights within the system while the user that created the environment is given the <strong class="screentext">System Administrator</strong> role, among others. However, the synchronization performed by the connection sets, projects, and tasks currently uses the team permissions, not the user permissions, when writing to the Dataverse environment.</p>
    <p class="book-title--packt">Creating a data <a id="calibre_link-2099" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>integration project consists of three tasks, creating connections, creating a connection set, and finally creating a project that contains the <a id="calibre_link-2100" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"></a>tasks to perform. A connection simply holds the authentication credentials for a data source, similar to defining a data source connection in Power BI (data source settings). A connection set simply defines a source and destination system. Unlike Power BI where the destination is always the Power BI data model, data integration projects can synchronize data between any two source systems. Finally, a project defines the tasks to be performed during data integration. The tasks hold the mappings between columns in the source and destination systems. </p>
    <p class="book-title--packt">The data integration projects created in the Power Platform admin center leverage the same Power Query technology as Power BI and dataflows. This can be seen by selecting the task in the data integration project created in this recipe and then selecting <strong class="screentext">Advanced query and filtering</strong>. The familiar Power Query editor interface is shown, including access to the <strong class="screentext">Advanced Editor</strong> for the direct insertion of M code. This <strong class="screentext">Advanced query and filtering</strong> interface can be used to further refine the source data query, such as the removal of unnecessary columns, to improve the overall efficiency of the data source query or perform required transformations.</p>
    <h2 id="calibre_link-2101" class="calibre8">See also</h2>
    <ul class="calibre9">
      <li class="bullet">Administer Power Platform: <a href="https://bit.ly/3bqaKTQ" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3bqaKTQ</span></a></li>
      <li class="bullet">Integrate data into Microsoft Dataverse: <a href="https://bit.ly/3bpQykV%20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://bit.ly/3bpQykV</span></a></li>
    </ul>
    <h1 id="calibre_link-1318" class="title">Conclusion</h1>
    <p class="book-title--packt">This chapter highlighted powerful integration points between Power BI, SSRS, Analysis Services, Excel, PowerPoint, Power Apps, Power Automate, Dataverse, and Dynamics 365. This included connecting Power BI to Analysis Services, leveraging DAX as a query language to support custom reports in Excel, pinning reporting service visuals to Power BI dashboards, and utilizing cube formulas to build templates or scorecard report layouts. Additionally, an example was provided of designing an automated workflow with Power Automate to push data from a relational database to a streaming dataset in the Power BI service, thus delivering real-time visibility to source data changes via common Power BI visualization and data alert capabilities.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-14">
<div id="calibre_link-2102" class="calibre2">
<div id="calibre_link-2103" class="calibre3"><div id="calibre_link-2104" class="calibre4">
    <p class="book-title--packt"><img src="images/000131.png" alt="" class="calibre22" /></p>
    <p class="book-title--packt"><a href="http://packt.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">packt.com</span></a></p>
    <p class="book-title--packt">Subscribe to our online digital library for full access to over 7,000 books and videos, as well as industry leading tools to help you plan your personal development and advance your career. For more information, please visit our website.</p>
    <h1 id="calibre_link-2105" class="title">Why subscribe?</h1>
    <ul class="calibre9">
      <li class="bullet">Spend less time learning and more time coding with practical eBooks and Videos from over 4,000 industry professionals</li>
      <li class="bullet">Learn better with Skill Plans built especially for you</li>
      <li class="bullet">Get a free eBook or video every month</li>
      <li class="bullet">Fully searchable for easy access to vital information</li>
      <li class="bullet">Copy and paste, print, and bookmark content</li>
    </ul>
    <p class="book-title--packt">Did you know that Packt offers eBook versions of every book published, with PDF and ePub files available? You can upgrade to the eBook version at <a href="http://www.Packt.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">www.Packt.com</span></a> and as a print book customer, you are entitled to a discount on the eBook copy. Get in touch with us at <a href="mailto:customercare@packtpub.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">customercare@packtpub.com</span></a> for more details.</p>
    <p class="book-title--packt">At <a href="http://www.Packt.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">www.Packt.com</span></a>, you can also read a collection of free technical articles, sign up for a range of free newsletters, and receive exclusive discounts and offers on Packt books and eBooks.</p>
<p class="eop"></p>
    <div class="calibre13"></div><h1 id="calibre_link-1319" class="introduction-title--packt">Other Book You&nbsp;May&nbsp;Enjoy</h1>
    <p class="book-title--packt">If you enjoyed this book, you may be interested in these other books by Packt:</p>
    <p class="book-title--packt"><a href="https://www.packtpub.com/product/microsoft-power-bi-quick-start-guide-second-edition/9781800561571" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><img src="images/000143.png" alt="" class="calibre23" /></a></p>
    <p class="book-title--packt"><strong class="screentext">Microsoft Power BI Quick Start Guide. &ndash; Second Edition</strong></p>
    <p class="book-title--packt">Devin Knight</p>
    <p class="book-title--packt">Mitchell Pearson</p>
    <p class="book-title--packt">Bradley Schacht</p>
    <p class="book-title--packt">Erin Ostrowsky</p>
    <p class="book-title--packt">ISBN: 978-1-80056-157-1</p>
    <ul class="calibre9">
      <li class="bullet">Connect to data sources using import and DirectQuery options</li>
      <li class="bullet">Use Query Editor for data transformation and data cleansing processes, including writing M and R scripts and dataflows to do the same in the cloud</li>
      <li class="bullet">Design optimized data models by designing relationships and DAX calculations</li>
      <li class="bullet">Design effective reports with built-in and custom visuals</li>
      <li class="bullet">Adopt Power BI Desktop and Service to implement row-level security</li>
      <li class="bullet">Administer a Power BI cloud tenant for your organization</li>
      <li class="bullet">Use built-in AI capabilities to enhance Power BI data transformation techniques</li>
      <li class="bullet">Deploy your Power BI desktop files into the Power BI Report Server</li>
    </ul>
<p class="eop"></p>
    <h1 id="calibre_link-2106" class="title">Packt is searching for authors like you</h1>
    <p class="book-title--packt">If you're interested in becoming an author for Packt, please visit <a href="http://authors.packtpub.com" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">authors.packtpub.com</span></a> and apply today. We have worked with thousands of developers and tech professionals, just like you, to help them share their insight with the global tech community. You can make a general application, apply for a specific hot topic that we are recruiting an author for, or submit your own idea.</p>
  </div>
  <div id="calibre_link-2107" class="calibre4">
    <h1 id="calibre_link-2108" class="title">Share Your Thoughts</h1>
    <p class="book-title--packt">Now you've finished <em class="italic">Microsoft Power BI Cookbook, Second Edition</em>, we'd love to hear your thoughts! If you purchased the book from Amazon, <a href="https://packt.link/r/1801813043" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">please click here to go straight to the Amazon review page</span></a> for this book and share your feedback or leave a review on the site that you purchased it from.</p>
    <p class="book-title--packt">Your review is important to us and the tech community and will help us make sure we're delivering excellent quality content.</p>
  </div>
</div>
</div>
</div>


<div class="calibre1" id="calibre_link-15">
<div id="calibre_link-2109" class="calibre2">
<div id="calibre_link-2110" class="calibre3"><div id="calibre_link-1321" type="index" class="calibre4">
    <h1 id="calibre_link-1320" class="introduction-title--packt">Index</h1>
    <p class="book-title--packt">A</p>
    <p class="book-title--packt">Add Conditional Column dialog <a href="#calibre_link-16" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">80</a></p>
    <p class="book-title--packt">additional tools</p>
    <p class="book-title--packt">configuring <a href="#calibre_link-17" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">22</a>, <a href="#calibre_link-18" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">23</a>, <a href="#calibre_link-19" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">24</a>, <a href="#calibre_link-20" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">25</a></p>
    <p class="book-title--packt">installing <a href="#calibre_link-21" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">22</a>, <a href="#calibre_link-22" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">23</a>, <a href="#calibre_link-23" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">24</a>, <a href="#calibre_link-24" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">25</a></p>
    <p class="book-title--packt">advanced analytics</p>
    <p class="book-title--packt">features <a href="#calibre_link-25" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">385</a>, <a href="#calibre_link-26" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">386</a></p>
    <p class="book-title--packt">incorporating <a href="#calibre_link-27" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">382</a>, <a href="#calibre_link-28" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">383</a>, <a href="#calibre_link-29" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">384</a></p>
    <p class="book-title--packt">advanced date intelligence measures</p>
    <p class="book-title--packt">developing <a href="#calibre_link-30" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">298</a>, <a href="#calibre_link-31" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">299</a>, <a href="#calibre_link-32" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">300</a></p>
    <p class="book-title--packt">Advanced Editor</p>
    <p class="book-title--packt">launching <a href="#calibre_link-33" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">33</a>, <a href="#calibre_link-34" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">34</a></p>
    <p class="book-title--packt">Advanced filtering <a href="#calibre_link-35" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">190</a></p>
    <p class="book-title--packt">Advanced Filter Rows Dialog</p>
    <p class="book-title--packt">in Query Editor <a href="#calibre_link-36" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">65</a></p>
    <p class="book-title--packt">AdventureWorksDW2019 database <a href="#calibre_link-37" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">30</a>, <a href="#calibre_link-38" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">31</a></p>
    <p class="book-title--packt">aggregation tables</p>
    <p class="book-title--packt">leveraging <a href="#calibre_link-39" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">172</a>, <a href="#calibre_link-40" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">173</a>, <a href="#calibre_link-41" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">174</a>, <a href="#calibre_link-42" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">175</a></p>
    <p class="book-title--packt">alerts and subscriptions</p>
    <p class="book-title--packt">adding <a href="#calibre_link-43" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">260</a>, <a href="#calibre_link-44" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">261</a>, <a href="#calibre_link-45" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">262</a>, <a href="#calibre_link-46" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">263</a>, <a href="#calibre_link-47" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">264</a>, <a href="#calibre_link-48" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">265</a></p>
    <p class="book-title--packt">ALL function <a href="#calibre_link-49" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">296</a></p>
    <p class="book-title--packt">ALM Toolkit <a href="#calibre_link-50" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">25</a></p>
    <p class="book-title--packt">installing <a href="#calibre_link-51" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">25</a></p>
    <p class="book-title--packt">reference link <a href="#calibre_link-52" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">27</a></p>
    <p class="book-title--packt">analysis layer</p>
    <p class="book-title--packt">constructing <a href="#calibre_link-53" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">446</a>, <a href="#calibre_link-54" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">447</a>, <a href="#calibre_link-55" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">448</a>, <a href="#calibre_link-56" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">449</a>, <a href="#calibre_link-57" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">450</a></p>
    <p class="book-title--packt">Analysis Services <a href="#calibre_link-58" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">12</a>, <a href="#calibre_link-59" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">111</a></p>
    <p class="book-title--packt">Analysis Services features <a href="#calibre_link-60" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">45</a></p>
    <p class="book-title--packt">Analyze</p>
    <p class="book-title--packt">installing, in Excel from Power BI Service <a href="#calibre_link-61" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">17</a>, <a href="#calibre_link-62" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">18</a>, <a href="#calibre_link-63" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">19</a>, <a href="#calibre_link-64" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">20</a></p>
    <p class="book-title--packt">Analyze in Excel</p>
    <p class="book-title--packt">references <a href="#calibre_link-65" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">22</a></p>
    <p class="book-title--packt">annotations</p>
    <p class="book-title--packt">building <a href="#calibre_link-66" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">401</a>, <a href="#calibre_link-67" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">402</a>, <a href="#calibre_link-68" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">403</a>, <a href="#calibre_link-69" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">404</a>, <a href="#calibre_link-70" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">405</a>, <a href="#calibre_link-71" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">406</a>, <a href="#calibre_link-72" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">407</a></p>
    <p class="book-title--packt">anomaly detection</p>
    <p class="book-title--packt">performing <a href="#calibre_link-73" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">424</a>, <a href="#calibre_link-74" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">425</a>, <a href="#calibre_link-75" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">426</a>, <a href="#calibre_link-76" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">427</a>, <a href="#calibre_link-77" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">428</a>, <a href="#calibre_link-78" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">429</a></p>
    <p class="book-title--packt">apps</p>
    <p class="book-title--packt">publishing <a href="#calibre_link-79" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">551</a>, <a href="#calibre_link-80" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">552</a>, <a href="#calibre_link-81" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">553</a>, <a href="#calibre_link-82" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">554</a>, <a href="#calibre_link-83" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">555</a>, <a href="#calibre_link-84" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">556</a></p>
    <p class="book-title--packt">ArcGIS, for Power BI documentation</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-85" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">396</a></p>
    <p class="book-title--packt">ArcGIS maps</p>
    <p class="book-title--packt">geospatial mapping, creating with <a href="#calibre_link-86" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">390</a>, <a href="#calibre_link-87" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">391</a>, <a href="#calibre_link-88" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">392</a>, <a href="#calibre_link-89" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">393</a>, <a href="#calibre_link-90" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">394</a></p>
    <p class="book-title--packt">artificial intelligence</p>
    <p class="book-title--packt">capabilities <a href="#calibre_link-91" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">396</a></p>
    <p class="book-title--packt">democratizing <a href="#calibre_link-92" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">396</a>, <a href="#calibre_link-93" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">397</a>, <a href="#calibre_link-94" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">398</a>, <a href="#calibre_link-95" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">399</a>, <a href="#calibre_link-96" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">400</a></p>
    <p class="book-title--packt">Assume Referential Integrity relationship setting <a href="#calibre_link-97" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">110</a></p>
    <p class="book-title--packt">authentication, with data source</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-98" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">45</a></p>
    <p class="book-title--packt">Automated Machine Learning (AutoML) <a href="#calibre_link-99" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">279</a></p>
    <p class="book-title--packt">automatic data type detection <a href="#calibre_link-100" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">90</a></p>
    <p class="book-title--packt">Azure Active Directory (AAD) <a href="#calibre_link-101" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">351</a></p>
    <p class="book-title--packt">Azure Analysis Services</p>
    <p class="book-title--packt">connecting to <a href="#calibre_link-102" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">596</a>, <a href="#calibre_link-103" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">598</a>, <a href="#calibre_link-104" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">599</a>, <a href="#calibre_link-105" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">600</a></p>
    <p class="book-title--packt">Azure Data Catalog <a href="#calibre_link-106" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">146</a></p>
    <p class="book-title--packt">B</p>
    <p class="book-title--packt">best practices rules, Tabular Editor</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-107" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">499</a></p>
    <p class="book-title--packt">best practices rules, to improve model performance</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-108" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">499</a></p>
    <p class="book-title--packt">binaries, combining in Power BI Desktop</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-109" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">446</a></p>
    <p class="book-title--packt">binning <a href="#calibre_link-110" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">166</a></p>
    <p class="book-title--packt">Bookmarks</p>
    <p class="book-title--packt">enabling <a href="#calibre_link-111" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">407</a>, <a href="#calibre_link-112" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">408</a></p>
    <p class="book-title--packt">Budget Filter Test measure <a href="#calibre_link-113" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">152</a></p>
    <p class="book-title--packt">C</p>
    <p class="book-title--packt">calculated tables</p>
    <p class="book-title--packt">date intelligence, simplifying <a href="#calibre_link-114" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">303</a>, <a href="#calibre_link-115" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">304</a></p>
    <p class="book-title--packt">CALCULATE function <a href="#calibre_link-116" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">296</a></p>
    <p class="book-title--packt">calculation groups</p>
    <p class="book-title--packt">leveraging <a href="#calibre_link-117" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">306</a>, <a href="#calibre_link-118" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">307</a>, <a href="#calibre_link-119" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">308</a>, <a href="#calibre_link-120" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">309</a>, <a href="#calibre_link-121" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">310</a></p>
    <p class="book-title--packt">calculation groups, Analysis Services tabular models</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-122" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">311</a></p>
    <p class="book-title--packt">card visualizations</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-123" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">196</a></p>
    <p class="book-title--packt">Card visualizations</p>
    <p class="book-title--packt">integrating <a href="#calibre_link-124" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">191</a>, <a href="#calibre_link-125" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">192</a>, <a href="#calibre_link-126" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">193</a>, <a href="#calibre_link-127" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">194</a></p>
    <p class="book-title--packt">centralized IT monitoring solution</p>
    <p class="book-title--packt">creating, with Power BI <a href="#calibre_link-128" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">440</a>, <a href="#calibre_link-129" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">441</a>, <a href="#calibre_link-130" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">442</a>, <a href="#calibre_link-131" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">444</a>, <a href="#calibre_link-132" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">445</a></p>
    <p class="book-title--packt">clustering, applying techniques</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-133" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">424</a></p>
    <p class="book-title--packt">clusters</p>
    <p class="book-title--packt">detecting and analyzing <a href="#calibre_link-134" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">419</a>, <a href="#calibre_link-135" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">420</a>, <a href="#calibre_link-136" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">421</a>, <a href="#calibre_link-137" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">422</a>, <a href="#calibre_link-138" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">423</a>, <a href="#calibre_link-139" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">424</a></p>
    <p class="book-title--packt">Color Blind Friendly theme</p>
    <p class="book-title--packt">download link <a href="#calibre_link-140" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">185</a></p>
    <p class="book-title--packt">column data types</p>
    <p class="book-title--packt">selecting <a href="#calibre_link-141" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">87</a>, <a href="#calibre_link-142" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">88</a>, <a href="#calibre_link-143" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">89</a>, <a href="#calibre_link-144" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">90</a></p>
    <p class="book-title--packt">Column distribution <a href="#calibre_link-145" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">97</a></p>
    <p class="book-title--packt">Column From Examples feature <a href="#calibre_link-146" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">78</a></p>
    <p class="book-title--packt">Column From Examples interface <a href="#calibre_link-147" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">79</a></p>
    <p class="book-title--packt">column level security</p>
    <p class="book-title--packt">alternative approaches <a href="#calibre_link-148" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">170</a>, <a href="#calibre_link-149" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">171</a></p>
    <p class="book-title--packt">designing <a href="#calibre_link-150" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">167</a>, <a href="#calibre_link-151" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">168</a>, <a href="#calibre_link-152" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">169</a>, <a href="#calibre_link-153" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">170</a></p>
    <p class="book-title--packt">Column quality <a href="#calibre_link-154" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">97</a></p>
    <p class="book-title--packt">columns <a href="#calibre_link-155" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">66</a></p>
    <p class="book-title--packt">eliminating <a href="#calibre_link-156" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">69</a></p>
    <p class="book-title--packt">hiding <a href="#calibre_link-157" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">134</a>, <a href="#calibre_link-158" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">135</a>, <a href="#calibre_link-159" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">136</a>, <a href="#calibre_link-160" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">137</a>, <a href="#calibre_link-161" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">138</a></p>
    <p class="book-title--packt">renaming <a href="#calibre_link-162" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">67</a>, <a href="#calibre_link-163" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">68</a></p>
    <p class="book-title--packt">selecting <a href="#calibre_link-164" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">68</a></p>
    <p class="book-title--packt">Combine Binaries feature <a href="#calibre_link-165" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">87</a></p>
    <p class="book-title--packt">comments <a href="#calibre_link-166" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">512</a></p>
    <p class="book-title--packt">Common Data Service (CDS) <a href="#calibre_link-167" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">610</a></p>
    <p class="book-title--packt">composite model projects <a href="#calibre_link-168" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">45</a></p>
    <p class="book-title--packt">conditional table formatting, in Power BI Desktop</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-169" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">218</a></p>
    <p class="book-title--packt">Condition Column feature <a href="#calibre_link-170" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">79</a></p>
    <p class="book-title--packt">connect live <a href="#calibre_link-171" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">599</a></p>
    <p class="book-title--packt">content</p>
    <p class="book-title--packt">distributing, with teams <a href="#calibre_link-172" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">568</a>, <a href="#calibre_link-173" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">569</a>, <a href="#calibre_link-174" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">570</a>, <a href="#calibre_link-175" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">571</a>, <a href="#calibre_link-176" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">572</a></p>
    <p class="book-title--packt">managing, between environments <a href="#calibre_link-177" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">532</a>, <a href="#calibre_link-178" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">533</a>, <a href="#calibre_link-179" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">534</a>, <a href="#calibre_link-180" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">535</a></p>
    <p class="book-title--packt">sharing, with colleagues <a href="#calibre_link-181" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">535</a>, <a href="#calibre_link-182" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">536</a>, <a href="#calibre_link-183" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">537</a>, <a href="#calibre_link-184" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">538</a></p>
    <p class="book-title--packt">content collaboration</p>
    <p class="book-title--packt">preparing <a href="#calibre_link-185" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">524</a>, <a href="#calibre_link-186" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">525</a>, <a href="#calibre_link-187" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">526</a>, <a href="#calibre_link-188" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">527</a>, <a href="#calibre_link-189" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">528</a></p>
    <p class="book-title--packt">content creation</p>
    <p class="book-title--packt">preparing <a href="#calibre_link-190" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">524</a>, <a href="#calibre_link-191" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">525</a>, <a href="#calibre_link-192" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">526</a>, <a href="#calibre_link-193" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">527</a>, <a href="#calibre_link-194" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">528</a></p>
    <p class="book-title--packt">copy and paste report visualization</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-195" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">196</a></p>
    <p class="book-title--packt">cross-filtering interactions <a href="#calibre_link-196" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">204</a></p>
    <p class="book-title--packt">cross-report drill through <a href="#calibre_link-197" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">222</a></p>
    <p class="book-title--packt">current filter context</p>
    <p class="book-title--packt">displaying <a href="#calibre_link-198" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">369</a>, <a href="#calibre_link-199" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">371</a>, <a href="#calibre_link-200" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">372</a></p>
    <p class="book-title--packt">current user context</p>
    <p class="book-title--packt">capturing <a href="#calibre_link-201" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">350</a>, <a href="#calibre_link-202" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">351</a></p>
    <p class="book-title--packt">custom columns</p>
    <p class="book-title--packt">creating <a href="#calibre_link-203" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">74</a>, <a href="#calibre_link-204" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">75</a>, <a href="#calibre_link-205" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">76</a>, <a href="#calibre_link-206" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">77</a>, <a href="#calibre_link-207" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">78</a></p>
    <p class="book-title--packt">CustomerKeys query <a href="#calibre_link-208" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">325</a></p>
    <p class="book-title--packt">customer relationship management (CRM) <a href="#calibre_link-209" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">615</a></p>
    <p class="book-title--packt">Custom Functions, writing in Power Query M</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-210" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">331</a></p>
    <p class="book-title--packt">custom visuals</p>
    <p class="book-title--packt">content, enriching with <a href="#calibre_link-211" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">386</a>, <a href="#calibre_link-212" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">387</a>, <a href="#calibre_link-213" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">388</a></p>
    <p class="book-title--packt">D</p>
    <p class="book-title--packt">dashboard</p>
    <p class="book-title--packt">building <a href="#calibre_link-214" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">246</a>, <a href="#calibre_link-215" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">247</a>, <a href="#calibre_link-216" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">248</a>, <a href="#calibre_link-217" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">249</a>, <a href="#calibre_link-218" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">250</a>, <a href="#calibre_link-219" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">251</a>, <a href="#calibre_link-220" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">252</a>, <a href="#calibre_link-221" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">253</a>, <a href="#calibre_link-222" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">254</a></p>
    <p class="book-title--packt">dashboard, for Power BI designers</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-223" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">254</a></p>
    <p class="book-title--packt">data</p>
    <p class="book-title--packt">cleansing <a href="#calibre_link-224" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">70</a>, <a href="#calibre_link-225" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">71</a>, <a href="#calibre_link-226" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">72</a></p>
    <p class="book-title--packt">importing <a href="#calibre_link-227" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">50</a>, <a href="#calibre_link-228" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">51</a>, <a href="#calibre_link-229" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">52</a>, <a href="#calibre_link-230" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">53</a>, <a href="#calibre_link-231" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">54</a>, <a href="#calibre_link-232" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">55</a></p>
    <p class="book-title--packt">transforming <a href="#calibre_link-233" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">70</a>, <a href="#calibre_link-234" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">71</a>, <a href="#calibre_link-235" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">72</a></p>
    <p class="book-title--packt">dataflows</p>
    <p class="book-title--packt">authoring <a href="#calibre_link-236" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">274</a>, <a href="#calibre_link-237" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">275</a>, <a href="#calibre_link-238" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">276</a>, <a href="#calibre_link-239" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">277</a>, <a href="#calibre_link-240" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">278</a>, <a href="#calibre_link-241" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">279</a></p>
    <p class="book-title--packt">references <a href="#calibre_link-242" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">280</a></p>
    <p class="book-title--packt">using <a href="#calibre_link-243" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">279</a></p>
    <p class="book-title--packt">data import</p>
    <p class="book-title--packt">strengthening <a href="#calibre_link-244" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">510</a>, <a href="#calibre_link-245" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">511</a></p>
    <p class="book-title--packt">data load speeds</p>
    <p class="book-title--packt">improving, with incremental refresh <a href="#calibre_link-246" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">518</a>, <a href="#calibre_link-247" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">519</a>, <a href="#calibre_link-248" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">520</a>, <a href="#calibre_link-249" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">521</a></p>
    <p class="book-title--packt">data model</p>
    <p class="book-title--packt">designing <a href="#calibre_link-250" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">106</a>, <a href="#calibre_link-251" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">107</a>, <a href="#calibre_link-252" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">108</a>, <a href="#calibre_link-253" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">109</a>, <a href="#calibre_link-254" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">110</a>, <a href="#calibre_link-255" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">111</a></p>
    <p class="book-title--packt">implementing <a href="#calibre_link-256" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">112</a>, <a href="#calibre_link-257" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">113</a>, <a href="#calibre_link-258" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">114</a>, <a href="#calibre_link-259" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">115</a>, <a href="#calibre_link-260" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">116</a>, <a href="#calibre_link-261" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">117</a></p>
    <p class="book-title--packt">scalability, enhancing <a href="#calibre_link-262" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">492</a>, <a href="#calibre_link-263" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">493</a>, <a href="#calibre_link-264" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">494</a>, <a href="#calibre_link-265" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">495</a>, <a href="#calibre_link-266" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">496</a>, <a href="#calibre_link-267" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">497</a></p>
    <p class="book-title--packt">usability, enhancing <a href="#calibre_link-268" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">492</a>, <a href="#calibre_link-269" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">493</a>, <a href="#calibre_link-270" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">494</a>, <a href="#calibre_link-271" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">495</a>, <a href="#calibre_link-272" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">496</a>, <a href="#calibre_link-273" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">497</a></p>
    <p class="book-title--packt">data, optimizing for Power BI quick insights</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-274" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">390</a></p>
    <p class="book-title--packt">data profiling tools</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-275" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">97</a></p>
    <p class="book-title--packt">data quality <a href="#calibre_link-276" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">95</a></p>
    <p class="book-title--packt">Data Quality Services <a href="#calibre_link-277" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">146</a></p>
    <p class="book-title--packt">data reduction techniques, Import modeling</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-278" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">58</a></p>
    <p class="book-title--packt">dataset modes, Power BI service</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-279" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">58</a></p>
    <p class="book-title--packt">datasets</p>
    <p class="book-title--packt">streaming <a href="#calibre_link-280" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">270</a>, <a href="#calibre_link-281" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">271</a>, <a href="#calibre_link-282" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">272</a>, <a href="#calibre_link-283" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">273</a></p>
    <p class="book-title--packt">dataset storage mode</p>
    <p class="book-title--packt">selecting <a href="#calibre_link-284" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">109</a></p>
    <p class="book-title--packt">data source credentials</p>
    <p class="book-title--packt">managing <a href="#calibre_link-285" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">44</a></p>
    <p class="book-title--packt">data source management <a href="#calibre_link-286" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">512</a>, <a href="#calibre_link-287" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">513</a></p>
    <p class="book-title--packt">data source queries</p>
    <p class="book-title--packt">isolating, from data load queries <a href="#calibre_link-288" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">40</a>, <a href="#calibre_link-289" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">41</a>, <a href="#calibre_link-290" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">42</a></p>
    <p class="book-title--packt">data sources <a href="#calibre_link-291" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">39</a></p>
    <p class="book-title--packt">managing <a href="#calibre_link-292" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">39</a>, <a href="#calibre_link-293" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">40</a>, <a href="#calibre_link-294" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">41</a>, <a href="#calibre_link-295" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">42</a>, <a href="#calibre_link-296" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">43</a></p>
    <p class="book-title--packt">Dataverse</p>
    <p class="book-title--packt">using <a href="#calibre_link-297" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">610</a>, <a href="#calibre_link-298" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">611</a>, <a href="#calibre_link-299" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">612</a>, <a href="#calibre_link-300" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">613</a>, <a href="#calibre_link-301" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">615</a></p>
    <p class="book-title--packt">data warehouse bus matrix</p>
    <p class="book-title--packt">creating <a href="#calibre_link-302" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">108</a></p>
    <p class="book-title--packt">date dimension <a href="#calibre_link-303" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">282</a></p>
    <p class="book-title--packt">preparing, via Query Editor <a href="#calibre_link-304" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">287</a>, <a href="#calibre_link-305" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">290</a>, <a href="#calibre_link-306" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">291</a>, <a href="#calibre_link-307" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">292</a></p>
    <p class="book-title--packt">date dimension table</p>
    <p class="book-title--packt">building <a href="#calibre_link-308" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">283</a>, <a href="#calibre_link-309" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">284</a>, <a href="#calibre_link-310" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">285</a>, <a href="#calibre_link-311" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">286</a></p>
    <p class="book-title--packt">date intelligence <a href="#calibre_link-312" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">281</a></p>
    <p class="book-title--packt">simplifying, with calculated tables <a href="#calibre_link-313" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">303</a>, <a href="#calibre_link-314" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">304</a></p>
    <p class="book-title--packt">simplifying, with DAX <a href="#calibre_link-315" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">303</a>, <a href="#calibre_link-316" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">304</a></p>
    <p class="book-title--packt">date intelligence measures</p>
    <p class="book-title--packt">authoring <a href="#calibre_link-317" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">293</a>, <a href="#calibre_link-318" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">294</a>, <a href="#calibre_link-319" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">295</a>, <a href="#calibre_link-320" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">296</a>, <a href="#calibre_link-321" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">297</a></p>
    <p class="book-title--packt">simplifying <a href="#calibre_link-322" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">304</a>, <a href="#calibre_link-323" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">305</a></p>
    <p class="book-title--packt">date range filters <a href="#calibre_link-324" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">189</a></p>
    <p class="book-title--packt">DateTime.LocalNow function <a href="#calibre_link-325" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">291</a></p>
    <p class="book-title--packt">DAX</p>
    <p class="book-title--packt">model, enriching <a href="#calibre_link-326" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">140</a>, <a href="#calibre_link-327" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">141</a>, <a href="#calibre_link-328" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">143</a>, <a href="#calibre_link-329" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">144</a>, <a href="#calibre_link-330" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">145</a>, <a href="#calibre_link-331" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">146</a>, <a href="#calibre_link-332" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">147</a>, <a href="#calibre_link-333" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">148</a>, <a href="#calibre_link-334" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">149</a>, <a href="#calibre_link-335" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">150</a></p>
    <p class="book-title--packt">DAX 445 Custom Financial Calendar</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-336" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">282</a></p>
    <p class="book-title--packt">DAX authoring <a href="#calibre_link-337" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">517</a></p>
    <p class="book-title--packt">DAX CONCATENATEX function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-338" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">374</a></p>
    <p class="book-title--packt">DAX CROSSJOIN function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-339" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">303</a></p>
    <p class="book-title--packt">DAX (Data Analysis Expressions) <a href="#calibre_link-340" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">22</a></p>
    <p class="book-title--packt">DAX expressions</p>
    <p class="book-title--packt">documenting <a href="#calibre_link-341" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">514</a>, <a href="#calibre_link-342" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">515</a>, <a href="#calibre_link-343" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">516</a></p>
    <p class="book-title--packt">isolating <a href="#calibre_link-344" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">514</a>, <a href="#calibre_link-345" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">515</a>, <a href="#calibre_link-346" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">516</a></p>
    <p class="book-title--packt">DAX FILTER function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-347" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">298</a></p>
    <p class="book-title--packt">DAX FILTERS function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-348" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">374</a></p>
    <p class="book-title--packt">DAX Formatter <a href="#calibre_link-349" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">516</a></p>
    <p class="book-title--packt">DAX HASONEVALUE function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-350" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">298</a>, <a href="#calibre_link-351" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">303</a></p>
    <p class="book-title--packt">DAX ISCROSSFILTERED function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-352" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">374</a></p>
    <p class="book-title--packt">DAX LOOKUPVALUE function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-353" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">302</a>, <a href="#calibre_link-354" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">306</a>, <a href="#calibre_link-355" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">379</a></p>
    <p class="book-title--packt">DAX measure</p>
    <p class="book-title--packt">example <a href="#calibre_link-356" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">503</a>, <a href="#calibre_link-357" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">504</a></p>
    <p class="book-title--packt">DAX measure performance</p>
    <p class="book-title--packt">improving <a href="#calibre_link-358" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">499</a>, <a href="#calibre_link-359" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">500</a>, <a href="#calibre_link-360" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">501</a>, <a href="#calibre_link-361" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">502</a></p>
    <p class="book-title--packt">DAX measures</p>
    <p class="book-title--packt">creating <a href="#calibre_link-362" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">414</a></p>
    <p class="book-title--packt">DAX ROW function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-363" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">306</a></p>
    <p class="book-title--packt">DAX SELECTCOLUMNS function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-364" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">306</a></p>
    <p class="book-title--packt">DAX SELECTEDMEASURE function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-365" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">311</a></p>
    <p class="book-title--packt">DAX Studio <a href="#calibre_link-366" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">516</a></p>
    <p class="book-title--packt">DAX Studio tutorials</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-367" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">27</a></p>
    <p class="book-title--packt">DAX time intelligence functions <a href="#calibre_link-368" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">297</a></p>
    <p class="book-title--packt">reference link <a href="#calibre_link-369" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">298</a></p>
    <p class="book-title--packt">DAX USERNAME function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-370" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">353</a></p>
    <p class="book-title--packt">DAX USEROBJECTID function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-371" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">353</a></p>
    <p class="book-title--packt">DAX USERPRINCIPALNAME function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-372" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">353</a></p>
    <p class="book-title--packt">DBA productivity</p>
    <p class="book-title--packt">increasing <a href="#calibre_link-373" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">455</a>, <a href="#calibre_link-374" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">456</a>, <a href="#calibre_link-375" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">457</a>, <a href="#calibre_link-376" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">458</a>, <a href="#calibre_link-377" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">459</a>, <a href="#calibre_link-378" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">460</a></p>
    <p class="book-title--packt">Decomposition tree <a href="#calibre_link-379" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">400</a></p>
    <p class="book-title--packt">reference link <a href="#calibre_link-380" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">401</a></p>
    <p class="book-title--packt">Detect data changes setting <a href="#calibre_link-381" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">521</a></p>
    <p class="book-title--packt">Development environment <a href="#calibre_link-382" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">40</a></p>
    <p class="book-title--packt">Diagnose Step feature <a href="#calibre_link-383" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">103</a>, <a href="#calibre_link-384" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">104</a></p>
    <p class="book-title--packt">dimensional design process <a href="#calibre_link-385" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">107</a>, <a href="#calibre_link-386" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">108</a></p>
    <p class="book-title--packt">DirectQuery <a href="#calibre_link-387" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">109</a></p>
    <p class="book-title--packt">dynamic security, building for <a href="#calibre_link-388" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">365</a>, <a href="#calibre_link-389" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">366</a>, <a href="#calibre_link-390" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">368</a></p>
    <p class="book-title--packt">limitations <a href="#calibre_link-391" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">110</a></p>
    <p class="book-title--packt">using <a href="#calibre_link-392" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">45</a>, <a href="#calibre_link-393" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">46</a>, <a href="#calibre_link-394" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">47</a>, <a href="#calibre_link-395" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">48</a></p>
    <p class="book-title--packt">DirectQuery mode <a href="#calibre_link-396" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">172</a></p>
    <p class="book-title--packt">documentation</p>
    <p class="book-title--packt">providing <a href="#calibre_link-397" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">461</a>, <a href="#calibre_link-398" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">462</a>, <a href="#calibre_link-399" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">463</a>, <a href="#calibre_link-400" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">464</a>, <a href="#calibre_link-401" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">465</a>, <a href="#calibre_link-402" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">466</a></p>
    <p class="book-title--packt">drill through, in Power BI reports</p>
    <p class="book-title--packt">references <a href="#calibre_link-403" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">223</a></p>
    <p class="book-title--packt">dynamic functions</p>
    <p class="book-title--packt">static queries, converting to <a href="#calibre_link-404" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">326</a>, <a href="#calibre_link-405" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">327</a>, <a href="#calibre_link-406" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">328</a>, <a href="#calibre_link-407" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">329</a>, <a href="#calibre_link-408" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">330</a>, <a href="#calibre_link-409" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">331</a></p>
    <p class="book-title--packt">dynamic management view (DMV) data</p>
    <p class="book-title--packt">importing <a href="#calibre_link-410" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">450</a>, <a href="#calibre_link-411" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">451</a>, <a href="#calibre_link-412" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">452</a>, <a href="#calibre_link-413" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">453</a>, <a href="#calibre_link-414" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">454</a></p>
    <p class="book-title--packt">visualizing <a href="#calibre_link-415" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">450</a>, <a href="#calibre_link-416" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">451</a>, <a href="#calibre_link-417" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">452</a>, <a href="#calibre_link-418" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">453</a>, <a href="#calibre_link-419" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">454</a></p>
    <p class="book-title--packt">dynamic management views (DMVs) <a href="#calibre_link-420" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">461</a></p>
    <p class="book-title--packt">Dynamic M query parameters, in Power BI Desktop</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-421" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">337</a></p>
    <p class="book-title--packt">Dynamics 365</p>
    <p class="book-title--packt">using <a href="#calibre_link-422" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">610</a>, <a href="#calibre_link-423" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">611</a>, <a href="#calibre_link-424" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">612</a>, <a href="#calibre_link-425" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">613</a>, <a href="#calibre_link-426" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">614</a>, <a href="#calibre_link-427" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">615</a></p>
    <p class="book-title--packt">Dynamics 365 Finance and Operations</p>
    <p class="book-title--packt">connecting <a href="#calibre_link-428" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">615</a>, <a href="#calibre_link-429" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">616</a>, <a href="#calibre_link-430" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">617</a>, <a href="#calibre_link-431" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">619</a>, <a href="#calibre_link-432" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">620</a></p>
    <p class="book-title--packt">dynamic security</p>
    <p class="book-title--packt">building, for DirectQuery <a href="#calibre_link-433" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">365</a>, <a href="#calibre_link-434" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">366</a>, <a href="#calibre_link-435" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">368</a></p>
    <p class="book-title--packt">dynamic security models</p>
    <p class="book-title--packt">designing <a href="#calibre_link-436" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">361</a>, <a href="#calibre_link-437" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">362</a>, <a href="#calibre_link-438" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">363</a>, <a href="#calibre_link-439" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">364</a></p>
    <p class="book-title--packt">E</p>
    <p class="book-title--packt">enterprise resource planning (ERP) <a href="#calibre_link-440" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">615</a></p>
    <p class="book-title--packt">environment <a href="#calibre_link-441" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">evaluation <a href="#calibre_link-442" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">Excel</p>
    <p class="book-title--packt">content, deploying from <a href="#calibre_link-443" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">266</a>, <a href="#calibre_link-444" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">267</a>, <a href="#calibre_link-445" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">268</a>, <a href="#calibre_link-446" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">269</a></p>
    <p class="book-title--packt">integrating <a href="#calibre_link-447" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">574</a>, <a href="#calibre_link-448" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">575</a>, <a href="#calibre_link-449" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">576</a>, <a href="#calibre_link-450" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">577</a>, <a href="#calibre_link-451" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">578</a>, <a href="#calibre_link-452" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">579</a>, <a href="#calibre_link-453" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">580</a>, <a href="#calibre_link-454" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">581</a>, <a href="#calibre_link-455" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">582</a></p>
    <p class="book-title--packt">Power BI dataset, accessing <a href="#calibre_link-456" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">587</a>, <a href="#calibre_link-457" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">588</a>, <a href="#calibre_link-458" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">589</a>, <a href="#calibre_link-459" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">590</a>, <a href="#calibre_link-460" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">591</a></p>
    <p class="book-title--packt">Power BI dataset, analyzing <a href="#calibre_link-461" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">587</a>, <a href="#calibre_link-462" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">588</a>, <a href="#calibre_link-463" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">589</a>, <a href="#calibre_link-464" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">590</a>, <a href="#calibre_link-465" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">591</a></p>
    <p class="book-title--packt">Excel Data</p>
    <p class="book-title--packt">Power Pivot, migrating to Power BI <a href="#calibre_link-466" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">582</a>, <a href="#calibre_link-467" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">583</a>, <a href="#calibre_link-468" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">584</a>, <a href="#calibre_link-469" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">585</a>, <a href="#calibre_link-470" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">586</a></p>
    <p class="book-title--packt">expression <a href="#calibre_link-471" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">35</a></p>
    <p class="book-title--packt">Extended Events</p>
    <p class="book-title--packt">analyzing <a href="#calibre_link-472" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">473</a>, <a href="#calibre_link-473" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">474</a>, <a href="#calibre_link-474" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">475</a>, <a href="#calibre_link-475" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">476</a>, <a href="#calibre_link-476" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">477</a></p>
    <p class="book-title--packt">F</p>
    <p class="book-title--packt">filter expressions</p>
    <p class="book-title--packt">defining <a href="#calibre_link-477" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">353</a>, <a href="#calibre_link-478" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">354</a>, <a href="#calibre_link-479" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">355</a>, <a href="#calibre_link-480" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">356</a>, <a href="#calibre_link-481" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">357</a>, <a href="#calibre_link-482" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">358</a>, <a href="#calibre_link-483" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">359</a>, <a href="#calibre_link-484" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">360</a></p>
    <p class="book-title--packt">FILTER function <a href="#calibre_link-485" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">296</a></p>
    <p class="book-title--packt">Filter Rows dialog</p>
    <p class="book-title--packt">accessing <a href="#calibre_link-486" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">64</a></p>
    <p class="book-title--packt">filters</p>
    <p class="book-title--packt">implementing, at different scopes <a href="#calibre_link-487" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">187</a>, <a href="#calibre_link-488" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">188</a>, <a href="#calibre_link-489" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">189</a></p>
    <p class="book-title--packt">filter test measure <a href="#calibre_link-490" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">151</a></p>
    <p class="book-title--packt">forecasting</p>
    <p class="book-title--packt">feature <a href="#calibre_link-491" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">429</a></p>
    <p class="book-title--packt">performing <a href="#calibre_link-492" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">424</a>, <a href="#calibre_link-493" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">425</a>, <a href="#calibre_link-494" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">426</a>, <a href="#calibre_link-495" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">427</a>, <a href="#calibre_link-496" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">428</a>, <a href="#calibre_link-497" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">429</a></p>
    <p class="book-title--packt">with what-if analysis <a href="#calibre_link-498" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">338</a>, <a href="#calibre_link-499" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">339</a>, <a href="#calibre_link-500" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">340</a>, <a href="#calibre_link-501" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">341</a>, <a href="#calibre_link-502" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">342</a>, <a href="#calibre_link-503" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">343</a>, <a href="#calibre_link-504" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">344</a>, <a href="#calibre_link-505" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">345</a>, <a href="#calibre_link-506" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">346</a>, <a href="#calibre_link-507" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">347</a>, <a href="#calibre_link-508" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">348</a></p>
    <p class="book-title--packt">formatting <a href="#calibre_link-509" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">131</a></p>
    <p class="book-title--packt">formula bar <a href="#calibre_link-510" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">33</a></p>
    <p class="book-title--packt">function <a href="#calibre_link-511" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">G</p>
    <p class="book-title--packt">gateway clusters <a href="#calibre_link-512" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">16</a></p>
    <p class="book-title--packt">Gauge visualization <a href="#calibre_link-513" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">195</a></p>
    <p class="book-title--packt">geographic information systems (GIS) <a href="#calibre_link-514" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">390</a></p>
    <p class="book-title--packt">geospatial mapping</p>
    <p class="book-title--packt">creating, with ArcGIS maps <a href="#calibre_link-515" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">390</a>, <a href="#calibre_link-516" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">391</a>, <a href="#calibre_link-517" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">392</a>, <a href="#calibre_link-518" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">393</a>, <a href="#calibre_link-519" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">394</a></p>
    <p class="book-title--packt">graphical visualizations</p>
    <p class="book-title--packt">utilizing <a href="#calibre_link-520" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">206</a>, <a href="#calibre_link-521" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">207</a>, <a href="#calibre_link-522" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">208</a>, <a href="#calibre_link-523" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">209</a>, <a href="#calibre_link-524" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">210</a></p>
    <p class="book-title--packt">grouping <a href="#calibre_link-525" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">166</a></p>
    <p class="book-title--packt">grouping and binning</p>
    <p class="book-title--packt">using <a href="#calibre_link-526" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">415</a>, <a href="#calibre_link-527" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">416</a>, <a href="#calibre_link-528" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">417</a>, <a href="#calibre_link-529" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">418</a>, <a href="#calibre_link-530" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">419</a></p>
    <p class="book-title--packt">using, reference link <a href="#calibre_link-531" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">419</a></p>
    <p class="book-title--packt">groups</p>
    <p class="book-title--packt">creating <a href="#calibre_link-532" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">160</a>, <a href="#calibre_link-533" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">161</a>, <a href="#calibre_link-534" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">162</a>, <a href="#calibre_link-535" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">163</a>, <a href="#calibre_link-536" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">164</a>, <a href="#calibre_link-537" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">165</a>, <a href="#calibre_link-538" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">166</a></p>
    <p class="book-title--packt">H</p>
    <p class="book-title--packt">hierarchies</p>
    <p class="book-title--packt">creating <a href="#calibre_link-539" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">160</a>, <a href="#calibre_link-540" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">161</a>, <a href="#calibre_link-541" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">162</a>, <a href="#calibre_link-542" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">163</a>, <a href="#calibre_link-543" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">164</a>, <a href="#calibre_link-544" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">165</a>, <a href="#calibre_link-545" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">166</a></p>
    <p class="book-title--packt">horizontal slicers <a href="#calibre_link-546" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">201</a></p>
    <p class="book-title--packt">I</p>
    <p class="book-title--packt">Image URL <a href="#calibre_link-547" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">131</a></p>
    <p class="book-title--packt">implementation bus matrix</p>
    <p class="book-title--packt">creating <a href="#calibre_link-548" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">109</a></p>
    <p class="book-title--packt">import <a href="#calibre_link-549" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">50</a></p>
    <p class="book-title--packt">Import <a href="#calibre_link-550" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">56</a></p>
    <p class="book-title--packt">incremental refresh <a href="#calibre_link-551" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">518</a></p>
    <p class="book-title--packt">data load speeds, improving <a href="#calibre_link-552" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">518</a>, <a href="#calibre_link-553" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">519</a>, <a href="#calibre_link-554" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">520</a>, <a href="#calibre_link-555" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">521</a></p>
    <p class="book-title--packt">references <a href="#calibre_link-556" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">522</a></p>
    <p class="book-title--packt">settings <a href="#calibre_link-557" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">521</a></p>
    <p class="book-title--packt">Independent Software Vendor (ISV) <a href="#calibre_link-558" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">325</a></p>
    <p class="book-title--packt">infrastructure-as-a-service (IaaS) <a href="#calibre_link-559" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">12</a></p>
    <p class="book-title--packt">integration processes</p>
    <p class="book-title--packt">strengthening <a href="#calibre_link-560" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">510</a>, <a href="#calibre_link-561" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">511</a></p>
    <p class="book-title--packt">Internet Sales Budget table <a href="#calibre_link-562" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">151</a></p>
    <p class="book-title--packt">Internet Sales fact table <a href="#calibre_link-563" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">151</a></p>
    <p class="book-title--packt">K</p>
    <p class="book-title--packt">Key influencers visual <a href="#calibre_link-564" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">399</a></p>
    <p class="book-title--packt">key performance indicator (KPI) visuals</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-565" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">196</a></p>
    <p class="book-title--packt">key performance indicators (KPIs) <a href="#calibre_link-566" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">245</a></p>
    <p class="book-title--packt">KPI-style visualization <a href="#calibre_link-567" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">195</a></p>
    <p class="book-title--packt">L</p>
    <p class="book-title--packt">lazy evaluation <a href="#calibre_link-568" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">35</a></p>
    <p class="book-title--packt">let expression <a href="#calibre_link-569" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">ley influencers visualizations tutorial</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-570" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">401</a></p>
    <p class="book-title--packt">Line chart visual <a href="#calibre_link-571" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">428</a></p>
    <p class="book-title--packt">locales <a href="#calibre_link-572" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">91</a></p>
    <p class="book-title--packt">log file data</p>
    <p class="book-title--packt">visualizing <a href="#calibre_link-573" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">478</a>, <a href="#calibre_link-574" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">479</a>, <a href="#calibre_link-575" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">480</a>, <a href="#calibre_link-576" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">481</a>, <a href="#calibre_link-577" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">482</a>, <a href="#calibre_link-578" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">483</a></p>
    <p class="book-title--packt">M</p>
    <p class="book-title--packt">manual user clicks</p>
    <p class="book-title--packt">avoiding <a href="#calibre_link-579" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">374</a>, <a href="#calibre_link-580" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">375</a>, <a href="#calibre_link-581" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">376</a>, <a href="#calibre_link-582" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">377</a>, <a href="#calibre_link-583" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">378</a>, <a href="#calibre_link-584" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">379</a></p>
    <p class="book-title--packt">many-to-many model</p>
    <p class="book-title--packt">with single-direction cross-filtering relationships <a href="#calibre_link-585" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">124</a>, <a href="#calibre_link-586" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">125</a></p>
    <p class="book-title--packt">Master Data Services (MDS) <a href="#calibre_link-587" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">109</a>, <a href="#calibre_link-588" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">146</a></p>
    <p class="book-title--packt">matrix visualizations, in Power BI</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-589" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">217</a></p>
    <p class="book-title--packt">matrix visuals</p>
    <p class="book-title--packt">creating <a href="#calibre_link-590" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">212</a>, <a href="#calibre_link-591" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">214</a>, <a href="#calibre_link-592" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">216</a></p>
    <p class="book-title--packt">megabytes (MB) <a href="#calibre_link-593" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">453</a></p>
    <p class="book-title--packt">M engine <a href="#calibre_link-594" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">35</a></p>
    <p class="book-title--packt">metadata <a href="#calibre_link-595" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">126</a></p>
    <p class="book-title--packt">M functions</p>
    <p class="book-title--packt">analyzing <a href="#calibre_link-596" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">30</a>, <a href="#calibre_link-597" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">31</a>, <a href="#calibre_link-598" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">32</a>, <a href="#calibre_link-599" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">33</a>, <a href="#calibre_link-600" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">34</a></p>
    <p class="book-title--packt">viewing <a href="#calibre_link-601" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">30</a>, <a href="#calibre_link-602" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">31</a>, <a href="#calibre_link-603" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">33</a>, <a href="#calibre_link-604" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">34</a></p>
    <p class="book-title--packt">M Functions</p>
    <p class="book-title--packt">analyzing <a href="#calibre_link-605" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">35</a></p>
    <p class="book-title--packt">viewing <a href="#calibre_link-606" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">35</a></p>
    <p class="book-title--packt">Microsoft Business Applications Summit (MBAS) <a href="#calibre_link-607" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">11</a></p>
    <p class="book-title--packt">Microsoft Installer (MSI) version, Power BI Desktop</p>
    <p class="book-title--packt">download link <a href="#calibre_link-608" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">4</a></p>
    <p class="book-title--packt">Microsoft Power BI blog</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-609" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">10</a></p>
    <p class="book-title--packt">Microsoft R Client, installing on Windows</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-610" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">436</a></p>
    <p class="book-title--packt">M language <a href="#calibre_link-611" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">29</a>, <a href="#calibre_link-612" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">30</a></p>
    <p class="book-title--packt">M language, elements</p>
    <p class="book-title--packt">environment <a href="#calibre_link-613" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">evaluation <a href="#calibre_link-614" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">expression <a href="#calibre_link-615" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">35</a></p>
    <p class="book-title--packt">function <a href="#calibre_link-616" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">let expression <a href="#calibre_link-617" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">operators <a href="#calibre_link-618" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">type <a href="#calibre_link-619" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">value <a href="#calibre_link-620" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">35</a></p>
    <p class="book-title--packt">variable <a href="#calibre_link-621" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">M library</p>
    <p class="book-title--packt">visualizing <a href="#calibre_link-622" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">92</a>, <a href="#calibre_link-623" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">93</a>, <a href="#calibre_link-624" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">94</a></p>
    <p class="book-title--packt">M (Mashup) engine <a href="#calibre_link-625" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">505</a></p>
    <p class="book-title--packt">mobile experience</p>
    <p class="book-title--packt">enabling <a href="#calibre_link-626" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">561</a>, <a href="#calibre_link-627" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">562</a>, <a href="#calibre_link-628" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">563</a>, <a href="#calibre_link-629" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">564</a>, <a href="#calibre_link-630" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">565</a>, <a href="#calibre_link-631" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">566</a>, <a href="#calibre_link-632" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">567</a></p>
    <p class="book-title--packt">mobile layout, in Power BI Desktop <a href="#calibre_link-633" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">233</a>, <a href="#calibre_link-634" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">234</a></p>
    <p class="book-title--packt">mobile layouts</p>
    <p class="book-title--packt">designing <a href="#calibre_link-635" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">230</a>, <a href="#calibre_link-636" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">231</a>, <a href="#calibre_link-637" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">232</a></p>
    <p class="book-title--packt">model</p>
    <p class="book-title--packt">enriching, with DAX <a href="#calibre_link-638" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">140</a>, <a href="#calibre_link-639" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">141</a>, <a href="#calibre_link-640" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">143</a>, <a href="#calibre_link-641" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">144</a>, <a href="#calibre_link-642" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">145</a>, <a href="#calibre_link-643" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">146</a>, <a href="#calibre_link-644" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">147</a>, <a href="#calibre_link-645" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">148</a>, <a href="#calibre_link-646" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">149</a>, <a href="#calibre_link-647" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">150</a></p>
    <p class="book-title--packt">model metadata</p>
    <p class="book-title--packt">configuring <a href="#calibre_link-648" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">126</a>, <a href="#calibre_link-649" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">127</a>, <a href="#calibre_link-650" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">128</a>, <a href="#calibre_link-651" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">130</a>, <a href="#calibre_link-652" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">131</a>, <a href="#calibre_link-653" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">132</a>, <a href="#calibre_link-654" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">133</a></p>
    <p class="book-title--packt">monitoring layer</p>
    <p class="book-title--packt">constructing <a href="#calibre_link-655" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">446</a>, <a href="#calibre_link-656" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">447</a>, <a href="#calibre_link-657" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">448</a>, <a href="#calibre_link-658" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">449</a>, <a href="#calibre_link-659" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">450</a></p>
    <p class="book-title--packt">monthly Power BI Desktop update video and blog post</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-660" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">9</a></p>
    <p class="book-title--packt">multiple queries</p>
    <p class="book-title--packt">applying <a href="#calibre_link-661" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">58</a>, <a href="#calibre_link-662" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">59</a>, <a href="#calibre_link-663" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">60</a>, <a href="#calibre_link-664" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">61</a>, <a href="#calibre_link-665" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">62</a>, <a href="#calibre_link-666" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">63</a>, <a href="#calibre_link-667" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">64</a></p>
    <p class="book-title--packt">Multi-row Card visualization <a href="#calibre_link-668" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">195</a></p>
    <p class="book-title--packt">N</p>
    <p class="book-title--packt">Native Query <a href="#calibre_link-669" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">37</a>, <a href="#calibre_link-670" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">38</a></p>
    <p class="book-title--packt">O</p>
    <p class="book-title--packt">Only refresh complete days setting <a href="#calibre_link-671" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">521</a></p>
    <p class="book-title--packt">on-premises data gateway</p>
    <p class="book-title--packt">analyzing <a href="#calibre_link-672" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">467</a>, <a href="#calibre_link-673" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">468</a>, <a href="#calibre_link-674" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">470</a>, <a href="#calibre_link-675" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">471</a>, <a href="#calibre_link-676" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">472</a>, <a href="#calibre_link-677" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">473</a></p>
    <p class="book-title--packt">On-Premises Data Gateway</p>
    <p class="book-title--packt">creating <a href="#calibre_link-678" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">12</a>, <a href="#calibre_link-679" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">13</a>, <a href="#calibre_link-680" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">14</a>, <a href="#calibre_link-681" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">15</a>, <a href="#calibre_link-682" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">16</a></p>
    <p class="book-title--packt">on-premises gateway data connections</p>
    <p class="book-title--packt">configuring <a href="#calibre_link-683" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">545</a>, <a href="#calibre_link-684" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">546</a>, <a href="#calibre_link-685" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">547</a>, <a href="#calibre_link-686" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">548</a>, <a href="#calibre_link-687" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">549</a>, <a href="#calibre_link-688" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">550</a></p>
    <p class="book-title--packt">Open Database Connectivity (ODBC) <a href="#calibre_link-689" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">12</a></p>
    <p class="book-title--packt">operators <a href="#calibre_link-690" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">optimizations</p>
    <p class="book-title--packt">within Power Query Editor <a href="#calibre_link-691" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">497</a>, <a href="#calibre_link-692" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">498</a>, <a href="#calibre_link-693" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">499</a></p>
    <p class="book-title--packt">Organizational data source <a href="#calibre_link-694" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">44</a></p>
    <p class="book-title--packt">Organization Dimension Query</p>
    <p class="book-title--packt">modifying <a href="#calibre_link-695" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">56</a>, <a href="#calibre_link-696" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">57</a>, <a href="#calibre_link-697" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">58</a></p>
    <p class="book-title--packt">P</p>
    <p class="book-title--packt">page-level filters <a href="#calibre_link-698" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">187</a>, <a href="#calibre_link-699" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">189</a></p>
    <p class="book-title--packt">pages <a href="#calibre_link-700" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">138</a></p>
    <p class="book-title--packt">paginated reports</p>
    <p class="book-title--packt">creating <a href="#calibre_link-701" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">234</a>, <a href="#calibre_link-702" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">235</a>, <a href="#calibre_link-703" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">236</a>, <a href="#calibre_link-704" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">237</a>, <a href="#calibre_link-705" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">238</a>, <a href="#calibre_link-706" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">239</a>, <a href="#calibre_link-707" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">240</a></p>
    <p class="book-title--packt">references <a href="#calibre_link-708" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">243</a></p>
    <p class="book-title--packt">parameter tables</p>
    <p class="book-title--packt">user selections, capturing with <a href="#calibre_link-709" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">331</a>, <a href="#calibre_link-710" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">332</a>, <a href="#calibre_link-711" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">333</a>, <a href="#calibre_link-712" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">335</a>, <a href="#calibre_link-713" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">336</a>, <a href="#calibre_link-714" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">337</a></p>
    <p class="book-title--packt">partial query folding <a href="#calibre_link-715" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">38</a></p>
    <p class="book-title--packt">Performance analyzer</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-716" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">505</a></p>
    <p class="book-title--packt">performance optimization <a href="#calibre_link-717" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">493</a></p>
    <p class="book-title--packt">perspectives <a href="#calibre_link-718" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">138</a>, <a href="#calibre_link-719" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">139</a></p>
    <p class="book-title--packt">Platform-as-a-Service (PaaS) <a href="#calibre_link-720" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">600</a></p>
    <p class="book-title--packt">Power Apps</p>
    <p class="book-title--packt">integrating with <a href="#calibre_link-721" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">600</a>, <a href="#calibre_link-722" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">601</a>, <a href="#calibre_link-723" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">602</a>, <a href="#calibre_link-724" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">603</a>, <a href="#calibre_link-725" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">604</a>, <a href="#calibre_link-726" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">605</a>, <a href="#calibre_link-727" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">607</a>, <a href="#calibre_link-728" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">608</a>, <a href="#calibre_link-729" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">609</a>, <a href="#calibre_link-730" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">610</a></p>
    <p class="book-title--packt">Power Automate</p>
    <p class="book-title--packt">integrating with <a href="#calibre_link-731" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">600</a>, <a href="#calibre_link-732" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">601</a>, <a href="#calibre_link-733" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">602</a>, <a href="#calibre_link-734" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">603</a>, <a href="#calibre_link-735" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">604</a>, <a href="#calibre_link-736" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">605</a>, <a href="#calibre_link-737" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">606</a>, <a href="#calibre_link-738" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">607</a>, <a href="#calibre_link-739" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">608</a>, <a href="#calibre_link-740" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">609</a>, <a href="#calibre_link-741" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">610</a></p>
    <p class="book-title--packt">Power BI</p>
    <p class="book-title--packt">centralized IT monitoring solution, creating with <a href="#calibre_link-742" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">440</a>, <a href="#calibre_link-743" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">441</a>, <a href="#calibre_link-744" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">442</a>, <a href="#calibre_link-745" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">444</a>, <a href="#calibre_link-746" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">445</a></p>
    <p class="book-title--packt">Power Pivot, migrating for Excel Data <a href="#calibre_link-747" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">583</a>, <a href="#calibre_link-748" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">584</a>, <a href="#calibre_link-749" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">585</a>, <a href="#calibre_link-750" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">586</a></p>
    <p class="book-title--packt">references <a href="#calibre_link-751" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">11</a></p>
    <p class="book-title--packt">Power BI Analytics pane</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-752" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">386</a></p>
    <p class="book-title--packt">Power BI Community <a href="#calibre_link-753" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">11</a></p>
    <p class="book-title--packt">Power BI custom visuals</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-754" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">390</a></p>
    <p class="book-title--packt">Power BI dashboard</p>
    <p class="book-title--packt">designing, reference link <a href="#calibre_link-755" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">254</a></p>
    <p class="book-title--packt">Power BI dataset</p>
    <p class="book-title--packt">accessing, in Excel <a href="#calibre_link-756" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">586</a>, <a href="#calibre_link-757" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">587</a>, <a href="#calibre_link-758" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">589</a>, <a href="#calibre_link-759" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">590</a>, <a href="#calibre_link-760" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">591</a></p>
    <p class="book-title--packt">analyzing, in Excel <a href="#calibre_link-761" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">586</a>, <a href="#calibre_link-762" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">587</a>, <a href="#calibre_link-763" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">589</a>, <a href="#calibre_link-764" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">590</a>, <a href="#calibre_link-765" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">591</a></p>
    <p class="book-title--packt">Power BI datasets <a href="#calibre_link-766" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">21</a></p>
    <p class="book-title--packt">Power BI Datasets <a href="#calibre_link-767" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">111</a></p>
    <p class="book-title--packt">Power BI Desktop <a href="#calibre_link-768" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">2</a></p>
    <p class="book-title--packt">configuring <a href="#calibre_link-769" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">2</a>, <a href="#calibre_link-770" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">3</a>, <a href="#calibre_link-771" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">4</a>, <a href="#calibre_link-772" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">5</a>, <a href="#calibre_link-773" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">6</a>, <a href="#calibre_link-774" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">8</a>, <a href="#calibre_link-775" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">9</a></p>
    <p class="book-title--packt">installing <a href="#calibre_link-776" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">2</a>, <a href="#calibre_link-777" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">3</a>, <a href="#calibre_link-778" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">4</a>, <a href="#calibre_link-779" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">5</a>, <a href="#calibre_link-780" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">6</a>, <a href="#calibre_link-781" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">7</a>, <a href="#calibre_link-782" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">8</a>, <a href="#calibre_link-783" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">9</a></p>
    <p class="book-title--packt">Power BI Desktop DirectQuery documentation</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-784" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">50</a></p>
    <p class="book-title--packt">Power BI Desktop file</p>
    <p class="book-title--packt">tracing, reference link <a href="#calibre_link-785" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">386</a></p>
    <p class="book-title--packt">Power BI Desktop file (PBIX) <a href="#calibre_link-786" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">495</a></p>
    <p class="book-title--packt">Power BI Desktop (PBIX) <a href="#calibre_link-787" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">324</a></p>
    <p class="book-title--packt">Power BI documentation</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-788" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">10</a></p>
    <p class="book-title--packt">Power BI Ideas</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-789" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">11</a></p>
    <p class="book-title--packt">Power BI mobile apps</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-790" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">234</a></p>
    <p class="book-title--packt">Power BI models, retrieval processes</p>
    <p class="book-title--packt">ETL questions <a href="#calibre_link-791" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">Power BI Performance improvement, by DAX optimization</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-792" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">517</a></p>
    <p class="book-title--packt">Power BI Premium</p>
    <p class="book-title--packt">about <a href="#calibre_link-793" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">528</a>, <a href="#calibre_link-794" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">529</a>, <a href="#calibre_link-795" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">530</a>, <a href="#calibre_link-796" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">531</a>, <a href="#calibre_link-797" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">532</a></p>
    <p class="book-title--packt">Power BI Q&amp;A</p>
    <p class="book-title--packt">limitations, reference link <a href="#calibre_link-798" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">260</a></p>
    <p class="book-title--packt">reference link <a href="#calibre_link-799" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">260</a></p>
    <p class="book-title--packt">Power BI report</p>
    <p class="book-title--packt">references <a href="#calibre_link-800" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">187</a></p>
    <p class="book-title--packt">theme <a href="#calibre_link-801" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">186</a></p>
    <p class="book-title--packt">Power BI Report Builder</p>
    <p class="book-title--packt">capability <a href="#calibre_link-802" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">240</a></p>
    <p class="book-title--packt">download link <a href="#calibre_link-803" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">234</a>, <a href="#calibre_link-804" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">238</a></p>
    <p class="book-title--packt">elements <a href="#calibre_link-805" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">242</a></p>
    <p class="book-title--packt">functionality <a href="#calibre_link-806" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">240</a></p>
    <p class="book-title--packt">Power BI reports</p>
    <p class="book-title--packt">building, into Powerpoint presentations <a href="#calibre_link-807" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">592</a>, <a href="#calibre_link-808" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">593</a>, <a href="#calibre_link-809" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">594</a>, <a href="#calibre_link-810" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">595</a></p>
    <p class="book-title--packt">design practices <a href="#calibre_link-811" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">185</a></p>
    <p class="book-title--packt">Power BI Report Server (PBIRS) <a href="#calibre_link-812" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">234</a></p>
    <p class="book-title--packt">Power BI reports filters</p>
    <p class="book-title--packt">references <a href="#calibre_link-813" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">191</a></p>
    <p class="book-title--packt">Power BI REST API</p>
    <p class="book-title--packt">leveraging <a href="#calibre_link-814" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">484</a>, <a href="#calibre_link-815" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">485</a>, <a href="#calibre_link-816" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">486</a>, <a href="#calibre_link-817" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">487</a>, <a href="#calibre_link-818" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">488</a></p>
    <p class="book-title--packt">Power BI security documentation and whitepaper</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-819" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">353</a></p>
    <p class="book-title--packt">Power BI Service</p>
    <p class="book-title--packt">Analyze, installing in Excel from <a href="#calibre_link-820" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">17</a>, <a href="#calibre_link-821" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">18</a>, <a href="#calibre_link-822" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">20</a></p>
    <p class="book-title--packt">Power BI User Groups (PUGs) <a href="#calibre_link-823" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">11</a></p>
    <p class="book-title--packt">Power BI visualizations, formatting</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-824" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">196</a></p>
    <p class="book-title--packt">Power BI visuals, creating with R</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-825" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">436</a></p>
    <p class="book-title--packt">Power Pivot</p>
    <p class="book-title--packt">migrating, for Excel Data to Power BI <a href="#calibre_link-826" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">582</a>, <a href="#calibre_link-827" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">583</a>, <a href="#calibre_link-828" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">584</a>, <a href="#calibre_link-829" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">585</a>, <a href="#calibre_link-830" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">586</a></p>
    <p class="book-title--packt">Power Platform</p>
    <p class="book-title--packt">connecting <a href="#calibre_link-831" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">615</a>, <a href="#calibre_link-832" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">616</a>, <a href="#calibre_link-833" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">617</a>, <a href="#calibre_link-834" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">618</a>, <a href="#calibre_link-835" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">620</a></p>
    <p class="book-title--packt">Powerpoint presentations</p>
    <p class="book-title--packt">Power BI reports, building into <a href="#calibre_link-836" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">592</a>, <a href="#calibre_link-837" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">593</a>, <a href="#calibre_link-838" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">594</a>, <a href="#calibre_link-839" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">595</a></p>
    <p class="book-title--packt">Power Query calendar</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-840" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">282</a></p>
    <p class="book-title--packt">Power Query code</p>
    <p class="book-title--packt">maintainability, improving <a href="#calibre_link-841" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">512</a>, <a href="#calibre_link-842" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">513</a>, <a href="#calibre_link-843" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">514</a></p>
    <p class="book-title--packt">Power Query Date functions</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-844" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">293</a></p>
    <p class="book-title--packt">Power Query function</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-845" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">95</a></p>
    <p class="book-title--packt">Power Query M engine <a href="#calibre_link-846" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">98</a></p>
    <p class="book-title--packt">Power Query M Function reference</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-847" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">39</a></p>
    <p class="book-title--packt">Power Query M language specification</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-848" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">39</a></p>
    <p class="book-title--packt">Power Query optimization, on table column expansion</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-849" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">510</a></p>
    <p class="book-title--packt">Power Query Table functions</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-850" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">293</a></p>
    <p class="book-title--packt">prior period date intelligence measures <a href="#calibre_link-851" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">301</a>, <a href="#calibre_link-852" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">302</a></p>
    <p class="book-title--packt">Privacy Level settings</p>
    <p class="book-title--packt">None <a href="#calibre_link-853" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">44</a></p>
    <p class="book-title--packt">Organizational <a href="#calibre_link-854" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">44</a></p>
    <p class="book-title--packt">Private <a href="#calibre_link-855" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">44</a></p>
    <p class="book-title--packt">Public <a href="#calibre_link-856" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">45</a></p>
    <p class="book-title--packt">privacy levels, Power BI Desktop</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-857" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">45</a></p>
    <p class="book-title--packt">Private data source <a href="#calibre_link-858" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">44</a></p>
    <p class="book-title--packt">Process ID (PID) <a href="#calibre_link-859" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">384</a></p>
    <p class="book-title--packt">product subcategories remaining</p>
    <p class="book-title--packt">measuring <a href="#calibre_link-860" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">373</a>, <a href="#calibre_link-861" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">374</a></p>
    <p class="book-title--packt">Public data source <a href="#calibre_link-862" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">45</a></p>
    <p class="book-title--packt">public internet</p>
    <p class="book-title--packt">reports, publishing to <a href="#calibre_link-863" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">556</a>, <a href="#calibre_link-864" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">557</a>, <a href="#calibre_link-865" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">558</a>, <a href="#calibre_link-866" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">559</a>, <a href="#calibre_link-867" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">560</a>, <a href="#calibre_link-868" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">561</a></p>
    <p class="book-title--packt">Python visuals</p>
    <p class="book-title--packt">using <a href="#calibre_link-869" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">430</a>, <a href="#calibre_link-870" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">432</a>, <a href="#calibre_link-871" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">433</a>, <a href="#calibre_link-872" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">434</a>, <a href="#calibre_link-873" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">435</a>, <a href="#calibre_link-874" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">436</a></p>
    <p class="book-title--packt">Q</p>
    <p class="book-title--packt">Q&amp;A</p>
    <p class="book-title--packt">preparing <a href="#calibre_link-875" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">254</a>, <a href="#calibre_link-876" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">255</a>, <a href="#calibre_link-877" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">256</a>, <a href="#calibre_link-878" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">257</a>, <a href="#calibre_link-879" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">258</a>, <a href="#calibre_link-880" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">259</a></p>
    <p class="book-title--packt">setting up, tips <a href="#calibre_link-881" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">258</a></p>
    <p class="book-title--packt">Q&amp;A dashboard <a href="#calibre_link-882" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">228</a>, <a href="#calibre_link-883" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">229</a></p>
    <p class="book-title--packt">quality assurance (QA) <a href="#calibre_link-884" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">360</a></p>
    <p class="book-title--packt">queries</p>
    <p class="book-title--packt">combining <a href="#calibre_link-885" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">81</a>, <a href="#calibre_link-886" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">82</a>, <a href="#calibre_link-887" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">83</a>, <a href="#calibre_link-888" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">84</a></p>
    <p class="book-title--packt">diagnosing <a href="#calibre_link-889" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">98</a>, <a href="#calibre_link-890" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">100</a>, <a href="#calibre_link-891" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">101</a>, <a href="#calibre_link-892" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">102</a>, <a href="#calibre_link-893" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">103</a></p>
    <p class="book-title--packt">managing <a href="#calibre_link-894" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">39</a>, <a href="#calibre_link-895" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">40</a>, <a href="#calibre_link-896" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">41</a>, <a href="#calibre_link-897" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">42</a>, <a href="#calibre_link-898" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">43</a></p>
    <p class="book-title--packt">merging <a href="#calibre_link-899" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">81</a>, <a href="#calibre_link-900" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">82</a>, <a href="#calibre_link-901" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">83</a>, <a href="#calibre_link-902" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">84</a></p>
    <p class="book-title--packt">Query Dependencies view <a href="#calibre_link-903" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">42</a>, <a href="#calibre_link-904" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">43</a>, <a href="#calibre_link-905" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">86</a></p>
    <p class="book-title--packt">Query Designer <a href="#calibre_link-906" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">240</a></p>
    <p class="book-title--packt">Query Diagnostics <a href="#calibre_link-907" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">512</a></p>
    <p class="book-title--packt">reference link <a href="#calibre_link-908" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">514</a></p>
    <p class="book-title--packt">Query Editor</p>
    <p class="book-title--packt">date dimension, preparing <a href="#calibre_link-909" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">287</a>, <a href="#calibre_link-910" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">290</a>, <a href="#calibre_link-911" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">291</a>, <a href="#calibre_link-912" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">292</a></p>
    <p class="book-title--packt">query folding</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-913" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">510</a></p>
    <p class="book-title--packt">Query Folding <a href="#calibre_link-914" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">37</a></p>
    <p class="book-title--packt">considerations <a href="#calibre_link-915" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">39</a></p>
    <p class="book-title--packt">query folding analysis process <a href="#calibre_link-916" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">506</a>, <a href="#calibre_link-917" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">507</a>, <a href="#calibre_link-918" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">508</a>, <a href="#calibre_link-919" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">509</a></p>
    <p class="book-title--packt">query logic <a href="#calibre_link-920" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">39</a></p>
    <p class="book-title--packt">query parameters</p>
    <p class="book-title--packt">leveraging <a href="#calibre_link-921" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">317</a>, <a href="#calibre_link-922" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">318</a>, <a href="#calibre_link-923" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">319</a>, <a href="#calibre_link-924" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">320</a>, <a href="#calibre_link-925" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">321</a>, <a href="#calibre_link-926" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">322</a></p>
    <p class="book-title--packt">references <a href="#calibre_link-927" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">322</a></p>
    <p class="book-title--packt">query processing</p>
    <p class="book-title--packt">pushing, to source systems <a href="#calibre_link-928" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">505</a>, <a href="#calibre_link-929" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">506</a>, <a href="#calibre_link-930" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">507</a>, <a href="#calibre_link-931" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">508</a>, <a href="#calibre_link-932" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">509</a></p>
    <p class="book-title--packt">Query Processing Units (QPUs) <a href="#calibre_link-933" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">599</a></p>
    <p class="book-title--packt">quick insights</p>
    <p class="book-title--packt">content, enriching with <a href="#calibre_link-934" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">386</a>, <a href="#calibre_link-935" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">387</a>, <a href="#calibre_link-936" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">388</a></p>
    <p class="book-title--packt">feature <a href="#calibre_link-937" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">389</a>, <a href="#calibre_link-938" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">390</a></p>
    <p class="book-title--packt">R</p>
    <p class="book-title--packt">Radial Gauge charts, in Power BI</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-939" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">196</a></p>
    <p class="book-title--packt">referential integrity assumption</p>
    <p class="book-title--packt">activating <a href="#calibre_link-940" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">49</a></p>
    <p class="book-title--packt">regions remaining</p>
    <p class="book-title--packt">measuring <a href="#calibre_link-941" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">373</a>, <a href="#calibre_link-942" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">374</a></p>
    <p class="book-title--packt">relationships</p>
    <p class="book-title--packt">creating <a href="#calibre_link-943" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">118</a>, <a href="#calibre_link-944" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">119</a>, <a href="#calibre_link-945" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">120</a>, <a href="#calibre_link-946" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">121</a>, <a href="#calibre_link-947" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">122</a>, <a href="#calibre_link-948" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">123</a></p>
    <p class="book-title--packt">relative Date slicers <a href="#calibre_link-949" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">201</a></p>
    <p class="book-title--packt">Report Definition Language (RDL) <a href="#calibre_link-950" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">239</a></p>
    <p class="book-title--packt">report-level filters <a href="#calibre_link-951" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">187</a>, <a href="#calibre_link-952" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">189</a></p>
    <p class="book-title--packt">reports</p>
    <p class="book-title--packt">building <a href="#calibre_link-953" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">178</a>, <a href="#calibre_link-954" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">179</a>, <a href="#calibre_link-955" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">180</a>, <a href="#calibre_link-956" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">182</a>, <a href="#calibre_link-957" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">183</a>, <a href="#calibre_link-958" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">184</a></p>
    <p class="book-title--packt">enhancing <a href="#calibre_link-959" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">218</a>, <a href="#calibre_link-960" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">219</a>, <a href="#calibre_link-961" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">220</a>, <a href="#calibre_link-962" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">221</a></p>
    <p class="book-title--packt">filtering, dynamically <a href="#calibre_link-963" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">314</a>, <a href="#calibre_link-964" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">315</a>, <a href="#calibre_link-965" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">316</a></p>
    <p class="book-title--packt">formatting, for publication <a href="#calibre_link-966" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">223</a>, <a href="#calibre_link-967" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">224</a>, <a href="#calibre_link-968" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">225</a>, <a href="#calibre_link-969" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">226</a>, <a href="#calibre_link-970" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">227</a>, <a href="#calibre_link-971" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">228</a></p>
    <p class="book-title--packt">publishing, to public internet <a href="#calibre_link-972" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">556</a>, <a href="#calibre_link-973" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">557</a>, <a href="#calibre_link-974" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">558</a>, <a href="#calibre_link-975" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">559</a>, <a href="#calibre_link-976" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">560</a>, <a href="#calibre_link-977" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">561</a></p>
    <p class="book-title--packt">reports, filtering with query string parameters</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-978" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">316</a></p>
    <p class="book-title--packt">report tooltip pages, in Power BI</p>
    <p class="book-title--packt">references <a href="#calibre_link-979" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">223</a></p>
    <p class="book-title--packt">RLS roles</p>
    <p class="book-title--packt">defining <a href="#calibre_link-980" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">353</a>, <a href="#calibre_link-981" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">354</a>, <a href="#calibre_link-982" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">355</a>, <a href="#calibre_link-983" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">356</a>, <a href="#calibre_link-984" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">357</a>, <a href="#calibre_link-985" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">358</a>, <a href="#calibre_link-986" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">359</a>, <a href="#calibre_link-987" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">360</a></p>
    <p class="book-title--packt">role-playing tables <a href="#calibre_link-988" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">287</a></p>
    <p class="book-title--packt">row-level security (RLS) <a href="#calibre_link-989" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">137</a>, <a href="#calibre_link-990" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">359</a>, <a href="#calibre_link-991" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">471</a></p>
    <p class="book-title--packt">Row-Level Security (RLS) <a href="#calibre_link-992" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">582</a></p>
    <p class="book-title--packt">row-level security (RLS) guidance in Power BI Desktop</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-993" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">361</a></p>
    <p class="book-title--packt">row-level security (RLS) with Power BI</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-994" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">361</a></p>
    <p class="book-title--packt">RS version, Power BI Desktop</p>
    <p class="book-title--packt">download link <a href="#calibre_link-995" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">5</a></p>
    <p class="book-title--packt">run-length encoding (RLE) <a href="#calibre_link-996" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">497</a></p>
    <p class="book-title--packt">R visuals</p>
    <p class="book-title--packt">using <a href="#calibre_link-997" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">430</a>, <a href="#calibre_link-998" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">432</a>, <a href="#calibre_link-999" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">433</a>, <a href="#calibre_link-1000" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">434</a>, <a href="#calibre_link-1001" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">435</a>, <a href="#calibre_link-1002" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">436</a></p>
    <p class="book-title--packt">S</p>
    <p class="book-title--packt">scatter chart <a href="#calibre_link-1003" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">406</a></p>
    <p class="book-title--packt">Server Integration Services (SSIS) <a href="#calibre_link-1004" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">606</a></p>
    <p class="book-title--packt">slicers</p>
    <p class="book-title--packt">using <a href="#calibre_link-1005" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">196</a>, <a href="#calibre_link-1006" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">197</a>, <a href="#calibre_link-1007" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">198</a>, <a href="#calibre_link-1008" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">199</a>, <a href="#calibre_link-1009" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">200</a>, <a href="#calibre_link-1010" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">201</a></p>
    <p class="book-title--packt">slicers, Power BI</p>
    <p class="book-title--packt">references <a href="#calibre_link-1011" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">202</a></p>
    <p class="book-title--packt">slicers, types</p>
    <p class="book-title--packt">horizontal slicers <a href="#calibre_link-1012" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">201</a></p>
    <p class="book-title--packt">relative Date slicers <a href="#calibre_link-1013" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">202</a></p>
    <p class="book-title--packt">Slowly Changing Dimension (SCD)</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-1014" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">85</a></p>
    <p class="book-title--packt">Sort by Column <a href="#calibre_link-1015" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">126</a></p>
    <p class="book-title--packt">source data</p>
    <p class="book-title--packt">profiling <a href="#calibre_link-1016" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">95</a>, <a href="#calibre_link-1017" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">96</a></p>
    <p class="book-title--packt">source systems</p>
    <p class="book-title--packt">query processing, pushing to <a href="#calibre_link-1018" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">505</a>, <a href="#calibre_link-1019" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">506</a>, <a href="#calibre_link-1020" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">507</a>, <a href="#calibre_link-1021" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">508</a>, <a href="#calibre_link-1022" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">509</a></p>
    <p class="book-title--packt">SQL Database <a href="#calibre_link-1023" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">325</a></p>
    <p class="book-title--packt">SQL query statements</p>
    <p class="book-title--packt">retrieving, from Query Store and Extended Events <a href="#calibre_link-1024" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">460</a></p>
    <p class="book-title--packt">SQL Server Analysis Services (SSAS) <a href="#calibre_link-1025" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">360</a></p>
    <p class="book-title--packt">SQL Server Data Tools (SSDT) <a href="#calibre_link-1026" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">26</a></p>
    <p class="book-title--packt">SQL Server Management Studio (SSMS) <a href="#calibre_link-1027" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">455</a>, <a href="#calibre_link-1028" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">474</a>, <a href="#calibre_link-1029" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">601</a></p>
    <p class="book-title--packt">SQL Server Reporting Services (SSRS) <a href="#calibre_link-1030" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">39</a>, <a href="#calibre_link-1031" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">245</a></p>
    <p class="book-title--packt">integrating <a href="#calibre_link-1032" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">574</a>, <a href="#calibre_link-1033" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">575</a>, <a href="#calibre_link-1034" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">576</a>, <a href="#calibre_link-1035" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">577</a>, <a href="#calibre_link-1036" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">578</a>, <a href="#calibre_link-1037" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">579</a>, <a href="#calibre_link-1038" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">580</a>, <a href="#calibre_link-1039" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">581</a>, <a href="#calibre_link-1040" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">582</a></p>
    <p class="book-title--packt">SSAS <a href="#calibre_link-1041" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">111</a></p>
    <p class="book-title--packt">SSAS tabular databases</p>
    <p class="book-title--packt">analyzing <a href="#calibre_link-1042" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">467</a>, <a href="#calibre_link-1043" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">468</a>, <a href="#calibre_link-1044" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">470</a>, <a href="#calibre_link-1045" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">471</a>, <a href="#calibre_link-1046" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">472</a>, <a href="#calibre_link-1047" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">473</a></p>
    <p class="book-title--packt">SSRS</p>
    <p class="book-title--packt">content, deploying from <a href="#calibre_link-1048" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">266</a>, <a href="#calibre_link-1049" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">267</a>, <a href="#calibre_link-1050" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">268</a>, <a href="#calibre_link-1051" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">269</a></p>
    <p class="book-title--packt">staging query <a href="#calibre_link-1052" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">50</a></p>
    <p class="book-title--packt">static queries</p>
    <p class="book-title--packt">converting, to dynamic functions <a href="#calibre_link-1053" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">326</a>, <a href="#calibre_link-1054" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">327</a>, <a href="#calibre_link-1055" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">328</a>, <a href="#calibre_link-1056" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">329</a>, <a href="#calibre_link-1057" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">330</a>, <a href="#calibre_link-1058" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">331</a></p>
    <p class="book-title--packt">statistical analyses</p>
    <p class="book-title--packt">embedding <a href="#calibre_link-1059" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">408</a>, <a href="#calibre_link-1060" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">409</a>, <a href="#calibre_link-1061" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">410</a>, <a href="#calibre_link-1062" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">411</a>, <a href="#calibre_link-1063" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">412</a>, <a href="#calibre_link-1064" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">413</a></p>
    <p class="book-title--packt">storage engine (SE) <a href="#calibre_link-1065" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">504</a></p>
    <p class="book-title--packt">storytelling</p>
    <p class="book-title--packt">building <a href="#calibre_link-1066" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">401</a>, <a href="#calibre_link-1067" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">402</a>, <a href="#calibre_link-1068" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">403</a>, <a href="#calibre_link-1069" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">404</a>, <a href="#calibre_link-1070" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">405</a>, <a href="#calibre_link-1071" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">406</a>, <a href="#calibre_link-1072" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">407</a></p>
    <p class="book-title--packt">T</p>
    <p class="book-title--packt">Table.AddColumn function <a href="#calibre_link-1073" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">68</a></p>
    <p class="book-title--packt">Table.AddIndexColumn function <a href="#calibre_link-1074" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">292</a></p>
    <p class="book-title--packt">Table.Combine function <a href="#calibre_link-1075" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">84</a></p>
    <p class="book-title--packt">Table.Distinct function <a href="#calibre_link-1076" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">84</a></p>
    <p class="book-title--packt">Table.ExpandTableColumn function <a href="#calibre_link-1077" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">85</a></p>
    <p class="book-title--packt">Table.NestedJoin function <a href="#calibre_link-1078" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">84</a></p>
    <p class="book-title--packt">Table.RemoveColumns function <a href="#calibre_link-1079" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">69</a></p>
    <p class="book-title--packt">Table.ReorderColumns function <a href="#calibre_link-1080" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">69</a></p>
    <p class="book-title--packt">tables</p>
    <p class="book-title--packt">hiding <a href="#calibre_link-1081" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">134</a>, <a href="#calibre_link-1082" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">135</a>, <a href="#calibre_link-1083" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">136</a>, <a href="#calibre_link-1084" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">137</a>, <a href="#calibre_link-1085" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">138</a></p>
    <p class="book-title--packt">parallel loading <a href="#calibre_link-1086" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">509</a></p>
    <p class="book-title--packt">Table.SelectColumns function <a href="#calibre_link-1087" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">68</a>, <a href="#calibre_link-1088" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">85</a></p>
    <p class="book-title--packt">table visuals</p>
    <p class="book-title--packt">creating <a href="#calibre_link-1089" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">212</a>, <a href="#calibre_link-1090" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">214</a>, <a href="#calibre_link-1091" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">215</a></p>
    <p class="book-title--packt">Tabular Editor</p>
    <p class="book-title--packt">installing <a href="#calibre_link-1092" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">26</a>, <a href="#calibre_link-1093" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">27</a></p>
    <p class="book-title--packt">Tabular Editor documentation</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-1094" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">27</a></p>
    <p class="book-title--packt">teams</p>
    <p class="book-title--packt">content, distributing with <a href="#calibre_link-1095" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">568</a>, <a href="#calibre_link-1096" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">569</a>, <a href="#calibre_link-1097" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">570</a>, <a href="#calibre_link-1098" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">571</a>, <a href="#calibre_link-1099" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">572</a></p>
    <p class="book-title--packt">templates</p>
    <p class="book-title--packt">working with <a href="#calibre_link-1100" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">322</a>, <a href="#calibre_link-1101" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">323</a>, <a href="#calibre_link-1102" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">324</a>, <a href="#calibre_link-1103" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">325</a></p>
    <p class="book-title--packt">templates, using in Power BI Desktop</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-1104" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">326</a></p>
    <p class="book-title--packt">The Kimball Group downloadable Excel file</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-1105" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">282</a></p>
    <p class="book-title--packt">Top N filtering <a href="#calibre_link-1106" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">190</a></p>
    <p class="book-title--packt">Top N visual-level filter condition <a href="#calibre_link-1107" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">187</a></p>
    <p class="book-title--packt">T-SQL approach</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-1108" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">282</a></p>
    <p class="book-title--packt">type <a href="#calibre_link-1109" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">U</p>
    <p class="book-title--packt">User Acceptance Testing (UAT) environment <a href="#calibre_link-1110" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">40</a></p>
    <p class="book-title--packt">user-defined native SQL query</p>
    <p class="book-title--packt">providing <a href="#calibre_link-1111" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">39</a></p>
    <p class="book-title--packt">USERNAME function</p>
    <p class="book-title--packt">used, locally and outside of Power BI service <a href="#calibre_link-1112" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">352</a></p>
    <p class="book-title--packt">user principal name (UPN) <a href="#calibre_link-1113" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">350</a></p>
    <p class="book-title--packt">user selections</p>
    <p class="book-title--packt">capturing, with parameter tables <a href="#calibre_link-1114" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">331</a>, <a href="#calibre_link-1115" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">332</a>, <a href="#calibre_link-1116" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">333</a>, <a href="#calibre_link-1117" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">335</a>, <a href="#calibre_link-1118" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">336</a>, <a href="#calibre_link-1119" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">337</a></p>
    <p class="book-title--packt">V</p>
    <p class="book-title--packt">value <a href="#calibre_link-1120" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">35</a></p>
    <p class="book-title--packt">variable <a href="#calibre_link-1121" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">36</a></p>
    <p class="book-title--packt">variables <a href="#calibre_link-1122" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">34</a></p>
    <p class="book-title--packt">VertiPaq <a href="#calibre_link-1123" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">497</a></p>
    <p class="book-title--packt">Vertipaq Analyzer <a href="#calibre_link-1124" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">497</a></p>
    <p class="book-title--packt">Vertipaq Analyzer script, Tabular Editor 2</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-1125" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">499</a></p>
    <p class="book-title--packt">virtual table relationships</p>
    <p class="book-title--packt">creating <a href="#calibre_link-1126" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">159</a>, <a href="#calibre_link-1127" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">160</a></p>
    <p class="book-title--packt">supporting <a href="#calibre_link-1128" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">153</a>, <a href="#calibre_link-1129" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">154</a>, <a href="#calibre_link-1130" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">155</a>, <a href="#calibre_link-1131" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">156</a>, <a href="#calibre_link-1132" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">157</a>, <a href="#calibre_link-1133" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">158</a>, <a href="#calibre_link-1134" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">159</a></p>
    <p class="book-title--packt">visual interactions</p>
    <p class="book-title--packt">controlling <a href="#calibre_link-1135" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">202</a>, <a href="#calibre_link-1136" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">203</a>, <a href="#calibre_link-1137" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">204</a></p>
    <p class="book-title--packt">references <a href="#calibre_link-1138" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">205</a></p>
    <p class="book-title--packt">visualization layer</p>
    <p class="book-title--packt">constructing <a href="#calibre_link-1139" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">446</a>, <a href="#calibre_link-1140" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">447</a>, <a href="#calibre_link-1141" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">448</a>, <a href="#calibre_link-1142" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">449</a>, <a href="#calibre_link-1143" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">450</a></p>
    <p class="book-title--packt">visualizations, in Power BI reports</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-1144" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">230</a></p>
    <p class="book-title--packt">visualization types, in Power BI</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-1145" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">212</a></p>
    <p class="book-title--packt">visual-level filters <a href="#calibre_link-1146" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">189</a></p>
    <p class="book-title--packt">W</p>
    <p class="book-title--packt">waterfall chart visual <a href="#calibre_link-1147" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">210</a>, <a href="#calibre_link-1148" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">211</a></p>
    <p class="book-title--packt">Web URL <a href="#calibre_link-1149" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">131</a></p>
    <p class="book-title--packt">Web URL conditional formatting <a href="#calibre_link-1150" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">216</a>, <a href="#calibre_link-1151" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">217</a></p>
    <p class="book-title--packt">what-if analysis</p>
    <p class="book-title--packt">forecasting with <a href="#calibre_link-1152" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">338</a>, <a href="#calibre_link-1153" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">339</a>, <a href="#calibre_link-1154" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">340</a>, <a href="#calibre_link-1155" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">341</a>, <a href="#calibre_link-1156" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">342</a>, <a href="#calibre_link-1157" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">343</a>, <a href="#calibre_link-1158" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">344</a>, <a href="#calibre_link-1159" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">345</a>, <a href="#calibre_link-1160" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">346</a>, <a href="#calibre_link-1161" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">347</a>, <a href="#calibre_link-1162" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">348</a></p>
    <p class="book-title--packt">what-if parameters, using to visualizing variables</p>
    <p class="book-title--packt">reference link <a href="#calibre_link-1163" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">348</a></p>
    <p class="book-title--packt">workspaces</p>
    <p class="book-title--packt">configuring <a href="#calibre_link-1164" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">539</a>, <a href="#calibre_link-1165" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">540</a>, <a href="#calibre_link-1166" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">541</a>, <a href="#calibre_link-1167" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">542</a>, <a href="#calibre_link-1168" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">543</a>, <a href="#calibre_link-1169" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1">544</a></p>
<p class="eop"></p>

    <h1 class="heading">Download a free PDF copy of this book</h1>
<p class="book-title--packt">Thanks for purchasing this book!</p>
<p class="book-title--packt">Do you like to read on the go but are unable to carry your print books everywhere? Is your eBook purchase not compatible with the device of your choice?</p>
<p class="book-title--packt">Donât worry, now with every Packt book you get a DRM-free PDF version of that book at no cost.</p>
<p class="book-title--packt">Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into your application.</p>
<p class="book-title--packt">The perks donât stop there, you can get exclusive access to discounts, newsletters, and great free content in your inbox daily</p>
<p class="book-title--packt">Follow these simple steps to get the benefits:</p>
    <ol class="calibre9">
      <li class="calibre12">Scan the QR code or visit the link below
      <figure class="mediaobject"><img src="images/000218.png" alt="" class="calibre14" /></figure>
<p class="normal"><a href="https://packt.link/free-ebook/9781801813044" class="calibre6 pcalibre pcalibre2 pcalibre3 pcalibre1"><span class="url">https://packt.link/free-ebook/9781801813044</span></a></p></li>
      <li class="calibre12">Submit your proof of purchase</li>
      <li class="calibre12">Thatâs it! Weâll send your free PDF and other benefits to your email directly</li>
    </ol>
  </div>

</div>
</div>
</div>


</body></html>